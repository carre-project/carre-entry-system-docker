function sidebarDirective(){return{templateUrl:"app/components/sidebar/sidebar.html",restrict:"E",replace:!0,scope:{},controllerAs:"sidebar",controller:["$rootScope","$scope","$state",function(e,t,r){function i(e){return a.indexOf(e.substring(0,e.lastIndexOf(".")))>=0}var a=[];angular.forEach(angular.element("#carreElements > ul.nav.nav-second-level > li > a"),function(e){a.push(angular.element(e).attr("ui-sref-active-if"))}),e.$on("$stateChangeSuccess",function(e,r,a,s,n,o){t.carreElements=i(r.name)}),t.carreElements=i(r.current.name),t.slideWidth=window.innerWidth>730?.4*window.innerWidth:.9*window.innerWidth,$(window).resize(function(){t.showAbout&&(t.slideWidth=window.innerWidth>730?.4*window.innerWidth:.9*window.innerWidth,t.slideWidth=window.innerWidth>730?.4*window.innerWidth:.9*window.innerWidth,t.$apply(function(){t.showAbout=!1}),t.$apply(function(){t.showAbout=!0}))})}]}}!function(){"use strict";angular.module("CarreEntrySystem",["ngAnimate","ngCookies","angular-loading-bar","ngTouch","ngSanitize","ngMessages","ui.router","ui.bootstrap","toastr","cgBusy","ui.grid","ui.grid.cellNav","ui.grid.edit","ui.grid.selection","ui.grid.resizeColumns","ui.grid.pinning","ui.grid.moveColumns","ui.grid.exporter","ui.grid.grouping","ui.grid.pagination","ui.grid.autoResize","ui.select","pageslide-directive","toggle-switch","chart.js","oitozero.ngSweetAlert","permission","angular-intro","rzModule"])}(),function(){"use strict";function e(e,t,r,i,a,s){function n(){l.id?s.go("^.view",{id:l.id}):s.go("^.list")}function o(r){l.gridLoading=t.risk_evidences(r).then(function(t){t.data?(l.mygrid.data=t.data,l.res=t,l.mygrid.columnDefs=[],l.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_evidences.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button></div>',width:60}),e.fields(t.fields,c).forEach(function(e){l.mygrid.columnDefs.push(e)}),l.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})):(l.mygrid.columnDefs=[],l.mygrid.data=[])})}var l=i;if(l.id=s.params.id,s.includes("**.create"))l.mode="create";else if(l.id)if(s.includes("**.view"))l.mode="view",o(l.id);else{if(!s.includes("**.edit"))return void s.go("404_error");l.mode="edit"}i.$on("risk_factor:save",n),i.$on("risk_factor:cancel",n);var c=["has_risk_factor","has_observable_condition_text","has_risk_evidence_ratio_value"];l.mygrid=e["default"]}e.$inject=["content","Risk_factors","uiGridGroupingConstants","$scope","uiGridConstants","$state"],angular.module("CarreEntrySystem").controller("risk_factorsSingleController",e)}(),angular.module("CarreEntrySystem").directive("riskFactorForm",function(){return{templateUrl:"app/pages/risk_factors/form_component/form.html",restrict:"E",replace:!0,scope:{model:"="},controller:["$scope","Observables","Bioportal","Risk_elements","Risk_factors","Auth","toastr",function(e,t,r,i,a,s,n){e.model=e.model||{},i.get().then(function(t){e.risk_elements=t.data.map(function(e){return{value:e.id,label:e.has_risk_element_name_label}})}),e.types=[{label:"is an issue in",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_is_an_issue_in"},{label:"causes",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_causes"},{label:"reduces",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_reduces"},{label:"elevates",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_elevates"}],e.saveModel=function(){a.save(e.model,e.risk_factor).then(function(t){e.$emit("risk_factor:save"),n.success("<b> Risk factor</b>"+(e.model.id?" has been updated":" has been created"),"<h4>Risk factor saved</h4>")})},e.cancelForm=function(){e.$emit("risk_factor:cancel")},e.model.id?e.risk_factor={source:e.model.has_risk_factor_source[0],target:e.model.has_risk_factor_target[0],type:e.model.has_risk_factor_association_type[0]}:e.risk_factor={source:"",target:"",type:""}}]}}),function(){"use strict";function e(e,t,r){function i(){a.id?e.go("^.view",{id:a.id}):e.go("^.list")}var a=t;if(a.id=e.params.id,a.pubmedId=e.params.pubmedId,e.is("main.risk_evidences.createWithId"))a.pubmedId?r.search("citation",a.pubmedId).then(function(e){a.create=!0,e.data=e.data||[],e.data.length>0?(a.current={pubmedId:a.pubmedId,citation:e.data[0].id},a.mode="create"):(a.current={pubmedId:a.pubmedId},a.mode="create")}):e.go("main.risk_evidences.create",{},{reload:!0});else if(e.includes("**.create"))a.mode="create";else if(a.id)if(e.includes("**.view"))a.mode="view";else{if(!e.includes("**.edit"))return void e.go("404_error");a.mode="edit"}t.$on("risk_evidence:save",i),t.$on("risk_evidence:cancel",i)}e.$inject=["$state","$scope","CARRE"],angular.module("CarreEntrySystem").controller("risk_evidencesSingleController",e)}(),angular.module("CarreEntrySystem").directive("riskEvidenceForm",function(){return{templateUrl:"app/pages/risk_evidences/form_component/form.html",restrict:"E",replace:!0,scope:{model:"="},controller:["$rootScope","$scope","$state","$stateParams","Citations","Observables","Bioportal","Risk_factors","Risk_evidences","toastr","$timeout","Measurement_types","$q",function(e,t,r,i,a,s,n,o,l,c,d,u,m){function p(){t.showPubmed=!1,d(function(){t.showPubmed=!0,_()},200)}function _(){d(function(){t.risk_evidence.evidence_source=t.CIbyPMID(t.citations,t.risk_evidence.pubmedId)},0)}function h(e){if(!t.observables)return"";if(!e)return"";for(var r="(",i=0;i<e.rules.length;i++)i>0&&(r+=" <b>"+e.operator+"</b> "),r+=e.rules[i].group?h(e.rules[i].group):g(e.rules[i].field)+" "+e.rules[i].condition+" "+e.rules[i].data;return r+")"}function f(e){if(!t.observables)return"";if(!e)return"";for(var r="(",i=0;i<e.rules.length;i++)i>0&&(r+=" "+e.operator+" "),r+=e.rules[i].group?h(e.rules[i].group):e.rules[i].field+" "+e.rules[i].condition+" "+e.rules[i].data;return r+")"}function g(e){if(!e)return"";if(t.observables){var r=t.observables.filter(function(t){return t.value===e});return r.length>0?"<a href='/observables/"+e+"'>"+r[0].label+"</a>":""}}function v(e){return e.substr(1,e.length-2)}function b(e){e.condition?(delete e.hiddenData,delete e.datatype,delete e.unit_label,delete e.dataoptions,delete e.unit):e.group.rules&&e.group.rules.forEach(function(e){b(e)})}t.copyModel={},angular.copy(t.model,t.copyModel),t.showLeEditor=!1,t.model=t.model||{},t.bioportalAutocompleteResults=[],t.$on("citation:save",function(e){t.showAddCitation=!1,a.get().then(function(e){t.citations=e.data.map(function(e){var t=[];return e.has_citation_summary_label&&(t=e.has_citation_summary_label.split(".")),{value:e.id||"",pubmed:e.has_citation_pubmed_identifier[0]||"",title:t[1]||"",authors:t[0]||"",date:t[2]||""}}),_()})}),t.model.id?(t.risk_evidence={observables:[],ratio_type:t.model.has_risk_evidence_ratio_type?t.model.has_risk_evidence_ratio_type[0]:"",ratio_value:t.model.has_risk_evidence_ratio_value?parseFloat(t.model.has_risk_evidence_ratio_value[0]):0,confidence_interval_min:t.model.has_confidence_interval_min?parseFloat(t.model.has_confidence_interval_min[0]):0,confidence_interval_max:t.model.has_confidence_interval_max?parseFloat(t.model.has_confidence_interval_max[0]):0,risk_factor:t.model.has_risk_factor[0],pubmedId:t.model.has_risk_evidence_source_label,evidence_source:t.model.has_risk_evidence_source[0],condition:t.model.has_observable_condition,condition_json:angular.fromJson(t.model.has_observable_condition_json[0]),condition_text:"",adjusted_for:[]},t.filter=t.risk_evidence.condition_json||{group:{operator:"AND",rules:[]}}):(t.filter={group:{operator:"AND",rules:[]}},t.risk_evidence={observables:[],pubmedId:t.model.pubmedId||"",evidence_source:t.model.citation||"",risk_factor:"",condition_text:"",adjusted_for:[]}),t.adjusted_for=[],m.all([s.get(),u.get()]).then(function(e){var r=[];t.observables=e[0].data.map(function(e){var i={value:e.id_label,id:e.id,label:e.has_observable_name_label,metype_label:e.has_observable_measurement_type_label,metype_id:e.has_observable_measurement_type[0]};return t.model.id&&t.model.has_risk_evidence_observable.indexOf(e.id)>=0&&r.push(e.id),i}),t.risk_evidence.observables=r,t.output=v(h(t.filter.group)),t.metypes=e[1].data,t.showLeEditor=!0}),l.adjusted_for().then(function(e){t.adjusted_for=e,t.model.is_adjusted_for instanceof Array&&(t.risk_evidence.adjusted_for=t.model.is_adjusted_for[0].split(",").map(function(e){return e.trim().toLocaleLowerCase()}))}),o.get().then(function(e){t.risk_factors=e.data.map(function(e){return{value:e.id,label:e.has_risk_factor_source_label+" ["+e.has_risk_factor_association_type_label+"] "+e.has_risk_factor_target_label}})}),a.get().then(function(e){t.citations=e.data.map(function(e){var t=[];return e.has_citation_summary_label&&(t=e.has_citation_summary_label.split(".")),{value:e.id||"",pubmed:e.has_citation_pubmed_identifier[0]||"",title:t[1]||"",authors:t[0]||"",date:t[2]||""}}),_()}),t.ratiotypes=[{label:"Hazard ratio",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_hazard_ratio"},{label:"Odds ratio",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_odds_ratio"},{label:"Relative risk",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_relative_risk"},{label:"Risk ratio",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_risk_ratio"}],t.saveModel=function(){t.risk_evidence.condition_text=t.output.replace(/<\/?[a-z][a-z0-9]*[^>]*>/gi,"").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">");var e={};angular.copy(t.filter,e),b(e),t.risk_evidence.condition_json=angular.toJson(e).toString().replace(/"/g,'\\"'),l.save(t.model,t.risk_evidence).then(function(e){t.$emit("risk_evidence:save"),c.success("<b>"+t.risk_evidence.pubmedId+"</b>"+(t.model.id?" has been updated":" has been created"),"<h4>Risk evidence saved</h4>")})},t.cancelForm=function(){t.$emit("risk_evidence:cancel")},t.loadPubmed=p,t.viewPubmed=function(e,r){t.risk_evidence.pubmedId=e.pubmed,p()},t.CIbyPMID=function(e,t){return e&&t?e.filter(function(e){return e.pubmed===t}).map(function(e){return e.value})[0]:null},t.$watch("filter",function(e){t.risk_evidence.condition_json=e,t.output=v(h(e.group,0,{})),t.risk_evidence.condition=v(f(e.group,0,{}))},!0),p()}]}}),function(){"use strict";function e(e,t){function r(){i.id?t.go("^.view",{id:i.id}):t.go("^.list")}var i=e;if(i.id=t.params.id,t.includes("**.create"))i.mode="create";else if(i.id)if(t.includes("**.view"))i.mode="view";else{if(!t.includes("**.edit"))return void t.go("404_error");i.mode="edit"}e.$on("risk_element:save",r),e.$on("risk_element:cancel",r)}e.$inject=["$scope","$state"],angular.module("CarreEntrySystem").controller("risk_elementsSingleController",e)}(),angular.module("CarreEntrySystem").directive("riskElementForm",function(){return{templateUrl:"app/pages/risk_elements/form_component/form.html",restrict:"E",replace:!0,scope:{model:"="},controller:["$scope","Observables","Bioportal","Risk_elements","Auth","toastr",function(e,t,r,i,a,s){e.model=e.model||{},e.bioportalAutocompleteResults=[],t.get().then(function(t){var r=[];e.observables=t.data.map(function(t){var i={value:t.id,label:t.has_observable_name_label};return e.model.id&&e.model.has_risk_element_observable&&e.model.has_risk_element_observable.indexOf(t.id)>=0&&r.push(i.value),i}),e.risk_element.observables=r}),i.get().then(function(t){var r=[];e.risk_elements=t.data.map(function(t){var i={value:t.id,label:t.has_risk_element_name_label};return e.model.id&&e.model.includes_risk_element&&e.model.includes_risk_element.indexOf(t.id)>=0&&r.push(i.value),i}),e.risk_element.risk_elements=r}),e.types=[{label:"behavioural",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_behavioural"},{label:"biomedical",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_biomedical"},{label:"demographic",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_demographic"},{label:"intervention",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_intervention"},{label:"genetic",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_genetic"},{label:"environmental",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_environmental"}],e.bioportalAutocomplete=function(t){return t.length<2?!1:(e.loadingElementIdentifier=!0,void r.fetch(t).then(function(t){e.bioportalAutocompleteResults=t,e.loadingElementIdentifier=!1}))},e.saveModel=function(){i.save(e.model,e.risk_element).then(function(t){e.$emit("risk_element:save"),s.success("<b>"+e.risk_element.name+"</b>"+(e.model.id?" has been updated":" has been created"),"<h4>Risk element saved</h4>")})},e.cancelForm=function(){e.$emit("risk_element:cancel")},e.model.id?(e.risk_element={observables:[],risk_elements:[],type:e.model.has_risk_element_type[0],name:e.model.has_risk_element_name_label,identifier:e.model.has_risk_element_identifier_label,modifiable_status:e.model.has_risk_element_modifiable_status_label},e.bioportalAutocomplete(e.risk_element.identifier)):e.risk_element={observables:[],risk_elements:[],type:"",name:"",identifier:"",modifiable_status:""}}]}}),function(){"use strict";function e(e,t){function r(){i.id?t.go("^.view",{id:i.id}):t.go("^.list")}var i=e;if(i.id=t.params.id,t.includes("**.create"))i.mode="create";else if(i.id)if(t.includes("**.view"))i.mode="view";else{if(!t.includes("**.edit"))return void t.go("404_error");i.mode="edit"}e.$on("observable:save",r),e.$on("observable:cancel",r)}e.$inject=["$scope","$state"],angular.module("CarreEntrySystem").controller("observablesSingleController",e)}(),angular.module("CarreEntrySystem").directive("observableForm",function(){return{templateUrl:"app/pages/observables/form_component/form.html",restrict:"E",replace:!0,scope:{model:"="},controller:["$scope","Observables","Bioportal","Measurement_types","Auth","toastr","CONFIG",function(e,t,r,i,a,s,n){e.model=e.model||{},i.get().then(function(t){e.measurement_types=t.data.map(function(e){return{value:e.id,label:e.has_measurement_type_name_label}})}),e.bioportalAutocompleteResults=[],e.bioportalAutocomplete=function(t){if(t.length<2)return!1;e.loadingElementIdentifier=!0;var i={ontologies:"CMO"};r.fetch(t,i,"no cui").then(function(t){e.bioportalAutocompleteResults=t,e.loadingElementIdentifier=!1})},e.transformIndentifier=function(t){var r=t.replace(/ /g,"_").replace(/[^\w\s]/gi,"").toUpperCase();e.observable.identifier=r.length>0?"http://carre.kmi.open.ac.uk/external_observable_type/CMO_"+r:"_:blankNode"},e.transformPredicate=function(t){var r=t.toLowerCase();e.observable.predicate=r.length>0?"http://carre.kmi.open.ac.uk/ontology/sensors.owl#has_"+r:"_:blankNode"},e.types=[{label:"Personal",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#observable_type_personal"},{label:"Clinical",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#observable_type_clinical"},{label:"Other",value:"http://carre.kmi.open.ac.uk/ontology/risk.owl#observable_type_other"}],e.SensorPredicates=n.SENSOR_PREDICATES,e.saveModel=function(){t.save(e.model,e.observable).then(function(t){e.$emit("observable:save"),s.success("<b>"+e.observable.name+"</b>"+(e.model.id?" has been updated":" has been created"),"<h4>Observable saved</h4>")})},e.cancelForm=function(){e.$emit("observable:cancel")},e.model.id?(e.observable={name:e.model.has_observable_name[0],type:e.model.has_observable_type[0],measurement_type:e.model.has_observable_measurement_type[0],identifier:e.model.has_external_type?e.model.has_external_type[0]:"",predicate:e.model.has_external_predicate?e.model.has_external_predicate[0]:""},e.customPredicate=e.model.has_external_predicate?e.model.has_external_predicate_label.split("has_")[1]:"",e.bioportalAutocomplete(e.observable.identifier)):e.observable={name:"",type:"",measurement_type:"",identifier:"",predicate:""}}]}}),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){function m(e){a.get([e]).then(function(e){e.data?(p.current=e.data[0],i.fetch(p.current.has_medical_specialty_identifier_label,{ontologies:"MESH,SNOMEDCT"}).then(function(e){p.current.has_medical_specialty_label=e[0].label||"",p.current.has_medical_specialty_link=e[0].link||""}),a.countFor(p.current.has_graph_uri[0]).then(function(e){e.data.forEach(function(e){var t=h.indexOf(e.type.value.split("#")[1]+"s");p.counterchart_data[0][t]=Number(e.authored.value),p.counterchart_data[1][t]=Number(e.reviewed.value)})})):d.go("main.medical_experts.list")},function(e){d.go("main.medical_experts.list")})}var p=this,_=["Risk Factors","Risk Evidences","Risk Elements","Observables","Citations"],h=_.map(function(e){return e.toLowerCase().replace(" ","_")});p.colors=t.COLORS,p.counterchart_options={},p.counterchart_labels=_,p.counterchart_series=["Entered","Reviewed"],p.counterchart_data=[[0,0,0,0,0],[0,0,0,0,0]],p.id=o.id,p.current={},p.id&&m(p.id)}e.$inject=["toastr","CONFIG","content","Bioportal","Medical_experts","CARRE","SweetAlert","$stateParams","$timeout","Pubmed","$state","$scope"],angular.module("CarreEntrySystem").controller("medical_expertsSingleController",e)}(),function(){"use strict";function e(e,t){function r(){i.id?e.go("^.view",{id:i.id}):e.go("^.list")}var i=t;if(i.id=e.params.id,e.includes("**.create"))i.mode="create";else if(i.id)if(e.includes("**.view"))i.mode="view";else{if(!e.includes("**.edit"))return void e.go("404_error");i.mode="edit"}t.$on("measurement_type:save",r),t.$on("measurement_type:cancel",r)}e.$inject=["$state","$scope"],angular.module("CarreEntrySystem").controller("measurement_typesSingleController",e)}(),angular.module("CarreEntrySystem").directive("measurementTypeForm",function(){return{templateUrl:"app/pages/measurement_types/form_component/form.html",restrict:"E",replace:!0,scope:{model:"="},controller:["$scope","Measurement_types","toastr","Bioportal",function(e,t,r,i){e.model=e.model||{},e.datatypes=["float","enum","integer","boolean"],e.bioportalAutocompleteResults=[],e.bioportalAutocomplete=function(t){if(t.length<2)return!1;e.loadingElementIdentifier=!0;var r={ontologies:"UO"};i.fetch(t,r,"no cui").then(function(t){e.bioportalAutocompleteResults=t,e.loadingElementIdentifier=!1})},e.transformItem=function(t){var r=t.replace(/ /g,"_").replace(/[^\w\s]/gi,"").toUpperCase();e.measurement_type.identifier="http://carre.kmi.open.ac.uk/external_measurement_unit/UO_"+r},e.saveModel=function(){"enum"===e.measurement_type.datatype||"boolean"===e.measurement_type.datatype?e.measurement_type.has_enumeration_values=e.measurement_type.values.join(";"):e.measurement_type.has_enumeration_values="",delete e.measurement_type.values,t.save(e.model,e.measurement_type).then(function(t){e.$emit("measurement_type:save"),r.success("<b>"+e.measurement_type.name+"</b>"+(e.model.id?" has been updated":" has been created"),"<h4>Measurement type saved</h4>")})},e.cancelForm=function(){e.$emit("measurement_type:cancel")},e.model.id?(e.measurement_type={name:e.model.has_measurement_type_name_label,unit:e.model.has_label_label||"",datatype:e.model.has_datatype_label,identifier:e.model.has_external_unit?e.model.has_external_unit[0]:""},("enum"===e.model.has_datatype_label||"boolean"===e.model.has_datatype_label)&&(e.measurement_type.values=e.model.has_enumeration_values_label.split(";")),e.bioportalAutocomplete(e.measurement_type.identifier)):e.measurement_type={name:"",unit:"",datatype:"",values:[],identifier:""}}]}}),function(){"use strict";function e(e,t,r,i){function a(){s.id?t.go("^.view",{id:s.id}):t.go("^.list")}var s=i;if(s.id=t.params.id,t.is("main.citations.createWithId"))e.pubmedId?r.search("citation",e.pubmedId).then(function(r){s.create=!0,r.data=r.data||[],r.data.length>0?t.go("main.citations.edit",{id:r.data[0].id_label},{reload:!0}):(s.current={pubmedId:e.pubmedId},s.mode="create")}):t.go("main.citations.create",{},{reload:!0});else if(t.includes("**.create"))s.mode="create";else if(s.id)if(t.includes("**.view"))s.mode="view";else{if(!t.includes("**.edit"))return void t.go("404_error");s.mode="edit"}i.$on("citation:save",a),i.$on("citation:cancel",a)}e.$inject=["$stateParams","$state","CARRE","$scope"],angular.module("CarreEntrySystem").controller("citationsSingleController",e)}(),angular.module("CarreEntrySystem").directive("citationForm",function(){return{templateUrl:"app/pages/citations/form_component/form.html",restrict:"E",replace:!0,scope:{model:"="},controller:["$scope","Citations","Pubmed","toastr","$timeout","CONFIG",function(e,t,r,i,a,s){e.model=e.model||{},e.pubmedAutocompleteResults=[],e.noPubmed=e.model.noPubmed,e.types=[],t.types().then(function(t){e.types=t}),e.selectPubmed=function(t,r){var i=null;t.title&&(i=t.authorString+"; "+t.title+" "+t.journalTitle+" "+t.pubYear+";"+t.journalVolume+"("+t.issue+"):"+t.pageInfo+". doi:"+t.doi||"0000"),e.citation.pubmedId=t.pmid||e.citation.pubmedId,e.citation.summary=JSON.stringify(i||e.citation.summary).slice(1,-1),e.loadPubmed()},e.loadPubmed=function(){e.showPubmed=!1,a(function(){e.showPubmed=!0},200)},e.searchPubmed=function(t){return t.length<2?!1:(e.loadingElementIdentifier=!0,void r.search(t).then(function(t){e.pubmedAutocompleteResultsCount=t.count,e.pubmedAutocompleteResults=t.result.map(function(e){return e.title=e.title||"",e.authorString=e.authorString||"",e.source=e.source||"",e.pubYear=e.pubYear||"",e.pmid=e.pmid||e.id,e}),e.loadingElementIdentifier=!1,e.selectPubmed(e.pubmedAutocompleteResults[0]||{})}))},e.saveModel=function(){e.citation.type=e.citation.studyType[0],delete e.citation.studyType,t.save(e.model,e.citation).then(function(t){t&&(e.$emit("citation:save"),i.success("<b>Citation with PMID:"+e.citation.pubmedId+"</b>"+(e.model.id?" has been updated":" has been created"),"<h4>Citations saved</h4>"))},function(e){})},e.cancelForm=function(){e.$emit("citation:cancel")},e.model.id?(e.citation={type:e.model.has_citation_source_type_label||"",level:parseInt(e.model.has_citation_source_level_label)||1,summary:e.model.has_citation_summary_label||"",pubmedId:e.model.has_citation_pubmed_identifier_label||""},e.searchPubmed(e.citation.pubmedId),e.citation.studyType=[e.citation.type]):(e.citation={type:"",level:1,summary:"",pubmedId:e.model.pubmedId||""},e.citation.pubmedId&&e.searchPubmed(e.citation.pubmedId))}]}}),angular.module("CarreEntrySystem").directive("sidebarSearch",function(){return{templateUrl:"app/components/sidebar/sidebar-search/sidebar-search.html",restrict:"E",replace:!0,scope:{},controller:["$scope",function(e){e.selectedMenu="home"}]}}),angular.module("CarreEntrySystem").directive("headerNotification",["$rootScope","$timeout","$state","$location",function(e,t,r,i){return{templateUrl:"app/components/header/header-notification/header-notification.html",restrict:"E",replace:!0,link:function(t,r,a){function s(){return i.absUrl().replace("/edit","")}t.pathname=s(),e.$on("$stateChangeSuccess",function(){t.pathname=s()})}}}]),angular.module("CarreEntrySystem").service("Risk_factors",["$http","CARRE","CONFIG","QUERY",function(e,t,r,i){function a(e,r){return t.instances("risk_factor",e)}function s(e,a,s){s=s||r.currentUser.graphName;var n="",o="",l={};return a.source.length>0&&(l.has_risk_factor_source={pre:"risk",value:a.source,type:"node"}),a.target.length>0&&(l.has_risk_factor_target={pre:"risk",value:a.target.toString(),type:"node"}),a.type.length>0&&(l.has_risk_factor_association_type={pre:"risk",value:a.type.toString(),type:"node"}),t.invalidateCache("risk_factor_all"),t.invalidateCache("risk_evidence_all"),t.invalidateCache("count_all"),e.id?(n=i.update(e,l),t.query(n,"no prefix")):(o=i.insert(l,"risk_factor","RF",s),t.query(o,"no prefix"))}function n(e){e=e?e instanceof Array?e:[e]:[];var i="SELECT * FROM "+r.CARRE_DEFAULT_GRAPH+" WHERE { \n             ?subject a risk:risk_evidence; ?predicate ?object. \n             ?subject risk:has_risk_factor ?filter. \n             VALUES (?filter) { "+e.map(function(e){return"("+e.split("_")[0]+":"+e+")"}).join(" ")+" } \n              OPTIONAL {    \n               ?object a risk:citation. \n               ?object risk:has_citation_pubmed_identifier ?has_citation_pubmed_identifier  \n              } \n              OPTIONAL {    \n               ?object a risk:observable. \n               ?object risk:has_observable_name ?has_observable_name  \n               FILTER(lang(?has_observable_name)='"+r.LANG+"') \n              } \n              OPTIONAL {    \n               ?object a risk:risk_element. \n               ?object risk:has_risk_element_name ?has_risk_element_name  \n               FILTER(lang(?has_risk_element_name)='"+r.LANG+"') \n              } \n              OPTIONAL {    \n               ?object a risk:measurement_type. \n               ?object risk:has_measurement_type_name ?has_measurement_type_name  \n               FILTER(lang(?has_measurement_type_name)='"+r.LANG+"') \n              } \n              OPTIONAL {    \n               ?object a risk:risk_factor.  \n               ?object risk:has_risk_factor_association_type ?has_risk_factor_association_type. \n               ?object risk:has_risk_factor_source ?has_risk_factor_source. \n               ?object risk:has_risk_factor_target ?has_risk_factor_target. \n               ?has_risk_factor_source risk:has_risk_element_name ?has_source_risk_element_name.  \n               ?has_risk_factor_target risk:has_risk_element_name ?has_target_risk_element_name.  \n               FILTER(lang(?has_source_risk_element_name)='"+r.LANG+"') \n               FILTER(lang(?has_target_risk_element_name)='"+r.LANG+"') \n              } \n";return i+=" }",t.selectQuery(i)}return this.exports={get:a,save:s,risk_evidences:n},this.exports}]),function(){"use strict";function e(e){e.state("main.risk_factors",{"abstract":!0,templateUrl:"app/pages/risk_factors/main.html",url:"/risk_factors"}).state("main.risk_factors.list",{controller:"risk_factorsController",controllerAs:"risk_factors",templateUrl:"app/pages/risk_factors/list.html",url:""}).state("main.risk_factors.create",{templateUrl:"app/pages/risk_factors/single/single.html",controller:"risk_factorsSingleController",controllerAs:"risk_factor",url:"/create",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.risk_factors.edit",{templateUrl:"app/pages/risk_factors/single/single.html",controller:"risk_factorsSingleController",controllerAs:"risk_factor",url:"/:id/edit",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.risk_factors.view",{controller:"risk_factorsSingleController",templateUrl:"app/pages/risk_factors/single/single.html",controllerAs:"risk_factor",url:"/:id"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){var m=this,p=t("risk_factor","list"),_=[];m.gridLoading=r.get().then(function(e){_=e.data,m.mygrid.data=_,m.res=e,m.mygrid.columnDefs=[],m.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_factors.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button></div>',width:60}),i.username&&m.mygrid.columnDefs.push({field:"Edit",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_factors.edit({id:row.entity.id_label})"><i class="fa fa-edit"></i></button></div>',width:60}),u.fields(e.fields,p).forEach(function(e){m.mygrid.columnDefs.push(e)}),m.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})}),m.mygrid=u["default"]}e.$inject=["toastr","VisibleFields","Risk_factors","currentUser","CONFIG","$stateParams","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content"],angular.module("CarreEntrySystem").controller("risk_factorsController",e)}(),angular.module("CarreEntrySystem").service("Risk_evidences",["$http","CARRE","CONFIG","QUERY",function(e,t,r,i){function a(){var e="PREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \n              SELECT ?adjusted_for FROM "+r.CARRE_DEFAULT_GRAPH+" WHERE { ?subject a risk:risk_evidence; risk:is_adjusted_for ?adjusted_for}";return t.query(e,"no prefix").then(function(e){var t=[];return e.data instanceof Array&&e.data.forEach(function(e){var r=e.adjusted_for.value.split(",");r.forEach(function(e){e=e.trim().toLocaleLowerCase(),e.length>0&&-1===t.indexOf(e)&&t.push(e)})}),t})}function s(e){return t.instances("risk_evidence",e)}function n(e,a,s){s=s||r.currentUser.graphName;var n="",o="",l={};return a.observables.length>0&&(l.has_risk_evidence_observable={pre:"risk",value:a.observables,type:"node"}),a.ratio_type.length>0&&(l.has_risk_evidence_ratio_type={pre:"risk",value:a.ratio_type.toString(),type:"node"}),a.ratio_value&&(l.has_risk_evidence_ratio_value={pre:"risk",value:a.ratio_value,type:"decimal"}),a.confidence_interval_min&&(l.has_confidence_interval_min={pre:"risk",value:a.confidence_interval_min,type:"decimal"}),a.confidence_interval_max&&(l.has_confidence_interval_max={pre:"risk",value:a.confidence_interval_max,type:"decimal"}),a.risk_factor.length>0&&(l.has_risk_factor={pre:"risk",value:a.risk_factor,type:"node"}),a.evidence_source.length>0&&(l.has_risk_evidence_source={pre:"risk",value:a.evidence_source.toString(),type:"node"}),a.adjusted_for.length>0&&(l.is_adjusted_for={pre:"risk",value:a.adjusted_for.join(","),type:"string"}),a.condition.length>0&&(l.has_observable_condition={pre:"risk",value:a.condition.toString(),type:"string"},l.has_observable_condition_json={pre:"risk",value:a.condition_json.toString(),type:"string"},l.has_observable_condition_text={pre:"risk",value:a.condition_text.toString(),type:"string"}),t.invalidateCache("risk_factor_all"),t.invalidateCache("risk_evidence_all"),t.invalidateCache("count_all"),e.id?(n=i.update(e,l),t.query(n,"no prefix")):(o=i.insert(l,"risk_evidence","RV",s),t.query(o,"no prefix"))}return this.exports={get:s,adjusted_for:a,save:n},this.exports}]),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){var m=this,p=r("risk_evidence","list"),_=[];m.gridLoading=i.get().then(function(e){_=e.data,m.mygrid.data=_,m.res=e,m.mygrid.columnDefs=[],m.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_evidences.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button></div>',width:60}),t.username&&m.mygrid.columnDefs.push({field:"Edit",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_evidences.edit({id:row.entity.id_label})"><i class="fa fa-edit"></i></button></div>',width:60}),u.fields(e.fields,p).forEach(function(e){m.mygrid.columnDefs.push(e)}),m.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})}),m.mygrid=u["default"]}e.$inject=["toastr","currentUser","VisibleFields","Risk_evidences","CONFIG","$stateParams","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content"],angular.module("CarreEntrySystem").controller("risk_evidencesController",e)}(),function(){"use strict";function e(e){e.state("main.risk_evidences",{"abstract":!0,templateUrl:"app/pages/risk_evidences/main.html",url:"/risk_evidences"}).state("main.risk_evidences.list",{controller:"risk_evidencesController",controllerAs:"risk_evidences",templateUrl:"app/pages/risk_evidences/list.html",url:""}).state("main.risk_evidences.createWithId",{templateUrl:"app/pages/risk_evidences/single/single.html",
controller:"risk_evidencesSingleController",controllerAs:"risk_evidence",url:"/create/:pubmedId",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.risk_evidences.create",{templateUrl:"app/pages/risk_evidences/single/single.html",controller:"risk_evidencesSingleController",controllerAs:"risk_evidence",url:"/create",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.risk_evidences.edit",{templateUrl:"app/pages/risk_evidences/single/single.html",controller:"risk_evidencesSingleController",controllerAs:"risk_evidence",url:"/:id/edit",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.risk_evidences.view",{controller:"risk_evidencesSingleController",templateUrl:"app/pages/risk_evidences/single/single.html",controllerAs:"risk_evidence",url:"/:id"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),angular.module("CarreEntrySystem").service("Risk_elements",["$http","CARRE","CONFIG","QUERY","RdfFormatter",function(e,t,r,i,a){function s(e){return t.instances("risk_element",e)}function n(e,a,s){s=s||r.currentUser.graphName;var n="",o="",l={};return a.name.length>0&&(l.has_risk_element_name={pre:"risk",value:a.name.toString(),type:"string"}),a.identifier.length>0&&(l.has_risk_element_identifier={pre:"risk",value:"http://umls.nlm.nih.gov/sab/mth/cui/"+a.identifier.toString(),type:"node"}),a.type.length>0&&(l.has_risk_element_type={pre:"risk",value:a.type.toString(),type:"node"}),a.modifiable_status.length>0&&(l.has_risk_element_modifiable_status={pre:"risk",value:a.modifiable_status.toString(),type:"string"}),a.observables.length>0&&(l.has_risk_element_observable={pre:"risk",value:a.observables,type:"node"}),a.risk_elements.length>0&&(l.includes_risk_element={pre:"risk",value:a.risk_elements,type:"node"}),t.invalidateCache("risk"),t.invalidateCache("count_all"),e.id?(n=i.update(e,l),t.query(n,"no prefix")):(o=i.insert(l,"risk_element","RL",s),t.query(o,"no prefix"))}function o(e){var i="",a="",s=[];e?(e instanceof Array||(e=[e]),e.forEach(function(e,t){var r="";-1===e.indexOf("http")?(a=a+"_"+e,r=e.split("_")[0],e=r+":"+e):(a=a+"_"+e.substring(e.lastIndexOf("/")+1),e="<"+e+">"),e.indexOf("RL")>=0?s.push("?has_risk_factor_source="+e+"||?has_risk_factor_target="+e):e.indexOf("RF")>=0&&s.push("?subject="+e)}),i="FILTER ("+s.join("||")+")",a="risk_associations_for"+a):a="risk_associations_for_all";var n="SELECT * FROM "+r.CARRE_DEFAULT_GRAPH+" \n            WHERE { \n            ?subject a risk:risk_factor; ?predicate ?object. \n             ?subject risk:has_risk_factor_association_type ?has_risk_factor_association_type. \n             ?subject risk:has_risk_factor_source ?has_risk_factor_source. \n             ?subject risk:has_risk_factor_target ?has_risk_factor_target. \n            OPTIONAL {    \n             ?object a risk:risk_element. \n             ?object risk:has_risk_element_name ?has_risk_element_name  \n               FILTER(lang(?has_risk_element_name)='"+r.LANG+"') \n            } "+i+" }";return t.selectQuery(n,null,r.USECACHE?a:null).then(function(e){var t={nodes:[],edges:[]},r=[];return e.data.forEach(function(e){var i={label:e.has_risk_factor_source_label,id:e.has_risk_factor_source[0],value:1},a={label:e.has_risk_factor_target_label,id:e.has_risk_factor_target[0],value:1},s={label:e.has_risk_factor_association_type_label,id:e.id},n=r.indexOf(i.id);-1===n?(r.push(i.id),t.nodes.push(i)):t.nodes[n].value++;var o=r.indexOf(a.id);-1===o?(r.push(a.id),t.nodes.push(a)):t.nodes[o].value++,t.edges.push({id:s.id,from:i.id,label:s.label,to:a.id})}),t})}return this.exports={get:s,save:n,associations:o},this.exports}]),function(){"use strict";function e(e){e.state("main.risk_elements",{"abstract":!0,templateUrl:"app/pages/risk_elements/main.html",controller:"risk_elementsController",controllerAs:"risk_elements",url:"/risk_elements"}).state("main.risk_elements.list",{templateUrl:"app/pages/risk_elements/list.html",controller:"risk_elementsController",controllerAs:"risk_elements",url:""}).state("main.risk_elements.create",{templateUrl:"app/pages/risk_elements/single/single.html",controller:"risk_elementsSingleController",controllerAs:"risk_element",url:"/create",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.risk_elements.view",{templateUrl:"app/pages/risk_elements/single/single.html",controller:"risk_elementsSingleController",controllerAs:"risk_element",url:"/:id"}).state("main.risk_elements.edit",{templateUrl:"app/pages/risk_elements/single/single.html",controller:"risk_elementsSingleController",controllerAs:"risk_element",url:"/:id/edit",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){var m=this,p=u("risk_element","list"),_=[];m.gridLoading=r.get().then(function(e){_=e.data,m.mygrid.data=_,m.res=e,m.mygrid.columnDefs=[],m.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_elements.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button></div>',width:60}),t.username&&m.mygrid.columnDefs.push({field:"Edit",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.risk_elements.edit({id:row.entity.id_label})"><i class="fa fa-edit"></i></button></div>',width:60}),d.fields(e.fields,p).forEach(function(e){m.mygrid.columnDefs.push(e)}),m.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})}),m.mygrid=d["default"]}e.$inject=["toastr","currentUser","Risk_elements","$stateParams","CONFIG","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content","VisibleFields"],angular.module("CarreEntrySystem").controller("risk_elementsController",e)}(),angular.module("CarreEntrySystem").service("Observables",["$http","CARRE","CONFIG","QUERY",function(e,t,r,i){function a(e){return t.instances("observable",e)}function s(e,a,s){s=s||r.currentUser.graphName;var n="",o="",l={};return a.name.length>0&&(l.has_observable_name={pre:"risk",value:a.name.toString(),type:"string"}),a.type.length>0&&(l.has_observable_type={pre:"risk",value:a.type.toString(),type:"node"}),a.measurement_type.length>0&&(l.has_observable_measurement_type={pre:"risk",value:a.measurement_type.toString(),type:"node"}),a.identifier.length>0&&(l.has_external_type={pre:"risk",value:a.identifier.toString(),type:"node"}),a.predicate.length>0&&(l.has_external_predicate={pre:"risk",value:a.predicate.toString(),type:"node"}),t.invalidateCache("observable_all"),t.invalidateCache("count_all"),e.id?(n=i.update(e,l),t.query(n,"no prefix")):(o=i.insert(l,"observable","OB",s),t.query(o,"no prefix"))}return this.exports={get:a,save:s},this.exports}]),function(){"use strict";function e(e){e.state("main.observables",{"abstract":!0,templateUrl:"app/pages/observables/main.html",url:"/observables"}).state("main.observables.list",{controller:"observablesController",controllerAs:"observables",templateUrl:"app/pages/observables/list.html",url:""}).state("main.observables.create",{templateUrl:"app/pages/observables/single/single.html",controller:"observablesSingleController",controllerAs:"observable",url:"/create",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.observables.edit",{templateUrl:"app/pages/observables/single/single.html",controller:"observablesSingleController",controllerAs:"observable",url:"/:id/edit",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.observables.view",{controller:"observablesSingleController",templateUrl:"app/pages/observables/single/single.html",controllerAs:"observable",url:"/:id"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){var m=this,p=u("observable","list"),_=[];m.gridLoading=r.get().then(function(e){_=e.data,m.mygrid.data=_,m.res=e,m.mygrid.columnDefs=[],m.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.observables.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button></div>',width:60}),t.username&&m.mygrid.columnDefs.push({field:"Edit",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.observables.edit({id:row.entity.id_label})"><i class="fa fa-edit"></i></button></div>',width:60}),d.fields(e.fields,p).forEach(function(e){m.mygrid.columnDefs.push(e)}),m.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})}),m.mygrid=d["default"]}e.$inject=["toastr","currentUser","Observables","CONFIG","$stateParams","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content","VisibleFields"],angular.module("CarreEntrySystem").controller("observablesController",e)}(),function(){"use strict";angular.module("CarreEntrySystem").service("Medical_experts",["$http","CARRE","CONFIG","$q",function(e,t,r,i){function a(e){return e?t.instances("medical_expert",e):r.medical_experts.cache?i(function(e,t){e(r.medical_experts.cache),t()}):t.instances("medical_expert",e).then(function(e){return r.medical_experts.cache=e,e})}function s(e){var i="SELECT ?type (COUNT(?item_authored) AS ?authored) (COUNT(?item_reviewed) AS ?reviewed) \n    FROM "+r.CARRE_DEFAULT_GRAPH+" WHERE { \n    {?item_authored risk:has_author ?user; a ?type } UNION {?item_reviewed risk:has_reviewer ?user; a ?type} \n    ";return i+=e?"FILTER ( ?user=<"+e+">) }":"}",t.query(i)}function n(e,i,a){a=a||r.currentUser.graphName;var s="",n="",o={};return i.name.length>0&&(o.has_risk_element_name={pre:"risk",value:i.name.toString(),type:"string"}),i.identifier.length>0&&(o.has_risk_element_identifier={pre:"risk",value:"http://umls.nlm.nih.gov/sab/mth/cui/"+i.identifier.toString(),type:"node"}),i.type.length>0&&(o.has_risk_element_type={pre:"risk",value:i.type.toString(),type:"node"}),i.modifiable_status.length>0&&(o.has_risk_element_modifiable_status={pre:"risk",value:i.modifiable_status.toString(),type:"string"}),i.observables.length>0&&(o.has_risk_element_observable={pre:"risk",value:i.observables,type:"node"}),i.risk_elements.length>0&&(o.includes_risk_element={pre:"risk",value:i.risk_elements,type:"node"}),t.invalidateCache("risk"),t.invalidateCache("count_all"),e.id?(s=QUERY.update(e,o),t.query(s,"no prefix")):(n=QUERY.insert(o,"risk_element","RL",a),t.query(n,"no prefix"))}return this.exports={get:a,countFor:s,saveProfile:n},r.medical_experts=r.medical_experts||{},this.exports}])}(),function(){"use strict";function e(e){e.state("main.medical_experts",{"abstract":!0,templateUrl:"app/pages/medical_experts/main.html",url:"/medical_experts"}).state("main.medical_experts.list",{controller:"medical_expertsController",controllerAs:"medical_experts",templateUrl:"app/pages/medical_experts/list.html",url:""}).state("main.medical_experts.view",{controller:"medical_expertsSingleController",templateUrl:"app/pages/medical_experts/single/view.html",controllerAs:"medical_expert",url:"/:id"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d){var u=this;u.gridLoading=r.get().then(function(e){u.users=e.data,u.res=e})}e.$inject=["Bioportal","toastr","Medical_experts","CONFIG","$stateParams","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content"],angular.module("CarreEntrySystem").controller("medical_expertsController",e)}(),angular.module("CarreEntrySystem").service("Measurement_types",["$http","CARRE","CONFIG","QUERY",function(e,t,r,i){function a(e){return t.instances("measurement_type",e)}function s(e,a,s){s=s||r.currentUser.graphName;var n="",o="",l={};return a.name.length>0&&(l.has_measurement_type_name={pre:"risk",value:a.name.toString(),type:"string"}),a.unit.length>0&&(l.has_label={pre:"risk",value:a.unit.toString(),type:"string"}),a.datatype.length>0&&(l.has_datatype={pre:"risk",value:a.datatype.toString(),type:"string"}),a.has_enumeration_values.length>0&&(l.has_enumeration_values={pre:"risk",value:a.has_enumeration_values.toString(),type:"string"}),a.identifier.length>0&&(l.has_external_unit={pre:"risk",value:a.identifier.toString(),type:"node"}),t.invalidateCache("measurement_type_all"),t.invalidateCache("count_all"),e.id?(n=i.update(e,l),t.query(n,"no prefix")):(o=i.insert(l,"measurement_type","ME",s),t.query(o,"no prefix"))}return this.exports={get:a,save:s},this.exports}]),function(){"use strict";function e(e){e.state("main.measurement_types",{"abstract":!0,templateUrl:"app/pages/measurement_types/main.html",url:"/measurement_types"}).state("main.measurement_types.list",{controller:"measurement_typesController",controllerAs:"measurement_types",templateUrl:"app/pages/measurement_types/list.html",url:""}).state("main.measurement_types.create",{templateUrl:"app/pages/measurement_types/single/single.html",controller:"measurement_typesSingleController",controllerAs:"measurement_type",url:"/create",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.measurement_types.edit",{templateUrl:"app/pages/measurement_types/single/single.html",controller:"measurement_typesSingleController",controllerAs:"measurement_type",url:"/:id/edit",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.measurement_types.view",{controller:"measurement_typesSingleController",templateUrl:"app/pages/measurement_types/single/single.html",controllerAs:"measurement_type",url:"/:id"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){var m=this,p=u("measurement_type","list"),_=[];m.gridLoading=r.get().then(function(e){_=e.data,m.mygrid.data=_,m.res=e,m.mygrid.columnDefs=[],m.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.measurement_types.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button></div>',width:60}),t.username&&m.mygrid.columnDefs.push({field:"Edit",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.measurement_types.edit({id:row.entity.id_label})"><i class="fa fa-edit"></i></button></div>',width:60}),d.fields(e.fields,p).forEach(function(e){m.mygrid.columnDefs.push(e)}),m.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})}),m.mygrid=d["default"]}e.$inject=["toastr","currentUser","Measurement_types","CONFIG","$stateParams","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content","VisibleFields"],angular.module("CarreEntrySystem").controller("measurement_typesController",e)}(),angular.module("CarreEntrySystem").service("GRAPH",["CONFIG","CARRE","RdfFormatter",function(e,t,r){function i(e,t,r,i){r=r||"id",i&&(t=t[i]);for(var a=0;a<e.length;a++)if(t===e[a][r])return a;return-1}function a(e){if(!e||0===e.length)return"";var t=e.map(function(e){return isNaN(e.rv_ratio_value)?1:parseFloat(e.rv_ratio_value)}).sort();return": "+(1===t.length?t[0]:t[0]+"..."+t[t.length-1])}function s(e){return e.substring(e.lastIndexOf("risk_evidence_ratio_type_")+25).replace("_"," ")}function n(i,a){a=a||"risk_evidence";var s="",n="",o=[];i?(i instanceof Array||(i=[i]),i.forEach(function(e,t){var r="";-1===e.indexOf("http")?(n=n+"_"+e,r=e.split("_")[0],e=r+":"+e):(n=n+"_"+e.substring(e.lastIndexOf("/")+1),e="<"+e+">"),e.indexOf("RL")>=0?o.push("?has_risk_factor_source="+e+"||?has_risk_factor_target="+e):e.indexOf("RF")>=0?o.push("?risk_factor="+e):e.indexOf("RV")>=0?o.push("?has_risk_evidence="+e):e.indexOf("OB")>=0&&o.push("?has_risk_evidence_observable="+e)}),s="FILTER ("+o.join("||")+")",n="risk_associations_for"+n):n="risk_associations_for_all";var l="SELECT * FROM "+e.CARRE_DEFAULT_GRAPH+" \n            WHERE { \n            ?risk_factor a risk:risk_factor. \n            ?risk_factor risk:has_risk_factor_association_type ?has_risk_factor_association_type. \n            ?risk_factor risk:has_risk_factor_source ?has_risk_factor_source. \n            ?risk_factor risk:has_risk_factor_target ?has_risk_factor_target. \n            ?has_risk_factor_source risk:has_risk_element_name ?has_risk_source_element_name. \n            ?has_risk_factor_target risk:has_risk_element_name ?has_risk_target_element_name. \n            ?has_risk_evidence a risk:risk_evidence; \n            risk:has_risk_factor ?risk_factor; \n            risk:has_risk_evidence_ratio_value ?has_risk_evidence_ratio_value; \n            risk:has_risk_evidence_ratio_type ?has_risk_evidence_ratio_type; \n            risk:has_observable_condition_text ?has_observable_condition_text; \n            risk:has_risk_evidence_observable ?has_risk_evidence_observable. \n            ?has_risk_evidence_observable risk:has_observable_name ?has_risk_evidence_observable_name. \n            # language filters \n            FILTER(lang(?has_risk_source_element_name)='"+e.LANG+"') \n            FILTER(lang(?has_risk_target_element_name)='"+e.LANG+"') \n            FILTER(lang(?has_risk_evidence_observable_name)='"+e.LANG+"') \n            "+s+" }";return t.selectQuery(l,"raw",e.USECACHE?n:null).then(function(e){var t=e.data.reduce(function(e,t){var r=e.valueProp,i=t.risk_factor[r].substring(t.risk_factor[r].lastIndexOf("/")+1),a={rf_id:t.risk_factor[r],rf_type:t.has_risk_factor_association_type[r],rf_source_id:t.has_risk_factor_source[r],rf_source_label:t.has_risk_source_element_name[r],rf_target_id:t.has_risk_factor_target[r],rf_target_label:t.has_risk_target_element_name[r],rf_evidences:[]},s=i+"_"+t.has_risk_evidence[r].substring(t.has_risk_evidence[r].lastIndexOf("/")+1),n={rv_id:t.has_risk_evidence[r],rv_observable_condition:t.has_observable_condition_text[r],rv_ratio_value:t.has_risk_evidence_ratio_value[r],rv_ratio_type:t.has_risk_evidence_ratio_type[r],rv_observables:[]},o={ob_id:t.has_risk_evidence_observable[r],ob_label:t.has_risk_evidence_observable_name[r]},l=e.index[i],c=e.index[s];return l||0===l?c||0===c?e.data[l].rf_evidences[c].rv_observables.push(o):(n.rv_observables.push(o),e.data[l].rf_evidences.push(n),e.index[s]=e.data[l].rf_evidences.indexOf(n)):(n.rv_observables.push(o),a.rf_evidences.push(n),e.data.push(a),e.index[s]=0,e.index[i]=e.data.indexOf(a)),e},{data:[],index:{},valueProp:"value"}),i={nodes:[],edges:[]},s=[];return t.data.forEach(function(e){var t={label:e.rf_source_label,id:e.rf_source_id,connections:0},n={label:e.rf_target_label,id:e.rf_target_id,connections:0},o={label:r.translate(e.rf_type),id:e.rf_id,evidences:e.rf_evidences},l=s.indexOf(t.id);-1===l?(s.push(t.id),i.nodes.push(t)):i.nodes[l].connections++;var c=s.indexOf(n.id);-1===c?(s.push(n.id),i.nodes.push(n)):i.nodes[c].connections++,"risk_factor"===a?i.edges.push({id:o.id,source:t.id,target:n.id,from:t.id,label:o.label,to:n.id,evidences:o.evidences}):o.evidences.forEach(function(e){var r=isNaN(e.rv_ratio_value)?1:parseFloat(e.rv_ratio_value);i.edges.push({risk_factor:o.id,id:e.rv_id,source:t.id,target:n.id,from:t.id,label:o.label,to:n.id,ratio:r,ratio_type:e.rv_ratio_type,observables:e.rv_observables})})}),i})}return this.exports={network:n,FindIndex:i,ratioMinMax:a,ratioType:s},this.exports}]),function(){"use strict";function e(e){e.state("main.explore",{controller:"ExploreController",controllerAs:"explore",url:"/explore",templateUrl:"app/pages/explore/index.html"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u,m){function p(e){_.risk_elements_selected.push(e),t(function(){n.refreshColors()},50)}var _=this;_.minConnections=0,_.ready=!0,_.risk_elements_selected=[],_.graph_type=a.search().graphtype||"sankey",_.setNewId=function(){_.ready=!1,t(function(){_.id=_.risk_elements_selected,_.ready=!0},100)},_.examples=[{label:"Connections between diabetes,hypertension and colorectal cancer",data:["http://carre.kmi.open.ac.uk/risk_elements/RL_29","http://carre.kmi.open.ac.uk/risk_elements/RL_19","http://carre.kmi.open.ac.uk/risk_elements/RL_14"]},{label:"How do obesity, diabetes and depression relate with each other?",data:["http://carre.kmi.open.ac.uk/risk_elements/RL_38","http://carre.kmi.open.ac.uk/risk_elements/RL_19","http://carre.kmi.open.ac.uk/risk_elements/RL_18"]},{label:"a complex one",data:["http://carre.kmi.open.ac.uk/risk_elements/RL_19","http://carre.kmi.open.ac.uk/risk_elements/RL_33","http://carre.kmi.open.ac.uk/risk_elements/RL_36","http://carre.kmi.open.ac.uk/risk_elements/RL_38","http://carre.kmi.open.ac.uk/risk_elements/RL_25"]},{label:"too complex to read",data:["http://carre.kmi.open.ac.uk/risk_elements/RL_19","http://carre.kmi.open.ac.uk/risk_elements/RL_33","http://carre.kmi.open.ac.uk/risk_elements/RL_36","http://carre.kmi.open.ac.uk/risk_elements/RL_38","http://carre.kmi.open.ac.uk/risk_elements/RL_25","http://carre.kmi.open.ac.uk/risk_elements/RL_7","http://carre.kmi.open.ac.uk/risk_elements/RL_10","http://carre.kmi.open.ac.uk/risk_elements/RL_11","http://carre.kmi.open.ac.uk/risk_elements/RL_18","http://carre.kmi.open.ac.uk/risk_elements/RL_22","http://carre.kmi.open.ac.uk/risk_elements/RL_9","http://carre.kmi.open.ac.uk/risk_elements/RL_29","http://carre.kmi.open.ac.uk/risk_elements/RL_16","http://carre.kmi.open.ac.uk/risk_elements/RL_31","http://carre.kmi.open.ac.uk/risk_elements/RL_40"]}],_.recommendPopoverUrl="recommendExampleTemplate.html",_.recommendExample=function(e,t){var r={label:e,data:_.risk_elements_selected};o.example(r)},n.refreshColors=function(){var e=angular.element(".ui-select-match-item");angular.forEach(e,function(e,t){angular.element(e).css("background",s.COLORS[t])})},n.runExample=function(e){var r=500;_.risk_elements_selected=[],e.forEach(function(e,i,a){t(function(){p(e)},i*r)}),t(function(){_.setNewId()},e.length*r)},l.get().then(function(e){_.risk_elements=e.data.map(function(e){var t={value:e.id,label:e.has_risk_element_name_label};return t})}),a.search().elements&&a.search().elementstype&&(_.risk_elements_selected=a.search().elements.split(",").map(function(e){return"http://carre.kmi.open.ac.uk/"+a.search().elementstype+"/"+e}),_.setNewId())}e.$inject=["$rootScope","$timeout","toastr","CARRE","$location","CONFIG","$scope","Email","Risk_elements","$state","$http","GRAPH","Risk_factors"],angular.module("CarreEntrySystem").controller("ExploreController",e)}(),function(){"use strict";function e(e){e.state("main.dashboard",{controller:"DashboardController",controllerAs:"dashboard",url:"/",templateUrl:"app/pages/dashboard/index.html"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o){var l=this;l.countAllInit=0,l.countAll=0,l.colors=s.COLORS,l.counterchart_labels=["Risk Factors","Risk Evidences","Risk Elements","Observables","Citations"],l.counterchart_data=[],l.counterchart_data[0]=[0,0,0,0,0],n.$on("create",function(e,r){r&&r.datasets&&r.datasets[0]&&r.datasets[0].bars.length>0?r.datasets[0].bars.map(function(e,t){return e.fillColor=l.colors[t],e.strokeColor="#FFF",e}):(o.bug({title:"chart datasets not exist",data:r.datasets[0]}),t(function(){r.datasets[0].bars.map(function(e,t){return e.fillColor=l.colors[t],e.strokeColor="#FFF",e})},200))}),i.countAll().then(function(e){var t=e.data[0];l.citations={total:Number(t.citations.value)},l.measurement_types={total:Number(t.measurement_types.value)},l.observables={total:Number(t.observables.value),noreviews:Number(t.observables_unreviewed.value)},l.risk_elements={total:Number(t.risk_elements.value),noreviews:Number(t.risk_elements_unreviewed.value)},l.risk_evidences={total:Number(t.risk_evidences.value),noreviews:Number(t.risk_evidences_unreviewed.value)},l.risk_factors={total:Number(t.risk_factors.value),noreviews:Number(t.risk_factors_unreviewed.value)},l.counterchart_data[0][0]=l.risk_factors.total,l.counterchart_data[0][1]=l.risk_evidences.total,l.counterchart_data[0][2]=l.risk_elements.total,l.counterchart_data[0][3]=l.observables.total,l.counterchart_data[0][4]=l.citations.total,l.countAll=l.citations.total+l.risk_elements.total+l.risk_factors.total+l.risk_evidences.total+l.observables.total+l.measurement_types.total,l.counterdonut_data=[l.risk_factors.total,l.risk_evidences.total,l.risk_elements.total,l.observables.total,l.citations.total],l.counterdonut_labels=l.counterchart_labels,l.counterdonut_options={}})}e.$inject=["$rootScope","$timeout","toastr","CARRE","$location","CONFIG","$scope","Email"],angular.module("CarreEntrySystem").controller("DashboardController",e)}(),angular.module("CarreEntrySystem").service("Citations",["$http","CARRE","CONFIG","QUERY",function(e,t,r,i){function a(e){return t.instances("citation",e)}function s(){var e="PREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \n              SELECT ?citationType FROM "+r.CARRE_DEFAULT_GRAPH+" WHERE { ?subject a risk:citation; risk:has_citation_source_type ?citationType}";return t.query(e,"no prefix").then(function(e){var t=[];return e.data instanceof Array&&e.data.forEach(function(e){var r=e.citationType.value;r.length>0&&-1===t.indexOf(r)&&t.push(r)}),t})}function n(e,a,s){s=s||r.currentUser.graphName;var n=o(a);t.invalidateCache("citation_all"),t.invalidateCache("count_all");var l="",c="";return e.id?(l=i.update(e,n),t.query(l,"no prefix")):(c=i.insert(n,"citation","CI",s),t.query(c,"no prefix"))}function o(e){return{has_citation_source_type:{pre:"risk",value:e.type.toString(),type:"string"},has_citation_source_level:{pre:"risk",value:e.level.toString(),type:"integer"},has_citation_summary:{pre:"risk",value:e.summary.toString(),type:"string"},has_citation_pubmed_identifier:{pre:"risk",value:e.pubmedId.toString(),type:"string"}}}return this.exports={types:s,get:a,save:n},this.exports}]),function(){"use strict";function e(e){e.state("main.citations",{"abstract":!0,templateUrl:"app/pages/citations/main.html",url:"/citations"}).state("main.citations.list",{controller:"citationsController",controllerAs:"citations",templateUrl:"app/pages/citations/list.html",url:""}).state("main.citations.createWithId",{templateUrl:"app/pages/citations/single/single.html",controller:"citationsSingleController",controllerAs:"citation",url:"/create/:pubmedId",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.citations.create",{templateUrl:"app/pages/citations/single/single.html",controller:"citationsSingleController",controllerAs:"citation",url:"/create",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.citations.edit",{templateUrl:"app/pages/citations/single/single.html",controller:"citationsSingleController",controllerAs:"citation",url:"/:id/edit",data:{permissions:{only:["authenticated_user"],redirectTo:function(e){window.location.replace(window.location.href.replace("/edit","").replace("/create",""))}}}}).state("main.citations.view",{controller:"citationsSingleController",templateUrl:"app/pages/citations/single/single.html",controllerAs:"citation",url:"/:id"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c,d,u){var m=this,p=u("citation","list"),_=[];m.gridLoading=t.get().then(function(e){_=e.data,m.mygrid.data=_,m.res=e,m.mygrid.columnDefs=[],m.mygrid.columnDefs.push({field:"View",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.citations.view({id:row.entity.id_label})"><i class="fa fa-eye"></i></button> </div>',width:70}),r.username&&m.mygrid.columnDefs.push({field:"Edit",enableFiltering:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><button type="button" class="btn btn-xs btn-primary" ui-sref="main.citations.edit({id:row.entity.id_label})"><i class="fa fa-edit"></i></button> </div>',width:60}),d.fields(e.fields,p).forEach(function(e){m.mygrid.columnDefs.push(e)}),m.mygrid.columnDefs.push({field:"id_label",displayName:"ID",visible:!1})}),m.mygrid=d["default"]}e.$inject=["toastr","Citations","currentUser","$stateParams","CONFIG","uiGridGroupingConstants","$timeout","Pubmed","uiGridConstants","$state","content","VisibleFields"],angular.module("CarreEntrySystem").controller("citationsController",e)}(),angular.module("CarreEntrySystem").directive("carreViewPubmed",["CONFIG",function(e){return{templateUrl:"app/components/view-pubmed/view-pubmed.html",restrict:"E",replace:!0,scope:{id:"@"},controller:["$scope","Pubmed",function(e,t){e.loading=t.fetch(e.id).then(function(t){e.pubmedArticle=t.data})}]}}]),angular.module("CarreEntrySystem").directive("stats",function(){return{templateUrl:"app/components/stats/stats.html",restrict:"E",replace:!0,scope:{model:"=",comments:"@",number:"@",name:"@",title:"@",color:"@",details:"@",type:"@","goto":"@"}}}),angular.module("CarreEntrySystem").directive("sidebar",sidebarDirective),angular.module("CarreEntrySystem").directive("carreLinker",["CONFIG",function(e){return{templateUrl:"app/components/linker/linker.html",restrict:"E",replace:!0,scope:{property:"@",model:"="},controller:["$scope","CONFIG","Medical_experts",function(e,t,r){e.show="label",e.items=[];var i=[],a=["has_observable_condition"],s=e.model[e.property];e.label=e.model[e.property+"_label"],"has_author"===e.property||"has_reviewer"===e.property?r.get().then(function(r){var a={};r.data.forEach(function(e){a[e.has_graph_uri_label]=e}),i=e.model[e.property+"_label_arr"],e.show="links",i.forEach(function(r){var i=a[r];e.items.push({link:("PROD"===t.ENV?"":"#/")+"medical_experts/"+i.id_label,label:i.has_firstname_label+" "+i.has_lastname_label})})}):"has_observable_condition"===e.property?(e.show="condition",e.model.has_risk_evidence_observable.forEach(function(r,i){var a=r.substr(r.lastIndexOf("/")+1),s=("PROD"===t.ENV?"":"#/")+"observables/"+a,n=e.model.has_risk_evidence_observable_label_arr[i],o="<a href="+s+">"+n+"</a>";e.label=e.label.replace(new RegExp(a,"g"),o).replace(new RegExp(">=","g"),"&ge;").replace(new RegExp("<=","g"),"&le;")})):"has_external_type"===e.property||"has_external_unit"===e.property||"has_external_predicate"===e.property?(e.show="external_link",e.external_link="<a target='_blank' href='"+e.model[e.property]+"'>"+e.model[e.property+"_label"]+"</a>"):s instanceof Array&&-1===a.indexOf(e.property)&&(i=e.model[e.property+"_label_arr"],s.forEach(function(r,a){var s=r.substr(r.lastIndexOf("/")+1),n=s.substr(0,2),o=!1;
switch(n){case"CI":o="citations/";break;case"OB":o="observables/";break;case"ME":o="measurement_types/";break;case"RF":o="risk_factors/";break;case"RL":o="risk_elements/";break;case"RV":o="risk_evidences/"}o&&(e.show="links",e.items.push({link:("PROD"===t.ENV?"":"#/")+o+s,label:i[a]}))}))}]}}]),angular.module("CarreEntrySystem").directive("leEditor",["$compile","$timeout","$q",function(e,t,r){return{restrict:"E",scope:{group:"=",observables:"=",metypes:"="},templateUrl:"app/components/le_editor/le_editor.html",compile:function(r,i){var a,s;return a=r.contents().remove(),function(r,i,n){r.operators=[{name:"AND"},{name:"OR"}],r.field={},r.conditions=[{name:"=",value:"=",types:"integer,float,enum,boolean"},{name:"<",value:"<",types:"integer,float"},{name:"",value:"<=",types:"integer,float"},{name:">",value:">",types:"integer,float"},{name:"",value:">=",types:"integer,float"}],r.getMeasurementType=function(e,i,a){a.hiddenData=!0,t(function(){var s="";if(e)s=e.metype_id,s=s.substring(s.indexOf("ME_"));else{for(var n=0;n<r.observables.length;n++)if(r.observables[n].value===i){s=r.observables[n].metype_id;break}s=s.substring(s.indexOf("ME_"))}for(var n=0;n<r.metypes.length;n++)if(r.metypes[n].id_label===s){a.datatype=r.metypes[n].has_datatype_label,a.unit=r.metypes[n].has_label_label,a.unit_label=r.metypes[n].has_measurement_type_name_label,r.metypes[n].has_enumeration_values_label&&(a.dataoptions=r.metypes[n].has_enumeration_values_label.split(";").map(function(e){return{value:e,name:e}}));break}t(function(){a.hiddenData=!a.hiddenData},400)},500)},r.addCondition=function(){r.group.rules.push({condition:"=",field:{selected:{label:""}},data:""})},r.removeCondition=function(e){r.group.rules.splice(e,1)},r.addGroup=function(){r.group.rules.push({group:{operator:"AND",rules:[]}})},r.removeGroup=function(){"group"in r.$parent&&r.$parent.group.rules.splice(r.$parent.$index,1)},s||(s=e(a)),i.append(s(r,function(e){return e}))}}}}]),angular.module("CarreEntrySystem").directive("carreHeader",function(){return{templateUrl:"app/components/header/header.html",restrict:"E",replace:!0,controllerAs:"header",controller:["$scope","$rootScope","$window",function(e,t,r){e.toggleNavbar=function(){$("div.navbar-collapse").hasClass("collapse")?$("div.navbar-collapse").removeClass("collapse"):$("div.navbar-collapse").addClass("collapse")},t.$on("$stateChangeSuccess",function(e,t,r,i,a){i!==t&&$("div.navbar-collapse").addClass("collapse")})}]}}),angular.module("CarreEntrySystem").directive("carreGraphSankeyRisk",function(){return{templateUrl:"app/components/graph-sankey/template.html",restrict:"E",scope:{limitNewConnections:"@",height:"@",riskid:"="},controller:["$scope","$timeout","toastr","CARRE","$location","CONFIG","GRAPH","content","$q",function(e,t,r,i,a,s,n,o,l){function c(e){return f.showRiskEvidences?e.ratio>=f.ratioFilter.min&&e.ratio<=f.ratioFilter.max?!0:!1:!0}function d(e,t){m(),d3.select(this).select("rect").classed("selected",!d3.select(this).classed("selected")),p(e,"node"),d3.event.stopPropagation()}function u(e,t){m(),d3.select(this).classed("selected",!d3.select(this).classed("selected")),p(e,"link"),d3.event.stopPropagation()}function m(){t(function(){f.selectedId=null},0),d3.select("#"+f.containerId+" svg").selectAll(".link").classed("selected",!1),d3.select("#"+f.containerId+" svg").selectAll(".node").select("rect").classed("selected",!1)}function p(e,r){var i=e?e.id:null;i&&(-1!==i.indexOf("/")&&(i=i.substr(i.lastIndexOf("/")+1)),t(function(){f.selectedId=i,f.selectedItem={type:r,obj:e}},0),f.showDetails&&f.alwaysOnDetails&&(t(function(){f.showDetails=!1},0),t(function(){f.showDetails=!0},100)))}function _(e){return e.substr(e.lastIndexOf("/")+1)}function h(e){var t=document.getElementById(f.containerId);return t?Number(getComputedStyle(t,null).getPropertyValue(e).replace("px","")):null}var f=e;f.loading=!1,f.containerId="sankey",f.limitNewConnections=e.limitNewConnections||30,f.minConnections=6,f.height=f.height||600,f.customHeight=0,f.alwaysOnDetails=!0,f.showRiskEvidences=!0,f.onlyCore=!1,f.ratioFilter={min:0,max:50},e.$watch("ratioFilter.min",function(e,t){e&&t&&e!==t&&f.renderSankey()}),e.$watch("ratioFilter.max",function(e,t){e&&t&&e!==t&&f.renderSankey()}),$(window).resize(function(){f.renderSankey()}),f.addSize=function(){return f.customHeight>=800?!1:(f.customHeight+=100,void t(function(){f.renderSankey()}))},f.removeSize=function(){return f.customHeight<=-300?!1:(f.customHeight-=100,void t(function(){f.renderSankey()}))},f.init=function(e){e=e||f.riskid,f.loading=n.network(e,f.showRiskEvidences?null:"risk_factor").then(function(r){f.nodesArr=e?r.nodes.map(function(t,r){var i=-1;return e instanceof Array?i=e[0].indexOf("RL_")>=0?e.indexOf(t.id):r:e[0].indexOf("RL_")>=0?e.substring(e.lastIndexOf("/")+1)===t.id.substring(t.id.lastIndexOf("/")+1)?0:-1:i=r,i>=0&&(t.color=s.COLORS[i]),t}):r.nodes.filter(function(e){return e.connections>f.minConnections}),f.edgesArr=r.edges.filter(function(e){for(var t=!1,r=!1,i=0,a=f.nodesArr.length;a>i;i++)f.nodesArr[i].id===e.from&&(t=!0),f.nodesArr[i].id===e.to&&(r=!0);return t&&r}),t(function(){f.renderSankey()},0)})},f.init(f.riskid),f.goToSelected=function(){var e,t=f.selectedItem.obj||{},r=t.id.substring(t.id.lastIndexOf("/")+1),i=f.selectedItem.type;if("node"===i)e=t.label;else{if("link"!==i)return!1;e=t.source.label+" "+t.label+" "+t.target.label}o.goTo(r,e)},f.addNodeRelations=function(){var e=f.selectedId;f.loading=n.network(e,f.showRiskEvidences?null:"risk_factor").then(function(e){var r=f.limitNewConnections,i={};e.nodes.forEach(function(e){i[e.id]=e}),e.edges.forEach(function(e){-1===n.FindIndex(f.edgesArr,e.id)&&r>0&&(-1===n.FindIndex(f.nodesArr,e.from)&&f.nodesArr.push(i[e.from]),-1===n.FindIndex(f.nodesArr,e.to)&&f.nodesArr.push(i[e.to]),f.edgesArr.push(e),r--)}),t(function(){f.renderSankey()},0)})},f.deleteSelected=function(e){if(!f.selectedItem||"node"!==f.selectedItem.type)return!1;var r=f.selectedItem.obj||{};r.sourceLinks.forEach(function(e){f.edgesArr.splice(n.FindIndex(f.edgesArr,e.id),1)}),r.targetLinks.forEach(function(e){f.edgesArr.splice(n.FindIndex(f.edgesArr,e.id),1)}),f.nodesArr=f.nodesArr.filter(function(e){return n.FindIndex(f.edgesArr,e.id,"from")+n.FindIndex(f.edgesArr,e.id,"to")>=-1}),e&&d3.event.preventDefault(),t(function(){f.renderSankey()},0)},f.renderSankey=function(){function e(e){d3.select(this).attr("transform","translate("+e.x+","+(e.y=Math.max(0,Math.min(l-e.dy,d3.event.y)))+")"),b.attr("d",v)}var t={},r={};r.nodes=f.nodesArr.map(function(e,r){return t[e.id]={index:r,value:e.value},e.name=e.label,e}),r.links=f.edgesArr.map(function(e){return f.showRiskEvidences&&(e.ratio_type=n.ratioType(e.ratio_type)),e.value=Number(e.ratio)||1,e.source=t[e.from].index,e.target=t[e.to].index,e});var i=f.customHeight+250*Math.log(r.links.length),a={top:10,right:10,bottom:10,left:10},o=h("width")-a.left-a.right,l=(i>f.height?i:f.height)-a.top-a.bottom,m="0 0 "+(angular.element(window).width()+40)+" "+(l+20);d3.format(",.0f"),d3.scale.category20b();angular.element("#"+f.containerId+" svg").remove();var p=d3.select("#"+f.containerId).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width","100%").attr("height","100%").attr("viewBox",m).append("g").attr("transform","translate("+a.left+","+a.top+")"),g=d3.sankey().nodeWidth(20).nodePadding(12).size([o,l]),v=g.link();g.nodes(r.nodes).links(r.links).layout(32);var b=p.append("g").selectAll(".link").data(r.links.filter(c)).enter().append("path").attr("id",function(e,t){return _(e.id)}).attr("class","link").attr("d",v).style("stroke",function(e,r){return f.riskid?e.source.color||"#aaaaaa":s.COLORS[t[e.source.id].index]}).style("stroke-width",function(e){return Math.max(2,e.dy)-1}).sort(function(e,t){return t.dy-e.dy});b.append("title").text(function(e){return e.source.name+" --> "+e.target.name+(f.showRiskEvidences?", "+e.ratio_type+" = "+e.ratio:", "+e.evidences.length+" evidence(s) "+n.ratioMinMax(e.evidences))});var k=p.append("g").selectAll(".node").data(r.nodes).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).call(d3.behavior.drag().origin(function(e){return e}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("dragend",function(){g.relayout()}).on("drag",e));k.append("rect").attr("height",function(e){return e.dy}).attr("width",g.nodeWidth()).style("stroke",function(e,t){return f.riskid?e.color||"#aaaaaa":s.COLORS[t]}).style("fill",function(e,t){return f.riskid?e.color||"#aaaaaa":s.COLORS[t]}).attr("data-title",function(e){return e.name}),k.append("text").attr("x",-6).attr("y",function(e){return e.dy/2}).attr("dy","0.36em").attr("text-anchor","end").attr("transform",null).text(function(e){return e.name.charAt(0).toUpperCase()+e.name.slice(1)}).filter(function(e){return e.x<o/2}).attr("x",6+g.nodeWidth()).attr("text-anchor","start"),k.on("mousedown",d),b.on("mousedown",u),k.on("dblclick",f.addNodeRelations),b.on("dblclick",f.goToSelected),k.on("contextmenu",f.deleteSelected)},angular.element("#"+f.containerId).on("mousedown",m)}]}}),angular.module("CarreEntrySystem").directive("carreGraphRisk",function(){return{templateUrl:"app/components/graph-network-vis/template.html",restrict:"E",scope:{limitNewConnections:"@",height:"@",riskid:"="},controller:["$scope","$timeout","toastr","$location","CONFIG","GRAPH","content","$q",function(e,t,r,i,a,s,n,o){var l=e;l.loading=null,l.limitNewConnections=e.limitNewConnections||4,l.minConnections=7,l.height=l.height||600,l.customHeight=0,l.alwaysOnDetails=!0,l.showRiskEvidences="risk_evidences"===i.search().elementstype?!0:!1,l.onlyCore=!1;var c;l.containerId="network";d3.scale.category20b();l.addSize=function(){l.customHeight+=100,c.setSize("100%",Number(l.height)+l.customHeight+"px"),c.redraw(),c.fit()},l.removeSize=function(){return l.customHeight<=0?!1:(l.customHeight-=100,c.setSize("100%",Number(l.height)+l.customHeight+"px"),c.redraw(),void c.fit())},l.init=function(e){e=e||l.riskid,t(function(){l.loading=o.defer()},0),s.network(e,l.showRiskEvidences?null:"risk_factor").then(function(r){l.nodesArr=e?r.nodes.map(function(t,r){var i=-1;return e instanceof Array?i=e[0].indexOf("RL_")>=0?e.indexOf(t.id):r:e[0].indexOf("RL_")>=0?e.substring(e.lastIndexOf("/")+1)===t.id.substring(t.id.lastIndexOf("/")+1)?0:-1:i=r,i>=0&&(t.color=a.COLORS[i]),t}):r.nodes.filter(function(e){return e.connections>l.minConnections}).map(function(e,t){return e.color=a.COLORS[t],e}),l.edgesArr=r.edges.filter(function(e){for(var t=!1,r=!1,i=0,a=l.nodesArr.length;a>i;i++)l.nodesArr[i].id===e.from&&(t=!0),l.nodesArr[i].id===e.to&&(r=!0);return t&&r}).map(function(t){var r=e instanceof Array?e.indexOf(t.from):null;return t.color=r>=0?a.COLORS[r]:"#aaaaaa",t}),t(function(){if(l.onlyCore&&l.riskid instanceof Array&&l.riskid.length>1){var e=[];l.startNetwork({nodes:l.nodesArr.filter(function(t){return c.getConnectedEdges(t.id).length>1||t.color?(-1===e.indexOf(t.id)&&e.push(t.id),!0):!1}),edges:l.edgesArr.filter(function(t){return e.indexOf(t.from)>=0&&e.indexOf(t.to)>=0})})}else l.startNetwork()},0)})},l.init(l.riskid),l.addNodeRelations=function(e){var e=e||l.selectedId;l.loading=s.network(e,l.showRiskEvidences?null:"risk_factor").then(function(e){var t=l.limitNewConnections,r={};e.nodes.forEach(function(e){r[e.id]=e}),e.edges.forEach(function(e){!l.edges._data[e.id]&&t>0&&(l.nodes._data[e.from]||l.nodes.add(r[e.from]),l.nodes._data[e.to]||l.nodes.add(r[e.to]),l.edges.add(e),t--)})})},l.selectElement=function(e){e?(-1!==e.indexOf("/")&&(e=e.substr(e.lastIndexOf("/")+1)),t(function(){l.selectedId=e},0),l.showDetails&&l.alwaysOnDetails&&(t(function(){l.showDetails=!1},0),t(function(){l.showDetails=!0},100))):t(function(){l.selectedId=!1},0)},l.deleteSelected=function(e){var t=e||c.getSelectedNodes()[0];if(!t)return!1;var r={nodes:[t],edges:c.getConnectedEdges(t)};l.removeOrphan(r)},l.goToSelected=function(){var e,t,r=c.getSelectedNodes(),i=c.getSelectedEdges();if(1===r.length)e=r[0].substring(r[0].lastIndexOf("/")+1),t=l.nodes._data[r[0]].label;else{if(1!==i.length)return!1;var a=l.edges._data[i[0]];e=i[0].substring(i[0].lastIndexOf("/")+1),t=l.nodes._data[a.from].label+" "+a.label+" "+l.nodes._data[a.to].label}n.goTo(e,t)},l.removeOrphan=function(e){e.nodes.forEach(function(e){l.nodes.remove(e)}),e.edges.forEach(function(e){l.edges.remove(e)});var t=Object.keys(l.nodes._data);t.forEach(function(e){var t=c.getConnectedEdges(e);t.length<=0&&l.nodes.remove(e)})},l.startNetwork=function(e){l.loading&&l.loading.promise&&1!==l.loading.promise.$$state.status||t(function(){l.loading=o.defer()},0),e=e||{},l.customHeight=0,l.edges=new vis.DataSet(e.edges||l.edgesArr),l.nodes=new vis.DataSet(e.nodes||l.nodesArr);var r=document.getElementById(l.containerId),i={nodes:l.nodes,edges:l.edges},a={autoResize:!0,height:l.height+"px",width:"100%",manipulation:{enabled:!1},configure:{enabled:!1},edges:{smooth:{enabled:!0,type:"dynamic"},arrows:"to",color:"#aaaaaa",font:{color:"#343434",size:11,face:"arial",background:"none",strokeWidth:1,strokeColor:"#ffffff"}},nodes:{color:{border:"#aaaaaa",background:"#ffffff"}},physics:{enabled:!0,barnesHut:{gravitationalConstant:-1e3,centralGravity:.1,springLength:200,springConstant:.001,damping:.09,avoidOverlap:0},forceAtlas2Based:{gravitationalConstant:-70,centralGravity:.01,springConstant:.08,springLength:100,damping:.4,avoidOverlap:1},maxVelocity:50,minVelocity:.1,solver:"barnesHut",stabilization:{enabled:!0,iterations:300,updateInterval:100,onlyDynamicEdges:!1,fit:!0},timestep:.5,adaptiveTimestep:!0}};c=new vis.Network(r,i,a),c.on("doubleClick",function(e){if(1===e.nodes.length)l.addNodeRelations(e.nodes[0]);else if(1===e.edges.length){var t=l.edges._data[e.edges[0]],r=e.edges[0].substring(e.edges[0].lastIndexOf("/")+1),i=l.nodes._data[t.from].label+" "+t.label+" "+l.nodes._data[t.to].label;n.goTo(r,i)}}),c.on("click",function(e){1===e.nodes.length?l.selectElement(e.nodes[0]):1===e.edges.length?l.selectElement(e.edges[0]):l.selectElement()}),c.on("oncontext",function(e){var t=c.getNodeAt(e.pointer.DOM);t&&(e.event.preventDefault(),l.deleteSelected(t))}),c.on("afterDrawing",function(e){l.loading&&l.loading.promise&&0===l.loading.promise.$$state.status&&t(function(){l.loading.resolve()},50)})}}]}}),angular.module("CarreEntrySystem").directive("carreGraphNetworkD3",function(){return{templateUrl:"app/components/graph-network-d3/template.html",restrict:"E",scope:{limitNewConnections:"@",height:"@",riskid:"="},controller:["$scope","$timeout","toastr","$location","CONFIG","GRAPH","$state","SweetAlert","$q",function(e,t,r,i,a,s,n,o,l){function c(e,t,r,i){var a=(d3.scale.category20b(),d3.select("#"+e).append("svg").attr("id","graph").attr("width",t).attr("height",r).attr("style","pointer-events:fill;")),s=self.force=d3.layout.force().nodes(i.nodes).links(i.links).gravity(.2).distance(180).charge(-500).size([t,r]).start();a.append("svg:defs").selectAll("marker").data(["end-marker"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",30).attr("refY",0).attr("markerWidth",2).attr("markerHeight",2).attr("class","marker").attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").style("fill","#aaaaaa").style("stroke","#aaaaaa");var n=20,o=a.selectAll("g.node").data(i.nodes).enter().append("circle").attr("class","node").attr("r",n).style("fill",function(e){return e.color||"#aaaaaa"}).style("stroke-width",function(e){return e.selected,2}).style("stroke",function(e){var t=e.selected;return t?"red":"white"}).call(s.drag),l=a.selectAll("line.link").data(i.links).enter().append("svg:line").attr("class","link").attr("marker-end",function(e){return"url(#end-marker)"}).style("stroke",function(e){var t=e.selected;return t?"red":"#aaaaaa"}).style("stroke-width",function(e){return e.selected,5}).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y});o.append("title").text(function(e){return e.label});var c=a.append("svg:g").selectAll("g").data(s.nodes()).enter().append("svg:g");c.append("svg:text").attr("x",28).attr("y",0).attr("class","text shadow").text(function(e){return e.label}),c.append("svg:text").attr("x",28).attr("y",0).attr("class","text").text(function(e){return e.label});var d=a.append("svg:g").selectAll("g").data(s.links()).enter().append("svg:g");d.append("svg:text").attr("class","path-text shadow").text(function(e){return e.label}),d.append("svg:text").attr("class","path-text").text(function(e){return e.label}),s.on("tick",function(){l.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),c.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),o.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),d.attr("transform",function(e){var t=e.target.x-e.source.x,r=e.target.y-e.source.y,i=Math.sqrt(t*t+r*r);0==i&&(i=.1);var a=r/i,s=t/i,n=6*e.label.length,o=(1-n/i)/2,l=e.source.x+t*o,c=e.source.y+r*o;return"translate("+l+","+c+") matrix("+s+", "+a+", "+-a+", "+s+", 0 , 0)"})})}var d=e;d.loading=!1,d.limitNewConnections=e.limitNewConnections||4,d.minConnections=10,d.height=d.height||600,d.customHeight=0;var u;d.options={showRiskEvidences:!1,onlyCore:!1},t(function(){d.selectedId="RL_2"},3e3),e.$watch("options",function(e,r){e.showRiskEvidences!==r.showRiskEvidences||e.onlyCore!==r.onlyCore,(e.showRiskEvidences!==r.showRiskEvidences||e.onlyCore!==r.onlyCore)&&(d.loading=l.defer()),t(function(){d.loading=d.init(d.riskid)},250)}),d.addSize=function(){},d.removeSize=function(){},d.init=function(e){e||(e=d.riskid),d.loading=s.network(e,d.options.showRiskEvidences?null:"risk_factor").then(function(r){d.nodesArr=e?r.nodes.map(function(t){var r=-1;return r=e instanceof Array?e.indexOf(t.id):e.substring(e.lastIndexOf("/")+1)===t.id.substring(t.id.lastIndexOf("/")+1)?0:-1,r>=0&&(t.color=a.COLORS[r]),t}):r.nodes.filter(function(e){return e.connections>d.minConnections}),d.edgesArr=r.edges.filter(function(e){for(var t=!1,r=!1,i=0,a=d.nodesArr.length;a>i;i++)d.nodesArr[i].id===e.from&&(t=!0),d.nodesArr[i].id===e.to&&(r=!0);return t&&r}),t(function(){if(d.options.onlyCore&&d.riskid instanceof Array&&d.riskid.length>1){var e=[];d.loading=d.startNetwork({nodes:d.nodesArr.filter(function(t){return u.getConnectedEdges(t.id).length>1||t.color?(-1===e.indexOf(t.id)&&e.push(t.id),!0):!1}),edges:d.edgesArr.filter(function(t){return e.indexOf(t.from)>=0&&e.indexOf(t.to)>=0})})}else d.startNetwork()},50)})},d.init(d.riskid),d.showRiskFactor=function(e,t){o.swal({title:"Show the Risk factor?",text:'This will redirect you to the "'+t+"\" risk factor's detail page.",type:"info",showCancelButton:!0,confirmButtonColor:"#2E8B57",confirmButtonText:"Yes, show me!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&n.go("main.risk_factors.view",{id:e})})},d.showRiskElement=function(e,t){o.swal({title:"Show the Risk element?",text:'This will redirect you to the "'+t+"\" risk element's detail page.",type:"info",showCancelButton:!0,confirmButtonColor:"#2E8B57",confirmButtonText:"Yes, show me!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&n.go("main.risk_elements.view",{id:e})})},d.addNodeRelations=function(e){e=e||d.selectedId,d.loading=s.network(e,d.options.showRiskEvidences?null:"risk_factor").then(function(e){var t=d.limitNewConnections,r={};e.nodes.forEach(function(e){r[e.id]=e}),e.edges.forEach(function(e){!d.edges._data[e.id]&&t>0&&(d.nodes._data[e.from]||d.nodes.add(r[e.from]),d.nodes._data[e.to]||d.nodes.add(r[e.to]),d.edges.add(e),t--)})})},d.selectElement=function(e){e?(-1!==e.indexOf("/")&&(e=e.substr(e.lastIndexOf("/")+1)),t(function(){d.selectedId=e},0),d.showDetails&&(t(function(){d.showDetails=!1},0),t(function(){d.showDetails=!0},100))):t(function(){d.showDetails=!1,d.selectedId=!1},0)},d.deleteSelected=function(e){var t=e||u.getSelectedNodes()[0];if(!t)return!1;var r={nodes:[t],edges:u.getConnectedEdges(t)};d.removeOrphan(r)},d.goToSelected=function(){var e=u.getSelectedNodes(),t=u.getSelectedEdges();if(1===e.length){var r=e[0].substring(e[0].lastIndexOf("/")+1),i=d.nodes._data[e[0]].label;d.showRiskElement(r,i)}else{if(1!==t.length)return!1;var a=d.edges._data[t[0]],s=t[0].substring(t[0].lastIndexOf("/")+1),n=d.nodes._data[a.from].label+" "+a.label+" "+d.nodes._data[a.to].label;d.showRiskFactor(s,n)}},d.removeOrphan=function(e){e.nodes.forEach(function(e){d.nodes.remove(e)}),e.edges.forEach(function(e){d.edges.remove(e)});var t=Object.keys(d.nodes._data);t.forEach(function(e){var t=u.getConnectedEdges(e);t.length<=0&&d.nodes.remove(e)})},d.startNetwork=function(e){e=e||{},d.customHeight=0;var t=e.nodes||d.nodesArr,r=e.edges||d.edgesArr;angular.element("#network svg").remove(),c("network",window.width-200,500,{nodes:t,links:r.map(function(e){return e.source=s.FindIndex(t,e.source,"id"),e.target=s.FindIndex(t,e.target,"id"),e.value=e.ratio,e})})}}]}}),angular.module("CarreEntrySystem").directive("carreGraphControls",function(){return{templateUrl:"app/components/graph-controls/template.html",restrict:"E",replace:!1,bindToController:{selectedId:"=",disableOptions:"=?",enableRotation:"@",rotation:"=?",onlyPath:"=?",showRiskEvidences:"=?",ratioFilter:"=?",refresh:"&",addSize:"&",removeSize:"&",navigate:"&",expand:"&",clear:"&"},controllerAs:"controls",scope:!0,controller:["$timeout","CONFIG","content","$scope",function(e,t,r,i){var a=this;i.$watch("selectedId",function(t,r){t&&t!==r&&i.showDetails&&(i.showDetails=!1,e(function(){i.showDetails=!0}))}.bind(this)),i.applyRefresh=function(){e(function(){a.refresh({}),a.showRiskEvidences?(i.$broadcast("rzSliderForceRender"),a.showSlider=!0):a.showSlider=!1},0)},a.user=t.currentUser.username,a.getType=r.typeFromId,a.showSlider=a.showRiskEvidences?!0:!1;for(var s=50.5,n=.5,o=[],l=0;s>l;l+=n)o.push(Number(Math.round(l+"e2")+"e-2"));a.slider_toggle={options:{stepsArray:o}}}]}}),angular.module("CarreEntrySystem").directive("carreGraphChordRisk",function(){return{templateUrl:"app/components/graph-chord/template.html",restrict:"E",scope:{limitNewConnections:"@",height:"@",riskid:"="},controller:["$scope","$timeout","toastr","CARRE","$location","CONFIG","GRAPH","$state","SweetAlert","content",function(e,t,r,i,a,s,n,o,l,c){function d(e,t){m(),d3.select(this).classed("selected",!d3.select(this).classed("selected")),p(h.nodesArr[t],"node"),"click"===d3.event.type&&d3.event.stopPropagation()}function u(e,t){m(),d3.select(this).classed("selected",!d3.select(this).classed("selected"));var r=h.edgesArr.filter(function(t){return t.from===h.nodesArr[e.source.index].id&&t.to===h.nodesArr[e.target.index].id})[0];p(r,"link"),d3.event.stopPropagation()}function m(){t(function(){h.selectedId=null},0),d3.select("#"+h.containerId+" svg").selectAll(".chord path").classed("selected",!1),d3.select("#"+h.containerId+" svg").selectAll(".group").classed("selected",!1)}function p(e,r){var i=e?e.id:null;i&&(-1!==i.indexOf("/")&&(i=i.substr(i.lastIndexOf("/")+1)),t(function(){h.selectedId=i,h.selectedItem={type:r,obj:e}},0),h.showDetails&&h.alwaysOnDetails&&(t(function(){h.showDetails=!1},0),t(function(){h.showDetails=!0},100)))}function _(e){var t=document.getElementById(h.containerId);return t?Number(getComputedStyle(t,null).getPropertyValue(e).replace("px","")):null}var h=e;h.loading=!1,h.containerId="chord",h.limitNewConnections=e.limitNewConnections||10,h.minConnections=5,h.height=h.height||700,h.customHeight=0,h.rotation=0,h.alwaysOnDetails=!0,h.showRiskEvidences=!1,h.onlyCore=!1,$(window).resize(function(){h.renderChord()}),h.addSize=function(){return h.customHeight>=800?!1:(h.customHeight+=100,void t(function(){h.renderChord()}))},h.removeSize=function(){return h.customHeight<=-300?!1:(h.customHeight-=100,void t(function(){h.renderChord()}))},h.init=function(e){e=e||h.riskid,h.loading=n.network(e,h.showRiskEvidences?null:"risk_factor").then(function(r){h.nodesArr=e?r.nodes.map(function(t){var r=-1;return r=e instanceof Array?e.indexOf(t.id):e.substring(e.lastIndexOf("/")+1)===t.id.substring(t.id.lastIndexOf("/")+1)?0:-1,r>=0&&(t.color=s.COLORS[r]),t}):r.nodes.filter(function(e){return e.connections>h.minConnections}),h.edgesArr=r.edges.filter(function(e){for(var t=!1,r=!1,i=0,a=h.nodesArr.length;a>i;i++)h.nodesArr[i].id===e.from&&(t=!0),h.nodesArr[i].id===e.to&&(r=!0);return t&&r}),t(function(){h.renderChord()},0)})},h.init(h.riskid),h.goToSelected=function(){var e,t=h.selectedItem.obj||{},r=t.id.substring(t.id.lastIndexOf("/")+1),i=h.selectedItem.type;if("node"===i)e=t.label;else{if("link"!==i)return!1;e=h.nodesArr[n.FindIndex(h.nodesArr,t.from)].label+" "+t.label+" "+h.nodesArr[n.FindIndex(h.nodesArr,t.to)].label}c.goTo(r,e)},h.addNodeRelations=function(){var e=h.selectedId;h.loading=n.network(e,h.showRiskEvidences?null:"risk_factor").then(function(e){var r=h.limitNewConnections,i={};e.nodes.forEach(function(e){i[e.id]=e}),e.edges.forEach(function(e){-1===n.FindIndex(h.edgesArr,e.id)&&r>0&&(-1===n.FindIndex(h.nodesArr,e.from)&&h.nodesArr.push(i[e.from]),-1===n.FindIndex(h.nodesArr,e.to)&&h.nodesArr.push(i[e.to]),h.edgesArr.push(e),r--)}),t(function(){h.renderChord()},0)})},h.deleteSelected=function(e){if(!h.selectedItem||"node"!==h.selectedItem.type)return!1;var r=h.selectedItem.obj||{};h.edgesArr=h.edgesArr.filter(function(e,t){return!(e.from===r.id||e.to===r.id)}),h.nodesArr=h.nodesArr.filter(function(e){return n.FindIndex(h.edgesArr,e.id,"from")+n.FindIndex(h.edgesArr,e.id,"to")>=-1}),e&&d3.event.preventDefault(),t(function(){h.renderChord()},0)},h.renderChord=function(){function r(e){return e.startAngle+p}function i(e){return e.endAngle+p}function a(e,t){for(var r in t)e[r]=t[r]}function s(e){return function(t,r){R.selectAll(".chord path").filter(function(e){return e.source.index!=r&&e.target.index!=r}).transition().style("opacity",e)}}h.rotationWatch&&h.rotationWatch();var n={rotation:h.rotation},o={},l=[],c=[];h.nodesArr.forEach(function(e,t){o[e.id]={i:t,obj:e},l[t]=l[t]||[],c[t]=c[t]||[],h.nodesArr.forEach(function(e,r){l[t][r]=0,c[t][r]=0})}),h.edgesArr.forEach(function(e,t){l[o[e.from].i][o[e.to].i]=e,c[o[e.from].i][o[e.to].i]=1});var m={width:_("width"),height:700+h.customHeight,rotation:0,textgap:10};n&&a(m,n);var p=Math.PI*h.rotation,f=m.width,g=m.height,v=m.textgap,b=d3.scale.category20b(),k="0 0 "+f+" "+g,y=d3.layout.chord().padding(.05).sortSubgroups(d3.descending).matrix(c),w=.31*Math.min(f,g),x=1.1*w,E=function(e,t){return t=t||e,h.riskid?h.nodesArr[t].color||"#aaaaaa":b(t)},C=function(){d3.select("#"+h.containerId+" svg g").transition().duration(1e3).attr("transform","translate("+f/2+","+g/2+")rotate("+h.rotation+")")};h.rotationWatch=e.$watch("rotation",function(){t(function(){C()},0)}),angular.element("#"+h.containerId+" svg").remove();var R=d3.select("#"+h.containerId).append("svg").attr("viewBox",k).attr("preserveAspectRatio","xMinYMid").attr("width",f).attr("height",g).append("g").attr("transform","translate("+f/2+","+g/2+")"),A=R.selectAll("g.group").data(y.groups).enter().append("svg:g").attr("class","group");A.append("svg:path").style("fill",function(e){return E(e.index)}).style("stroke",function(e){return E(e.index)}).attr("id",function(e,t){return"group"+e.index}).attr("d",d3.svg.arc().innerRadius(w).outerRadius(x).startAngle(r).endAngle(i)),A.append("svg:text").each(function(e){e.angle=(e.startAngle+e.endAngle)/2+p}).attr("dy",".35em").attr("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+(x+v)+")"+(e.angle>Math.PI?"rotate(180)":"")}).text(function(e){return h.nodesArr[e.index].label}).style("fill",function(e){return E(e.index)});var $=R.append("g").attr("class","chord").selectAll("path").data(y.chords).enter().append("path").attr("d",d3.svg.chord().radius(w).startAngle(r).endAngle(i)).style("fill",function(e){return E(e.source.index)}).style("opacity",1);$.append("svg:title").text(function(e){return h.nodesArr[e.source.index].label+" "+l[e.source.index][e.target.index].label+" "+h.nodesArr[e.target.index].label}),A.on("mouseover",s(.1)).on("mouseout",s(1)).on("click",d).on("dblclick",h.addNodeRelations),$.on("click",u).on("dblclick",h.goToSelected)},angular.element("#"+h.containerId).on("click",m)}]}}),angular.module("CarreEntrySystem").directive("carreFooter",function(){return{templateUrl:"app/components/footer/footer.html",restrict:"E",replace:!0}}),angular.module("CarreEntrySystem").directive("carreElementControls",function(){return{templateUrl:"app/components/carre-element-controls/template.html",restrict:"E",replace:!0,bindToController:{carreId:"@"},controllerAs:"controls",scope:!0,controller:["CONFIG",function(e){this.dev="DEV"===e.ENV,this.user=e.currentUser.username}]}}),angular.module("CarreEntrySystem").directive("carreElement",["CONFIG",function(e){return{templateUrl:"app/components/carre-element/template.html",restrict:"E",replace:!0,scope:{type:"@",mode:"@",elemId:"@",elem:"=",notFields:"@",hidePubmed:"@"},controller:["$rootScope","$state","$scope","$timeout","content","CONFIG","VisibleFields","Observables","Risk_elements","Risk_factors","Measurement_types","Citations","Medical_experts","Risk_evidences",function(e,t,r,i,a,s,n,o,l,c,d,u,m,p){function _(e,r){switch(e=e||a.typeFromId(r).raw,x.type=e,e){case"risk_element":"RL"!==r.substring(0,2)?t.go("404_error"):f(r);break;case"risk_factor":"RF"!==r.substring(0,2)?t.go("404_error"):g(r);break;case"risk_evidence":"RV"!==r.substring(0,2)?t.go("404_error"):v(r);break;case"observable":"OB"!==r.substring(0,2)?t.go("404_error"):k(r);break;case"citation":"CI"!==r.substring(0,2)?t.go("404_error"):b(r);break;case"measurement_type":"ME"!==r.substring(0,2)?t.go("404_error"):y(r);break;case"medical_expert":break;default:t.go("404_error")}}function h(e,t){var r=n(e,"single",x.notFields.split(","));x.current=t,x.fields=r.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id)}function f(e){var t=n("risk_element","single",x.notFields.split(","));x.loading=l.get([e]).then(function(e){e.data&&(x.current=e.data[0],x.fields=t.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id))})}function g(e){var t=n("risk_factor","single",x.notFields.split(","));x.loading=c.get([e]).then(function(e){e.data&&(x.current=e.data[0],x.fields=t.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id))})}function v(e){var t=n("risk_evidence","single",x.notFields.split(","));x.loading=p.get([e]).then(function(e){e.data&&(x.current=e.data[0],x.current.pubmedId=r.hidePubmed?!1:e.data[0].has_risk_evidence_source_label,x.fields=t.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id))})}function b(e){var t=n("citation","single",x.notFields.split(","));x.loading=u.get([e]).then(function(e){e.data&&(x.current=e.data[0],x.current.pubmedId=r.hidePubmed?!1:e.data[0].has_citation_pubmed_identifier_label,x.fields=t.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id))})}function k(e){var t=n("observable","single",x.notFields.split(","));x.loading=o.get([e]).then(function(e){e.data&&(x.current=e.data[0],x.fields=t.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id))})}function y(e){var t=n("measurement_type","single",x.notFields.split(","));x.loading=d.get([e]).then(function(e){e.data&&(x.current=e.data[0],x.fields=t.map(function(e){return{value:e,label:a.labelOf(e)}}),x.rdf_source=w(x.current.id))})}function w(e){return"http://"+s.CARRE_API_URL.substring(s.CARRE_API_URL.indexOf("://")+3,s.CARRE_API_URL.indexOf("/ws"))+":8890/sparql?query=DESCRIBE <"+e+">&format=text/plain"}var x=r;x.current=x.elem||{},x.notFields=x.notFields||"",x.elemId?(_(x.type,x.elemId),e.elementViewerWatcher&&e.elementViewerWatcher(),e.elementViewerWatcher=r.$watch("elemId",function(e,t){
e&&e.length>=2&&e!==t&&_(x.type,e)})):x.type&&x.elem&&h(x.type,x.elem)}]}}]),angular.module("CarreEntrySystem").service("VisibleFields",function(){var e={risk_element:{single:["has_risk_element_name","has_risk_element_identifier","has_risk_element_type","has_risk_element_modifiable_status","has_risk_element_observable","has_risk_element_observable_condition","includes_risk_element","has_author","has_reviewer"],list:["has_risk_element_name","has_risk_element_identifier","has_risk_element_type","has_risk_element_modifiable_status","has_risk_element_observable"]},risk_evidence:{single:["has_risk_factor","has_risk_evidence_observable","has_observable_condition","has_risk_evidence_ratio_type","has_risk_evidence_ratio_value","has_confidence_interval_min","has_confidence_interval_max","is_adjusted_for","has_risk_evidence_source","has_author","has_reviewer"],list:["has_risk_factor","has_observable_condition_text","has_risk_evidence_ratio_value"]},risk_factor:{single:["has_risk_factor_source","has_risk_factor_target","has_risk_factor_association_type","has_author","has_reviewer"],list:["has_risk_factor_source","has_risk_factor_target","has_risk_factor_association_type"]},risk_review:{single:["is_for_element","is_assigned_to","has_review_notes","has_review_json","review_date","assign_date","review_status"],list:["is_for_element","is_assigned_to","has_review_notes","review_status"]},observable:{single:["has_observable_name","has_observable_acronym","has_observable_type","has_observable_measurement_type","has_external_type","has_external_predicate","has_author","has_reviewer"],list:["has_observable_name","has_observable_type","has_observable_measurement_type"]},citation:{single:["has_citation_pubmed_identifier","has_citation_summary","has_citation_source_type","has_citation_source_level","has_author","has_reviewer"],list:["has_citation_pubmed_identifier","has_citation_summary","has_citation_source_type","has_citation_source_level"]},measurement_type:{single:["has_measurement_type_name","has_enumeration_values","has_label","has_datatype","has_external_unit"],list:["has_measurement_type_name","has_datatype","has_label","has_enumeration_values"]},medical_expert:{single:[],list:[]}};return function(t,r,i){return t&&e[t]?(r=r||"list",i=i&&i instanceof Array?i:[],e[t][r].filter(function(e){return-1==i.indexOf(e)?!0:!1})):""}}),angular.module("CarreEntrySystem").service("Auth",["$http","CONFIG","$cookies","$state","$q","$timeout","Email",function(e,t,r,i,a,s,n){this.cookie=r.get("CARRE_USER")||t.TEST_TOKEN||"",this.isLoggedIn=function(){var e=a.defer();return t.currentUser.username?e.resolve(t.currentUser):t.currentUser.guest?e.reject("Guest users not allowed to do this!"):this.getUser().then(function(){s(function(){t.currentUser.username?e.resolve(t.currentUser):t.currentUser.guest&&e.reject("Guest users not allowed to do this!")},200)}),e.promise},this.getUser=function(){var r=a.defer();return t.currentUser.username||t.currentUser.guest?r.resolve(t.currentUser):this.cookie.length>0?e.get(t.CARRE_API_URL+"userProfile?token="+this.cookie,{cache:!0,timeout:5e3}).then(function(e){0===e.data.username.indexOf("(")?(n.bug({data:e.data,title:"RDF server is down"}),t.currentUser={guest:!0}):(t.currentUser=e.data,t.CARRE_DEFAULT_GRAPH=t.CARRE_ARCHIVE_GRAPH),r.resolve(t.currentUser)})["catch"](function(e){t.currentUser={},r.reject(e),n.bug(e),i.go("500_API_ERROR")}):(t.currentUser={guest:!0},r.resolve(t.currentUser)),r.promise}}]),angular.module("CarreEntrySystem").service("content",["CarreTranslate","SweetAlert","$state",function(e,t,r){function i(e,t){var r=[];return t.forEach(function(e){r.push({field:e+"_label",displayName:s(e)})}),e.forEach(function(e){-1===t.indexOf(e)&&r.push({field:e+"_label",displayName:s(e),visible:!1})}),r[0].sort={priority:0,direction:"asc"},r}function a(){return{paginationPageSizes:[10,50,100],paginationPageSize:10,enableColumnResizing:!0,enableFiltering:!0,allowCellFocus:!0,enableGridMenu:!0,multiSelect:!0,enableRowSelection:!0,enableHighlighting:!0,enableColumnMenus:!0,showGridFooter:!0,showColumnFooter:!0,exporterMenuPdf:!1,exporterCsvFilename:window.location.href.substr(window.location.href.lastIndexOf("/")+1)+".csv"}}function s(t){return e(t)}function n(e){if(!e)return"";if(-1===e.indexOf("_"))return"";var t=e.substr(e.lastIndexOf("_")-2,2).toUpperCase();return"OB"===t?{state:"observables",raw:"risk_element",label:"Risk element"}:"CI"===t?{state:"citations",raw:"citation",label:"Citation"}:"MD"===t?{state:"medical_experts",raw:"medical_expert",label:"Medical expert"}:"ME"===t?{state:"measurement_types",raw:"measurement_type",label:"Measurement types"}:"RL"===t?{state:"risk_elements",raw:"risk_element",label:"Risk element"}:"RF"===t?{state:"risk_factors",raw:"risk_factor",label:"Risk factor"}:"RV"===t?{state:"risk_evidences",raw:"risk_evidence",label:"Risk evidence"}:"RW"===t?{state:"risk_reviews",raw:"risk_review",label:"Review"}:void 0}function o(e,i){var a=n(e);t.swal({title:"Show the "+a.label+"?",text:"This will redirect you to the `"+i+"` "+a.label+"'s detail page.",type:"info",showCancelButton:!0,confirmButtonColor:"#2E8B57",confirmButtonText:"Yes, show me!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&r.go("main."+a.state+".view",{id:e})})}return this.exports={"default":a(),fields:i,labelOf:s,typeFromId:n,goTo:o},this.exports}]),angular.module("CarreEntrySystem").service("Tutorial",["$http","CONFIG","toastr","$state",function(e,t,r,i){function a(e){t.currentUser&&t.currentUser.username?t.currentUser.username:"guest";e()}function s(r){var i=t.currentUser?t.currentUser.username:"guest";e.post(t.CARRE_CACHE_URL+"sendemail",{action:"report_bug",user:i,reqdata:JSON.stringify(r)})}function n(){return{steps:[{element:"#intro-risk-model",intro:"Here you can see the CARRE risk model overview",position:"right"},{element:"#intro-stats",intro:"This chart represents all the current CARRE elements in the database",position:"left"},{element:"#intro-box-risk-factors",intro:"This box is a counter for all the CARRE risk factors",position:"top"},{element:"#intro-box-risk-evidences",intro:"This box is a counter for all the CARRE risk evidences",position:"top"}],showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"<strong>Next</strong>",prevLabel:"<strong>Previous</strong>",skipLabel:"Exit",doneLabel:"OK that's enough!"}}return this.exports={startGuest:a,startUser:s,options:n},this.exports}]),angular.module("CarreEntrySystem").filter("translateMapping",["CarreTranslate",function(e){return function(t){return e(t)}}]).service("CarreTranslate",["CONFIG",function(e){var t={en:{loading_please_wait:"Please wait...",create_btn:"Create new",cancel_btn:"Cancel",submit_btn:"Submit",back_btn:"Back",view_btn:"View",edit_btn:"Edit",uigrid_total_items:"Total items",uigrid_showing_items:"Showing items",uigrid_items_per_page:"items per page",uigrid_items:"items",uigrid_menu_clear_filters:"Clear all filters",uigrid_menu_columns:"Columns",uigrid_menu_export_all:"Export all data as",uigrid_menu_export_visual:"Export visible data as",carre_risk_elements:"Risk elements",carre_risk_factors:"Risk factors",carre_risk_evidences:"Risk evidences",carre_risk_observables:"Observables",carre_risk_measurement_types:"Risk elements",carre_risk_citations:"Citations",header_greeting:"Hello",header_login:"Login",header_logout:"Logout",header_settings:"Settings",header_guest:"guest",header_change_password:"Change password",sidebar_about:"About",sidebar_dashboard:"Dashboard",sidebar_explore:"Explore",sidebar_carre_elements:"CARRE elements",sidebar_medical_experts:"Medical Experts",pages_dashboard_box_unreviewed:"unreviewed!",pages_explore_graph_search:"Graph search by risk elements",pages_explore_visualization_type:"Visualization Type",pages_explore_sankey_graph:"Sankey graph",pages_explore_network_graph:"Network graph",pages_explore_chord_graph:"Chord graph",pages_explore_reset_btn:"Reset",pages_explore_search_btn:"Search",pages_explore_examples_btn:"Examples",pages_explore_recommend_btn:"Recommend",pages_explore_options_btn:"Options",pages_explore_show_details_btn:"Show details",pages_explore_hide_details_btn:"Hide details",has_author:"Entered by",has_reviewer:"Reviewed by",has_firstname:"First name",has_lastname:"Last name",has_medical_specialty:"Medical specialty",has_medical_position:"Medical position",has_short_cv:"Short CV",has_personal_page_url:"Personal website",has_user_graph:"User graph",has_observable_name:"Name",has_observable_acronym:"Acronym",has_observable_type:"Type",has_external_type:"External Vocabulary",has_external_predicate:"Sensors",has_observable_measurement_type:"Measurement type",observable_type_personal:"personal",observable_type_clinical:"clinical",observable_type_other:"other",has_risk_element_name:"Name",has_risk_element_identifier:"UMLS Identifier",has_risk_element_type:"Type",has_risk_element_modifiable_status:"Modifiable status",has_risk_element_observable:"Observable",has_risk_element_observable_condition:"Observable condition",includes_risk_element:"Includes",risk_element_type_biomedical:"biomedical",risk_element_type_demographic:"demographic",risk_element_type_behavioural:"behavioural",risk_element_type_intervention:"intervention",risk_element_type_genetic:"genetic",risk_element_type_environmental:"environmental",has_risk_factor_source:"Source",has_risk_factor_target:"Target",has_risk_factor_association_type:"Association type",risk_factor_association_type_is_an_issue_in:"is an issue in",risk_factor_association_type_causes:"causes",risk_factor_association_type_reduces:"reduces",risk_factor_association_type_elevates:"elevates",has_risk_factor:"Risk factor",has_risk_evidence_observable:"Observable",has_observable_condition:"Observable condition",has_observable_condition_text:"Observable condition",has_risk_evidence_ratio_type:"Ratio type",has_risk_evidence_ratio_value:"Ratio value",has_confidence_interval_min:"Confidence Interval min",has_confidence_interval_max:"Confidence Interval max",is_adjusted_for:"Is adjusted for",has_risk_evidence_source:"Source",risk_evidence_ratio_type_hazard_ratio:"hazard ratio",risk_evidence_ratio_type_odds_ratio:"odds ratio",risk_evidence_ratio_type_relative_risk:"relative risk",risk_evidence_ratio_type_risk_ratio:"risk ratio",has_citation_pubmed_identifier:"Pubmed Identifier",has_citation_summary:"Summary",has_citation_source_type:"Study type",has_citation_source_level:"Study level",has_measurement_type_name:"Name",has_datatype:"Datatype",has_label:"Unit",has_enumeration_values:"Values",has_external_unit:"External Vocabulary"},el:{has_author:" ",has_reviewer:" ",has_firstname:"",has_lastname:"",has_medical_specialty:" ",has_medical_position:" ",has_short_cv:" ",has_personal_page_url:" ",has_user_graph:" ",has_observable_name:"",has_observable_acronym:"",has_observable_type:"",has_external_type:"External Vocabulary",has_external_predicate:"Sensors",has_observable_measurement_type:"Measurement type",observable_type_personal:"",observable_type_clinical:"",observable_type_other:"",has_risk_element_name:"",has_risk_element_identifier:"UMLS Identifier",has_risk_element_type:"",has_risk_element_modifiable_status:"Modifiable status",has_risk_element_observable:"Observable",has_risk_element_observable_condition:"Observable condition",includes_risk_element:"",risk_element_type_biomedical:"biomedical",risk_element_type_demographic:"demographic",risk_element_type_behavioural:"behavioural",risk_element_type_intervention:"intervention",risk_element_type_genetic:"genetic",risk_element_type_environmental:"environmental",has_risk_factor_source:"",has_risk_factor_target:"",has_risk_factor_association_type:"Association type",risk_factor_association_type_is_an_issue_in:"is an issue in",risk_factor_association_type_causes:"causes",risk_factor_association_type_reduces:"reduces",risk_factor_association_type_elevates:"elevates",has_risk_factor:"Risk factor",has_risk_evidence_observable:"Observable",has_observable_condition:"Observable condition",has_observable_condition_text:"Observable condition",has_risk_evidence_ratio_type:"Ratio type",has_risk_evidence_ratio_value:"Ratio value",has_confidence_interval_min:"Confidence Interval min",has_confidence_interval_max:"Confidence Interval max",is_adjusted_for:"Is adjusted for",has_risk_evidence_source:"Source",risk_evidence_ratio_type_hazard_ratio:"hazard ratio",risk_evidence_ratio_type_odds_ratio:"odds ratio",risk_evidence_ratio_type_relative_risk:"relative risk",risk_evidence_ratio_type_risk_ratio:"risk ratio",has_citation_pubmed_identifier:"Pubmed Identifier",has_citation_summary:"Summary",has_citation_source_type:"Study type",has_citation_source_level:"Study level",has_measurement_type_name:"Name",has_datatype:"Datatype",has_label:"Unit",has_enumeration_values:"Values",has_external_unit:"External Vocabulary"},lt:{has_author:"Entered by",has_reviewer:"Reviewed by",has_firstname:"First name",has_lastname:"Last name",has_medical_specialty:"Medical specialty",has_medical_position:"Medical position",has_short_cv:"Short CV",has_personal_page_url:"Personal website",has_user_graph:"User graph",has_observable_name:"Name",has_observable_acronym:"Acronym",has_observable_type:"Type",has_external_type:"External Vocabulary",has_external_predicate:"Sensors",has_observable_measurement_type:"Measurement type",observable_type_personal:"personal",observable_type_clinical:"clinical",observable_type_other:"other",has_risk_element_name:"Name",has_risk_element_identifier:"UMLS Identifier",has_risk_element_type:"Type",has_risk_element_modifiable_status:"Modifiable status",has_risk_element_observable:"Observable",has_risk_element_observable_condition:"Observable condition",includes_risk_element:"Includes",risk_element_type_biomedical:"biomedical",risk_element_type_demographic:"demographic",risk_element_type_behavioural:"behavioural",risk_element_type_intervention:"intervention",risk_element_type_genetic:"genetic",risk_element_type_environmental:"environmental",has_risk_factor_source:"Source",has_risk_factor_target:"Target",has_risk_factor_association_type:"Association type",risk_factor_association_type_is_an_issue_in:"is an issue in",risk_factor_association_type_causes:"causes",risk_factor_association_type_reduces:"reduces",risk_factor_association_type_elevates:"elevates",has_risk_factor:"Risk factor",has_risk_evidence_observable:"Observable",has_observable_condition:"Observable condition",has_observable_condition_text:"Observable condition",has_risk_evidence_ratio_type:"Ratio type",has_risk_evidence_ratio_value:"Ratio value",has_confidence_interval_min:"Confidence Interval min",has_confidence_interval_max:"Confidence Interval max",is_adjusted_for:"Is adjusted for",has_risk_evidence_source:"Source",risk_evidence_ratio_type_hazard_ratio:"hazard ratio",risk_evidence_ratio_type_odds_ratio:"odds ratio",risk_evidence_ratio_type_relative_risk:"relative risk",risk_evidence_ratio_type_risk_ratio:"risk ratio",has_citation_pubmed_identifier:"Pubmed Identifier",has_citation_summary:"Summary",has_citation_source_type:"Study type",has_citation_source_level:"Study level",has_measurement_type_name:"Name",has_datatype:"Datatype",has_label:"Unit",has_enumeration_values:"Values",has_external_unit:"External Vocabulary"}};return function(r,i){return t[e.LANG].hasOwnProperty(r)?t[e.LANG][r]:i?"--Not-Available-Translation--":r}}]).filter("translate",["Translate",function(e){return function(t){return e(t)}}]),angular.module("CarreEntrySystem").service("RdfFormatter",["CONFIG","CarreTranslate","Email",function(e,t,r){function i(e,t,r,i){t=t||["subject","predicate","object"];var s={triplesFormat:t,groupProp:t[r||0],valueProp:i,keys:[],fields:[],mappings:{},data:[]};return e.reduce(a,s)}function a(t,r){var i,a,s,n,l;if(a=r[t.groupProp][t.valueProp],s=o(r[t.triplesFormat[1]][t.valueProp]),i=r[t.triplesFormat[2]].type,n=r[t.triplesFormat[2]][t.valueProp],"has_educational_material"===s)return t;if("has_observable_condition_text"===s&&(n=n.replace(new RegExp(">=","g"),"").replace(new RegExp("<=","g"),"")),r[t.triplesFormat[2]].hasOwnProperty("xml:lang")&&r[t.triplesFormat[2]]["xml:lang"]!==e.LANG)return t;if(l="typed-literal"===i?n:o(n),["CI","OB","RF","RL","RV","ME"].indexOf(l.substr(0,2))>-1&&-1===l.indexOf("observable_condition")){t.mappings[l]=t.mappings[l]||{};for(var c in r)"subject"!==c&&"predicate"!==c&&"object"!==c&&r[c].value.length>0&&(t.mappings[l][c]=r[c].value)}("has_external_type"===s||"has_external_unit"===s||"has_external_predicate"===s)&&(l=o(n)),-1===t.fields.indexOf(s)&&t.fields.push(s);var d=t.keys.indexOf(a);return-1===d&&(t.keys.push(a),t.data.push({id:a,id_label:o(a)}),d=t.keys.length-1),t.data[d][s]=t.data[d][s]||[],t.data[d][s].push(n),t.data[d][s+"_label"]=t.data[d][s+"_label"]||"",t.data[d][s+"_label"]+=(t.data[d][s+"_label"].length>0?",":"")+l,t.data[d][s+"_label_arr"]=t.data[d][s+"_label_arr"]||[],t.data[d][s+"_label_arr"].push(l),t}function s(e){return e.data=e.data.map(function(t){var r="";for(var i in t)i.indexOf("_label_arr")>0&&-1===i.indexOf("has_observable_condition")&&(t[i]=t[i].map(function(t){if(!e.mappings.hasOwnProperty(t))return n(t);switch(r=t.substr(0,2)){case"CI":return e.mappings[t].has_citation_pubmed_identifier;case"OB":return e.mappings[t].has_observable_name;case"ME":return e.mappings[t].has_measurement_type_name;case"RF":return e.mappings[t].has_source_risk_element_name+" ["+n(e.mappings[t].has_risk_factor_association_type)+"] "+e.mappings[t].has_target_risk_element_name;case"RL":return e.mappings[t].has_risk_element_name;case"RV":return t;default:return t}}),t[i.split("_arr")[0]]=t[i].join(", "));return t}),e}function n(e){return e?t(e.indexOf("#")>=0?e.split("#")[1]:e):""}function o(e){return e.indexOf("#")>=0?e=e.split("#")[1]:e.indexOf("http")>=0?e.substring(e.lastIndexOf("/")+1):e}return this.exports={groupByProp:i,mappings:s,translate:n},this.exports}]),angular.module("CarreEntrySystem").service("QUERY",["CONFIG",function(e){function t(e){if(e.indexOf("http")>=0)return e;var t=e.split("_")[0];return l.hasOwnProperty(t)?l[t]+e:e}function r(e){if(e)l.hasOwnProperty(e)&&-1===d.indexOf(e)&&(d.push(e),c+="PREFIX "+e+": <"+l[e]+"> \n");else for(var t in l)d.push(t),c+="PREFIX "+t+": <"+l[t]+"> \n"}function i(e,t){var r={};for(var i in t)if(t[i].value instanceof Array)if(e[i]instanceof Array){if(t[i].value.length!==e[i].length)r[i]=t[i];else for(var a=0,s=t[i].value;a<s.length;a++)if(-1===e[i].indexOf(s[a])){r[i]=t[i];break}}else r[i]=t[i];else e[i]&&e[i][0]==t[i].value||(r[i]=t[i]);return r}function a(e){return e instanceof Object?"node"!==e.type?'"'+e.value+'"^^'+s("xsd:"+e.type):0===e.value.indexOf("http://")||0===e.value.indexOf("https://")?"<"+e.value+">":s(e.value):0===e.indexOf("http://")||0===e.indexOf("https://")?"<"+e+">":s(e)}function s(t,i){-1===t.indexOf(":")&&(t="risk:"+t);var a=t.split(":");return e.OPTIONS.usePrefix?(r(a[0]),t):(i=i||l,i.hasOwnProperty(a[0])?"<"+i[a[0]]+a[1]+">":"<node_"+Math.round(1e8*Math.random())+">")}function n(t,r,s,n){d=[],c=[],n=n||e.CARRE_DEFAULT_GRAPH,r=i(t,r),s=s||a(t.id);var o="",l="",u=!0;for(var m in r){u=!1;var p=r[m].pre;o+=s+" "+a(p+":"+m)+" ?"+m+"_var . \n",r[m].value instanceof Array?r[m].value.forEach(function(e){l+=s+" "+a(p+":"+m)+" "+a(e)+" . \n"}):l+=s+" "+a(p+":"+m)+" "+a(r[m])+" . \n"}if(u)return"";var _="WITH "+n+" DELETE { \n"+o+" } \n WHERE { \n"+o+" } \n",h="INSERT DATA { GRAPH "+n+" { \n"+l+" }} \n";return(e.OPTIONS.usePrefix?c:"")+_+h}function o(t,r,i,s,n){d=[],c=[],n=n||e.CARRE_DEFAULT_GRAPH,s=s||e.currentUser.graphName;var o="",l=!0;for(var u in t){l=!1;var m=t[u].pre;t[u].value instanceof Array?t[u].value.forEach(function(e){o+="?newid "+a(m+":"+u)+" "+a(e)+" . \n"}):o+="?newid "+a(m+":"+u)+" "+a(t[u])+" . \n"}if(l)return"";o+="?newid "+a("risk:has_author")+" "+a(s)+"; a "+a("risk:"+r)+" .  \n";var p="INSERT { GRAPH "+n+" { \n"+o+" }} WHERE \n          { GRAPH "+n+" \n          { { \n              SELECT ?oldindex FROM "+n+" \n              WHERE { \n               ?elem a "+a("risk:"+r)+' . \n                BIND (xsd:integer(strafter(STR(?elem),"'+i+'_")) AS ?oldindex) \n              } ORDER BY DESC(?oldindex) LIMIT 1 \n            } \n            BIND (IRI(CONCAT('+a(i+":")+', "'+i+'_", ?oldindex+1)) AS ?newid) \n          } }';return(e.OPTIONS.usePrefix?c:"")+p}this.exports={insert:o,update:n,prefix:t};var l={xsd:"http://www.w3.org/2001/XMLSchema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",carreUsers:"https://carre.kmi.open.ac.uk/users/",risk:"http://carre.kmi.open.ac.uk/ontology/risk.owl#",ME:"http://carre.kmi.open.ac.uk/measurement_types/",OB:"http://carre.kmi.open.ac.uk/observables/",RL:"http://carre.kmi.open.ac.uk/risk_elements/",RV:"http://carre.kmi.open.ac.uk/risk_evidences/",RF:"http://carre.kmi.open.ac.uk/risk_factors/",MD:"http://carre.kmi.open.ac.uk/medical_experts/",CI:"http://carre.kmi.open.ac.uk/citations/",RW:"http://carre.kmi.open.ac.uk/reviews/"},c="",d=[];return this.exports}]),angular.module("CarreEntrySystem").service("Pubmed",["$http","CONFIG",function(e,t){var r=t.PUBMED_API_URL,i=t.EUROPEPMC_API_URL,a=function(t){return e.get(r+"efetch.fcgi?db=pubmed&retmode=text&rettype=abstract&id="+t,{ignoreLoadingBar:!1,cache:!0}).then(function(e){return e},function(e){})},s=function(t){return e.jsonp(i+"search?resulttype=lite&format=json&callback=JSON_CALLBACK&query="+t,{ignoreLoadingBar:!1,cache:!0}).then(function(e){return{count:e.data.hitCount,result:e.data.resultList.result}},function(e){})};return{fetch:a,search:s}}]),angular.module("CarreEntrySystem").service("Email",["$http","CONFIG","toastr",function(e,t,r){function i(i){var a=t.currentUser?t.currentUser.username:"guest";e.post(t.CARRE_CACHE_URL+"sendemail",{action:"recommend_examples",user:a,reqdata:JSON.stringify(i)}).then(function(e){r.success("<b>Example sent!</b>","<h4>Thank you!</h4>")},function(e){r.error("<b>Example not sent</b>"+e,"<h4>Example error</h4>")})}function a(r){var i=t.currentUser?t.currentUser.username:"guest";e.post(t.CARRE_CACHE_URL+"sendemail",{action:"report_bug",user:i,reqdata:JSON.stringify(r)})}function s(i,a){var s=t.currentUser?t.currentUser.username:"guest";e.post(t.CARRE_CACHE_URL+"sendemail",{action:a,user:s,reqdata:JSON.stringify(i)}).then(function(e){r.success("<b>Message sent!</b>","<h4>Thank you!</h4>")},function(e){r.error("<b>Message not sent</b>"+e,"<h4>Message error</h4>")})}return this.exports={example:i,bug:a,send:s},this.exports}]),d3.sankey=function(){function e(){p.forEach(function(e){e.sourceLinks=[],e.targetLinks=[]}),_.forEach(function(e){var t=e.source,r=e.target;"number"==typeof t&&(t=e.source=p[e.source]),"number"==typeof r&&(r=e.target=p[e.target]),t.sourceLinks.push(e),r.targetLinks.push(e)})}function t(){p.forEach(function(e){e.value=Math.max(d3.sum(e.sourceLinks,l),d3.sum(e.targetLinks,l))})}function r(){for(var e,t=p,r=0;t.length;)e=[],t.forEach(function(t){t.x=r,t.dx=d,t.sourceLinks.forEach(function(t){e.push(t.target)})}),t=e,++r;i(r);var s=window.innerWidth||document.width;a((s-d)/(r-1))}function i(e){p.forEach(function(t){t.sourceLinks.length||(t.x=e-1)})}function a(e){p.forEach(function(t){t.x*=e})}function s(e){function t(){var e=d3.min(n,function(e){return(m[1]-(e.length-1)*u)/d3.sum(e,l)});n.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*e})}),_.forEach(function(t){t.dy=t.value*e})}function r(e){function t(e){return o(e.source)*e.value}n.forEach(function(r,i){r.forEach(function(r){if(r.targetLinks.length){var i=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,l);r.y+=(i-o(r))*e}})})}function i(e){function t(e){return o(e.target)*e.value}n.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var i=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,l);r.y+=(i-o(r))*e}})})}function a(){n.forEach(function(e){var t,r,i,a=0,n=e.length;for(e.sort(s),i=0;n>i;++i)t=e[i],r=a-t.y,r>0&&(t.y+=r),a=t.y+t.dy+u;if(r=a-u-m[1],r>0)for(a=t.y-=r,i=n-2;i>=0;--i)t=e[i],r=t.y+t.dy+u-a,r>0&&(t.y-=r),a=t.y})}function s(e,t){return e.y-t.y}var n=d3.nest().key(function(e){return e.x}).sortKeys(d3.ascending).entries(p).map(function(e){return e.values});t(),a();for(var c=1;e>0;--e)i(c*=.99),a(),r(c),a()}function n(){function e(e,t){return e.source.y-t.source.y}function t(e,t){return e.target.y-t.target.y}p.forEach(function(r){r.sourceLinks.sort(t),r.targetLinks.sort(e)}),p.forEach(function(e){var t=0,r=0;e.sourceLinks.forEach(function(e){e.sy=t,t+=e.dy}),e.targetLinks.forEach(function(e){e.ty=r,r+=e.dy})})}function o(e){return e.y+e.dy/2}function l(e){return e.value}var c={},d=24,u=8,m=[1,1],p=[],_=[];return c.nodeWidth=function(e){return arguments.length?(d=+e,c):d},c.nodePadding=function(e){return arguments.length?(u=+e,c):u},c.nodes=function(e){return arguments.length?(p=e,c):p},c.links=function(e){return arguments.length?(_=e,c):_},c.size=function(e){return arguments.length?(m=e,c):m},c.layout=function(i){return e(),t(),r(),s(i),n(),c},c.relayout=function(){return n(),c},c.link=function(){function e(e){var r=e.source.x+e.source.dx,i=e.target.x,a=d3.interpolateNumber(r,i),s=a(t),n=a(1-t),o=e.source.y+e.sy+e.dy/2,l=e.target.y+e.ty+e.dy/2;return"M"+r+","+o+"C"+s+","+o+" "+n+","+l+" "+i+","+l}var t=.5;return e.curvature=function(r){return arguments.length?(t=+r,e):t},e},c},angular.module("CarreEntrySystem").service("CARRE",["$http","CONFIG","Auth","RdfFormatter","$q","toastr","$state","$cacheFactory","QUERY","Email","$rootScope",function(e,t,r,i,a,s,n,o,l,c,d){function u(e){var r="WITH "+t.CARRE_ARCHIVE_GRAPH+" DELETE { <"+l.prefix(e)+"> ?s ?p .  }  WHERE { <"+l.prefix(e)+"> ?s ?p .}";return g(r)}function m(e,r){if(!e||!r)throw"CARRE Error: Cannot search without type and term!";var i="SELECT * FROM "+t.CARRE_DEFAULT_GRAPH+" WHERE { \n             ?subject a risk:"+e+"; ?predicate ?object. \n              OPTIONAL {    \n               ?object a risk:citation. \n               ?object risk:has_citation_pubmed_identifier ?has_citation_pubmed_identifier  \n              } \n              OPTIONAL {    \n               ?object a risk:observable. \n               ?object risk:has_observable_name ?has_observable_name  \n              } \n              OPTIONAL {    \n               ?object a risk:risk_element. \n               ?object risk:has_risk_element_name ?has_risk_element_name  \n              } \n              OPTIONAL {    \n               ?object a risk:measurement_type. \n               ?object risk:has_measurement_type_name ?has_measurement_type_name  \n              } \n              OPTIONAL {    \n               ?object a risk:risk_factor.  \n               ?object risk:has_risk_factor_association_type ?has_risk_factor_association_type. \n               ?object risk:has_risk_factor_source ?has_risk_factor_source. \n               ?object risk:has_risk_factor_target ?has_risk_factor_target. \n               ?has_risk_factor_source risk:has_risk_element_name ?has_source_risk_element_name.  \n               ?has_risk_factor_target risk:has_risk_element_name ?has_target_risk_element_name.  \n              } \n";return i+='FILTER (lcase(str(?object)) = "'+r+'") }',f(i)}function p(e){var r=t.LANG;return"FILTER(lang("+e+")='"+r+"') "}function _(e,r){var i="SELECT * FROM "+t.CARRE_DEFAULT_GRAPH+" WHERE { \n             ?subject a risk:"+e+"; ?predicate ?object. \n              OPTIONAL {    \n               ?object a risk:citation. \n               ?object risk:has_citation_pubmed_identifier ?has_citation_pubmed_identifier  \n              } \n              OPTIONAL {    \n               ?object a risk:observable. \n               ?object risk:has_observable_name ?has_observable_name  \n              "+p("?has_observable_name")+" \n              } \n              OPTIONAL {    \n               ?object a risk:risk_element. \n               ?object risk:has_risk_element_name ?has_risk_element_name  \n              "+p("?has_risk_element_name")+" \n              } \n              OPTIONAL {    \n               ?object a risk:measurement_type. \n               ?object risk:has_measurement_type_name ?has_measurement_type_name  \n              "+p("?has_measurement_type_name")+" \n              } \n              OPTIONAL {    \n               ?object a risk:risk_factor.  \n               ?object risk:has_risk_factor_association_type ?has_risk_factor_association_type. \n               ?object risk:has_risk_factor_source ?has_risk_factor_source. \n               ?object risk:has_risk_factor_target ?has_risk_factor_target. \n               ?has_risk_factor_source risk:has_risk_element_name ?has_source_risk_element_name.  \n               ?has_risk_factor_target risk:has_risk_element_name ?has_target_risk_element_name.  \n              "+p("?has_source_risk_element_name")+" \n              "+p("?has_target_risk_element_name")+" \n              } \n";return r?(i+="FILTER ( "+r.map(function(e){return"?subject="+e.split("_")[0]+":"+e}).join("||")+"  )\n }",f(i)):(i+="}",f(i,null,t.USECACHE?e+"_all":null))}function h(){var e="SELECT \n    (COUNT(?rf) as ?risk_factors) \n    (COUNT(?rf_r) as ?risk_factors_unreviewed) \n    (COUNT(?rl) as ?risk_elements) \n    (COUNT(?rl_r) as ?risk_elements_unreviewed) \n    (COUNT(?ob) as ?observables) \n    (COUNT(?ob_r) as ?observables_unreviewed) \n    (COUNT(?rv) as ?risk_evidences) \n    (COUNT(?rv_r) as ?risk_evidences_unreviewed) \n    (COUNT(?ci) as ?citations) \n    (COUNT(?me) as ?measurement_types)  \n    FROM "+t.CARRE_DEFAULT_GRAPH+" WHERE { \n    {?rf a risk:risk_factor} \n    UNION { ?rf_r a risk:risk_factor FILTER NOT EXISTS {?rf_r risk:has_reviewer ?anything} } \n    UNION {?rl a risk:risk_element} \n    UNION { ?rl_r a risk:risk_element FILTER NOT EXISTS {?rl_r risk:has_reviewer ?anything} } \n    UNION {?ob a risk:observable} UNION { ?ob_r a risk:observable FILTER NOT EXISTS {?ob_r risk:has_reviewer ?anything} } \n    UNION {?rv a risk:risk_evidence} UNION { ?rv_r a risk:risk_evidence FILTER NOT EXISTS {?rv_r risk:has_reviewer ?anything} } \n    UNION {?ci a risk:citation} \n    UNION {?me a risk:measurement_type}  }";return t.USECACHE?v(e,null,"count_all"):g(e)}function f(e,t,r){var a=["subject","predicate","object","has_observable_name","has_risk_element_name","has_measurement_type_name","has_risk_factor_association_type","has_risk_factor_source","has_risk_factor_target","has_source_risk_element_name","has_target_risk_element_name","has_citation_pubmed_identifier"];return r?v(e,null,r).then(function(e){if(t)return e;var r=i.groupByProp(e.data,a,null,"value");return r.data.length>0?i.mappings(r):[]}):g(e).then(function(e){if(t)return e;var r=i.groupByProp(e.data,a,null,"value");if(r.data.length>0){var s=i.mappings(r);return s}return[]})}function g(i,o){if(d.isOffline)return n.go("500_API_ERROR"),a.reject({});var l={};return l.sparql=(o?"":k)+i,r.cookie&&(l.token=r.cookie),e.post(t.CARRE_API_URL+"query",l).then(function(e){return"No JSON object could be decoded"===e.data||500===e.status||404===e.status||401===e.status?(s.error("<p>"+e.data+"</p>","<h4>Oh Error</h4>"),a.reject(e)):e})["catch"](function(e){c.bug(e),n.go("500_API_ERROR")})}function v(i,o,l){var c=t.CARRE_DEFAULT_GRAPH.substring(t.CARRE_DEFAULT_GRAPH.lastIndexOf("/")+1,t.CARRE_DEFAULT_GRAPH.lastIndexOf(">")),d=t.CARRE_CACHE_URL+"carreapi/"+c+"_"+t.LANG+"_"+l+"/"+encodeURIComponent(t.CARRE_API_URL+"query")+"/"+encodeURIComponent((o?"":k)+i)+(r.cookie?"/"+r.cookie:"");return e.get(d,{cache:!1}).then(function(e){return"No JSON object could be decoded"===e.data?(s.error("<p>"+e.data+"</p>","<h4>Oh Error</h4>"),a.reject(e)):e})["catch"](function(e){n.go("500_API_ERROR")})}function b(r){var i=t.CARRE_DEFAULT_GRAPH.substring(t.CARRE_DEFAULT_GRAPH.lastIndexOf("/")+1,t.CARRE_DEFAULT_GRAPH.lastIndexOf(">")),a=t.CARRE_CACHE_URL+"refresh_cache/"+i+"_"+t.LANG+"_"+r;return e.get(a).then(function(e){})["catch"](function(e){
n.go("500_API_ERROR")})}this.exports={countAll:h,query:g,cacheQuery:v,invalidateCache:b,selectQuery:f,instances:_,search:m,"delete":u};var k="PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> \nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \nPREFIX carreUsers: <https://carre.kmi.open.ac.uk/users/> \nPREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \nPREFIX ME: <http://carre.kmi.open.ac.uk/measurement_types/> \nPREFIX OB: <http://carre.kmi.open.ac.uk/observables/> \nPREFIX RL: <http://carre.kmi.open.ac.uk/risk_elements/> \nPREFIX RV: <http://carre.kmi.open.ac.uk/risk_evidences/> \nPREFIX RF: <http://carre.kmi.open.ac.uk/risk_factors/> \nPREFIX RW: <http://carre.kmi.open.ac.uk/risk_reviews/> \nPREFIX MD: <http://carre.kmi.open.ac.uk/medical_experts/> \nPREFIX CI: <http://carre.kmi.open.ac.uk/citations/> \n";return this.exports}]),angular.module("CarreEntrySystem").service("Bioportal",["$http","CONFIG",function(e,t){var r=t.BIOPORTAL_API_KEY,i=t.BIOPORTAL_API_URL,a=function(e,t,r){return s(e,t).then(function(e){var t=[],i=[];return e.data.collection.forEach(function(e){(r||(e.cui?e.cui.length>0:!1)&&-1===t.indexOf(e.cui[0]))&&(r||t.push(e.cui[0]),i.push({label:e.prefLabel,value:r?e["@id"]:e.cui[0],link:e.links.ui}))}),i})},s=function(a,s){s=s||{};var n={display_context:s.display_context||"false",require_exact_match:s.require_exact_match||"false",include:s.include||"prefLabel,definition,cui",display_links:s.display_links||"true",ontologies:s.ontologies||t.BIOPORTAL_ONTOLOGIES,require_definitions:s.require_definitions||"false"};return n.q=a,n.apikey=r,e.get(i+"search",{params:n,ignoreLoadingBar:!0,cache:!0})},n=function(t,a){var s=a||{};return s.text=t,s.apikey=r,e.get(i+"annotator",{params:s,ignoreLoadingBar:!0,cache:!0})},o=function(t,a){var s=a||{};return s.input=t,s.apikey=r,e.get(i+"recommender",{params:s,ignoreLoadingBar:!0,cache:!0})};return{fetch:a,search:s,annotator:n,recommender:o}}]),function(){"use strict";function e(e){return function(t){return e.trustAsResourceUrl(t)}}function t(){return function(e,t){return 0===t.length?!1:(t.forEach(function(t){return e.value===t?!0:void 0}),!1)}}function r(){return function(e,t){return!e||e.length<=0||!t||t.length<=0?"":e.substring(e.lastIndexOf(t)+1)}}function i(){return function(e){return!e||e.length<=0?"":e.replace(new RegExp(">=","g"),"").replace(new RegExp("<=","g"),"")}}function a(){return function(e,t){var r=[];return 0===t.length?e:(e.forEach(function(e){-1===t.indexOf(e.value)&&r.push(e)}),r)}}function s(){return function(e,t){var r=[];return angular.isArray(e)?e.forEach(function(e){for(var i=!1,a=Object.keys(t),s=0;s<a.length;s++){var n=a[s],o=t[n].toLowerCase();try{if(-1!==e[n].toString().toLowerCase().indexOf(o)){i=!0;break}}catch(l){}}i&&r.push(e)}):r=e,r}}e.$inject=["$sce"],angular.module("CarreEntrySystem").filter("trustAsResourceUrl",e).filter("hideSelected",t).filter("sliceLast",r).filter("prettySigns",i).filter("propsFilter",s).filter("exclude",a)}(),function(){"use strict";function e(e){return{restrict:"A",controller:["$scope","$element","$attrs","CONFIG",function(t,r,i,a){function s(){var t=i.uiSrefActiveIf;e.includes(t)||e.is(t)?(r.css("border-right","5px solid "+n(t)),r.addClass("active")):(r.css("border-right","none"),r.removeClass("active"))}var n=function(e){var t=e.substr(e.lastIndexOf(".")+1),r="";switch(t){case"risk_factors":r=a.COLORS[0];break;case"risk_evidences":r=a.COLORS[1];break;case"risk_elements":r=a.COLORS[2];break;case"observables":r=a.COLORS[3];break;case"citations":r=a.COLORS[4];break;default:r="#EEEEEE"}return r};t.$on("$stateChangeSuccess",s),s()}]}}function t(e){return{replace:!1,scope:!0,link:function(t,r,i){var a,s,n,o,l,c,d,u=r[0],m=function(){s=30,l=0,t.timoutId=null,c=parseInt(i.countTo)||0,t.value=parseInt(i.value,10)||0,n=1e3*parseFloat(i.duration)||0,o=Math.ceil(n/s),d=(c-t.value)/o,a=t.value},p=function(){t.timoutId=e(function(){a+=d,l++,l>=o?(e.cancel(t.timoutId),a=c,u.textContent=c):(u.textContent=Math.round(a),p())},s)},_=function(){t.timoutId&&e.cancel(t.timoutId),m(),p()};return i.$observe("countTo",function(e){e&&_()}),i.$observe("value",function(e){_()}),!0}}}e.$inject=["$state"],t.$inject=["$timeout"],angular.module("CarreEntrySystem").directive("uiSrefActiveIf",e).directive("countTo",t)}(),function(){"use strict";function e(e,t,r,i,a,s,n,o,l,c){function d(){return"DEV"===i.ENV?window.location.host+"/#/":"PROD"===i.ENV?window.location.host+"/":void 0}var u=this;i.ROOT_URL=d(),u.config=i,u.user=u.config.currentUser||{},u.loginUrl=i.CARRE_DEVICES+"login?next=",u.logoutUrl=i.CARRE_DEVICES+"logout?next=",u.settingsUrl=i.CARRE_DEVICES+"settings",u.passwordUrl=i.CARRE_DEVICES+"recover?next=",c.isEmbedded||(u.user.username?t.success("Have fun with the risk factors!","<h4>Hi "+u.user.username+"!</h4>"):t.info("Please login if you want to add/edit data.","<h4>Hello Guest!</h4>")),u.deleteCurrent=function(r){r&&n.swal({title:"Are you sure?",text:"Your will not be able to recover this element!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n&&(i.AllowDelete?a["delete"](r).then(function(){s.go("^.list")}):(t.info(r+" deleted!","DEBUG"),e(function(){s.go("^.list")},500)))})},l.IntroOptions=o.options(),e(function(){!i.currentUser.username&&"DEV"===i.ENV&&s.includes("main.dashboard")&&o.startGuest(l.startIntro)},1e3)}e.$inject=["$timeout","toastr","$location","CONFIG","CARRE","$state","SweetAlert","Tutorial","$scope","$rootScope"],angular.module("CarreEntrySystem").controller("MainController",e)}(),function(){"use strict";function e(e,t,r){e.defineRole("authenticated_user",function(e){return t.isLoggedIn()})}function t(e,t,r,i){r.search().lang&&(i.LANG=r.search().lang),r.search().embed&&(e.isEmbedded=!0,r.search().hidemenu&&(e.hideMenu=!0),r.search().showonlygraph&&(e.showOnlyGraph=!0)),i.useOfflineMode&&e.$on("$stateChangeStart",function(t,r,i,a,s,n){"500_API_ERROR"===r.name&&(t.preventDefault(),e.isOffline=!0)}),e.$on("$stateChangeError",function(e,t,r,i,a,s){e.preventDefault()})}e.$inject=["Permission","Auth","$q"],t.$inject=["$rootScope","$state","$location","CONFIG"],angular.module("CarreEntrySystem").run(t).run(e)}(),$(function(){$("#side-menu").metisMenu()}),$(function(){$(window).bind("load resize",function(){topOffset=50,width=this.window.innerWidth>0?this.window.innerWidth:this.screen.width,width<768?($("div.navbar-collapse").addClass("collapse"),topOffset=100):$("div.navbar-collapse").removeClass("collapse"),height=(this.window.innerHeight>0?this.window.innerHeight:this.screen.height)-1,height-=topOffset,height<1&&(height=1),height>topOffset&&$("#page-wrapper").css("min-height",height+"px")});var e=window.location,t=$("ul.nav a").filter(function(){return this.href==e||0==e.href.indexOf(this.href)}).addClass("active").parent().parent().addClass("in").parent();t.is("li")&&t.addClass("active")}),function(){"use strict";function e(e){e.state("main",{"abstract":!0,controller:"MainController",controllerAs:"main",templateUrl:"app/main.html",resolve:{currentUser:["Auth",function(e){return e.getUser()}]}}).state("404_error",{templateUrl:"404.html",url:"/404_error"}).state("500_API_ERROR",{templateUrl:"500_API.html",url:"/500_api_error"})}e.$inject=["$stateProvider"],angular.module("CarreEntrySystem").config(e)}(),function(){"use strict";angular.module("CarreEntrySystem").constant("CONFIG",{currentUser:{},USECACHE:!0,ENV:"PROD",useOfflineMode:!0}).config(["$locationProvider","$compileProvider","$urlRouterProvider",function(e,t,r){r.otherwise(function(e){var t=e.get("$state");t.go("404_error")}),e.html5Mode(!0),t.debugInfoEnabled(!1),function(e,t,r,i,a,s,n){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,s=t.createElement(r),n=t.getElementsByTagName(r)[0],s.async=1,s.src=i,n.parentNode.insertBefore(s,n)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-60507179-2","auto"),ga("send","pageview")}])}(),function(){"use strict";function e(e,t,r,i){var a={language:"en",api_url:"https://carre.kmi.open.ac.uk/ws/",cache_url:"https://cache.carre-project.eu/",authentication_url:"https://devices.carre-project.eu/devices/accounts/",graph_url:"carre.kmi.open.ac.uk"};window.CARRE_ENTRY_SYSTEM_CONFIGURATION=angular.isObject(window.CARRE_ENTRY_SYSTEM_CONFIGURATION)?angular.extend(a,window.CARRE_ENTRY_SYSTEM_CONFIGURATION):a,i.CARRE_DEFAULT_GRAPH="<http://"+window.CARRE_ENTRY_SYSTEM_CONFIGURATION.graph_url+"/public>",i.CARRE_ARCHIVE_GRAPH="<http://"+window.CARRE_ENTRY_SYSTEM_CONFIGURATION.graph_url+"/riskdata>",i.CARRE_DEVICES=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.authentication_url,i.CARRE_API_URL=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.api_url,i.CARRE_CACHE_URL=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.cache_url,"NO_CACHE"===i.CARRE_CACHE_URL&&(i.USECACHE=!1),i.BIOPORTAL_API_URL="https://data.bioontology.org/",i.BIOPORTAL_API_KEY="a15281a9-d87d-4c0f-b7aa-31debe0f6449",i.BIOPORTAL_ONTOLOGIES="ICD10,ICD10CM",i.PUBMED_API_URL="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/",i.EUROPEPMC_API_URL="https://www.ebi.ac.uk/europepmc/webservices/rest/",i.CACHED_QUERIES={},i.OPTIONS={usePrefix:!0},i.LANG=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.language||"en",i.LANGPredicates=["risk:has_risk_element_name","risk:has_observable_name","risk:has_measurement_type_name","risk:has_enumeration_values","risk:has_label"],i.SENSOR_PREDICATES=["bmi","height","provenance","calories_metabolised","steps","o2saturation","light_activity_duration","sodium","sleep_time","sleep_efficiency","asleep_duration","deep_sleep_duration","weight","protein","calories_b_m_r","sedentary_activity_duration","date","body_fat","muscle_mass","water_mass","bone_mass","body_d_c_i","intense_activity_duration","intense_activity_distance","logged_activity_distance","sedentary_activity_distance","actuality","minutes_after_wakeup","fat","fibre","blood_pressure_systolic","blood_pressure_diastolic","who_b_p_level","pulse","elevation","floors","moderate_activity_duration","light_activity_distance","moderate_activity_distance","tracked_activity_distance","distance","times_restless","time_to_fall_asleep","awake_duration","restless_duration","calories","activity_calories","marginal_calories","times_awake","carbs","glucose","dinner_situation","drug_situation","start_date","sleep_status","note","latitude","longitude","end_date","light_sleep_duration","water","lean_mass","location","arrhythmia_type","activity_points","fat_mass","timezone","logged_activity_duration","logged_activity_name","http://carre.kmi.open.ac.uk/ontology/sensors.owl#date","diagnosis","left_ventricular_hypertrophy_diagnosis","acute_kidney_injury_diagnosis","egfr","blood_pressure","uric_acid_serum_concentration","smoking_status","blood_glucose_fasting","blood_glucose_2h_glucose_after_oral_glucose_tolerance_test","duration","heartrate","haemoglobin_hb","high-density_lipoprotein_cholesterol_hdl-c","ldl-c_low-density_lipoprotein_cholesterol","total_cholesterol_tc","triglycerides_serum_concentration_tg","hemoglobin_hb_level","diabetes_diagnosis","hypertension_diagnosis"];var s=["#e08526","#a118fb","#2f739c","#2db315","#fb64b0","#27af8d","#4663db","#706f42","#ba4645","#b68bce","#ad36bc","#ac9c1f","#b3948f","#2b7d1a","#d32528","#ad4a80","#8f6521","#4ea8ad","#87a64a","#3d7860","#77687f","#ea7790","#fe4df0","#cb2964","#9d5962","#f57550","#d78670","#4858fb","#7499ee","#c37eef","#6f60bc","#9a3cdb","#7ca66d","#107d40","#3e6cbb","#6ba78d","#f067d0","#939f8e","#4f7741","#bd4525","#c52d81","#c3924d","#22a3ee","#54717e","#657061","#58771c","#d02747","#766f1e","#c589af","#7d43fb","#a696ae","#81a0ae","#8b6543","#0d797e","#69ad18","#4dae6c","#5fad49","#a14c9e","#8ea51c","#c79223","#a79d4b","#bd936f","#836661","#9f9e6e","#e26af0","#65a1ce","#63699d","#a75823","#935b7f","#dd854e","#9297ce","#914fbc","#d47bcf","#b54863","#d0878f","#f17671","#a08def","#7753db","#bb319e","#e179af","#f9742a","#a35844","#855d9d"],n=["#377eb8","#e41a1c","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"].concat(s);i.COLORS=n.concat(d3.scale.category20().range()),Chart.defaults.global.colours=i.COLORS.map(function(e){return{fillColor:e}}),angular.extend(e,{allowHtml:!0,closeButton:!1,closeHtml:"<button>&times;</button>",extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},positionClass:"toast-top-right",messageClass:"toast-message",onHidden:null,onShown:null,onTap:null,preventDuplicates:!1,progressBar:!1,tapToDismiss:!0,timeOut:4e3,titleClass:"toast-title",toastClass:"toast"}),r.spinnerTemplate='<div style="position:absolute; top:-80px; z-index:99999; left:49%"><div class="loader">Loading...</div></div>',r.latencyThreshold=600,t.interceptors.push(["$q","$injector",function(e,t){function r(e){var r=t.get("$timeout");return i*=2,r(function(){var r=t.get("$http");return r(e)},i)}var i=1e3;return{request:function(e){return e},requestError:function(e){return e},responseError:function(t){return 500===t.status||-1===t.status?4e3>i?r(t.config):e.reject(t):(i=1e3,e.reject(t))}}}])}e.$inject=["toastrConfig","$httpProvider","cfpLoadingBarProvider","CONFIG"],angular.module("CarreEntrySystem").config(e)}(),angular.module("CarreEntrySystem").run(["$templateCache",function(e){e.put("app/main.html",'<div id="wrapper" ng-intro-options="IntroOptions" ng-intro-method="startIntro" ng-intro-oncomplete="CompletedEvent" ng-intro-onexit="ExitEvent" ng-intro-onchange="ChangeEvent" ng-intro-onbeforechange="BeforeChangeEvent" ng-intro-autostart="false"><div style="width:100%; height:19px; background-color:#E41A1C; color:white" class="text-center" ng-if="isOffline">OFFLINE MODE</div><carre-header ng-hide="isEmbedded"></carre-header><sidebar ng-if="!hideMenu"></sidebar><div id="page-wrapper" style="min-height: 561px;" ng-style="hideMenu?{\'margin\':\'0 0 0 0\'}:{}"><div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-6"><labe>Configuration<pre>{{main.config | json}}</pre></labe></div><div class="col-xs-6"><labe>User<pre>{{main.user | json}}</pre></labe></div></div><div ui-view=""></div></div><carre-footer ng-hide="isEmbedded"></carre-footer></div>'),e.put("app/about/about.html",'<div><p>The CARRE risk entry system enables the <a href="http://entry.carre-project.eu/medical_experts">medical experts</a> in the <a href="http://www.carre-project.eu/">CARRE project</a> to encode the risk factors between biological, demographic, lifestyle and environmental elements and clinical outcomes in accordance with evidence from the clinical literature. The presented system is based fundamentally on <a href="http://www.w3.org/DesignIssues/LinkedData.html"></a>Linked Data principles, and so in order to make the best use of these encoded factors, they are available as Linked Data through the <a href="http://carre.kmi.open.ac.uk:8890/sparql">CARRE SPARQL Endpoint</a>, making use of control vocabularies (<a href="https://www.nlm.nih.gov/research/umls/">UMLS</a> , <a href="https://www.nlm.nih.gov/snomed/"></a>SNOMED, etc.) and the <a href="http://bioportal.bioontology.org/ontologies/CARRE">CARRE risk factor ontology</a>; specifically, they are encoded in the (standard) Resource Description Framework (<a href="http://www.w3.org/RDF/">RDF</a>) format.</p><p>The system has been developed as a client side web application that follows the <a href="http://microservices.io/">Microservices</a> architectural style and provides native RDF support via the <a href="https://carre.kmi.open.ac.uk/ws/">CARRE API</a> and the <a href="http://carre.kmi.open.ac.uk:8890/sparql">CARRE SPARQL Endpoint</a>. Moreover custom form components have been developed to reflect the structure of the <a href="http://bioportal.bioontology.org/ontologies/CARRE">CARRE risk factor ontology</a>, so that citations, observables, risk elements, risk evidences and risk factors are automatically stored into the CARRE RDF triple store. The CARRE risk entry system is implemented in <a href="http://www.w3.org/TR/html5/">HTML5</a>, <a href="http://www.w3.org/Style/CSS/"></a>CSS and <a href="https://www.javascript.com/">JavaScript</a> using the <a href="https://angularjs.org/">AngularJS</a> framework. The system is open source and the source code is available at <a href="https://github.com/carre-project/carre-entry-system">GitHub</a>. The system maintains referential integrity, so that if diabetes is entered as a risk element entity, then a risk factor representing an observed link between diabetes and hypertension will refer to the existing diabetes risk element entity. Medical experts are supported in the reuse of data already entered into the system by the user interface, which allows existing relevant entities to be selected via appropriate searchable lists wherever possible.</p><p>Web development: <a href="http://nporto.com/">Nick Portokallidis</a></p><p>Data cleansing: <a href="http://drosatos.info/">George Drosatos</a></p><p>Scientific supervision: <a href="http://iris.med.duth.gr/kaldoudi/en/">Eleni Kaldoudi</a></p></div><br><br><footer class="footer" style="height:60px;"><div class="row"><div class="col-xs-6"><span><a href="//www.carre-project.eu" target="_blank"><img src="assets/images/CARRE-FooterLogo.png" width="36" height="40" alt="CARRE">&nbsp;CARRE Project  2015</a></span></div><div class="col-xs-6"><span class="pull-right" style="">FP7-ICT-611140.&nbsp; <a href="//cordis.europa.eu/" target="_blank"><img src="assets/images/Picture1-150x150.png" width="40" height="40" alt="EU"></a></span></div></div></footer>'),e.put("app/components/carre-element/template.html",'<div class="carre-element"><div cg-busy="loading" style="position:relative;top:-15px;z-index:1"></div><div ng-if="mode===\'view\'" class="carre-element-view"><div ng-class="{\'col-sm-6\':current.pubmedId,\'col-sm-12\':!current.pubmedId }"><ul class="list-group"><li ng-repeat="field in fields" ng-if="current[field.value]" class="list-group-item">{{field.label}}:<carre-linker model="current" property="{{field.value}}"></carre-linker></li></ul><a href="{{rdf_source | trustAsResourceUrl}}" target="_blank" class="btn btn-default btn-xs pull-right">View RDF source</a></div><div ng-if="current.pubmedId" class="col-sm-6"><carre-view-pubmed id="{{current.pubmedId}}"></carre-view-pubmed></div></div><div ng-if="mode!==\'view\'" class="carre-element-form"><risk-element-form ng-if="type===\'risk_element\'&&(current.id||mode===\'create\')" model="current"></risk-element-form><risk-factor-form ng-if="type===\'risk_factor\'&&(current.id||mode===\'create\')" model="current"></risk-factor-form><risk-evidence-form ng-if="type===\'risk_evidence\'&&(current.id||mode===\'create\')" model="current"></risk-evidence-form><citation-form ng-if="type===\'citation\'&&(current.id||mode===\'create\')" model="current"></citation-form><measurement-type-form ng-if="type===\'measurement_type\'&&(current.id||mode===\'create\')" model="current"></measurement-type-form><observable-form ng-if="type===\'observable\'&&(current.id||mode===\'create\')" model="current"></observable-form></div></div>'),e.put("app/components/carre-element-controls/template.html",'<div class="well-sm" ng-if="controls.user"><a ng-show="\'**.view\'|includedByState" class="btn btn-xs btn-primary" ui-sref="^.edit({id:controls.carreId})"><i class="fa fa-pencil"></i> Edit</a> <a ng-show="\'**.edit\'|includedByState" class="btn btn-xs btn-primary" ui-sref="^.view({id:controls.carreId})"><i class="fa fa-eye"></i> View</a> <span ng-if="controls.dev&&controls.carreId"><a class="btn btn-xs btn-danger" href="" ng-click="main.deleteCurrent(controls.carreId)"><i class="fa fa-trash-o"></i> Delete</a> <span class="badge">{{controls.carreId}}</span></span></div>'),e.put("app/components/footer/footer.html",'<footer class="footer" style="height:60px;padding:10px"><div class="col-xs-6"><span style="padding-left:10px"><a href="//www.carre-project.eu" target="_blank"><img src="assets/images/CARRE-FooterLogo.png" width="36" height="40" alt="CARRE">&nbsp;CARRE Project  2015</a></span></div><div class="col-xs-6"><span class="pull-right" style="padding-right:10px">CARRE project is partly funded by the EC under the grant no. FP7-ICT-611140.&nbsp; <a href="//cordis.europa.eu/" target="_blank"><img src="assets/images/Picture1-150x150.png" width="40" height="40" alt="EU"></a></span></div></footer>'),e.put("app/components/graph-chord/template.html",'<div cg-busy="loading"><carre-graph-controls selected-id="selectedId" disable-options="{showRiskEvidences:true,onlyPath:true}" enable-rotation="true" rotation="rotation" refresh="init()" add-size="addSize()" remove-size="removeSize()" navigate="goToSelected()" expand="addNodeRelations()" clear="deleteSelected()"></carre-graph-controls><div id="chord" class="carre-graph"></div></div>'),e.put("app/components/graph-controls/template.html",'<div class="carre-graph-controls"><div class="col-xs-6 col-sm-7 col-md-5"><div ng-show="selectedId" class="panel panel-xs panel-default" style="margin:0;position:absolute;z-index:4"><div class="panel-heading" style="padding-top:0;padding-bottom:0;padding-left:0;"><button ng-show="!showDetails" style="background:none" ng-click="showDetails=!showDetails" class="btn btn-sm"><i class="fa fa-caret-square-o-down"></i> Show details</button> <button ng-show="showDetails" ng-click="showDetails=!showDetails" class="btn btn-sm"><i class="fa fa-caret-square-o-up"></i> Hide details</button> <span class="hidden-xs"><strong>{{controls.getType(controls.selectedId).label}}</strong></span> <button ng-click="controls.navigate({})" class="btn btn-xs btn-primary" title="Navigate"><i class="fa fa-link"></i></button> <button ng-show="controls.selectedId && controls.selectedId.indexOf(\'RL\')>=0" title="Expand" ng-click="controls.expand({id:controls.selectedId})" class="btn btn-xs btn-info"><i class="fa fa-share-alt"></i></button> <button ng-show="controls.selectedId && controls.selectedId.indexOf(\'RL\')>=0" title="Remove from graph" ng-click="controls.clear({})" class="btn btn-xs btn-danger"><i class="fa fa-remove"></i></button></div><div class="panel-body" ng-if="showDetails&&controls.selectedId"><carre-element elem-id="{{controls.selectedId}}" mode="view" not-fields="has_author,has_reviewer" hide-pubmed="true"></carre-element></div></div></div><div class="col-xs-6 col-sm-5 col-md-5 col-md-offset-2 text-right"><div ng-if="controls.enableRotation" class="btn-group"><button ng-click="controls.rotation=controls.rotation-40" class="btn btn-sm btn-default"><i class="fa fa-chevron-left"></i></button> <button class="btn btn-sm btn-default disabled">ROTATE</button> <button ng-click="controls.rotation=controls.rotation+40" class="btn btn-sm btn-default"><i class="fa fa-chevron-right"></i></button></div><div ng-hide="controls.disableOptions.showRiskEvidences&&controls.disableOptions.onlyPath" class="btn-group" uib-dropdown="" is-open="status.isopen"><button type="button" class="btn btn-sm btn-default" uib-dropdown-toggle="">Options <span class="caret"></span></button><ul uib-dropdown-menu="" role="menu"><li ng-hide="controls.disableOptions.showRiskEvidences" role="menuitem" style="width:180px"><label class="carre-dropdown-checkbox">Show Risk evidences <input type="checkbox" ng-change="applyRefresh()" ng-model="controls.showRiskEvidences"></label></li><li ng-show="controls.showSlider" role="menuitem" style="width:180px"><label style="width: 100%;" class="carre-dropdown-checkbox">Ratio filter<rzslider rz-slider-model="controls.ratioFilter.min" rz-slider-high="controls.ratioFilter.max" rz-slider-options="controls.slider_toggle.options"></rzslider></label></li><li ng-hide="controls.disableOptions.onlyPath" role="menuitem" style="width:180px"><label class="carre-dropdown-checkbox">Show only path <input type="checkbox" ng-change="applyRefresh()" ng-model="controls.onlyPath"></label></li></ul></div><button ng-click="controls.removeSize({})" class="btn btn-sm btn-default"><i class="fa fa-minus"></i></button> <button ng-click="controls.addSize({})" class="btn btn-sm btn-default"><i class="fa fa-plus"></i></button> <button ng-click="controls.refresh({})" class="btn btn-sm btn-default"><i class="fa fa-refresh"></i></button></div></div>'),e.put("app/components/graph-network-d3/template.html",'<div cg-busy="loading"><carre-graph-controls selected-id="selectedId" only-path="onlyCore" show-risk-evidences="showRiskEvidences" refresh="init()" add-size="addSize()" remove-size="removeSize()" navigate="goToSelected()" expand="addNodeRelations()" clear="deleteSelected()"></carre-graph-controls><div id="network" class="carre-graph"></div></div>'),e.put("app/components/graph-network-vis/template.html",'<div cg-busy="loading"><carre-graph-controls selected-id="selectedId" only-path="onlyCore" show-risk-evidences="showRiskEvidences" refresh="init()" add-size="addSize()" remove-size="removeSize()" navigate="goToSelected()" expand="addNodeRelations()" clear="deleteSelected()"></carre-graph-controls><div id="network" class="carre-graph"></div></div>'),e.put("app/components/graph-sankey/template.html",'<div cg-busy="loading"><carre-graph-controls selected-id="selectedId" only-path="onlyCore" disable-options="{onlyPath:true}" show-risk-evidences="showRiskEvidences" ratio-filter="ratioFilter" refresh="init()" add-size="addSize()" remove-size="removeSize()" navigate="goToSelected()" expand="addNodeRelations()" clear="deleteSelected()"></carre-graph-controls><div id="sankey" class="carre-graph"></div></div>'),e.put("app/components/header/header.html",'<nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0"><div class="navbar-header"><button type="button" class="navbar-toggle" ng-click="toggleNavbar()"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/"><img src="assets/images/carre_logo.png" class="logo" alt="CARRE"> CARRE Risk entry system</a></div><header-notification></header-notification></nav>'),e.put("app/components/le_editor/le_editor.html",'<div class="alert alert-default alert-group"><div class="form-inline"><select ng-options="o.name as o.name for o in operators" ng-model="group.operator" class="form-control input-sm"></select><a style="margin-left: 5px" ng-click="addCondition()" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-plus-sign"></span> Add Condition</a> <a style="margin-left: 5px" ng-click="addGroup()" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-plus-sign"></span> Add Group</a> <a ng-show="$parent.group" style="margin-left: 5px" ng-click="removeGroup()" class="btn btn-sm btn-danger"><span class="glyphicon glyphicon-minus-sign"></span> Remove Group</a></div><div class="group-conditions"><div ng-repeat="rule in group.rules track by $index| orderBy:\'index\'" class="condition"><div ng-switch="rule.hasOwnProperty(\'group\')"><div ng-switch-when="true"><le-editor observables="observables" metypes="metypes" group="rule.group"></le-editor></div><div ng-switch-default="ng-switch-default"><div class="form-inline"><div class="row" uib-collapse="!rule.hiddenData"><div class="text-center">loading <img src="assets/images/ajax-loader.gif"></div></div><div class="row" uib-collapse="rule.hiddenData"><ui-select class="le-editor observables input-sm" ng-model="rule.field" theme="bootstrap" ng-init="getMeasurementType(null, rule.field, rule)" on-select="getMeasurementType($item, $model, rule)"><ui-select-match placeholder="Select observable">{{$select.selected.label||\'Select Observable\'}}</ui-select-match><ui-select-choices repeat="ob.value as ob in observables | propsFilter: {label: $select.search}"><div ng-bind-html="ob.label | highlight: $select.search"></div></ui-select-choices></ui-select><select ng-options="c.value as c.name for c in conditions | filter: {types:rule.datatype}" ng-model="rule.condition" class="form-control"></select><div class="input-group"><input ng-if="rule.datatype===\'integer\'" style="margin-left: 5px; width:100px" min="0" type="number" ng-model="rule.data" class="form-control"> <input ng-if="rule.datatype===\'float\'" style="margin-left: 5px; width:100px" type="number" step="0.01" min="0" ng-model="rule.data" class="form-control"><select ng-if="rule.datatype===\'enum\'||rule.datatype===\'boolean\'" style="margin-left: 5px" ng-options="c.value as c.name for c in rule.dataoptions" ng-model="rule.data" class="form-control"><option value="">Select</option></select><span popover-trigger="mouseenter" uib-popover="{{rule.unit_label}}" class="input-group-addon" ng-show="rule.unit">{{rule.unit}}</span></div><a style="margin-left: 10px" ng-click="removeCondition($index)" class="btn btn-xs btn-danger"><span class="glyphicon glyphicon-minus-sign"></span></a></div></div></div></div><span style="margin: 0 15%;" class="text-center label label-default">{{(($index+1)!==group.rules.length?group.operator:"")}}</span></div></div></div>'),e.put("app/components/linker/linker.html",'<span><span ng-if="show===\'links\'"><span ng-repeat="i in items">&nbsp;<a href="/{{i.link | trustAsResourceUrl}}">{{i.label}}</a><span ng-if="!$last">,</span></span></span> <span ng-if="show===\'external_link\'" ng-bind-html="external_link | trustAsResourceUrl"></span> <span ng-if="show===\'condition\'" ng-bind-html="label | trustAsResourceUrl"></span> <span ng-if="show===\'label\'">{{label}}</span></span>'),e.put("app/components/sidebar/sidebar.html",'<div class="navbar-default sidebar" role="navigation"><div class="sidebar-nav navbar-collapse collapse"><ul class="nav in" id="side-menu"><li><a href="" style="border:none; text-align:left;" class="btn btn-default" ng-click="showAbout=!showAbout"><i class="fa fa-info"></i> About</a></li><li><a ui-sref="main.dashboard" ui-sref-active-if="main.dashboard">Dashboard</a></li><li><a ui-sref="main.explore" ui-sref-active-if="main.explore">Explore</a></li><li id="carreElements" ng-class="{active: carreElements}"><a href="" ng-click="carreElements=!carreElements">CARRE elements<span class="fa arrow"></span></a><ul class="nav nav-second-level" uib-collapse="!carreElements"><li><a ui-sref="main.risk_factors.list" ui-sref-active-if="main.risk_factors">Risk Factors</a></li><li><a ui-sref="main.risk_evidences.list" ui-sref-active-if="main.risk_evidences">Risk Evidences</a></li><li><a ui-sref="main.risk_elements.list" ui-sref-active-if="main.risk_elements">Risk Elements</a></li><li><a ui-sref="main.observables.list" ui-sref-active-if="main.observables">Observables</a></li><li><a ui-sref="main.citations.list" ui-sref-active-if="main.citations">Citations</a></li><li><a ui-sref="main.measurement_types.list" ui-sref-active-if="main.measurement_types">Measurement Types</a></li></ul></li><li><a ui-sref="main.medical_experts.list" ui-sref-active-if="main.medical_experts">Medical experts</a></li></ul></div><div pageslide="" ps-size="{{slideWidth}}px" ps-open="showAbout" ps-side="right"><div class="row" style="padding:30px; padding-top:15px; padding-bottom:0; margin-bottom:0;"><a href="" ng-click="showAbout=!showAbout" class="btn btn-primary pull-left"><i class="fa fa-times fa-lg"></i></a></div><div class="row" style="padding:50px; margin-top:0; padding-top:0; overflow: auto; height: 90%;"><h2 class="header">About</h2><div autoscroll="" ng-include="" src="\'app/about/about.html\'"></div></div></div></div>'),e.put("app/components/stats/stats.html",'<div class="col-lg-3 col-md-6"><a ui-sref="{{goto}}"><div class="panel" ng-style="{\'background-color\':color}"><div class="panel-heading" style="color:white"><div class="row"><div class="col-xs-3"><i class="fa fa-{{type}} fa-5x"></i></div><div class="col-xs-9 text-right"><div class="huge"><span count-to="{{number}}" value="0" duration="1"></span></div><div>{{comments}}</div></div></div></div><div class="panel-footer" style="color:black"><span class="pull-left"><b>{{title}}</b></span> <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span><div class="clearfix"></div></div></div></a></div>'),
e.put("app/components/view-pubmed/view-pubmed.html",'<div cg-busy="loading" class="panel panel-default"><div class="panel-heading">Article : {{id}} <a ng-href="http://www.ncbi.nlm.nih.gov/pubmed/{{id}}" target="_blank">link to PubMed</a></div><div class="panel-body"><div style="white-space: pre-line; overflow-y: auto;">{{pubmedArticle| trustAsResourceUrl}}</div></div></div>'),e.put("app/pages/citations/list.html",'<div class="col-xs-12"><div cg-busy="citations.gridLoading" id="grid1" ui-grid="citations.mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div>'),e.put("app/pages/citations/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Citations <a ng-hide="\'main.citations.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.citations.list"><i class="fa fa-arrow-left"></i> Back</a> <a ng-hide="(\'main.citations.create\' | isState) ||(\'main.citations.createWithId\' | isState) || !main.user.username" class="btn btn-sm btn-primary" ui-sref="main.citations.create"><i class="fa fa-plus"></i> <b>Create new</b></a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/pages/dashboard/index.html",'<div><div class="row"><div class="col-lg-12"><h2 class="page-header">Dashboard</h2></div></div><div class="row"><div class="col-lg-6 col-md-6"><p id="intro-risk-model" class="text-center"><img style="width:100%; height:100%" src="assets/images/model.jpg"></p></div><div class="col-lg-6 col-md-6"><canvas id="intro-stats" height="210%" class="chart chart-bar chart-sm" chart-data="dashboard.counterchart_data" chart-labels="dashboard.counterchart_labels" chart-options="dashboard.counterchart_options"></canvas></div></div><div class="row"><hr></div><div class="row"><stats id="intro-box-risk-factors" goto="main.risk_factors.list" title="Risk Factors" number="{{dashboard.risk_factors.total||0}}" comments="{{dashboard.risk_factors.noreviews||0}} unreviewed!" color="{{dashboard.colors[0]}}" type="info"></stats><stats id="intro-box-risk-evidences" goto="main.risk_evidences.list" title="Risk Evidences" number="{{dashboard.risk_evidences.total||0}}" comments="{{dashboard.risk_evidences.noreviews||0}} unreviewed!" color="{{dashboard.colors[1]}}" type="info"></stats><stats goto="main.risk_elements.list" title="Risk Elements" number="{{dashboard.risk_elements.total||0}}" comments="{{dashboard.risk_elements.noreviews||0}} unreviewed!" color="{{dashboard.colors[2]}}" type="info"></stats><stats goto="main.observables.list" title="Observables" number="{{dashboard.observables.total||0}}" comments="{{dashboard.observables.noreviews||0}} unreviewed!" color="{{dashboard.colors[3]}}" type="info"></stats><stats goto="main.citations.list" title="Citations" number="{{dashboard.citations.total||0}}" comments="" color="{{dashboard.colors[4]}}" type="info"></stats></div></div>'),e.put("app/pages/explore/index.html",'<div><div class="row" ng-hide="showOnlyGraph"><div class="col-lg-12"><h2 class="page-header">Explore <small></small></h2></div></div><div class="row"><div class="col-xs-12"><div class="row" ng-hide="showOnlyGraph"><div class="col-sm-9"><div class="form-group"><label>Graph search by risk elements</label><ui-select multiple="" ng-model="explore.risk_elements_selected" theme="bootstrap" style="width:100%" on-select="refreshColors()" on-remove="refreshColors()"><ui-select-match placeholder="Select...">{{$item.label}}</ui-select-match><ui-select-choices repeat="el.value as el in explore.risk_elements | propsFilter: {label: $select.search}"><div ng-bind-html="el.label | highlight: $select.search"></div></ui-select-choices></ui-select><div style="margin-top:5px"><div class="btn-group"><button ng-click="explore.risk_elements_selected=[];" class="btn btn-sm btn-default">Reset</button> <button ng-click="explore.setNewId()" ng-disabled="explore.risk_elements_selected.length===0" class="btn btn-sm btn-primary">Search</button></div><div class="btn-group"><div class="btn-group" uib-dropdown=""><button id="single-button" type="button" class="btn btn-sm btn-default" uib-dropdown-toggle="" ng-disabled="disabled"><i class="fa fa-youtube-play"></i> Examples <span class="caret"></span></button><ul uib-dropdown-menu="" role="menu" aria-labelledby="single-button"><li role="menuitem" ng-repeat="ex in explore.examples"><a href="" ng-click="runExample(ex.data)">{{ex.label}}</a></li></ul></div><button popover-is-open="explore.popover_open" ng-disabled="explore.risk_elements_selected.length===0" popover-placement="bottom" uib-popover-template="explore.recommendPopoverUrl" popover-title="Recommend example" type="button" class="btn btn-sm btn-default"><i class="fa fa-bookmark"></i> Recommend</button></div></div></div></div><div class="col-sm-3"><label for="visualization_type">Visualization type</label><select id="visualization_type" class="form-control" ng-model="explore.graph_type"><option value="network">Network graph</option><option ng-if="main.config.ENV===\'DEV\'" value="network-d3">Network graph d3</option><option value="sankey">Sankey graph</option><option value="chord">Chord graph</option></select></div></div><div class="row"><div class="col-xs-12"><carre-graph-sankey-risk ng-if="explore.graph_type===\'sankey\' && explore.ready" riskid="explore.id"></carre-graph-sankey-risk><carre-graph-chord-risk ng-if="explore.graph_type===\'chord\' && explore.ready" riskid="explore.id"></carre-graph-chord-risk><carre-graph-risk ng-if="explore.graph_type===\'network\' && explore.ready" riskid="explore.id"></carre-graph-risk><carre-graph-network-d3 ng-if="explore.graph_type===\'network-d3\' && explore.ready" riskid="explore.id"></carre-graph-network-d3></div></div></div></div></div><script type="text/ng-template" id="recommendExampleTemplate.html"><div class="form-group"> <label>Add a description for your example</label> <textarea ng-model="exampleDesc" style="width:400px" class="form-control"></textarea> <hr> <div> <a href="" ng-click="explore.popover_open=false;" class="btn btn-default"> Cancel </a> <a href="" ng-click="explore.recommendExample(exampleDesc);explore.popover_open=false;" class="btn btn-primary"> Send </a> </div> </div></script>'),e.put("app/pages/measurement_types/list.html",'<div class="col-xs-12"><div cg-busy="measurement_types.gridLoading" id="grid1" ui-grid="measurement_types.mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div>'),e.put("app/pages/measurement_types/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Measurement Types <a ng-hide="\'main.measurement_types.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.measurement_types.list"><i class="fa fa-arrow-left"></i> Back</a> <a ng-hide="(\'main.measurement_types.create\' | isState) || !main.user.username" class="btn btn-sm btn-primary" ui-sref="main.measurement_types.create"><i class="fa fa-plus"></i> <b>Create new</b></a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/pages/medical_experts/list.html",'<div class="col-xs-12"><div class="row"><div class="col-sm-6 col-lg-4" ng-repeat="item in medical_experts.users track by $index| orderBy:\'$index\'"><div class="panel panel-default" style="height:300px"><div class="panel-heading"><a href="" ui-sref="main.medical_experts.view({id:item.id_label})">{{item.has_firstname_label}} {{item.has_lastname_label}}, {{item.has_educational_degree_label}}</a><div class="box-tools pull-right"><a href="" ui-sref="main.medical_experts.view({id:item.id_label})">View profile</a></div></div><div class="panel-body" style="height:220px"><ul style="padding-left:5px"><li style="list-style-type: none; margin-top:10px" ng-repeat="pos in item.has_medical_position"><i class="fa fa-angle-right fa-lg fa-x2"></i> {{ pos}}</li></ul></div><div class="panel-footer" style="padding-bottom:26px"><span style="float:left"><span ng-if="item.is_coordinator_of_team"><b>Coordinator</b></span></span> <span style="float:right">{{item.has_team_name[0]}} Team</span></div></div></div></div></div>'),e.put("app/pages/medical_experts/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Medical Experts <a ng-hide="\'main.medical_experts.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.medical_experts.list"><i class="fa fa-arrow-left"></i> Back</a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/pages/observables/list.html",'<div class="col-xs-12"><div cg-busy="observables.gridLoading" id="grid1" ui-grid="observables.mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div>'),e.put("app/pages/observables/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Observables <a ng-hide="\'main.observables.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.observables.list"><i class="fa fa-arrow-left"></i> Back</a> <a ng-hide="(\'main.observables.create\' | isState) || !main.user.username" class="btn btn-sm btn-primary" ui-sref="main.observables.create"><i class="fa fa-plus"></i> <b>Create new</b></a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/pages/risk_elements/list.html",'<div class="col-xs-12"><div cg-busy="risk_elements.gridLoading" id="grid1" ui-grid="risk_elements.mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div>'),e.put("app/pages/risk_elements/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Risk elements <a ng-hide="\'main.risk_elements.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.risk_elements.list"><i class="fa fa-arrow-left"></i> Back</a> <a ng-hide="(\'main.risk_elements.create\' | isState) || !main.user.username" class="btn btn-sm btn-primary" ui-sref="main.risk_elements.create"><i class="fa fa-plus"></i> <b>Create new</b></a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/pages/risk_evidences/list.html",'<div class="col-xs-12"><div cg-busy="risk_evidences.gridLoading" id="grid1" ui-grid="risk_evidences.mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div><div pageslide="" ps-size="640px" ps-open="risk_evidences.selectedRisk_evidence" ps-side="right"><div cg-busy="risk_evidences.loading" style="padding:10px;"><a ui-sref="main.risk_evidences.view({id:risk_evidences.selectedRisk_evidence})" class="btn btn-primary">Profile</a> <a href="" ng-click="risk_evidences.setPubmed()" class="btn btn-primary"><i class="fa fa-times fa-lg"></i></a><br><br><div ng-if="risk_evidences.selectedRisk_evidence"><div ng-if="risk_evidences.pubmedApi" style="white-space: pre-line; overflow-y: auto;height: 95%; width:620px; position: fixed;" ng-bind-html="risk_evidences.pubmedArticle"></div><iframe ng-if="!risk_evidences.pubmedApi" style="border:none; position: fixed; height:90%; width:620px" height="90%" width="620px" src="{{\'http://www.ncbi.nlm.nih.gov/pubmed/\'+risk_evidences.selectedRisk_evidence | trustAsResourceUrl}}"></iframe></div></div></div>'),e.put("app/pages/risk_evidences/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Risk evidences <a ng-hide="\'main.risk_evidences.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.risk_evidences.list"><i class="fa fa-arrow-left"></i> Back</a> <a ng-hide="(\'main.risk_evidences.create\' | isState) || !main.user.username" class="btn btn-sm btn-primary" ui-sref="main.risk_evidences.create"><i class="fa fa-plus"></i> <b>Create new</b></a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/pages/risk_factors/list.html",'<div class="col-xs-12"><div cg-busy="risk_factors.gridLoading" id="grid1" ui-grid="risk_factors.mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div>'),e.put("app/pages/risk_factors/main.html",'<div><div class="row"><div class="col-xs-12"><h2 class="page-header">Risk factors <a ng-hide="\'main.risk_factors.list\' | isState" class="btn btn-sm btn-default" ui-sref="main.risk_factors.list"><i class="fa fa-arrow-left"></i> Back</a> <a ng-hide="(\'main.risk_factors.create\' | isState) || !main.user.username" class="btn btn-sm btn-primary" ui-sref="main.risk_factors.create"><i class="fa fa-plus"></i> <b>Create new</b></a></h2></div></div><div class="row" ui-view=""></div></div>'),e.put("app/components/header/header-notification/header-notification.html",'<ul class="nav navbar-top-links navbar-right"><li style="position: relative;top: 10px;"><toggle-switch ng-show="main.config.ENV===\'DEV\'" ng-model="main.DEBUG" knob-label="Debug"><toggle-switch></toggle-switch></toggle-switch></li><li ng-show="main.user.username" class="dropdown" uib-dropdown=""><a href="" uib-dropdown-toggle="">Hi {{main.user.username}} <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i></a><ul class="uib-dropdown-menu"><li><a ng-href="{{main.settingsUrl}}" target="_blank"><i class="fa fa-gear fa-fw"></i> Settings</a></li><li><a ng-href="{{main.passwordUrl}}"><i class="fa fa-user fa-fw"></i> Change password</a></li><li class="divider"></li><li><a id="logoutUrl" ng-href="{{main.logoutUrl}}{{pathname}}"><i class="fa fa-sign-out fa-fw"></i> Logout</a></li></ul></li><li ng-hide="main.user.username"><a id="loginUrl" ng-href="{{main.loginUrl}}{{pathname}}">Hello Guest, Login<i class="fa fa-sign-in fa-fw"></i></a></li></ul>'),e.put("app/components/sidebar/sidebar-search/sidebar-search.html",'<li class="sidebar-search"><div class="input-group custom-search-form"><input type="text" class="form-control" placeholder="Search..."> <span class="input-group-btn"><button class="btn btn-default" type="button"><i class="fa fa-search"></i></button></span></div></li>'),e.put("app/pages/citations/form_component/form.html",'<div><div ng-class="{\'col-sm-6\':!noPubmed}"><form name="form" ng-submit="saveModel()"><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><span ng-show="loadingElementIdentifier" class="loadingSelect"></span> <label>Evidence source</label> <span class="badge badge-default">{{pubmedAutocompleteResultsCount}} Result(s)</span><ui-select on-select="selectPubmed($item,$model)" class="ui-select-big-text" ng-model="citation.pubmedId" theme="bootstrap"><ui-select-match placeholder="Select evidence source"><div>{{$select.selected.title}}</div><div>{{$select.selected.authorString}}</div><div>{{$select.selected.source}} - {{$select.selected.pubYear}}</div></ui-select-match><ui-select-choices style="max-height: 500px;" repeat="obj.pmid as obj in pubmedAutocompleteResults | propsFilter: { title: $select.search, authorString: $select.search, source: $select.search, pmid: $select.search, pubYear: $select.search }" refresh="searchPubmed($select.search)" refresh-delay="1000"><div class="ui-select-big-text"><div ng-bind-html="obj.title | highlight: $select.search"></div><div><small ng-bind-html="obj.authorString | highlight: $select.search"></small></div><div><small ng-bind-html="obj.source | highlight: $select.search"></small> / <small ng-bind-html="obj.pubYear | highlight: $select.search"></small> / <small ng-bind-html="obj.pmid | highlight: $select.search"></small></div></div></ui-select-choices></ui-select></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Citation summary</label> <textarea class="form-control" rows="6" ng-model="citation.summary"></textarea></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Study type</label><ui-select ng-model="citation.studyType" limit="1" multiple="" tagging="" tagging-label="(add new type)" theme="bootstrap"><ui-select-match placeholder="Select study type">{{$item}}</ui-select-match><ui-select-choices repeat="type in types | filter: $select.search"><div ng-bind-html="type | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Study Level</label> <input type="number" min="1" max="4" class="form-control" ng-model="citation.level"></div><div class="form-group"><button type="button" ng-click="cancelForm()" class="btn btn-danger">Cancel</button> <button type="submit" class="btn btn-primary">Submit</button></div></form></div><div ng-hide="noPubmed" class="col-sm-6"><label>Pubmed Id</label> <input type="text" name="name" placeholder="Enter pubmed Id" class="form-control" ng-change="loadPubmed()" ng-model="citation.pubmedId" required=""><carre-view-pubmed ng-if="showPubmed" id="{{citation.pubmedId}}"></carre-view-pubmed></div></div>'),e.put("app/pages/citations/single/single.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current citation<pre>{{citation | json}}</pre></div></div><div class="col-xs-12"><carre-element-controls carre-id="{{id}}"></carre-element-controls><carre-element ng-if="mode" type="citation" elem-id="{{id}}" mode="{{mode}}" elem="current"></carre-element></div>'),e.put("app/pages/measurement_types/form_component/form.html",'<div><form name="form" novalidate="" ng-submit="saveModel()"><div class="form-group" ng-class="{ \'has-error\': form.name.$touched && form.name.$invalid }"><label>Name</label> <input type="text" name="name" placeholder="e.g filtration rate" class="form-control" ng-model="measurement_type.name" required=""><div class="help-block" ng-messages="form.name.$error" ng-if="form.name.$touched"><p ng-message="required">Name is required.</p></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Date type</label><ui-select ng-model="measurement_type.datatype" theme="bootstrap"><ui-select-match placeholder="Select datatype">{{$select.selected}}</ui-select-match><ui-select-choices repeat="type in datatypes"><div ng-bind-html="type | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-if="measurement_type.datatype===\'integer\' || measurement_type.datatype===\'float\'" ng-class="{ \'has-error\': form.unit.$touched && form.unit.$invalid }"><label>Unit</label> <input type="text" name="unit" placeholder="e.g ml/min/1.73 m^2" class="form-control" ng-model="measurement_type.unit" required=""><div class="help-block" ng-messages="form.unit.$error" ng-if="form.unit.$touched"><p ng-message="required">Unit is required.</p></div></div><div class="form-group" ng-if="measurement_type.datatype===\'enum\'" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Values</label><ui-select multiple="" tagging="" tagging-label="(custom \'new\' value)" ng-model="measurement_type.values" theme="bootstrap"><ui-select-match placeholder="Select values...">{{$item}}</ui-select-match><ui-select-choices repeat="val in []">{{val}}</ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-if="measurement_type.datatype===\'boolean\'" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Values</label><ui-select multiple="" limit="2" tagging="" tagging-label="(custom \'new\' value)" ng-model="measurement_type.values" theme="bootstrap"><ui-select-match placeholder="Select values...">{{$item}}</ui-select-match><ui-select-choices repeat="val in [\'yes\',\'no\']">{{val}}</ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Semantic annotation for "{{measurement_type.name||\'e.g age\'}}"</label><div class="alert alert-warning" style="margin-bottom: 0">{{measurement_type.identifier}}</div><uib-accordion close-others="true"><uib-accordion-group><uib-accordion-heading><span uib-popover="Units of Measurement Ontology by Bioportal" popover-trigger="mouseenter">UO ontology</span><div ng-show="loadingElementIdentifier" class="loadingSelect"></div></uib-accordion-heading><ui-select ng-model="measurement_type.identifier" theme="bootstrap"><ui-select-match allow-clear="true" placeholder="Search...">{{$select.selected.label}} - {{$select.selected.value | sliceLast:\'/\' }}</ui-select-match><ui-select-choices repeat="elem.value as elem in bioportalAutocompleteResults | propsFilter: {label: $select.search}" refresh="bioportalAutocomplete($select.search)" refresh-delay="500"><div ng-bind-html="elem.label | highlight: $select.search"></div><small>{{elem.value}}</small></ui-select-choices></ui-select></uib-accordion-group><uib-accordion-group heading="Custom"><input type="text" name="name" placeholder="e.g {{measurement_type.name}}" class="form-control" ng-change="transformItem(customIdentifier)" ng-model="customIdentifier"></uib-accordion-group></uib-accordion></div><div class="form-group"><button type="button" ng-click="cancelForm()" class="btn btn-danger">Cancel</button> <button type="submit" class="btn btn-primary">Submit</button></div></form></div>'),e.put("app/pages/measurement_types/single/single.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current measurement_type<pre>{{measurement_type | json}}</pre></div></div><div class="col-xs-12"><carre-element-controls carre-id="{{id}}"></carre-element-controls><carre-element type="measurement_type" elem-id="{{id}}" mode="{{mode}}"></carre-element></div>'),e.put("app/pages/medical_experts/single/view.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current medical_expert<pre>{{medical_expert | json}}</pre></div></div><div class="col-xs-12"><div class="col-sm-6"><div ng-show="main.user.username && main.config.ENV===\'DEV\'">ID: <b>{{medical_expert.id}}</b> <a class="btn btn-xs btn-danger" href="" ng-click="medical_expert.deleteCurrent()"><i class="fa fa-trash-o"></i> Delete</a></div><div class="thumbnail" style="display: inline-block;"><img class="avatar-img" ng-src="{{medical_expert.current.has_avatar[0]}}"></div><ul class="list-group"><li class="list-group-item">Name: <b>{{medical_expert.current.has_firstname_label}} {{medical_expert.current.has_lastname_label}}, {{medical_expert.current.has_educational_degree_label}}</b></li><li class="list-group-item">Medical specialty: <b><a target="_blank" ng-href="{{medical_expert.current.has_medical_specialty_link}}">{{medical_expert.current.has_medical_specialty_label}}</a></b></li><li class="list-group-item">Medical Positions:<ul style="padding-left:5px"><li style="list-style-type: none;" ng-repeat="pos in medical_expert.current.has_medical_position"><b><i class="fa fa-angle-right fa-lg fa-x2"></i> {{ pos}}</b></li></ul></li><li ng-if="medical_expert.current.has_short_cv.length>1" class="list-group-item">Short CV: <b>{{medical_expert.current.has_short_cv}}</b></li><li ng-if="medical_expert.current.has_personal_page_url" class="list-group-item">More details: <b><a target="_blank" ng-href="{{medical_expert.current.has_personal_page_url[0]}}">link</a></b></li><li ng-if="medical_expert.current.is_coordinator_of_team" class="list-group-item">Coordinator: <b>{{medical_expert.current.is_coordinator_of_team[0]}} team</b></li><li ng-if="!medical_expert.current.is_coordinator_of_team" class="list-group-item">Team: <b>{{medical_expert.current.has_team_name[0]}}</b></li><b></b><hr></ul></div><div class="col-sm-6"><canvas height="170%" class="chart chart-bar chart-sm" chart-legend="true" chart-data="medical_expert.counterchart_data" chart-series="medical_expert.counterchart_series" chart-labels="medical_expert.counterchart_labels" chart-options="medical_expert.counterchart_options"></canvas></div></div>'),e.put("app/pages/observables/form_component/form.html",'<div><form name="form" novalidate="" ng-submit="saveModel()"><div class="form-group" ng-class="{ \'has-error\': form.name.$touched && form.name.$invalid }"><label>Name</label> <input type="text" name="name" placeholder="e.g glucose tolerance test" class="form-control" ng-model="observable.name" required=""><div class="help-block" ng-messages="form.name.$error" ng-if="form.name.$touched"><p ng-message="required">Name is required.</p></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Type</label><ui-select ng-model="observable.type" theme="bootstrap"><ui-select-match placeholder="Select observable type">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="type.value as type in types | propsFilter: {label: $select.search}"><div ng-bind-html="type.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Measurement type</label><ui-select ng-model="observable.measurement_type" theme="bootstrap"><ui-select-match placeholder="Select measurement type">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="obj.value as obj in measurement_types | propsFilter: {label: $select.search}"><div ng-bind-html="obj.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group"><label>Semantic annotation for "{{observable.name||\'e.g age\'}}"</label><div class="alert alert-warning" style="margin-bottom: 0">{{observable.identifier}}</div><uib-accordion close-others="true"><uib-accordion-group><uib-accordion-heading><span uib-popover="Clinical Measurement Ontology by Bioportal" popover-trigger="mouseenter">CMO ontology</span><div ng-show="loadingElementIdentifier" class="loadingSelect"></div></uib-accordion-heading><ui-select ng-model="observable.identifier" theme="bootstrap"><ui-select-match allow-clear="true" placeholder="Search...">{{$select.selected.label}} - {{$select.selected.value | sliceLast:\'/\' }}</ui-select-match><ui-select-choices repeat="elem.value as elem in bioportalAutocompleteResults | propsFilter: {label: $select.search}" refresh="bioportalAutocomplete($select.search)" refresh-delay="500"><div ng-bind-html="elem.label | highlight: $select.search"></div><small>{{elem.value}}</small></ui-select-choices></ui-select></uib-accordion-group><uib-accordion-group heading="Custom"><input type="text" name="name" placeholder="e.g {{observable.name}}" class="form-control" ng-change="transformIdentifier(customIdentifier)" ng-model="customIdentifier"></uib-accordion-group></uib-accordion></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Sensor annotation for "{{observable.name||\'e.g age\'}}"</label><div class="alert alert-warning" style="margin-bottom: 0">{{observable.predicate}}</div><uib-accordion close-others="true"><uib-accordion-group><uib-accordion-heading><span uib-popover="CARRE Sensors ontology" popover-trigger="mouseenter">CARRE Sensors ontology</span><div ng-show="loadingElementIdentifier" class="loadingSelect"></div></uib-accordion-heading><ui-select on-select="transformPredicate(customPredicate)" ng-model="customPredicate" theme="bootstrap"><ui-select-match allow-clear="true" placeholder="Select from sensors ontology..">{{$select.selected }}</ui-select-match><ui-select-choices repeat="elem in SensorPredicates | filter : $select.search"><div ng-bind-html="elem | highlight: $select.search"></div></ui-select-choices></ui-select></uib-accordion-group><uib-accordion-group heading="Custom"><input type="text" name="name" placeholder="Or type a custom name" class="form-control" ng-change="transformPredicate(customPredicate)" ng-model="customPredicate"></uib-accordion-group></uib-accordion></div><div class="form-group"><button type="button" ng-click="cancelForm()" class="btn btn-danger">Cancel</button> <button type="submit" class="btn btn-primary">Submit</button></div></form></div>'),e.put("app/pages/observables/single/single.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current observable<pre>{{observable | json}}</pre></div></div><div class="col-xs-12"><carre-element-controls carre-id="{{id}}"></carre-element-controls><carre-element type="observable" elem-id="{{id}}" mode="{{mode}}"></carre-element></div>'),e.put("app/pages/risk_elements/form_component/form.html",'<div><form name="form" novalidate="" ng-submit="saveModel()"><div class="form-group" ng-class="{ \'has-error\': form.name.$touched && form.name.$invalid }"><label>Name</label> <input type="text" name="name" placeholder="Risk element name e.g acute kidney disease" class="form-control" ng-model="risk_element.name" required=""><div class="help-block" ng-messages="form.name.$error" ng-if="form.name.$touched"><p ng-message="required">Name is required.</p></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Modifiable status</label> <input type="checkbox" ng-true-value="\'yes\'" ng-false-value="\'no\'" ng-model="risk_element.modifiable_status"></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Type</label><ui-select ng-model="risk_element.type" theme="bootstrap"><ui-select-match placeholder="Select risk element type">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="type.value as type in types | propsFilter: {label: $select.search}"><div ng-bind-html="type.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Identifier</label><div ng-show="loadingElementIdentifier" class="loadingSelect"></div><ui-select ng-model="risk_element.identifier" theme="bootstrap"><ui-select-match placeholder="Search for CUI...">{{$select.selected.label+\' - \'+$select.selected.value}}</ui-select-match><ui-select-choices repeat="elem.value as elem in bioportalAutocompleteResults | propsFilter: {label: $select.search}" refresh="bioportalAutocomplete($select.search)" refresh-delay="500"><div ng-bind-html="elem.label | highlight: $select.search"></div><small>{{elem.value}}</small></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Observables</label><ui-select multiple="" ng-model="risk_element.observables" theme="bootstrap"><pre>{{$model| json}}</pre><ui-select-match placeholder="Select observables">{{$item.label}}</ui-select-match><ui-select-choices repeat="ob.value as ob in observables | propsFilter: {label: $select.search}"><div ng-bind-html="ob.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Include other risk elements</label><ui-select multiple="" ng-model="risk_element.risk_elements" theme="bootstrap"><ui-select-match placeholder="Select risk elements">{{$item.label}}</ui-select-match><ui-select-choices repeat="el.value as el in risk_elements | propsFilter: {label: $select.search}"><div ng-bind-html="el.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group"><button type="button" ng-click="cancelForm()" class="btn btn-danger">Cancel</button> <button type="submit" class="btn btn-primary">Submit</button></div></form></div>'),
e.put("app/pages/risk_elements/single/single.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current risk_element<pre>{{risk_element | json}}</pre></div></div><div class="col-xs-12"><div class="col-sm-4"><carre-element-controls carre-id="{{id}}"></carre-element-controls><carre-element ng-if="mode" type="risk_element" elem-id="{{id}}" mode="{{mode}}"></carre-element></div><div class="col-sm-8"><carre-graph-chord-risk height="400" riskid="id"></carre-graph-chord-risk></div></div>'),e.put("app/pages/risk_evidences/form_component/form.html",'<div><div class="col-sm-6"><form name="form" novalidate="" ng-submit="saveModel()"><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Risk factor</label><ui-select ng-model="risk_evidence.risk_factor" theme="bootstrap"><ui-select-match placeholder="Select risk factor">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="rl.value as rl in risk_factors | propsFilter: {label: $select.search}"><div ng-bind-html="rl.label | highlight: $select.search"></div></ui-select-choices></ui-select></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Observables</label><ui-select multiple="" ng-model="risk_evidence.observables" theme="bootstrap"><ui-select-match placeholder="Select observables">{{$item.label}}</ui-select-match><ui-select-choices repeat="ob.id as ob in observables | propsFilter: {label: $select.search}"><div ng-bind-html="ob.label | highlight: $select.search"></div></ui-select-choices></ui-select></div><div class="form-group"><label>Condition <a class="btn btn-xs btn-default" ng-click="leEditEnabled=!leEditEnabled"><span ng-if="!leEditEnabled">Show editor <i class="fa fa-plus-square"></i></span> <span ng-if="leEditEnabled">Hide editor <i class="fa fa-minus-square"></i></span></a></label><div><div class="alert alert-warning" ng-bind-html="output | prettySigns"></div></div><div uib-collapse="!leEditEnabled"><le-editor ng-if="showLeEditor" observables="observables" metypes="metypes" group="filter.group"></le-editor></div></div><div class="row"><div class="form-group col-sm-6" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Ratio value</label> <input type="number" min="{{risk_evidence.confidence_interval_min||0}}" max="{{risk_evidence.confidence_interval_max}}" step="0.01" class="form-control" ng-model="risk_evidence.ratio_value"></div><div class="form-group col-sm-6" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Confidence Interval Minimum</label> <input type="number" step="0.01" class="form-control" min="0" max="{{risk_evidence.confidence_interval_max}}" ng-model="risk_evidence.confidence_interval_min"></div><div class="form-group col-sm-6" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Ratio Type</label><ui-select ng-model="risk_evidence.ratio_type" theme="bootstrap"><ui-select-match placeholder="Select ratio type">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="type.value as type in ratiotypes"><div ng-bind-html="type.label | highlight: $select.search"></div></ui-select-choices></ui-select></div><div class="form-group col-sm-6" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Confidence Interval Maximum</label> <input type="number" step="0.01" class="form-control" min="{{risk_evidence.confidence_interval_min||0}}" max="" ng-model="risk_evidence.confidence_interval_max"></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Evidence source</label><ui-select on-select="viewPubmed($item,$model)" class="ui-select-big-text" ng-model="risk_evidence.evidence_source" theme="bootstrap"><ui-select-match placeholder="Select evidence source"><div>{{$select.selected.title}}</div><div>{{$select.selected.authors}}</div><div>{{$select.selected.date}}</div></ui-select-match><ui-select-choices repeat="obj.value as obj in citations | propsFilter: {title: $select.search,authors: $select.search,date: $select.search}"><div class="ui-select-big-text"><div ng-bind-html="obj.title | highlight: $select.search"></div><div><small ng-bind-html="obj.authors | highlight: $select.search"></small></div><div><small ng-bind-html="obj.date | highlight: $select.search"></small></div></div></ui-select-choices></ui-select></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Adjusted for</label><ui-select multiple="" tagging="" tagging-label="(custom \'new\' value)" ng-model="risk_evidence.adjusted_for" theme="bootstrap"><ui-select-match placeholder="Select values...">{{$item}}</ui-select-match><ui-select-choices repeat="val in adjusted_for | filter: $select.search"><div ng-bind-html="val| highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group"><button type="button" ng-click="cancelForm()" class="btn btn-danger">Cancel</button> <button type="submit" class="btn btn-primary">Submit</button></div></form></div><script type="text/ng-template" id="newCitationTemplate.html"><carre-element ng-if="showAddCitation" type="citation" mode="create" elem="{pubmedId:risk_evidence.pubmedId,noPubmed:true}"></carre-element></script><div class="col-sm-6"><label>Pubmed Id <a href="" ng-show="!risk_evidence.evidence_source" popover-is-open="showAddCitation" popover-placement="bottom" uib-popover-template="\'newCitationTemplate.html\'" popover-title="Create a new citation and add it to the collection" class="btn btn-xs btn-default" ng-click="">Add to Citations <i class="fa fa-plus"></i></a></label> <input type="text" name="name" placeholder="Enter pubmed Id" class="form-control" ng-change="loadPubmed()" ng-model="risk_evidence.pubmedId" required=""><carre-view-pubmed ng-if="showPubmed" id="{{risk_evidence.pubmedId}}"></carre-view-pubmed></div></div>'),e.put("app/pages/risk_evidences/single/single.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current risk_evidence<pre>{{risk_evidence | json}}</pre></div></div><div class="col-xs-12"><carre-element-controls carre-id="{{id}}"></carre-element-controls><carre-element ng-if="mode" type="risk_evidence" elem-id="{{id}}" mode="{{mode}}" elem="current"></carre-element></div>'),e.put("app/pages/risk_factors/form_component/form.html",'<div><form name="form" novalidate="" ng-submit="saveModel()"><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Source risk element</label><ui-select ng-model="risk_factor.source" theme="bootstrap"><ui-select-match placeholder="Select risk element">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="rl.value as rl in risk_elements | propsFilter: {label: $select.search}"><div ng-bind-html="rl.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Target risk element</label><ui-select ng-model="risk_factor.target" theme="bootstrap"><ui-select-match placeholder="Select risk element">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="rl.value as rl in risk_elements | propsFilter: {label: $select.search}"><div ng-bind-html="rl.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group" ng-class="{ \'has-error\': form.email.$touched && form.email.$invalid }"><label>Association Type</label><ui-select ng-model="risk_factor.type" theme="bootstrap"><ui-select-match placeholder="Select risk association type">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="type.value as type in types | propsFilter: {label: $select.search}"><div ng-bind-html="type.label | highlight: $select.search"></div></ui-select-choices></ui-select><div class="help-block" ng-messages="form.email.$error" ng-if="form.email.$touched"><div ng-messages-include="messages.html"></div></div></div><div class="form-group"><button type="button" ng-click="cancelForm()" class="btn btn-danger">Cancel</button> <button type="submit" class="btn btn-primary">Submit</button></div></form></div>'),e.put("app/pages/risk_factors/single/single.html",'<div uib-collapse="!main.DEBUG" class="row"><div class="col-xs-12">Current risk_factor<pre>{{risk_factor | json}}</pre></div></div><div class="col-xs-12"><div class="col-sm-6"><carre-element-controls carre-id="{{id}}"></carre-element-controls><carre-element type="risk_factor" elem-id="{{id}}" mode="{{mode}}"></carre-element></div><div ng-if="mode===\'view\'" class="col-sm-6"><carre-graph-risk height="250" riskid="id"></carre-graph-risk></div></div><div ng-if="mode===\'view\'" class="col-xs-12"><h4 class="page-header">Related risk evidences</h4><div cg-busy="gridLoading" id="grid1" ui-grid="mygrid" ui-grid-pagination="" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-exporter="" ui-grid-auto-resize="" class="grid"></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-f630b2f58a.js.map
