{"version":3,"sources":["scripts/app-cb86e0f1d0.js"],"names":["sidebarDirective","templateUrl","restrict","replace","scope","controllerAs","controller","$rootScope","$scope","$state","show_carreElementsMenu","state","carreElementsMenu","indexOf","substring","lastIndexOf","angular","forEach","element","el","push","attr","$on","event","toState","toParams","fromState","fromParams","error","carreElements","name","current","slideWidth","window","innerWidth","$","resize","showAbout","$apply","module","risk_factorsSingleController","content","Risk_factors","uiGridGroupingConstants","uiGridConstants","returnBack","vm","id","go","loadRiskEvidences","gridLoading","risk_evidences","then","res","data","mygrid","columnDefs","field","enableFiltering","enableColumnMenu","cellTemplate","width","fields","visibleGridColumns","obj","displayName","visible","params","includes","mode","$inject","directive","model","Observables","Bioportal","Risk_elements","Auth","toastr","get","risk_elements","map","rl","value","label","has_risk_element_name_label","types","saveModel","save","risk_factor","$emit","success","cancelForm","source","has_risk_factor_source","target","has_risk_factor_target","type","has_risk_factor_association_type","risk_evidencesSingleController","CARRE","pubmedId","is","search","create","length","citation","reload","$stateParams","Citations","Risk_evidences","$timeout","Measurement_types","$q","loadPubmed","showPubmed","updateSelectedCitation","risk_evidence","evidence_source","CIbyPMID","citations","computed","group","observables","str","i","rules","operator","getObservableName","condition","computedRaw","result","filter","ob","removeOuterParenthesis","substr","cleanseCondition","hiddenData","datatype","unit_label","dataoptions","unit","copyModel","copy","showLeEditor","bioportalAutocompleteResults","showAddCitation","has_citation_summary_label","split","pubmed","has_citation_pubmed_identifier","title","authors","date","ratio_type","has_risk_evidence_ratio_type","ratio_value","has_risk_evidence_ratio_value","parseFloat","confidence_interval_min","has_confidence_interval_min","confidence_interval_max","has_confidence_interval_max","has_risk_factor","has_risk_evidence_source_label","has_risk_evidence_source","has_observable_condition","condition_json","fromJson","has_observable_condition_json","condition_text","adjusted_for","all","selected","id_label","has_observable_name_label","metype_label","has_observable_measurement_type_label","metype_id","has_observable_measurement_type","has_risk_evidence_observable","output","metypes","is_adjusted_for","Array","trim","toLocaleLowerCase","risk_factors","has_risk_factor_source_label","has_risk_factor_association_type_label","has_risk_factor_target_label","ratiotypes","condition_clean","toJson","toString","viewPubmed","item","pmid","ci","$watch","newValue","risk_elementsSingleController","has_risk_element_observable","risk_element","includes_risk_element","bioportalAutocomplete","term","loadingElementIdentifier","fetch","has_risk_element_type","identifier","has_risk_element_identifier_label","modifiable_status","has_risk_element_modifiable_status_label","observablesSingleController","CONFIG","measurement_types","has_measurement_type_name_label","options","ontologies","transformIndentifier","formatted","toUpperCase","observable","transformPredicate","toLowerCase","predicate","SensorPredicates","SENSOR_PREDICATES","has_observable_name","has_observable_type","measurement_type","has_external_type","has_external_predicate","customPredicate","has_external_predicate_label","medical_expertsSingleController","Medical_experts","SweetAlert","Pubmed","getMedical_expert","has_medical_specialty_identifier_label","has_medical_specialty_label","has_medical_specialty_link","link","countFor","has_graph_uri","pos","labels_lo","counterchart_data","Number","authored","reviewed","err","this","labels","colors","COLORS","counterchart_options","counterchart_labels","counterchart_series","measurement_typesSingleController","datatypes","transformItem","has_enumeration_values","values","join","has_label_label","has_datatype_label","has_external_unit","has_enumeration_values_label","citationsSingleController","pubmedAutocompleteResults","noPubmed","selectPubmed","summary","authorString","journalTitle","pubYear","journalVolume","issue","pageInfo","doi","JSON","stringify","slice","searchPubmed","pubmedAutocompleteResultsCount","count","studyType","has_citation_source_type_label","level","parseInt","has_citation_source_level_label","has_citation_pubmed_identifier_label","selectedMenu","$location","elem","setPath","absUrl","pathname","service","$http","QUERY","getRisk_factors","ArrayOfIDs","raw","instances","saveRisk_factor","oldElem","newElem","user","currentUser","graphName","updateQuery","insertQuery","newObj","pre","invalidateCache","update","query","insert","getRisk_evidencesFromRisk_Factor","listQuery","CARRE_DEFAULT_GRAPH","LANG","selectQuery","exports","routerConfig","$stateProvider","abstract","url","permissions","only","redirectTo","rejectedPromise","location","href","config","risk_factorsController","VisibleFields","username","getRisk_evidenceAdjusted_for","arr","getRisk_evidences","saveRisk_evidence","has_observable_condition_text","risk_evidencesController","RdfFormatter","getRisk_elements","saveRisk_element","has_risk_element_name","has_risk_element_identifier","has_risk_element_modifiable_status","RiskElementAssociations","FilterString","cache_key","filters","sid","index","prefix","USECACHE","graphData","nodes","edges","tmp_nodes","rf","relation","source_index","target_index","from","to","associations","risk_elementsController","getObservables","saveObservable","observablesController","getMedical_experts","medical_experts","cache","resolve","reject","countAllInstancesFor","medicalExpert","saveMedicalExpertProfile","saveProfile","medical_expertsController","users","getMeasurement_types","saveMeasurement_type","has_measurement_type_name","has_label","has_datatype","measurement_typesController","FindIndex","val","prop","propVal","ratioMinMax","evidences","rv","isNaN","rv_ratio_value","sort","ratioType","getNetworkData","idFilter","edgeType","formattedData","reduce","init","cur","valueProp","rf_index","rf_id","rf_type","rf_source_id","rf_source_label","has_risk_source_element_name","rf_target_id","rf_target_label","has_risk_target_element_name","rf_evidences","rv_index","has_risk_evidence","rv_id","rv_observable_condition","rv_ratio_type","rv_observables","ob_id","ob_label","has_risk_evidence_observable_name","rf_pos","rv_pos","connections","translate","ratio","network","ExploreController","Email","GRAPH","addItem","risk_elements_selected","refreshColors","minConnections","ready","graph_type","graphtype","setNewId","examples","recommendPopoverUrl","recommendExample","items","example","elems","css","runExample","exampleItems","timeInterval","elements","elementstype","DashboardController","countAllInit","countAll","chart","datasets","bars","fillColor","strokeColor","bug","r","total","noreviews","observables_unreviewed","risk_elements_unreviewed","risk_evidences_unreviewed","risk_factors_unreviewed","counterdonut_data","counterdonut_labels","counterdonut_options","getCitations","getCitationTypes","citationType","saveCitation","mapper","has_citation_source_type","has_citation_source_level","has_citation_summary","citationsController","loading","pubmedArticle","comments","number","color","details","goto","property","show","label_arr","avoidExpressions","USERS","has_graph_uri_label","ENV","has_firstname_label","has_lastname_label","atag","RegExp","external_link","cat","$compile","compile","attrs","contents","remove","operators","conditions","getMeasurementType","rule","me_id","addCondition","removeCondition","splice","addGroup","removeGroup","$parent","$index","append","$window","toggleNavbar","hasClass","removeClass","addClass","limitNewConnections","height","riskid","ratioFilterFn","a","showRiskEvidences","ratioFilter","min","max","clickNode","clearSelection","d3","select","classed","selectElement","stopPropagation","clickLink","selectedId","containerId","selectAll","selectedItem","showDetails","alwaysOnDetails","idLabel","chartCss","document","getElementById","getComputedStyle","getPropertyValue","customHeight","onlyCore","n","o","renderSankey","addSize","removeSize","nodesArr","obj_pos","edgesArr","edge","len","goToSelected","goTo","addNodeRelations","limit","node","deleteSelected","d","sourceLinks","targetLinks","preventDefault","dragmove","x","y","Math","dy","path","node_index","graph","links","calculated_height","log","margin","top","right","bottom","left","viewBox","format","scale","category20b","svg","sankey","nodeWidth","nodePadding","size","layout","enter","style","b","text","call","behavior","drag","origin","on","parentNode","appendChild","relayout","charAt","setSize","redraw","fit","defer","nodeIds","startNetwork","getConnectedEdges","_data","add","getSelectedNodes","nodeData","removeOrphan","getSelectedEdges","Object","keys","externalData","promise","$$state","status","vis","DataSet","container","autoResize","manipulation","enabled","configure","smooth","arrows","font","face","background","strokeWidth","border","physics","barnesHut","gravitationalConstant","centralGravity","springLength","springConstant","damping","avoidOverlap","forceAtlas2Based","maxVelocity","minVelocity","solver","stabilization","iterations","updateInterval","onlyDynamicEdges","timestep","adaptiveTimestep","Network","rf_label","nodeId","getNodeAt","pointer","DOM","visualize","w","h","force","self","gravity","distance","charge","start","String","radius","sel","path_text","dx","dr","sqrt","sinus","cosinus","l","offset","showRiskFactor","swal","showCancelButton","confirmButtonColor","confirmButtonText","closeOnConfirm","closeOnCancel","isConfirm","showRiskElement","rl_id","rl_label","bindToController","disableOptions","enableRotation","rotation","onlyPath","refresh","navigate","expand","clear","bind","applyRefresh","$broadcast","showSlider","getType","typeFromId","maxLimit","step","stepsArray","round","slider_toggle","renderChord","startAngle","endAngle","extend","fade","opacity","g","transition","rotationWatch","nodesIndex","edgeMatrix","matrix","m","j","e","textgap","PI","viewBoxDimensions","chord","padding","sortSubgroups","descending","innerRadius","outerRadius","fill","rotate","duration","groups","arc","each","angle","chords","carreId","dev","AllowDelete","elemId","notFields","hidePubmed","renderElement","getRisk_element","getRisk_factor","getRisk_evidence","getObservable","getCitation","getMeasurement_type","renderTempElement","visibleFields","labelOf","rdf_source","rdfSource","CARRE_API_URL","elementViewerWatcher","newId","oldId","single","list","risk_review","medical_expert","view","removeFields","$cookies","cookie","TEST_TOKEN","isLoggedIn","deferred","role","guest","getUser","timeout","CARRE_DEVICES","CARRE_ARCHIVE_GRAPH","CarreTranslate","getModelFields","fieldsArray","visibleArray","field_name","labelFromKey","priority","direction","getDefaultGridProperties","paginationPageSizes","paginationPageSize","enableColumnResizing","allowCellFocus","enableGridMenu","multiSelect","enableRowSelection","enableHighlighting","enableColumnMenus","showGridFooter","showColumnFooter","exporterMenuPdf","exporterCsvFilename","key","getTypeFromId","showElement","default","startGuest","fn","startUser","post","CARRE_CACHE_URL","action","reqdata","defaultOptions","steps","intro","position","showStepNumbers","showBullets","exitOnOverlayClick","exitOnEsc","nextLabel","prevLabel","skipLabel","doneLabel","input","translations","CARRE_TRANSLATIONS","showOnlyIfExists","hasOwnProperty","Translate","groupByProp","triplesFormat","propIndex","settingsObj","groupProp","mappings","tripleAccumulator","settings","rel","val_label","makeLabel","replaceMappings","has_source_risk_element_name","has_target_risk_element_name","getPrefix","PREFIXES","addPrefix","PREFIXARR","PREFIXSTR","keepDiffProps","oldObj","parse","fillPrefix","test","prefixes","OPTIONS","usePrefix","random","buildUpdateQuery","old","deleteTriples","insertTriples","objEmpty","deleteQuery","buildInsertQuery","idlabel","usergraph","xsd","rdf","carreUsers","risk","ME","OB","RL","RV","RF","MD","CI","RW","apiEfetch","PUBMED_API_URL","apiSearch","EUROPEPMC_API_URL","efetch","ignoreLoadingBar","esearch","jsonp","hitCount","resultList","reportBug","sendEmail","send","computeNodeLinks","computeNodeValues","sum","computeNodeBreadths","nextNodes","remainingNodes","moveSinksRight","scaleNodeBreadths","kx","computeNodeDepths","initializeNodeDepth","ky","nodesByBreadth","relaxLeftToRight","alpha","weightedSource","center","breadth","relaxRightToLeft","weightedTarget","reverse","resolveCollisions","y0","ascendingDepth","nest","sortKeys","ascending","entries","computeLinkDepths","ascendingSourceDepth","ascendingTargetDepth","sy","ty","_","arguments","x0","x1","xi","interpolateNumber","x2","curvature","x3","y1","$cacheFactory","deleteInstance","apiQuery","searchInstances","langFilter","variable_predicate","lang","queryInstances","countAllInstances","cacheQuery","sparqlQuery","cache_id","props","results","MappedResults","noprefix","isOffline","sparql","token","req_url_id","encodeURIComponent","delete","apikey","BIOPORTAL_API_KEY","apiurl","BIOPORTAL_API_URL","nocui","cuis","collection","cui","prefLabel","ui","display_context","require_exact_match","include","display_links","BIOPORTAL_ONTOLOGIES","require_definitions","q","annotator","recommender","trustResourceFilter","$sce","trustAsResourceUrl","hideSelected","selectedItems","sliceLast","char","prettySigns","excludeItems","out","propsFilter","isArray","itemMatches","uiSrefActiveIfDirective","$element","$attrs","uiSrefActiveIf","menuColor","countToDirective","num","refreshInterval","countTo","increment","calculate","timoutId","ceil","tick","cancel","textContent","$observe","MainController","Tutorial","rootUrl","host","ROOT_URL","loginUrl","logoutUrl","settingsUrl","passwordUrl","isEmbedded","info","deleteCurrent","IntroOptions","startIntro","setPermissionValidator","Permission","defineRole","stateParams","runBlock","embed","hidemenu","hideMenu","showonlygraph","showOnlyGraph","useOfflineMode","lang_cookie","lt","en","run","metisMenu","topOffset","screen","innerHeight","parent","constant","$locationProvider","$compileProvider","$urlRouterProvider","otherwise","$injector","html5Mode","debugInfoEnabled","s","Date","createElement","getElementsByTagName","async","src","insertBefore","ga","toastrConfig","$httpProvider","cfpLoadingBarProvider","defaults","language","api_url","cache_url","authentication_url","graph_url","CARRE_ENTRY_SYSTEM_CONFIGURATION","isObject","CACHED_QUERIES","LANGPredicates","jnnnColors","myColors","concat","category20","range","Chart","global","colours","allowHtml","closeButton","closeHtml","extendedTimeOut","iconClasses","warning","positionClass","messageClass","onHidden","onShown","onTap","preventDuplicates","progressBar","tapToDismiss","timeOut","titleClass","toastClass","spinnerTemplate","latencyThreshold","interceptors","retryRequest","httpConfig","incrementalTimeout","request","requestError","responseError","response","$templateCache","put"],"mappings":"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","file":"scripts/app-cb86e0f1d0.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem', [\n      'ngAnimate',\n      'ngCookies',\n      'angular-loading-bar',\n      'ngTouch',\n      'ngSanitize',\n      'ngMessages',\n      'ui.router',\n      'ui.bootstrap',\n      'toastr',\n      'cgBusy',\n      'ui.grid',\n      'ui.grid.cellNav',\n      'ui.grid.edit',\n      'ui.grid.selection',\n      'ui.grid.resizeColumns',\n      'ui.grid.pinning',\n      'ui.grid.moveColumns',\n      'ui.grid.exporter',\n      'ui.grid.grouping',\n      'ui.grid.pagination',\n      'ui.grid.autoResize',\n      'ui.select',\n      'pageslide-directive',\n      'toggle-switch',\n      'chart.js',\n      'oitozero.ngSweetAlert',\n      'permission',\n      'angular-intro',\n      'rzModule'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('risk_factorsSingleController', risk_factorsSingleController);\n\n  /** @ngInject */\n  function risk_factorsSingleController(content, Risk_factors, uiGridGroupingConstants, $scope, uiGridConstants, $state) {\n\n    var vm = $scope;\n    \n    vm.id=$state.params.id;\n    // init process \n    if ($state.includes(\"**.create\")) {\n      vm.mode = 'create';\n    } else if (vm.id) {\n      if($state.includes(\"**.view\")){\n        vm.mode='view';\n        loadRiskEvidences(vm.id);\n      } else if($state.includes(\"**.edit\")){\n        vm.mode='edit';\n      } else {\n        $state.go('404_error');\n        return;\n      }\n    }\n    \n    $scope.$on('risk_factor:save', returnBack);\n    $scope.$on('risk_factor:cancel', returnBack);\n    \n    function returnBack() {\n      console.log('called',vm.id);\n      if (vm.id) {\n        $state.go('^.view', {\n          id: vm.id\n        });\n      }\n      else $state.go('^.list');\n    }\n\n    /************** List Template **************/\n\n    var visibleGridColumns = [\n      'has_risk_factor',\n      'has_observable_condition_text',\n      // 'has_risk_evidence_source',\n      // 'has_risk_evidence_ratio_type',\n      'has_risk_evidence_ratio_value',\n      // 'has_confidence_interval_min',\n      // 'has_confidence_interval_max'\n    ];\n\n\n    function loadRiskEvidences(id) {\n      \n      vm.gridLoading = Risk_factors.risk_evidences(id).then(function(res) {\n        \n        if(res.data) {\n          console.log(res.data)\n          vm.mygrid.data = res.data;\n  \n          //make the response available in the view\n          vm.res = res;\n  \n          /* Reset columns */\n          vm.mygrid.columnDefs = [];\n          \n          vm.mygrid.columnDefs.push({\n            field: 'View',\n            enableFiltering: false,\n            enableColumnMenu: false,\n            cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_evidences.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button></div>',\n            width: 60\n          });\n          \n          //dynamic creation of the grid columns\n          content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n            vm.mygrid.columnDefs.push(obj);\n          }));\n  \n          vm.mygrid.columnDefs.push({\n            field: 'id_label',\n            displayName: 'ID',\n            visible: false\n          });\n        } else {\n          vm.mygrid.columnDefs = [];\n          vm.mygrid.data=[];\n        }\n\n\n\n      });\n    }\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n\n\n\n  }\n\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('riskFactorForm', function() {\n  return {\n    templateUrl: 'app/pages/risk_factors/form_component/form.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      'model': '='\n    },\n    controller: function($scope, Observables, Bioportal, Risk_elements, Risk_factors, Auth, toastr) {\n      \n      \n      $scope.model = $scope.model || {};\n\n      //get risk elements\n      Risk_elements.get().then(function(res) {\n        $scope.risk_elements = res.data.map(function(rl) {\n            return {\n              value: rl.id,\n              label: rl.has_risk_element_name_label\n            };\n          });\n      });\n      \n      //risk factor association types\n      $scope.types = [{\n        label: \"is an issue in\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_is_an_issue_in\"\n      }, {\n        label: \"causes\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_causes\"\n      }, {\n        label: \"reduces\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_reduces\"\n      }, {\n        label: \"elevates\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_factor_association_type_elevates\"\n      }];\n\n      \n      //Save to RDF method\n      $scope.saveModel=function(){\n        Risk_factors.save($scope.model,$scope.risk_factor).then(function(res){\n          //success\n          console.log('Risk factor saved',res);\n          $scope.$emit('risk_factor:save');\n          toastr.success('<b> Risk factor</b>'+($scope.model.id?' has been updated':' has been created'),'<h4>Risk factor saved</h4>');\n        });\n      };\n      \n      //Return back\n      $scope.cancelForm=function(){\n        $scope.$emit('risk_factor:cancel');\n      };\n\n\n      if ($scope.model.id) {\n\n        /************** Edit Mode **************/\n        console.info('---Edit---');\n\n\n        //Init Form object\n        $scope.risk_factor = {\n          source: $scope.model.has_risk_factor_source[0],\n          target: $scope.model.has_risk_factor_target[0],\n          type: $scope.model.has_risk_factor_association_type[0],\n        };\n\n\n      }\n      else {\n\n        /************** Create Mode **************/\n        console.info('---Create---');\n        //Init Form object\n        $scope.risk_factor = {\n          source: \"\",\n          target: \"\",\n          type: \"\"\n        };\n\n      }\n\n      console.info('Model: ', $scope.model);\n      console.info('Form params: ', $scope.risk_factor);\n\n    }\n  };\n});\n\n/*global jsep*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('risk_evidencesSingleController', risk_evidencesSingleController);\n\n  /** @ngInject */\n  function risk_evidencesSingleController( $state, $scope, CARRE) {\n    \n    var vm = $scope;\n    \n    vm.id=$state.params.id;\n    vm.pubmedId=$state.params.pubmedId;\n    \n    // init process \n     if ($state.is(\"main.risk_evidences.createWithId\")) {\n      console.log(vm.pubmedId);\n      if(vm.pubmedId) {\n        //check if already exists a risk_evidence with this PubmedID;\n        CARRE.search('citation',vm.pubmedId).then(function(res){\n          vm.create = true;\n          console.log('risk_evidence Records for this pubmedid: '+ vm.pubmedId, res);\n          res.data=res.data||[];\n          if(res.data.length>0){\n            \n            console.log('Article found with data: ',res.data[0]);\n            vm.current = { pubmedId:vm.pubmedId, citation: res.data[0].id };\n            vm.mode='create';\n            \n          } else {\n            console.log('Article not found id: ',vm.pubmedId);\n            vm.current = { pubmedId:vm.pubmedId };\n            vm.mode='create';\n          }\n        });\n      } else $state.go('main.risk_evidences.create',{},{reload:true});\n      \n    } else if ($state.includes(\"**.create\")) {\n      vm.mode = 'create';\n    } else if (vm.id) {\n      if($state.includes(\"**.view\")){\n        vm.mode='view';\n      } else if($state.includes(\"**.edit\")){\n        vm.mode='edit';\n      } else {\n        $state.go('404_error');\n        return;\n      }\n    }\n    \n    $scope.$on('risk_evidence:save', returnBack);\n    $scope.$on('risk_evidence:cancel', returnBack);\n    \n    function returnBack() {\n      console.log('called',vm.id);\n      if (vm.id) {\n        $state.go('^.view', {\n          id: vm.id\n        });\n      }\n      else $state.go('^.list');\n    }\n    \n\n  }\n\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('riskEvidenceForm', function() {\n  return {\n    templateUrl: 'app/pages/risk_evidences/form_component/form.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      'model': '='\n    },\n    controller: function($rootScope, $scope, $state, $stateParams, Citations, Observables, Bioportal, Risk_factors, Risk_evidences, toastr,$timeout,Measurement_types,$q) {\n      \n      $scope.copyModel={};\n      angular.copy($scope.model,$scope.copyModel);\n      \n      \n      $scope.showLeEditor=false;\n      $scope.model = $scope.model || {};\n      $scope.bioportalAutocompleteResults = [];\n      \n      $scope.$on('citation:save',function(res){\n        $scope.showAddCitation=false;\n        \n        // get citations\n        Citations.get().then(function(res) {\n          $scope.citations = res.data.map(function(obj) {\n            var label=[];\n            if(obj.has_citation_summary_label) label=obj.has_citation_summary_label.split('.');\n            return {\n              value: obj.id||\"\",\n              pubmed:obj.has_citation_pubmed_identifier[0]||\"\",\n              title: label[1].replace('; ','')||\"\",\n              authors: label[0]||\"\",\n              date: label[2]||\"\"\n            };\n          });\n           updateSelectedCitation();\n        });\n        \n        // $state.go($state.current, $stateParams, {reload: true, inherit: false});\n      })\n\n      if ($scope.model.id) {\n\n        /************** Edit Mode **************/\n        console.info('---Edit---');\n\n\n        //Init Form object\n        $scope.risk_evidence = {\n          observables: [],\n          ratio_type:$scope.model.has_risk_evidence_ratio_type?$scope.model.has_risk_evidence_ratio_type[0]:\"\",\n          ratio_value:$scope.model.has_risk_evidence_ratio_value?parseFloat($scope.model.has_risk_evidence_ratio_value[0]):0,\n          confidence_interval_min:$scope.model.has_confidence_interval_min?parseFloat($scope.model.has_confidence_interval_min[0]):0,\n          confidence_interval_max:$scope.model.has_confidence_interval_max?parseFloat($scope.model.has_confidence_interval_max[0]):0,\n          risk_factor:$scope.model.has_risk_factor[0],\n          pubmedId:$scope.model.has_risk_evidence_source_label,\n          evidence_source:$scope.model.has_risk_evidence_source[0],\n          condition: $scope.model.has_observable_condition,\n          condition_json: angular.fromJson($scope.model.has_observable_condition_json[0]),\n          condition_text: \"\",\n          adjusted_for:[]\n        };\n        \n        //init expression\n        $scope.filter = $scope.risk_evidence.condition_json || {\n          \"group\": {\n            \"operator\": \"AND\",\n            \"rules\": []\n          }\n        };\n\n\n      }\n      else {\n\n        /************** Create Mode **************/\n        console.info('---Create---');\n\n        //init expression\n        $scope.filter = {\n          \"group\": {\n            \"operator\": \"AND\",\n            \"rules\": []\n          }\n        };\n        \n        \n        //Init Form object\n        $scope.risk_evidence = {\n          observables:[],\n          pubmedId:$scope.model.pubmedId||'',\n          evidence_source: $scope.model.citation||'',\n          risk_factor:'',\n          condition_text: \"\",\n          adjusted_for:[]\n        };\n\n\n      }\n      \n      $scope.adjusted_for=[];\n    \n      \n      // function loadExternalData() {\n      \n        //Get combined requests done in an async way!\n        $q.all([Observables.get(),Measurement_types.get()]).then(function(res){\n          console.log('Promises',res);      \n          \n          //observables\n          //auto select initial\n          var selected=[];\n          $scope.observables = res[0].data.map(function(obj) {\n              \n              var result= {\n                value: obj.id_label,\n                id: obj.id,\n                label: obj.has_observable_name_label,\n                metype_label: obj.has_observable_measurement_type_label,\n                metype_id: obj.has_observable_measurement_type[0]\n              };\n              \n              if($scope.model.id) {\n                if($scope.model.has_risk_evidence_observable.indexOf(obj.id)>=0) selected.push(obj.id);\n              }\n              \n              return result;\n            });\n          $scope.risk_evidence.observables=selected;\n          \n          \n          $scope.output=removeOuterParenthesis(computed($scope.filter.group));\n          \n          //measurement types\n          $scope.metypes=res[1].data;\n          $scope.showLeEditor=true;\n        })\n        \n        //get risk evidence adjusted for\n        Risk_evidences.adjusted_for().then(function(res){\n          console.log('adjusted_for',res);\n          $scope.adjusted_for=res;\n          \n          //initial selection\n          if($scope.model.is_adjusted_for instanceof Array) {\n            $scope.risk_evidence.adjusted_for=$scope.model.is_adjusted_for[0].split(',').map(function(str){\n              return str.trim().toLocaleLowerCase();\n            });\n          }\n        });\n        \n        \n        //get risk factors\n        Risk_factors.get().then(function(res) {\n          $scope.risk_factors = res.data.map(function(obj) {\n              return {\n                value: obj.id,\n                label: obj.has_risk_factor_source_label+' ['+obj.has_risk_factor_association_type_label+'] '+obj.has_risk_factor_target_label\n              };\n            });\n        });\n        \n        //get citations\n        Citations.get().then(function(res) {\n          $scope.citations = res.data.map(function(obj) {\n            var label=[];\n            if(obj.has_citation_summary_label) label=obj.has_citation_summary_label.split('.');\n              return {\n                value: obj.id||\"\",\n                pubmed:obj.has_citation_pubmed_identifier[0]||\"\",\n                title: label[1].replace('; ','')||\"\",\n                authors: label[0]||\"\",\n                date: label[2]||\"\"\n              };\n            });\n            updateSelectedCitation();\n        });\n        \n      // }\n\n      //ratio types\n      $scope.ratiotypes = [{\n        label: \"Hazard ratio\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_hazard_ratio\"\n      }, {\n        label: \"Odds ratio\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_odds_ratio\"\n      }, {\n        label: \"Relative risk\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_evidence_ratio_type_relative_risk\"\n      }];\n      \n      \n      //Save to RDF method\n      $scope.saveModel = function() {\n        //save condition text format\n        $scope.risk_evidence.condition_text=$scope.output\n          .replace(/<\\/?[a-z][a-z0-9]*[^>]*>/ig, \"\")\n          .replace(/&nbsp;/gi,\" \")\n          .replace(/&amp;/gi,\"&\")\n          .replace(/&quot;/gi,'\"')\n          .replace(/&lt;/gi,'<')\n          .replace(/&gt;/gi,'>');\n          \n        //cleanse condition json format\n        var condition_clean={};\n        angular.copy($scope.filter,condition_clean);\n        cleanseCondition(condition_clean);\n        $scope.risk_evidence.condition_json=angular.toJson(condition_clean).toString().replace(/\"/g, '\\\\\"');\n        \n        Risk_evidences.save($scope.model, $scope.risk_evidence).then(function(res) {\n          //success\n          console.log('Risk Evidence saved', res);\n\n          $scope.$emit('risk_evidence:save');\n          toastr.success('<b>' + $scope.risk_evidence.pubmedId + '</b>' + ($scope.model.id ? ' has been updated' : ' has been created'), '<h4>Risk evidence saved</h4>');\n\n        });\n      };\n      //Return back\n      $scope.cancelForm = function() {\n        $scope.$emit('risk_evidence:cancel');\n      };\n\n      \n      \n      /* LoadPubmed */\n      $scope.loadPubmed=loadPubmed;\n      function loadPubmed(){\n        $scope.showPubmed=false;\n        $timeout(function(){\n          $scope.showPubmed=true;\n          updateSelectedCitation();\n        },200);\n      }\n      \n      $scope.viewPubmed=function(item,model){\n        //init Pubmed Fetch\n        $scope.risk_evidence.pubmedId=item.pubmed;\n        loadPubmed();\n      };\n      \n      function updateSelectedCitation(){\n        $timeout(function() {\n          $scope.risk_evidence.evidence_source = $scope.CIbyPMID($scope.citations,$scope.risk_evidence.pubmedId);\n        }, 0);\n      }\n      \n      $scope.CIbyPMID=function(citations,pmid){\n        if(!citations||!pmid) return null;\n        else return citations.filter(function(ci){ return ci.pubmed === pmid; }).map(function(ci){ return ci.value;  })[0];  \n      };\n\n      // function htmlEntities(str) {\n      //   return String(str).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n      // }\n\n      function computed(group) {\n          if(!$scope.observables) return \"\";\n          if (!group) return \"\";\n          \n          var str=\"(\";\n          for (var i = 0; i < group.rules.length; i++) {\n              i > 0 && (str += \" <b>\" + group.operator + \"</b> \");\n              str += group.rules[i].group ?\n                  computed(group.rules[i].group) :\n                  getObservableName(group.rules[i].field) + \" \" + group.rules[i].condition + \" \" + group.rules[i].data;\n          }\n          return str +\")\";\n      }\n      \n      function computedRaw(group) {\n          if(!$scope.observables) return \"\";\n          if (!group) return \"\";\n          \n          var str=\"(\";\n          for (var i = 0; i < group.rules.length; i++) {\n              i > 0 && (str += \" \" + group.operator + \" \");\n              str += group.rules[i].group ?\n                  computed(group.rules[i].group) :\n                  group.rules[i].field + \" \" + group.rules[i].condition + \" \" + group.rules[i].data;\n          }\n          return str +\")\";\n      }\n\n      $scope.$watch('filter', function(newValue) {\n        $scope.risk_evidence.condition_json = newValue;\n        $scope.output = removeOuterParenthesis(computed(newValue.group, 0, {}));\n        //calculate raw condition\n        $scope.risk_evidence.condition = removeOuterParenthesis(computedRaw(newValue.group, 0, {}));\n      }, true);\n\n      \n      function getObservableName(id){\n        if (!id) return '';\n        if($scope.observables) {\n          var result=$scope.observables.filter(function(ob){\n            return ob.value===id;\n          });\n          if(result.length>0){\n            return \"<a href='/observables/\"+id+\"'>\"+result[0].label+\"</a>\";\n          } else return '';\n        }\n        // return <carre-linker model=\"risk_evidence.current\" property=\"{{field.value}}\"></carre-linker>\"\"\n      }\n      \n      function removeOuterParenthesis(str){\n        return str.substr(1,str.length-2);\n      }\n      \n      function cleanseCondition(obj){\n        if(obj.condition) {\n          delete obj.hiddenData;\n          delete obj.datatype;\n          delete obj.unit_label;\n          delete obj.dataoptions;\n          delete obj.unit;\n        } else {\n          //group\n          if(obj.group.rules) {\n            obj.group.rules.forEach(function(condition){\n              cleanseCondition(condition);\n            });\n          }\n        }\n      }\n      \n      console.info('Model: ', $scope.model);\n      console.info('Form params: ', $scope.risk_evidence);\n      \n      //init Pubmed Fetch\n      loadPubmed();\n      // loadExternalData();\n    }\n  };\n});\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('risk_elementsSingleController', risk_elementsSingleController);\n\n  /** @ngInject */\n  function risk_elementsSingleController($scope, $state ) {\n    var vm = $scope;\n    \n    vm.id=$state.params.id;\n    // init process \n    if ($state.includes(\"**.create\")) {\n      vm.mode = 'create';\n    } else if (vm.id) {\n      if($state.includes(\"**.view\")){\n        vm.mode='view';\n      } else if($state.includes(\"**.edit\")){\n        vm.mode='edit';\n      } else {\n        $state.go('404_error');\n        return;\n      }\n    }\n    \n    $scope.$on('risk_element:save', returnBack);\n    $scope.$on('risk_element:cancel', returnBack);\n    \n    function returnBack() {\n      console.log('called',vm.id);\n      if (vm.id) {\n        $state.go('^.view', {\n          id: vm.id\n        });\n      }\n      else $state.go('^.list');\n    }\n\n  }\n\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('riskElementForm', function() {\n  return {\n    templateUrl: 'app/pages/risk_elements/form_component/form.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      'model': '='\n    },\n    controller: function($scope, Observables, Bioportal, Risk_elements,Auth,toastr) {\n      \n      $scope.model = $scope.model || {};\n      $scope.bioportalAutocompleteResults = [];\n\n      //get observables\n      Observables.get().then(function(res) {\n        //auto select initial\n        var selected=[];\n        $scope.observables = res.data.map(function(ob) {\n            var obj={\n              value: ob.id,\n              label: ob.has_observable_name_label\n            };\n            if($scope.model.id && $scope.model.has_risk_element_observable) {\n              if($scope.model.has_risk_element_observable.indexOf(ob.id)>=0) selected.push(obj.value);\n            }\n            return obj;\n          });\n        $scope.risk_element.observables=selected;\n      });\n\n      //get risk elements\n      Risk_elements.get().then(function(res) {\n        //auto select initial\n        var selected=[];\n        $scope.risk_elements = res.data.map(function(rl) {\n            var obj={\n              value: rl.id,\n              label: rl.has_risk_element_name_label\n            };\n            if($scope.model.id && $scope.model.includes_risk_element) {\n              if($scope.model.includes_risk_element.indexOf(rl.id)>=0) selected.push(obj.value);\n            }\n            return obj;\n          });\n          $scope.risk_element.risk_elements=selected;\n      });\n\n      //risk element types\n      $scope.types = [{\n        label: \"behavioural\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_behavioural\"\n      }, {\n        label: \"biomedical\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_biomedical\"\n      }, {\n        label: \"demographic\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_demographic\"\n      }, {\n        label: \"intervention\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_intervention\"\n      }, {\n        label: \"genetic\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_genetic\"\n      }, {\n        label: \"environmental\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#risk_element_type_environmental\"\n      }];\n\n      //Bioportal stuff\n      $scope.bioportalAutocomplete = function(term) {\n        // var options = { };\n        if (term.length < 2) return false;\n        $scope.loadingElementIdentifier = true;\n        Bioportal.fetch(term).then(function(res) {\n          $scope.bioportalAutocompleteResults = res;\n          $scope.loadingElementIdentifier = false;\n        });\n      };\n      \n      //Save to RDF method\n      $scope.saveModel=function(){\n        Risk_elements.save($scope.model,$scope.risk_element).then(function(res){\n          //success\n          console.log('Risk Element saved',res);\n          \n          $scope.$emit('risk_element:save');\n          toastr.success('<b>'+$scope.risk_element.name+'</b>'+($scope.model.id?' has been updated':' has been created'),'<h4>Risk element saved</h4>');\n\n        });\n      };\n      //Return back\n      $scope.cancelForm=function(){\n        $scope.$emit('risk_element:cancel');\n      };\n\n\n      if ($scope.model.id) {\n\n        /************** Edit Mode **************/\n        console.info('---Edit---');\n\n\n        //Init Form object\n        $scope.risk_element = {\n          observables: [],\n          risk_elements: [],\n          type: $scope.model.has_risk_element_type[0],\n          name: $scope.model.has_risk_element_name_label,\n          identifier: $scope.model.has_risk_element_identifier_label,\n          modifiable_status: $scope.model.has_risk_element_modifiable_status_label\n        };\n\n\n        //init Bioportal Fetch\n        $scope.bioportalAutocomplete($scope.risk_element.identifier);\n\n\n      }\n      else {\n\n        /************** Create Mode **************/\n        console.info('---Create---');\n\n        //Init Form object\n        $scope.risk_element = {\n          observables: [],\n          risk_elements: [],\n          type: \"\",\n          name: \"\",\n          identifier: \"\",\n          modifiable_status: \"\"\n        };\n\n\n      }\n\n      \n\n      console.info('Model: ', $scope.model);\n      console.info('Form params: ', $scope.risk_element);\n\n    }\n  };\n});\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('observablesSingleController', observablesSingleController);\n\n  /** @ngInject */\n  function observablesSingleController($scope, $state ) {\n    \n    var vm = $scope;\n    \n    vm.id=$state.params.id;\n    // init process \n    if ($state.includes(\"**.create\")) {\n      vm.mode = 'create';\n    } else if (vm.id) {\n      if($state.includes(\"**.view\")){\n        vm.mode='view';\n      } else if($state.includes(\"**.edit\")){\n        vm.mode='edit';\n      } else {\n        $state.go('404_error');\n        return;\n      }\n    }\n    \n    $scope.$on('observable:save', returnBack);\n    $scope.$on('observable:cancel', returnBack);\n    \n    function returnBack() {\n      console.log('called',vm.id)\n      if (vm.id) {\n        $state.go('^.view', {\n          id: vm.id\n        });\n      }\n      else $state.go('^.list');\n    }\n    \n\n  }\n\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('observableForm', function() {\n  return {\n    templateUrl: 'app/pages/observables/form_component/form.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      'model': '='\n    },\n    controller: function($scope, Observables, Bioportal, Measurement_types,Auth,toastr,CONFIG) {\n      \n      $scope.model = $scope.model || {};\n\n      //get measurement types\n      Measurement_types.get().then(function(res) {\n        $scope.measurement_types = res.data.map(function(obj) {\n            return {\n              value: obj.id,\n              label: obj.has_measurement_type_name_label\n            };\n          });\n      });\n      \n      //Bioportal stuff\n      $scope.bioportalAutocompleteResults = [];\n      $scope.bioportalAutocomplete = function(term) {\n        if (term.length < 2) return false;\n        $scope.loadingElementIdentifier = true;\n        var options={\n          ontologies:\"CMO\"\n        };\n        Bioportal.fetch(term,options,\"no cui\").then(function(res) {\n          $scope.bioportalAutocompleteResults = res;\n          $scope.loadingElementIdentifier = false;\n        });\n      };\n      $scope.transformIndentifier=function(str){\n        var formatted = str.replace(/ /g, \"_\").replace(/[^\\w\\s]/gi, \"\").toUpperCase();\n        $scope.observable.identifier = formatted.length>0?\"http://carre.kmi.open.ac.uk/external_observable_type/CMO_\"+formatted:\"_:blankNode\";\n      };\n      $scope.transformPredicate=function(str){\n        var formatted = str.toLowerCase();\n        $scope.observable.predicate = formatted.length>0?\"http://carre.kmi.open.ac.uk/ontology/sensors.owl#has_\"+formatted:\"_:blankNode\";\n      };\n\n      //Observable types\n      $scope.types = [{\n        label: \"Personal\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#observable_type_personal\"\n      }, {\n        label: \"Clinical\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#observable_type_clinical\"\n      }, {\n        label: \"Other\",\n        value: \"http://carre.kmi.open.ac.uk/ontology/risk.owl#observable_type_other\"\n      }];\n\n      // Sensor Predicates\n      $scope.SensorPredicates = CONFIG.SENSOR_PREDICATES;\n      \n      //Save to RDF method\n      $scope.saveModel=function(){\n        Observables.save($scope.model,$scope.observable).then(function(res){\n          //success\n          console.log('Observable saved',res);\n          $scope.$emit('observable:save');\n          toastr.success('<b>'+$scope.observable.name+'</b>'+($scope.model.id?' has been updated':' has been created'),'<h4>Observable saved</h4>');\n        });\n      };\n      //Return back\n      $scope.cancelForm=function(){\n        $scope.$emit('observable:cancel');\n      };\n\n\n      if ($scope.model.id) {\n\n        /************** Edit Mode **************/\n        console.info('---Edit---');\n\n\n        //Init Form object\n        $scope.observable = {\n          name: $scope.model.has_observable_name[0],\n          type: $scope.model.has_observable_type[0],\n          measurement_type: $scope.model.has_observable_measurement_type[0],\n          identifier: $scope.model.has_external_type?$scope.model.has_external_type[0]:\"\",\n          predicate: $scope.model.has_external_predicate?$scope.model.has_external_predicate[0]:\"\"\n        };\n        \n        $scope.customPredicate = $scope.model.has_external_predicate?$scope.model.has_external_predicate_label.split('has_')[1]:\"\";\n        \n        //init Bioportal Fetch\n        $scope.bioportalAutocomplete($scope.observable.identifier);\n\n\n      }\n      else {\n\n        /************** Create Mode **************/\n        console.info('---Create---');\n\n        //Init Form object\n        $scope.observable = {\n          name: \"\",\n          type: \"\",\n          measurement_type: \"\",\n          identifier:\"\",\n          predicate:\"\"\n        };\n\n\n      }\n\n      \n\n      console.info('Model: ', $scope.model);\n      console.info('Form params: ', $scope.observable);\n\n    }\n  };\n});\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('medical_expertsSingleController', medical_expertsSingleController);\n\n  /** @ngInject */\n  function medical_expertsSingleController(toastr,CONFIG, content, Bioportal, Medical_experts, CARRE, SweetAlert, $stateParams, $timeout, Pubmed, $state, $scope) {\n    var vm = this;\n    \n    var visibleFields = [\n      \"has_firstname\",\n      \"has_lastname\",\n      \"has_medical_specialty_identifier\",\n      \"has_medical_position\",\n      \"has_short_cv\",\n      \"has_personal_page_url\",\n      \"has_user_graph\",\n      \"has_avatar\",\n      \"is_coordinator_of_team\",\n      \"has_team_name\"\n    ];\n    \n    var labels=[\n        \"Risk Factors\",\n        \"Risk Evidences\",\n        \"Risk Elements\",\n        \"Observables\",\n        \"Citations\"\n      ];\n      \n    var labels_lo=labels.map(function(str){return str.toLowerCase().replace(\" \",\"_\")});\n\n  \n    vm.colors=CONFIG.COLORS;\n    vm.counterchart_options = {\n      \n    };\n    vm.counterchart_labels = labels;\n    vm.counterchart_series=[\"Entered\",\"Reviewed\"];\n    vm.counterchart_data=[[0,0,0,0,0],[0,0,0,0,0]];\n    \n    /* View Risk_element */\n    vm.id = $stateParams.id;\n    vm.current = {};\n    if (vm.id) getMedical_expert(vm.id);\n\n\n    /* Helper functions */\n    function getMedical_expert(id) {\n      Medical_experts.get([id]).then(function(res) {\n        if (res.data) {\n          vm.current = res.data[0];\n          \n          Bioportal.fetch(vm.current.has_medical_specialty_identifier_label,{ontologies:'MESH,SNOMEDCT'}).then(function(res){\n            vm.current.has_medical_specialty_label=res[0].label||\"\";\n            vm.current.has_medical_specialty_link=res[0].link||\"\";\n          })\n          \n          Medical_experts.countFor(vm.current.has_graph_uri[0]).then(function(res){\n            //set data for the graph\n            res.data.forEach(function(obj){\n              var pos=labels_lo.indexOf(obj.type.value.split(\"#\")[1]+'s');\n              vm.counterchart_data[0][pos]=Number(obj.authored.value);\n              vm.counterchart_data[1][pos]=Number(obj.reviewed.value);\n            });\n          });\n          \n        }\n        else $state.go('main.medical_experts.list');\n      }, function(err) {\n        console.error(err);\n        $state.go('main.medical_experts.list');\n      });\n    }\n    \n    \n    //event on create method\n    // $scope.$on('create', function (event, chart) {\n    //   // set colors for each bar\n    //   if(chart.datasets){\n    //     chart.datasets[0].bars.map(function(obj,index){\n    //       var rgb=hexToRgb(vm.colors[index])\n    //       obj.fillColor=\"rgba(\"+rgb.r+\",\"+rgb.g+\",\"+rgb.b+\",0.5)\";\n    //       obj.strokeColor=\"#FFF\";\n    //       return obj;\n    //     });\n        \n    //     chart.datasets[1].bars.map(function(obj,index){\n    //       var rgb=hexToRgb(vm.colors[index])\n    //       obj.fillColor=\"rgba(\"+rgb.r+\",\"+rgb.g+\",\"+rgb.b+\",1)\";\n    //       obj.strokeColor=\"#FFF\";\n    //       return obj;\n    //     });\n    //   }\n    // });\n\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('measurement_typesSingleController', measurement_typesSingleController);\n\n  /** @ngInject */\n  function measurement_typesSingleController($state, $scope ) {\n    \n    var vm = $scope;\n    \n    vm.id=$state.params.id;\n    // init process \n    if ($state.includes(\"**.create\")) {\n      vm.mode = 'create';\n    } else if (vm.id) {\n      if($state.includes(\"**.view\")){\n        vm.mode='view';\n      } else if($state.includes(\"**.edit\")){\n        vm.mode='edit';\n      } else {\n        $state.go('404_error');\n        return;\n      }\n    }\n    \n    $scope.$on('measurement_type:save', returnBack);\n    $scope.$on('measurement_type:cancel', returnBack);\n    \n    function returnBack() {\n      console.log('called',vm.id);\n      if (vm.id) {\n        $state.go('^.view', {\n          id: vm.id\n        });\n      }\n      else $state.go('^.list');\n    }\n    \n  }\n\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('measurementTypeForm', function() {\n  return {\n    templateUrl: 'app/pages/measurement_types/form_component/form.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      'model': '='\n    },\n    controller: function($scope, Measurement_types, toastr, Bioportal) {\n\n\n      $scope.model = $scope.model || {};\n\n      //risk element types\n      $scope.datatypes = [\"float\",\"enum\",\"integer\",\"boolean\"];\n      \n      \n      //Bioportal stuff\n      $scope.bioportalAutocompleteResults = [];\n      $scope.bioportalAutocomplete = function(term) {\n        if (term.length < 2) return false;\n        $scope.loadingElementIdentifier = true;\n        var options={\n          ontologies:\"UO\"\n        };\n        Bioportal.fetch(term,options,\"no cui\").then(function(res) {\n          $scope.bioportalAutocompleteResults = res;\n          $scope.loadingElementIdentifier = false;\n        });\n      };\n      \n      $scope.transformItem=function(str){\n        var formatted = str.replace(/ /g, \"_\").replace(/[^\\w\\s]/gi, \"\").toUpperCase();\n        $scope.measurement_type.identifier = \"http://carre.kmi.open.ac.uk/external_measurement_unit/UO_\"+formatted;\n      }\n      \n      //Save to RDF method\n      $scope.saveModel=function(){\n        \n        //fix measurement type multi values\n        if($scope.measurement_type.datatype==='enum'||$scope.measurement_type.datatype==='boolean') {\n          $scope.measurement_type.has_enumeration_values = $scope.measurement_type.values.join(';');\n          \n          console.log($scope.measurement_type.values,$scope.measurement_type.has_enumeration_values);\n        } else $scope.measurement_type.has_enumeration_values = \"\";\n        delete $scope.measurement_type.values;\n        \n        Measurement_types.save($scope.model,$scope.measurement_type).then(function(res){\n          //success\n          console.log('Measurement type saved',res);\n          \n          $scope.$emit('measurement_type:save');\n          toastr.success('<b>'+$scope.measurement_type.name+'</b>'+($scope.model.id?' has been updated':' has been created'),'<h4>Measurement type saved</h4>');\n\n        });\n      };\n      \n      //Return back\n      $scope.cancelForm=function(){\n        $scope.$emit('measurement_type:cancel');\n      };\n\n\n      if ($scope.model.id) {\n\n        /************** Edit Mode **************/\n        console.info('---Edit---');\n\n        //Init Form object\n        $scope.measurement_type = {\n          name: $scope.model.has_measurement_type_name_label,\n          unit: $scope.model.has_label_label||\"\",\n          datatype: $scope.model.has_datatype_label,\n          identifier: $scope.model.has_external_unit?$scope.model.has_external_unit[0]:\"\"\n        };\n\n        if($scope.model.has_datatype_label==='enum'||$scope.model.has_datatype_label==='boolean') {\n          $scope.measurement_type.values=$scope.model.has_enumeration_values_label.split(';');\n        }\n        \n        //init Bioportal Fetch\n        $scope.bioportalAutocomplete($scope.measurement_type.identifier);\n\n\n      }\n      else {\n\n        /************** Create Mode **************/\n        console.info('---Create---');\n\n        //Init Form object\n        $scope.measurement_type = {\n          name: \"\",\n          unit: \"\",\n          datatype: \"\",\n          values: [],\n          identifier:\"\"\n        };\n\n\n      }\n\n      \n\n      console.info('Model: ', $scope.model);\n      console.info('Form params: ', $scope.measurement_type);\n\n    }\n  };\n});\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('citationsSingleController', citationsSingleController);\n\n  /** @ngInject */\n  function citationsSingleController($stateParams, $state, CARRE, $scope){\n   \n    var vm = $scope;\n    \n    vm.id=$state.params.id;\n    // init process \n     if ($state.is(\"main.citations.createWithId\")) {\n      if($stateParams.pubmedId) {\n        //check if already exists a citation with this PubmedID;\n        CARRE.search('citation',$stateParams.pubmedId).then(function(res){\n          \n          vm.create = true;\n          console.log('Citation Records for this pubmedid'+ $stateParams.pubmedId, res);\n          res.data=res.data||[];\n          if(res.data.length>0){\n            $state.go('main.citations.edit',{id:res.data[0].id_label},{reload:true});\n          } else {\n              console.log('Article with id: ',$stateParams.pubmedId);\n              vm.current = { pubmedId:$stateParams.pubmedId };\n              vm.mode='create';\n          }\n        });\n      } else $state.go('main.citations.create',{},{reload:true});\n      \n    } else if ($state.includes(\"**.create\")) {\n      vm.mode = 'create';\n    } else if (vm.id) {\n      if($state.includes(\"**.view\")){\n        vm.mode='view';\n      } else if($state.includes(\"**.edit\")){\n        vm.mode='edit';\n      } else {\n        $state.go('404_error');\n        return;\n      }\n    }\n    \n    $scope.$on('citation:save', returnBack);\n    $scope.$on('citation:cancel', returnBack);\n    \n    function returnBack() {\n      console.log('called',vm.id);\n      if (vm.id) {\n        $state.go('^.view', {\n          id: vm.id\n        });\n      }\n      else $state.go('^.list');\n    }\n    \n\n  }\n\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('citationForm', function() {\n  return {\n    templateUrl: 'app/pages/citations/form_component/form.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      'model': '=',\n    },\n    controller: function($scope, Citations, Pubmed, toastr,$timeout, CONFIG) {\n      \n      // $scope.pubmedId = $scope.pubmedId || null;\n      $scope.model = $scope.model || {};\n      $scope.pubmedAutocompleteResults = [];\n      \n      $scope.noPubmed = $scope.model.noPubmed;\n\n      //citation study types\n      $scope.types=[];\n      // $scope.addStudyType=function(item,model){\n      //   console.log(\"Add study type\");\n      //   console.log(item,model);\n      //   return item;\n      //   // if($scope.types.indexOf(item)===-1 && item) {\n      //   //   $scope.types.push(item);\n      //   //   $scope.showNewType=false;\n      //   // }\n      // };\n\n      Citations.types().then(function(res){\n        console.log('Citation types',res);\n          $scope.types=res;\n      });\n      \n      \n      $scope.selectPubmed=function(item,model){\n        //build the summary\n        var summary = null;\n        if(item.title) summary=item.authorString+\"; \"+item.title+\" \"+\n                item.journalTitle+\" \"+item.pubYear+\";\"+\n                item.journalVolume+\"(\"+item.issue+\"):\"+item.pageInfo+\".\"+\n                \" doi:\"+item.doi||\"0000\";\n                \n        $scope.citation.pubmedId=item.pmid || $scope.citation.pubmedId;\n        $scope.citation.summary=JSON.stringify(summary || $scope.citation.summary).slice(1, -1);\n        $scope.loadPubmed();\n      };\n      \n      //refresh pubmed article\n      $scope.loadPubmed=function(){\n        $scope.showPubmed=false;\n        $timeout(function(){\n          $scope.showPubmed=true;\n        },200);\n      };\n      \n      //Autocomplete stuff\n      $scope.searchPubmed = function(term) {\n        // var options = { };\n        if (term.length < 2) return false;\n        $scope.loadingElementIdentifier = true;\n        Pubmed.search(term).then(function(res) {\n          /*\n          \n          authorString: \"Levy M, Smith T, Alvarez-Perez A, Back A, Baker JN, Beck AC, Block S, Dalal S, Dans M, Fitch TR, Kapo J, Kutner JS, Kvale E, Misra S, Mitchell W, Portman DG, Sauer TM, Spiegel D, Sutton L, Szmuilowicz E, Taylor RM, Temel J, Tickoo R, Urba SG, Weinstein E, Zachariah F, Bergman MA, Scavone JL.\"\n          citedByCount: 0\n          epmcAuthMan: \"N\"\n          hasBook: \"N\"\n          hasDbCrossReferences: \"N\"\n          hasLabsLinks: \"N\"\n          hasPDF: \"N\"\n          hasReferences: \"N\"\n          hasSuppl: \"N\"\n          hasTMAccessionNumbers: \"N\"\n          hasTextMinedTerms: \"N\"\n          id: \"26733557\"\n          inEPMC: \"N\"\n          inPMC: \"N\"\n          issue: \"1\"\n          journalIssn: \"1540-1405\"\n          journalTitle: \"J Natl Compr Canc Netw\"\n          journalVolume: \"14\"\n          luceneScore: \"NaN\"\n          pageInfo: \"82-113\"\n          pmid: \"26733557\"\n          pubType: \"journal article\"\n          pubYear: \"2016\"\n          source: \"MED\"\n          title: \"Palliative Care Version 1.2016.\"\n          \n          */\n          $scope.pubmedAutocompleteResultsCount = res.count;\n          $scope.pubmedAutocompleteResults = res.result\n          .map(function(obj){\n              obj.title = obj.title || \"\";\n              obj.authorString = obj.authorString || \"\";\n              obj.source =obj.source || \"\";\n              obj.pubYear = obj.pubYear || \"\";\n              obj.pmid = obj.pmid || obj.id;\n              return obj;\n          });\n          $scope.loadingElementIdentifier = false;\n          $scope.selectPubmed($scope.pubmedAutocompleteResults[0]||{}); //pass an empty object for no errors\n        });\n      };\n      \n      //Save to RDF method\n      $scope.saveModel=function(){\n        \n        $scope.citation.type = $scope.citation.studyType[0];\n        delete $scope.citation.studyType;\n        \n        Citations.save($scope.model,$scope.citation).then(function(res){\n          if(!res) return;\n          $scope.$emit('citation:save');\n          toastr.success('<b>Citation with PMID:'+$scope.citation.pubmedId+'</b>'+($scope.model.id?' has been updated':' has been created'),'<h4>Citations saved</h4>');\n\n        },function(err){\n          console.error(\"Error saving citation\",$scope.citation)\n        });\n      };\n      //Return back\n      $scope.cancelForm=function(){\n        $scope.$emit('citation:cancel');\n      };\n\n\n      if ($scope.model.id) {\n\n        /************** Edit Mode **************/\n        console.info('---Edit---');\n\n\n        //Init Form object\n        $scope.citation = {\n          type: $scope.model.has_citation_source_type_label || \"\",\n          level: parseInt($scope.model.has_citation_source_level_label) || 1,\n          summary: $scope.model.has_citation_summary_label || \"\",\n          pubmedId: $scope.model.has_citation_pubmed_identifier_label || \"\"\n        };\n        \n        //run pubmed search\n        $scope.searchPubmed($scope.citation.pubmedId);\n        \n        $scope.citation.studyType=[$scope.citation.type]\n\n      }\n      else {\n\n        /************** Create Mode **************/\n        console.info('---Create---');\n\n        //Init Form object\n        $scope.citation = {\n          type: \"\",\n          level: 1,\n          summary: \"\",\n          pubmedId: $scope.model.pubmedId||\"\"\n        };\n        \n        if($scope.citation.pubmedId){\n          //run pubmed search\n          $scope.searchPubmed($scope.citation.pubmedId);\n        }\n\n      }\n\n      \n\n      console.info('Model: ', $scope.model);\n      console.info('Form params: ', $scope.citation);\n\n    }\n  };\n});\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name izzyposWebApp.directive:adminPosHeader\n * @description\n * # adminPosHeader\n */\n\nangular.module('CarreEntrySystem')\n  .directive('sidebarSearch',function() {\n    return {\n      templateUrl:'app/components/sidebar/sidebar-search/sidebar-search.html',\n      restrict: 'E',\n      replace: true,\n      scope: {\n      },\n      controller:function($scope){\n        $scope.selectedMenu = 'home';\n      }\n    }\n  });\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name izzyposWebApp.directive:adminPosHeader\n * @description\n * # adminPosHeader\n */\nangular.module('CarreEntrySystem')\n\t.directive('headerNotification',function($rootScope,$timeout,$state,$location){\n\t\treturn {\n            templateUrl:'app/components/header/header-notification/header-notification.html',\n            restrict: 'E',\n            replace: true,\n            link:function(scope,elem,attr){\n                scope.pathname=setPath();\n                $rootScope.$on('$stateChangeSuccess', function(){ scope.pathname=setPath(); })\n                function setPath(){ return $location.absUrl().replace('/edit','');}\n            }\n\t\t}\n\t});\n\n\n\nangular.module('CarreEntrySystem').service('Risk_factors', function($http, CARRE, CONFIG, QUERY) {\n\n  this.exports={\n    'get': getRisk_factors,\n    'save': saveRisk_factor,\n    'risk_evidences': getRisk_evidencesFromRisk_Factor\n  };\n  \n  function getRisk_factors(ArrayOfIDs,raw) {\n    return CARRE.instances('risk_factor',ArrayOfIDs);\n  }\n  \n  function saveRisk_factor(oldElem, newElem, user) {\n    user = user || CONFIG.currentUser.graphName;\n    var updateQuery = \"\",insertQuery = \"\";\n    var newObj = {};\n    \n    if(newElem.source.length>0) newObj.has_risk_factor_source = {pre:'risk',value:newElem.source,type:\"node\"};\n    if(newElem.target.length>0) newObj.has_risk_factor_target = {pre:'risk',value:newElem.target.toString(),type:\"node\"};\n    if(newElem.type.length>0) newObj.has_risk_factor_association_type = {pre:'risk',value:newElem.type.toString(),type:\"node\"};\n    \n    console.log('Old: ',oldElem);\n    console.log('New: ',newElem);\n    console.log('Mapped: ',newObj);\n    \n    /* invalidate Risk factors and Risk evidences */\n    CARRE.invalidateCache('risk_factor_all');\n    CARRE.invalidateCache('risk_evidence_all');\n    CARRE.invalidateCache('count_all');\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem,newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery,'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj,\"risk_factor\",\"RF\",user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery,'no prefix');\n    }\n\n  }\n  \n\n  function getRisk_evidencesFromRisk_Factor(ArrayOfIDs) {\n    console.log(\"getRisk_evidencesFromRisk_Factor\",ArrayOfIDs);\n    \n    ArrayOfIDs = ArrayOfIDs ? (ArrayOfIDs instanceof Array ? ArrayOfIDs : [ArrayOfIDs]) : [];\n    \n    var listQuery = \"SELECT * FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" WHERE { \\n\\\n             ?subject a risk:risk_evidence; ?predicate ?object. \\n\\\n             ?subject risk:has_risk_factor ?filter. \\n\\\n             VALUES (?filter) { \"+ArrayOfIDs.map(function(id) { return \"(\" + id.split('_')[0] + \":\" + id+ ')'; }).join(\" \")+\" } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:citation. \\n\\\n               ?object risk:has_citation_pubmed_identifier ?has_citation_pubmed_identifier  \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:observable. \\n\\\n               ?object risk:has_observable_name ?has_observable_name  \\n\\\n               FILTER(lang(?has_observable_name)='\"+CONFIG.LANG+\"') \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:risk_element. \\n\\\n               ?object risk:has_risk_element_name ?has_risk_element_name  \\n\\\n               FILTER(lang(?has_risk_element_name)='\"+CONFIG.LANG+\"') \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:measurement_type. \\n\\\n               ?object risk:has_measurement_type_name ?has_measurement_type_name  \\n\\\n               FILTER(lang(?has_measurement_type_name)='\"+CONFIG.LANG+\"') \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:risk_factor.  \\n\\\n               ?object risk:has_risk_factor_association_type ?has_risk_factor_association_type. \\n\\\n               ?object risk:has_risk_factor_source ?has_risk_factor_source. \\n\\\n               ?object risk:has_risk_factor_target ?has_risk_factor_target. \\n\\\n               ?has_risk_factor_source risk:has_risk_element_name ?has_source_risk_element_name.  \\n\\\n               ?has_risk_factor_target risk:has_risk_element_name ?has_target_risk_element_name.  \\n\\\n               FILTER(lang(?has_source_risk_element_name)='\"+CONFIG.LANG+\"') \\n\\\n               FILTER(lang(?has_target_risk_element_name)='\"+CONFIG.LANG+\"') \\n\\\n              } \\n\";\n              \n    //add filter to query if a single observable is requested\n    listQuery += \" }\";\n    return CARRE.selectQuery(listQuery);//,null,'risk_evidences_for_'+ArrayOfIDs.join(\"_\"));\n   \n\n  }\n  \n  return this.exports;\n  \n});\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n    $stateProvider\n     \n      /*  risk_factors  */\n      .state('main.risk_factors', {\n        'abstract':true,\n        templateUrl: 'app/pages/risk_factors/main.html',\n        url: '/risk_factors'\n      })\n      .state('main.risk_factors.list', {\n        controller: 'risk_factorsController',\n        controllerAs: 'risk_factors',\n        templateUrl: 'app/pages/risk_factors/list.html',\n        url: ''\n      })\n      .state('main.risk_factors.create', {\n        templateUrl: 'app/pages/risk_factors/single/single.html',\n        controller: 'risk_factorsSingleController',\n        controllerAs: 'risk_factor',\n        url: '/create',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.risk_factors.edit', {\n        templateUrl: 'app/pages/risk_factors/single/single.html',\n        controller: 'risk_factorsSingleController',\n        controllerAs: 'risk_factor',\n        url: '/:id/edit',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n        \n      })\n      .state('main.risk_factors.view', {\n        controller: 'risk_factorsSingleController',\n        templateUrl: 'app/pages/risk_factors/single/single.html',\n        controllerAs: 'risk_factor',\n        url: '/:id'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('risk_factorsController', risk_factorsController);\n\n  /** @ngInject */\n  function risk_factorsController(toastr, VisibleFields, Risk_factors,currentUser, CONFIG, $stateParams, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state, content) {\n    var vm = this; //controller as vm\n    \n    \n    /************** List Template **************/\n    \n    var visibleGridColumns=VisibleFields('risk_factor','list');\n    \n    var risk_factors = [];\n    vm.gridLoading=Risk_factors.get().then(function(res) {\n      risk_factors = res.data;\n      vm.mygrid.data = risk_factors;\n      \n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n      /* Reset columns */\n      vm.mygrid.columnDefs = [];\n      \n      \n      vm.mygrid.columnDefs.push({\n        field: 'View',\n        enableFiltering: false,\n        enableColumnMenu: false,\n        cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_factors.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button></div>',\n        width: 60\n      });\n\n      //show edit buttons\n      if (currentUser.username) {\n        vm.mygrid.columnDefs.push({\n          field: 'Edit',\n          enableFiltering: false,\n          enableColumnMenu: false,\n          cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_factors.edit({id:row.entity.id_label})\"><i class=\"fa fa-edit\"></i></button></div>',\n          width: 60\n        });\n      }\n      \n      //dynamic creation of the grid columns\n      content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n        vm.mygrid.columnDefs.push(obj);\n      }));\n\n      vm.mygrid.columnDefs.push({\n        field: 'id_label',\n        displayName: 'ID',\n        visible: false\n      });\n\n\n    });\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n    \n\n  }\n})();\n\nangular.module('CarreEntrySystem').service('Risk_evidences', function($http, CARRE, CONFIG, QUERY) {\n\n  this.exports = {\n    'get': getRisk_evidences,\n    'adjusted_for': getRisk_evidenceAdjusted_for,\n    'save': saveRisk_evidence\n\n  };\n\n  function getRisk_evidenceAdjusted_for() {\n    var query=\"PREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \\n\\\n              SELECT ?adjusted_for FROM \"+CONFIG.CARRE_DEFAULT_GRAPH+\" WHERE { ?subject a risk:risk_evidence; risk:is_adjusted_for ?adjusted_for}\";\n    return CARRE.query(query,'no prefix').then(function(res){\n      var types=[];\n      if(res.data instanceof Array) {\n        res.data.forEach(function(obj){\n          var arr=obj.adjusted_for.value.split(\",\");\n          arr.forEach(function(elem){\n            elem=elem.trim().toLocaleLowerCase();\n            if(elem.length>0 && types.indexOf(elem)===-1) types.push(elem);\n          });\n        });\n      }\n      return types;\n    });\n  }\n  \n  function getRisk_evidences(ArrayOfIDs) {\n    return CARRE.instances('risk_evidence', ArrayOfIDs);\n  }\n\n  function saveRisk_evidence(oldElem, newElem, user) {\n    user = user || CONFIG.currentUser.graphName;\n    var updateQuery = \"\",insertQuery = \"\";\n    var newObj = {};\n    \n    if(newElem.observables.length>0) newObj.has_risk_evidence_observable = {pre:'risk',value:newElem.observables,type:\"node\"};\n    if(newElem.ratio_type.length>0) newObj.has_risk_evidence_ratio_type = {pre:'risk',value:newElem.ratio_type.toString(),type:\"node\"};\n    if(newElem.ratio_value) newObj.has_risk_evidence_ratio_value = {pre:'risk',value:newElem.ratio_value,type:\"decimal\"};\n    if(newElem.confidence_interval_min) newObj.has_confidence_interval_min = {pre:'risk',value:newElem.confidence_interval_min,type:\"decimal\"};\n    if(newElem.confidence_interval_max) newObj.has_confidence_interval_max = {pre:'risk',value:newElem.confidence_interval_max,type:\"decimal\"};\n    if(newElem.risk_factor.length>0) newObj.has_risk_factor = {pre:'risk',value:newElem.risk_factor,type:\"node\"};\n    if(newElem.evidence_source.length>0) newObj.has_risk_evidence_source = {pre:'risk',value:newElem.evidence_source.toString(),type:\"node\"};\n    if(newElem.adjusted_for.length>0) newObj.is_adjusted_for = {pre:'risk',value:newElem.adjusted_for.join(\",\"),type:\"string\"};\n    if(newElem.condition.length>0) {\n      newObj.has_observable_condition = {pre:'risk',value:newElem.condition.toString(),type:\"string\"};\n      newObj.has_observable_condition_json = {pre:'risk',value:newElem.condition_json.toString(),type:\"string\"};\n      newObj.has_observable_condition_text = {pre:'risk',value:newElem.condition_text.toString(),type:\"string\"};\n    }\n    \n    \n    console.log('Old: ',oldElem);\n    console.log('New: ',newElem);\n    console.log('Mapped: ',newObj);\n    \n    /* invalidate Risk factors and Risk evidences */\n    CARRE.invalidateCache('risk_factor_all');\n    CARRE.invalidateCache('risk_evidence_all');\n    CARRE.invalidateCache('count_all');\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem,newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery,'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj,\"risk_evidence\",\"RV\",user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery,'no prefix');\n    }\n\n  }\n\n  return this.exports;\n\n});\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('risk_evidencesController', risk_evidencesController);\n\n  /** @ngInject */\n  function risk_evidencesController(toastr, currentUser, VisibleFields, Risk_evidences,CONFIG, $stateParams, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state, content) {\n    var vm = this; //controller as vm\n    \n    \n    /************** List Template **************/\n    var visibleGridColumns=VisibleFields('risk_evidence','list');\n\n    var risk_evidences = [];\n    vm.gridLoading = Risk_evidences.get().then(function(res) {\n\n      risk_evidences = res.data;\n      vm.mygrid.data = risk_evidences;\n\n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n      /* Reset columns */\n      vm.mygrid.columnDefs = [];\n      \n      vm.mygrid.columnDefs.push({\n        field: 'View',\n        enableFiltering: false,\n        enableColumnMenu: false,\n        cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_evidences.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button></div>',\n        width: 60\n      });\n\n      //show edit buttons\n      if (currentUser.username) {\n        vm.mygrid.columnDefs.push({\n          field: 'Edit',\n          enableFiltering: false,\n          enableColumnMenu: false,\n          cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_evidences.edit({id:row.entity.id_label})\"><i class=\"fa fa-edit\"></i></button></div>',\n          width: 60\n        });\n      }   \n      \n      //dynamic creation of the grid columns\n      content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n        vm.mygrid.columnDefs.push(obj);\n      }));\n\n      vm.mygrid.columnDefs.push({\n        field: 'id_label',\n        displayName: 'ID',\n        visible: false\n      });\n\n\n\n    });\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n    \n\n  }\n})();\n\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n    \n    $stateProvider\n  \n      /*  risk_evidences  */\n      .state('main.risk_evidences', {\n        'abstract':true,\n        templateUrl: 'app/pages/risk_evidences/main.html',\n        url: '/risk_evidences'\n      })\n      .state('main.risk_evidences.list', {\n        controller: 'risk_evidencesController',\n        controllerAs: 'risk_evidences',\n        templateUrl: 'app/pages/risk_evidences/list.html',\n        url: ''\n      })\n      .state('main.risk_evidences.createWithId', {\n        templateUrl: 'app/pages/risk_evidences/single/single.html',\n        controller: 'risk_evidencesSingleController',\n        controllerAs: 'risk_evidence',\n        url: '/create/:pubmedId',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.risk_evidences.create', {\n        templateUrl: 'app/pages/risk_evidences/single/single.html',\n        controller: 'risk_evidencesSingleController',\n        controllerAs: 'risk_evidence',\n        url: '/create',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.risk_evidences.edit', {\n        templateUrl: 'app/pages/risk_evidences/single/single.html',\n        controller: 'risk_evidencesSingleController',\n        controllerAs: 'risk_evidence',\n        url: '/:id/edit',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }            \n          }\n        }\n        \n      })\n      .state('main.risk_evidences.view', {\n        controller: 'risk_evidencesSingleController',\n        templateUrl: 'app/pages/risk_evidences/single/single.html',\n        controllerAs: 'risk_evidence',\n        url: '/:id'\n      });\n  }\n\n})();\n\nangular.module('CarreEntrySystem').service('Risk_elements', function($http, CARRE, CONFIG, QUERY,RdfFormatter) {\n\n  this.exports = {\n    'get': getRisk_elements,\n    'save': saveRisk_element,\n    'associations': RiskElementAssociations\n  };\n\n\n  function getRisk_elements(ArrayOfIDs) {\n    return CARRE.instances('risk_element', ArrayOfIDs);\n  }\n\n  function saveRisk_element(oldElem, newElem, user) {\n    user = user || CONFIG.currentUser.graphName;\n    var updateQuery = \"\",\n      insertQuery = \"\";\n    var newObj = {};\n    if (newElem.name.length > 0) newObj.has_risk_element_name = {\n      pre: 'risk',\n      value: newElem.name.toString(),\n      type: \"lang\"\n    };\n    if (newElem.identifier.length > 0) newObj.has_risk_element_identifier = {\n      pre: 'risk',\n      value: \"http://umls.nlm.nih.gov/sab/mth/cui/\" + newElem.identifier.toString(),\n      type: \"node\"\n    };\n    if (newElem.type.length > 0) newObj.has_risk_element_type = {\n      pre: 'risk',\n      value: newElem.type.toString(),\n      type: \"node\"\n    };\n    if (newElem.modifiable_status) newObj.has_risk_element_modifiable_status = {\n      pre: 'risk',\n      value: newElem.modifiable_status.toString(),\n      type: \"string\"\n    };\n    if (newElem.observables.length > 0) newObj.has_risk_element_observable = {\n      pre: 'risk',\n      value: newElem.observables,\n      type: \"node\"\n    };\n    if (newElem.risk_elements.length > 0) newObj.includes_risk_element = {\n      pre: 'risk',\n      value: newElem.risk_elements,\n      type: \"node\"\n    };\n\n\n    console.log('Old: ', oldElem);\n    console.log('New: ', newElem);\n    console.log('Mapped: ', newObj);\n\n    /* invalidate risk_element_all */\n    CARRE.invalidateCache('risk');\n    CARRE.invalidateCache('count_all');\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem, newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery, 'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj, \"risk_element\", \"RL\", user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery, 'no prefix');\n    }\n\n  }\n\n  function RiskElementAssociations(id) {\n    var FilterString=\"\";\n    var cache_key=\"\";\n    var filters=[];\n    if(id){\n      if(!(id instanceof Array)) {\n        //convert to array;\n        id = [id];\n      } //else it is array\n      \n      id.forEach(function(sid,index){\n        //id fix\n        var prefix = \"\";\n        if (sid.indexOf(\"http\") === -1) {\n          cache_key=cache_key+\"_\"+sid;\n          prefix = sid.split(\"_\")[0];\n          sid = prefix + \":\" + sid;\n        } else {\n          cache_key=cache_key+\"_\"+sid.substring(sid.lastIndexOf(\"/\")+1);\n          sid = \"<\" + sid + \">\";\n        }\n        \n        //now filter depending on id\n        if(sid.indexOf(\"RL\")>=0){\n          filters.push(\"?has_risk_factor_source=\"+sid+\"||?has_risk_factor_target=\"+sid);\n        } else if(sid.indexOf(\"RF\")>=0) {\n          filters.push(\"?subject=\"+sid);\n        }\n      });\n        \n      FilterString=\"FILTER (\"+filters.join(\"||\")+\")\";\n      \n      //if ids>1 no cache else add prefix\n      // if(id.length!==1) cache_key=null;\n      cache_key=\"risk_associations_for\"+cache_key;\n      \n    } else cache_key=\"risk_associations_for_all\";\n    \n     var query = \"SELECT * FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" \\n\\\n            WHERE { \\n\\\n            ?subject a risk:risk_factor; ?predicate ?object. \\n\\\n             ?subject risk:has_risk_factor_association_type ?has_risk_factor_association_type. \\n\\\n             ?subject risk:has_risk_factor_source ?has_risk_factor_source. \\n\\\n             ?subject risk:has_risk_factor_target ?has_risk_factor_target. \\n\\\n            OPTIONAL {    \\n\\\n             ?object a risk:risk_element. \\n\\\n             ?object risk:has_risk_element_name ?has_risk_element_name  \\n\\\n               FILTER(lang(?has_risk_element_name)='\"+CONFIG.LANG+\"') \\n\\\n            } \"+ FilterString+\" }\";\n            \n    return CARRE.selectQuery(query,null,(CONFIG.USECACHE?cache_key:null)).then(function(res) {\n      var graphData = {\n        nodes:[],\n        edges:[]\n      };\n        \n      var tmp_nodes=[];\n      res.data.forEach(function(rf) {\n        var source = {\n          label: rf.has_risk_factor_source_label,\n          id: rf.has_risk_factor_source[0],\n          value:1\n        };\n\n        var target = {\n          label: rf.has_risk_factor_target_label,\n          id: rf.has_risk_factor_target[0],\n          value:1\n        };\n\n        var relation = {\n          label: rf.has_risk_factor_association_type_label,\n          id: rf.id\n        };\n\n        //add the nodes\n        var source_index=tmp_nodes.indexOf(source.id);\n        if(source_index===-1) {\n          tmp_nodes.push(source.id);\n          graphData.nodes.push(source);\n        } else {\n          graphData.nodes[source_index].value++;\n        }\n        var target_index=tmp_nodes.indexOf(target.id);\n        if(target_index===-1) {\n          tmp_nodes.push(target.id);\n          graphData.nodes.push(target);\n        } else {\n          graphData.nodes[target_index].value++;\n        }\n        \n        //add the edges\n        graphData.edges.push({id:relation.id, from:source.id, label:relation.label, to:target.id});\n\n      });\n      console.log(\"Graph data\",graphData);\n      return graphData;\n\n    });\n\n  }\n\n  return this.exports;\n\n});\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n   \n    $stateProvider\n    \n      /*  Risk Elements  */\n      .state('main.risk_elements', {\n        'abstract':true,\n        templateUrl: 'app/pages/risk_elements/main.html',\n        controller: 'risk_elementsController',\n        controllerAs: 'risk_elements',\n        url: '/risk_elements'\n      })\n      .state('main.risk_elements.list', {\n        templateUrl: 'app/pages/risk_elements/list.html',\n        controller: 'risk_elementsController',\n        controllerAs: 'risk_elements',\n        url: ''\n      })\n      .state('main.risk_elements.create', {\n        templateUrl: 'app/pages/risk_elements/single/single.html',\n        controller: 'risk_elementsSingleController',\n        controllerAs: 'risk_element',\n        url: '/create',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.risk_elements.view', {\n        templateUrl: 'app/pages/risk_elements/single/single.html',\n        controller: 'risk_elementsSingleController',\n        controllerAs: 'risk_element',\n        url: '/:id'\n      })\n      .state('main.risk_elements.edit', {\n        templateUrl: 'app/pages/risk_elements/single/single.html',\n        controller: 'risk_elementsSingleController',\n        controllerAs: 'risk_element',\n        url: '/:id/edit',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }\n          }\n        }\n        \n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('risk_elementsController', risk_elementsController);\n\n  /** @ngInject */\n  function risk_elementsController(toastr, currentUser, Risk_elements, $stateParams, CONFIG, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state , content,VisibleFields) {\n    var vm = this; //controller as vm\n  \n    /************** List Template **************/\n      \n    var visibleGridColumns=VisibleFields('risk_element','list');\n    \n    var risk_elements = [];\n    vm.gridLoading=Risk_elements.get().then(function(res) {\n      risk_elements = res.data;\n      vm.mygrid.data = risk_elements;\n      \n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n      /* Reset columns */\n      vm.mygrid.columnDefs = [];\n      \n      vm.mygrid.columnDefs.push({\n        field: 'View',\n        enableFiltering: false,\n        enableColumnMenu: false,\n        cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_elements.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button></div>',\n        width: 60\n      });\n\n      //show edit buttons\n      if (currentUser.username) {\n        vm.mygrid.columnDefs.push({\n          field: 'Edit',\n          enableFiltering: false,\n          enableColumnMenu: false,\n          cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.risk_elements.edit({id:row.entity.id_label})\"><i class=\"fa fa-edit\"></i></button></div>',\n          width: 60\n        });\n      }\n      \n      //dynamic creation of the grid columns\n      content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n        vm.mygrid.columnDefs.push(obj);\n      }));\n\n      vm.mygrid.columnDefs.push({\n        field: 'id_label',\n        displayName: 'ID',\n        visible: false\n      });\n\n\n    });\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n    \n    \n  }\n    \n\n})();\n\nangular.module('CarreEntrySystem').service('Observables', function($http, CARRE, CONFIG, QUERY) {\n\n  this.exports={\n    'get': getObservables,\n    'save': saveObservable\n  };\n  \n  function getObservables(ArrayOfIDs) {\n    return CARRE.instances('observable',ArrayOfIDs);\n  }\n  \n  function saveObservable(oldElem, newElem, user) {\n    user = user || CONFIG.currentUser.graphName;\n    var updateQuery = \"\",insertQuery = \"\";\n    var newObj = {};\n    if(newElem.name.length>0) newObj.has_observable_name = {pre:'risk',value:newElem.name.toString(),type:\"lang\"};\n    if(newElem.type.length>0) newObj.has_observable_type = {pre:'risk',value:newElem.type.toString(),type:\"node\"};\n    if(newElem.measurement_type.length>0) newObj.has_observable_measurement_type = {pre:'risk',value:newElem.measurement_type.toString(),type:\"node\"};\n    if (newElem.identifier.length > 0) newObj.has_external_type = {\n      pre: 'risk',\n      value: newElem.identifier.toString(),\n      type: \"node\"\n    };\n    if (newElem.predicate.length > 0) newObj.has_external_predicate = {\n      pre: 'risk',\n      value: newElem.predicate.toString(),\n      type: \"node\"\n    };\n    \n    console.log('Old: ',oldElem);\n    console.log('New: ',newElem);\n    console.log('Mapped: ',newObj);\n    \n    /* invalidate observable_all */\n    CARRE.invalidateCache('observable_all');\n    CARRE.invalidateCache('count_all');\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem,newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery,'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj,\"observable\",\"OB\",user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery,'no prefix');\n    }\n\n  }\n\n\n  return this.exports;\n  \n});\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n  \n    $stateProvider\n\n      /*  Observables  */\n      .state('main.observables', {\n        'abstract':true,\n        templateUrl: 'app/pages/observables/main.html',\n        url: '/observables'\n      })\n      .state('main.observables.list', {\n        controller: 'observablesController',\n        controllerAs: 'observables',\n        templateUrl: 'app/pages/observables/list.html',\n        url: ''\n      })\n      .state('main.observables.create', {\n        templateUrl: 'app/pages/observables/single/single.html',\n        controller: 'observablesSingleController',\n        controllerAs: 'observable',\n        url: '/create',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.observables.edit', {\n        templateUrl: 'app/pages/observables/single/single.html',\n        controller: 'observablesSingleController',\n        controllerAs: 'observable',\n        url: '/:id/edit',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n        \n      })\n      .state('main.observables.view', {\n        controller: 'observablesSingleController',\n        templateUrl: 'app/pages/observables/single/single.html',\n        controllerAs: 'observable',\n        url: '/:id'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('observablesController', observablesController);\n\n  /** @ngInject */\n  function observablesController(toastr,currentUser, Observables,CONFIG, $stateParams, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state, content,VisibleFields) {\n    var vm = this; //controller as vm\n    \n    \n    /************** List Template **************/\n    var visibleGridColumns=VisibleFields('observable','list');\n    \n    var observables = [];\n    vm.gridLoading=Observables.get().then(function(res) {\n      observables = res.data;\n      vm.mygrid.data = observables;\n      \n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n      /* Reset columns */\n      vm.mygrid.columnDefs = [];\n      \n      \n      vm.mygrid.columnDefs.push({\n        field: 'View',\n        enableFiltering: false,\n        enableColumnMenu: false,\n        cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.observables.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button></div>',\n        width: 60\n      });\n\n      //show edit buttons\n      if (currentUser.username) {\n        vm.mygrid.columnDefs.push({\n          field: 'Edit',\n          enableFiltering: false,\n          enableColumnMenu: false,\n          cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.observables.edit({id:row.entity.id_label})\"><i class=\"fa fa-edit\"></i></button></div>',\n          width: 60\n        });\n      }\n      \n      //dynamic creation of the grid columns\n      content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n        vm.mygrid.columnDefs.push(obj);\n      }));\n\n      vm.mygrid.columnDefs.push({\n        field: 'id_label',\n        displayName: 'ID',\n        visible: false\n      });\n\n\n    });\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n\n  }\n})();\n\n(function() {\n  'use strict';\n\nangular.module('CarreEntrySystem').service('Medical_experts', function($http, CARRE, CONFIG, $q) {\n\n  this.exports = {\n    'get': getMedical_experts,\n    'countFor': countAllInstancesFor,\n    'saveProfile': saveMedicalExpertProfile\n    // 'insert': insertMedical_expert\n  };\n    \n  CONFIG.medical_experts=CONFIG.medical_experts|| {};\n  \n  function getMedical_experts(ArrayOfIDs) {\n    if(ArrayOfIDs) return CARRE.instances('medical_expert', ArrayOfIDs);\n    else if(CONFIG.medical_experts.cache) {\n      console.info(\"CACHE WORKS!\");\n      return $q(function(resolve, reject) {\n        resolve(CONFIG.medical_experts.cache)\n        reject();\n      });\n    }\n    else return CARRE.instances('medical_expert', ArrayOfIDs).then(function(res){ \n      CONFIG.medical_experts.cache=res;\n      console.info(\"CACHE LOADED!\");\n      return res;\n    })\n  }\n\n\n  function countAllInstancesFor(medicalExpert) {\n    var query = \"SELECT ?type (COUNT(?item_authored) AS ?authored) (COUNT(?item_reviewed) AS ?reviewed) \\n\\\n    FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" WHERE { \\n\\\n    {?item_authored risk:has_author ?user; a ?type } UNION {?item_reviewed risk:has_reviewer ?user; a ?type} \\n\\\n    \"\n    //add filter to query if a single observable is requested\n    if (medicalExpert) {\n      query += \"FILTER ( ?user=<\" +medicalExpert+ \">) }\";\n    }\n    else query += \"}\";\n    return CARRE.query(query);\n  }\n\n  function saveMedicalExpertProfile(oldElem, newElem, user) {\n    \n    user = user || CONFIG.currentUser.graphName;\n    var updateQuery = \"\",\n      insertQuery = \"\";\n    var newObj = {};\n    if (newElem.name.length > 0) newObj.has_risk_element_name = {\n      pre: 'risk',\n      value: newElem.name.toString(),\n      type: \"string\"\n    };\n    if (newElem.identifier.length > 0) newObj.has_risk_element_identifier = {\n      pre: 'risk',\n      value: \"http://umls.nlm.nih.gov/sab/mth/cui/\" + newElem.identifier.toString(),\n      type: \"node\"\n    };\n    if (newElem.type.length > 0) newObj.has_risk_element_type = {\n      pre: 'risk',\n      value: newElem.type.toString(),\n      type: \"node\"\n    };\n    if (newElem.modifiable_status.length > 0) newObj.has_risk_element_modifiable_status = {\n      pre: 'risk',\n      value: newElem.modifiable_status.toString(),\n      type: \"string\"\n    };\n    if (newElem.observables.length > 0) newObj.has_risk_element_observable = {\n      pre: 'risk',\n      value: newElem.observables,\n      type: \"node\"\n    };\n    if (newElem.risk_elements.length > 0) newObj.includes_risk_element = {\n      pre: 'risk',\n      value: newElem.risk_elements,\n      type: \"node\"\n    };\n\n\n    console.log('Old: ', oldElem);\n    console.log('New: ', newElem);\n    console.log('Mapped: ', newObj);\n\n    /* invalidate risk_element_all */\n    CARRE.invalidateCache('risk');\n    CARRE.invalidateCache('count_all');\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem, newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery, 'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj, \"risk_element\", \"RL\", user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery, 'no prefix');\n    }\n\n  }\n\n  return this.exports;\n\n});\n\n})();\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n\n    \n    $stateProvider\n    \n      /*  Medical Experts  */\n      .state('main.medical_experts', {\n        'abstract':true,\n        templateUrl: 'app/pages/medical_experts/main.html',\n        url: '/medical_experts'\n      })\n      .state('main.medical_experts.list', {\n        controller: 'medical_expertsController',\n        controllerAs: 'medical_experts',\n        templateUrl: 'app/pages/medical_experts/list.html',\n        url: ''\n      })\n      .state('main.medical_experts.view', {\n        controller: 'medical_expertsSingleController',\n        templateUrl: 'app/pages/medical_experts/single/view.html',\n        controllerAs: 'medical_expert',\n        url: '/:id'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('medical_expertsController', medical_expertsController);\n\n  /** @ngInject */\n  function medical_expertsController(Bioportal, toastr, Medical_experts, CONFIG, $stateParams, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state , content) {\n    var vm = this; //controller as vm\n    \n    \n    var visibleGridColumns=[\n      \"has_firstname\",\n      \"has_lastname\",\n      \"has_medical_specialty_identifier\",\n      \"has_medical_position\",\n      \"has_short_cv\",\n      \"has_personal_page_url\",\n      \"has_user_graph\",\n      \"has_avatar\",\n      \"is_coordinator_of_team\",\n      \"has_team_name\"\n      ];\n    \n    \n    /************** List Template **************/\n    \n    var medical_experts = [];\n    vm.gridLoading=Medical_experts.get().then(function(res) {\n      vm.users = res.data;\n      \n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n    });\n\n  }\n})();\n\nangular.module('CarreEntrySystem').service('Measurement_types', function($http, CARRE, CONFIG, QUERY) {\n\n  this.exports={\n    'get': getMeasurement_types,\n    'save': saveMeasurement_type\n  };\n  \n  function getMeasurement_types(ArrayOfIDs) {\n    return CARRE.instances('measurement_type',ArrayOfIDs);\n  }\n  \n  function saveMeasurement_type(oldElem, newElem, user) {\n    user = user || CONFIG.currentUser.graphName;\n    var updateQuery = \"\",insertQuery = \"\";\n    var newObj = {};\n    /*\n      //Init Form object\n        $scope.measurement_type = {\n          name: $scope.model.has_measurement_type_name_label,\n          unit: $scope.model.has_label_label||\"\",\n          datatype: $scope.model.has_datatype_label\n        };\n    */\n    if(newElem.name.length>0) newObj.has_measurement_type_name = {pre:'risk',value:newElem.name.toString(),type:\"lang\"};\n    if(newElem.unit.length>0) newObj.has_label = {pre:'risk',value:newElem.unit.toString(),type:\"string\"};\n    if(newElem.datatype.length>0) newObj.has_datatype = {pre:'risk',value:newElem.datatype.toString(),type:\"string\"};\n    if(newElem.has_enumeration_values.length>0) newObj.has_enumeration_values = {pre:'risk',value:newElem.has_enumeration_values.toString(),type:\"string\"};\n    if (newElem.identifier.length > 0) newObj.has_external_unit = {\n      pre: 'risk',\n      value: newElem.identifier.toString(),\n      type: \"node\"\n    };\n    \n    console.log('Old: ',oldElem);\n    console.log('New: ',newElem);\n    console.log('Mapped: ',newObj);\n    \n    /* invalidate measurement_type_all */\n    CARRE.invalidateCache('measurement_type_all');\n    CARRE.invalidateCache('count_all');\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem,newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery,'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj,\"measurement_type\",\"ME\",user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery,'no prefix');\n    }\n\n  }\n\n  return this.exports;\n  \n});\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n    $stateProvider\n    \n      /*  Measurement Types  */\n      .state('main.measurement_types', {\n        'abstract':true,\n        templateUrl: 'app/pages/measurement_types/main.html',\n        url: '/measurement_types'\n      })\n      .state('main.measurement_types.list', {\n        controller: 'measurement_typesController',\n        controllerAs: 'measurement_types',\n        templateUrl: 'app/pages/measurement_types/list.html',\n        url: ''\n      })\n      .state('main.measurement_types.create', {\n        templateUrl: 'app/pages/measurement_types/single/single.html',\n        controller: 'measurement_typesSingleController',\n        controllerAs: 'measurement_type',\n        url: '/create',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.measurement_types.edit', {\n        templateUrl: 'app/pages/measurement_types/single/single.html',\n        controller: 'measurement_typesSingleController',\n        controllerAs: 'measurement_type',\n        url: '/:id/edit',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n        \n      })\n      .state('main.measurement_types.view', {\n        controller: 'measurement_typesSingleController',\n        templateUrl: 'app/pages/measurement_types/single/single.html',\n        controllerAs: 'measurement_type',\n        url: '/:id'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('measurement_typesController', measurement_typesController);\n\n  /** @ngInject */\n  function measurement_typesController(toastr, currentUser, Measurement_types, CONFIG, $stateParams, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state, content,VisibleFields) {\n    var vm = this; //controller as vm\n    \n    \n    var visibleGridColumns=VisibleFields('measurement_type','list');\n    \n    \n    /************** List Template **************/\n    \n    var measurement_types = [];\n    vm.gridLoading=Measurement_types.get().then(function(res) {\n      measurement_types = res.data;\n      vm.mygrid.data = measurement_types;\n      \n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n      /* Reset columns */\n      vm.mygrid.columnDefs = [];\n      \n      vm.mygrid.columnDefs.push({\n        field: 'View',\n        enableFiltering: false,\n        enableColumnMenu: false,\n        cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.measurement_types.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button></div>',\n        width: 60\n      });\n\n      //show edit buttons\n      if (currentUser.username) {\n        vm.mygrid.columnDefs.push({\n          field: 'Edit',\n          enableFiltering: false,\n          enableColumnMenu: false,\n          cellTemplate: '<div class=\"ui-grid-cell-contents\"><button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.measurement_types.edit({id:row.entity.id_label})\"><i class=\"fa fa-edit\"></i></button></div>',\n          width: 60\n        });\n      }\n      \n      //dynamic creation of the grid columns\n      content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n        vm.mygrid.columnDefs.push(obj);\n      }));\n\n      vm.mygrid.columnDefs.push({\n        field: 'id_label',\n        displayName: 'ID',\n        visible: false\n      });\n\n\n    });\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n    \n\n  }\n})();\n\nangular.module('CarreEntrySystem').service('GRAPH', function(CONFIG,CARRE,RdfFormatter) {\n    \n  this.exports = {\n    'network': getNetworkData,\n    'FindIndex':FindIndex,\n    'ratioMinMax':ratioMinMax,\n    'ratioType':ratioType,\n  };\n  \n  // global functions --- not a good practice\n  function FindIndex(arr,val,prop,propVal){\n    prop = prop || 'id';\n    if(propVal) val=val[propVal];\n    for (var i=0;i<arr.length;i++){\n      if(val===arr[i][prop]) return i;\n    }\n    return -1;\n  };\n  \n  function ratioMinMax(evidences){\n    if(!evidences || evidences.length===0) return '';\n    var arr=evidences.map(function(rv){return isNaN(rv.rv_ratio_value)?1:parseFloat(rv.rv_ratio_value); }).sort();\n    return \": \"+ (arr.length===1?arr[0]:arr[0]+\"...\"+arr[arr.length-1]);\n  };\n  \n  function ratioType(val){\n    return val.substring(val.lastIndexOf(\"risk_evidence_ratio_type_\")+25).replace(\"_\",\" \"); \n  };\n  \n  //Returns a Tree ( RF: {RL_source,RL_target,RV:{OB:[],.. })\n  function getNetworkData(idFilter,edgeType){\n    edgeType = edgeType || \"risk_evidence\";\n    var FilterString=\"\";\n    var cache_key=\"\";\n    var filters=[];\n    if(idFilter){\n      if(!(idFilter instanceof Array)) {\n        //convert to array;\n        idFilter = [idFilter];\n      } //else it is array\n      \n      idFilter.forEach(function(sid,index){\n        //id fix\n        var prefix = \"\";\n        if (sid.indexOf(\"http\") === -1) {\n          cache_key=cache_key+\"_\"+sid;\n          prefix = sid.split(\"_\")[0];\n          sid = prefix + \":\" + sid;\n        } else {\n          cache_key=cache_key+\"_\"+sid.substring(sid.lastIndexOf(\"/\")+1);\n          sid = \"<\" + sid + \">\";\n        }\n        \n        //now filter depending on id\n        if(sid.indexOf(\"RL\")>=0){\n          filters.push(\"?has_risk_factor_source=\"+sid+\"||?has_risk_factor_target=\"+sid);\n        } else if(sid.indexOf(\"RF\")>=0) {\n          filters.push(\"?risk_factor=\"+sid);\n        } else if(sid.indexOf(\"RV\")>=0) {\n          filters.push(\"?has_risk_evidence=\"+sid);\n        } else if(sid.indexOf(\"OB\")>=0) {\n          filters.push(\"?has_risk_evidence_observable=\"+sid);\n        }\n      });\n        \n      FilterString=\"FILTER (\"+filters.join(\"||\")+\")\";\n      \n      //if ids>1 no cache else add prefix\n      // if(id.length!==1) cache_key=null;\n      cache_key=\"risk_associations_for\"+cache_key;\n      \n    } else cache_key=\"risk_associations_for_all\";\n    \n     var query = \"SELECT * FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" \\n\\\n            WHERE { \\n\\\n            ?risk_factor a risk:risk_factor. \\n\\\n            ?risk_factor risk:has_risk_factor_association_type ?has_risk_factor_association_type. \\n\\\n            ?risk_factor risk:has_risk_factor_source ?has_risk_factor_source. \\n\\\n            ?risk_factor risk:has_risk_factor_target ?has_risk_factor_target. \\n\\\n            ?has_risk_factor_source risk:has_risk_element_name ?has_risk_source_element_name. \\n\\\n            ?has_risk_factor_target risk:has_risk_element_name ?has_risk_target_element_name. \\n\\\n            ?has_risk_evidence a risk:risk_evidence; \\n\\\n            risk:has_risk_factor ?risk_factor; \\n\\\n            risk:has_risk_evidence_ratio_value ?has_risk_evidence_ratio_value; \\n\\\n            risk:has_risk_evidence_ratio_type ?has_risk_evidence_ratio_type; \\n\\\n            risk:has_observable_condition_text ?has_observable_condition_text; \\n\\\n            risk:has_risk_evidence_observable ?has_risk_evidence_observable. \\n\\\n            ?has_risk_evidence_observable risk:has_observable_name ?has_risk_evidence_observable_name. \\n\\\n            # language filters \\n\\\n            FILTER(lang(?has_risk_source_element_name)='\"+CONFIG.LANG+\"') \\n\\\n            FILTER(lang(?has_risk_target_element_name)='\"+CONFIG.LANG+\"') \\n\\\n            FILTER(lang(?has_risk_evidence_observable_name)='\"+CONFIG.LANG+\"') \\n\\\n            \"+ FilterString+\" }\";\n            \n    return CARRE.selectQuery(query,'raw',(CONFIG.USECACHE?cache_key:null)).then(function(res) {\n\n      var formattedData=res.data.reduce(function(init,cur){\n        var val=init.valueProp;\n        //construct risk factor element tree\n        var rf_index=cur.risk_factor[val].substring(cur.risk_factor[val].lastIndexOf('/')+1);\n        var rf={\n          rf_id:cur.risk_factor[val],\n          rf_type:cur.has_risk_factor_association_type[val],\n          rf_source_id:cur.has_risk_factor_source[val],\n          rf_source_label:cur.has_risk_source_element_name[val],\n          rf_target_id:cur.has_risk_factor_target[val],\n          rf_target_label:cur.has_risk_target_element_name[val],\n          rf_evidences:[]\n        };\n        var rv_index=rf_index+'_'+cur.has_risk_evidence[val].substring(cur.has_risk_evidence[val].lastIndexOf('/')+1);\n        var rv={\n          rv_id:cur.has_risk_evidence[val],\n          rv_observable_condition:cur.has_observable_condition_text[val],\n          rv_ratio_value:cur.has_risk_evidence_ratio_value[val],\n          rv_ratio_type:cur.has_risk_evidence_ratio_type[val],\n          rv_observables:[]\n        };\n        var ob={\n          ob_id:cur.has_risk_evidence_observable[val],\n          ob_label:cur.has_risk_evidence_observable_name[val]\n        };\n        var rf_pos=init.index[rf_index];\n        var rv_pos=init.index[rv_index];\n        \n        if (!rf_pos && rf_pos!==0) {\n          rv.rv_observables.push(ob);\n          rf.rf_evidences.push(rv);\n          init.data.push(rf);\n          init.index[rv_index] = 0;\n          init.index[rf_index] = init.data.indexOf(rf);\n        }\n        else if (!rv_pos && rv_pos!==0) {\n          rv.rv_observables.push(ob);\n          init.data[rf_pos].rf_evidences.push(rv);\n          init.index[rv_index] = init.data[rf_pos].rf_evidences.indexOf(rv);\n        }\n        else {\n          init.data[rf_pos].rf_evidences[rv_pos].rv_observables.push(ob);\n        }\n        \n        return init;\n          \n      },{data:[],index:{},valueProp:'value'});\n      \n      console.log(\"Graph Formatter: \",formattedData);\n      \n      var graphData = {\n        nodes:[],\n        edges:[]\n      };\n        \n      var tmp_nodes=[];\n      formattedData.data.forEach(function(rf) {\n      \n        var source = {\n          label: rf.rf_source_label,\n          id: rf.rf_source_id,\n          connections:0\n        };\n\n        var target = {\n          label: rf.rf_target_label,\n          id: rf.rf_target_id,\n          connections:0\n        };\n\n        var relation = {\n          label: RdfFormatter.translate(rf.rf_type),\n          id: rf.rf_id,\n          evidences:rf.rf_evidences\n        };\n\n        //add the nodes\n        var source_index=tmp_nodes.indexOf(source.id);\n        if(source_index===-1) {\n          tmp_nodes.push(source.id);\n          graphData.nodes.push(source);\n        } else {\n          graphData.nodes[source_index].connections++;\n        }\n        var target_index=tmp_nodes.indexOf(target.id);\n        if(target_index===-1) {\n          tmp_nodes.push(target.id);\n          graphData.nodes.push(target);\n        } else {\n          graphData.nodes[target_index].connections++;\n        }\n        if(edgeType==='risk_factor') { \n          graphData.edges.push({\n              id:relation.id, \n              source:source.id,\n              target:target.id,\n              from:source.id, \n              label:relation.label, \n              to:target.id,\n              evidences:relation.evidences\n            });\n          } else { //risk evidences\n          \n          relation.evidences.forEach(function(rv){\n            var ratio=isNaN(rv.rv_ratio_value)?1:parseFloat(rv.rv_ratio_value);\n            //add the edges\n            graphData.edges.push({\n              risk_factor:relation.id,\n              id:rv.rv_id, \n              source:source.id,\n              target:target.id,\n              from:source.id, \n              label:relation.label, \n              to:target.id, \n              ratio:ratio,\n              ratio_type:rv.rv_ratio_type,\n              observables:rv.rv_observables\n            });\n            \n          });\n        \n        }\n\n      });\n      \n      console.log(graphData);\n      return graphData;\n\n    });\n  }\n\n\n    return this.exports;\n});\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n    $stateProvider\n      .state('main.explore', {\n        controller: 'ExploreController',\n        controllerAs: 'explore',\n        url: '/explore',\n        templateUrl: 'app/pages/explore/index.html'\n      })\n      // .state('main.mineLiterature', {\n      //   controller: function(){},\n      //   url: '/mine-literature',\n      //   templateUrl: 'app/pages/explore/mine-literature.html'\n      // });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('ExploreController', ExploreController);\n\n  /** @ngInject */\n  function ExploreController($rootScope, $timeout, toastr, CARRE, $location, CONFIG, $scope, Email, Risk_elements,$state,$http,GRAPH, Risk_factors) {\n    var vm = this;\n    vm.minConnections=0;\n    vm.ready=true;\n    vm.risk_elements_selected=[];\n    vm.graph_type=$location.search().graphtype||\"sankey\";\n    console.log(\"Explore state params:\",$state.params)\n    vm.setNewId=function(){\n      vm.ready=false;\n      $timeout(function(){\n        vm.id=vm.risk_elements_selected;\n        vm.ready=true;\n      },100)\n    }\n    vm.examples=[\n    {\n      \"label\":\"Connections between diabetes,hypertension and colorectal cancer\",\n      \"data\":[\"http://carre.kmi.open.ac.uk/risk_elements/RL_29\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_19\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_14\"]\n    },{\n      \"label\":\"How do obesity, diabetes and depression relate with each other?\",\n      \"data\":[\"http://carre.kmi.open.ac.uk/risk_elements/RL_38\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_19\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_18\"]\n    },\n    {\n      \"label\": \"a complex one\",\n      \"data\": [\"http://carre.kmi.open.ac.uk/risk_elements/RL_19\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_33\", \"http://carre.kmi.open.ac.uk/risk_elements/RL_36\", \"http://carre.kmi.open.ac.uk/risk_elements/RL_38\", \"http://carre.kmi.open.ac.uk/risk_elements/RL_25\"]\n    },\n    {\n      \"label\":\"too complex to read\",\n      \"data\":[\"http://carre.kmi.open.ac.uk/risk_elements/RL_19\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_33\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_36\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_38\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_25\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_7\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_10\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_11\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_18\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_22\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_9\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_29\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_16\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_31\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_40\"]\n    },\n    // {\n    //   \"label\":\"Demo test from unknown user\",\n    //   \"data\":[\"http://carre.kmi.open.ac.uk/risk_elements/RL_19\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_33\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_36\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_38\",\"http://carre.kmi.open.ac.uk/risk_elements/RL_25\"]\n    // }\n    ];\n    \n    vm.recommendPopoverUrl=\"recommendExampleTemplate.html\";\n    vm.recommendExample=function(label,items){\n      var data={\n        label:label,\n        data:vm.risk_elements_selected\n      }\n      Email.example(data);\n    }\n    \n    //play with colors\n    $scope.refreshColors=function(){\n      var elems=angular.element('.ui-select-match-item');\n      angular.forEach(elems, function( el,index ){\n         angular.element(el).css('background',CONFIG.COLORS[index]);\n      });\n    }\n    \n    //add item programmatically\n    function addItem(item){\n      vm.risk_elements_selected.push(item);\n      $timeout(function(){$scope.refreshColors()},50);\n    }\n    \n    //example #1\n    $scope.runExample=function(exampleItems){\n      var timeInterval=500;\n      vm.risk_elements_selected=[];\n      exampleItems.forEach(function(url,index,arr){\n        $timeout(function(){ addItem(url); },index*timeInterval);\n      });\n      $timeout(function(){ vm.setNewId(); },exampleItems.length*timeInterval);\n    }\n    \n    //get risk elements\n    Risk_elements.get().then(function(res) {\n      vm.risk_elements = res.data.map(function(rl) {\n          var obj={\n            value: rl.id,\n            label: rl.has_risk_element_name_label\n          };\n          return obj;\n      });\n    });\n    \n    \n    // set elements by url\n    if($location.search().elements&&$location.search().elementstype){\n      vm.risk_elements_selected = $location.search().elements.split(',').map(function(elem){\n        return \"http://carre.kmi.open.ac.uk/\"+$location.search().elementstype+\"/\"+elem;\n      })\n      vm.setNewId();\n    }\n    \n  }\n})();\n\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n    $stateProvider\n      .state('main.dashboard', {\n        controller: 'DashboardController',\n        controllerAs: 'dashboard',\n        url: '/',\n        templateUrl: 'app/pages/dashboard/index.html'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('DashboardController', DashboardController);\n\n  /** @ngInject */\n  function DashboardController($rootScope, $timeout, toastr, CARRE, $location, CONFIG, $scope,Email) {\n    var vm = this;\n\n    //graph init\n    vm.countAllInit = 0;\n    vm.countAll = 0;\n  \n    vm.colors=CONFIG.COLORS;\n    console.log(vm.colors);\n    vm.counterchart_labels = [\n      // \"Medical Experts\",\n      \"Risk Factors\",\n      \"Risk Evidences\",\n      \"Risk Elements\",\n      \"Observables\",\n      \"Citations\"\n      // \"Measurement Types\",\n    ];\n    vm.counterchart_data=[];\n    vm.counterchart_data[0] = [0,0,0,0,0];\n    \n    //event on create method\n    $scope.$on('create', function (event, chart) {\n      // set colors for each bar\n      if(chart && chart.datasets && chart.datasets[0] && chart.datasets[0].bars.length>0){\n        chart.datasets[0].bars.map(function(obj,index){\n          obj.fillColor=vm.colors[index];\n          obj.strokeColor=\"#FFF\";\n          return obj;\n        });\n      } else {\n        Email.bug({title:'chart datasets not exist',data:chart.datasets[0]});\n        console.log('chart datasets not exist');\n        $timeout(function(){\n        chart.datasets[0].bars.map(function(obj,index){\n          obj.fillColor=vm.colors[index];\n          obj.strokeColor=\"#FFF\";\n          return obj;\n        });\n      },200);\n      }\n    });\n\n    //get total and unreviewed elements \n    \n    CARRE.countAll().then(function(res){\n      var r=res.data[0];\n      console.log('Counter data:',r);\n      \n      vm.citations = {\n        total:Number(r.citations.value)\n      };\n      vm.measurement_types = {\n        total:Number(r.measurement_types.value)\n      };\n      vm.observables = {\n        total:Number(r.observables.value),\n        noreviews:Number(r.observables_unreviewed.value)\n      };\n      vm.risk_elements = {\n        total:Number(r.risk_elements.value),\n        noreviews:Number(r.risk_elements_unreviewed.value)\n      };\n      vm.risk_evidences = {\n        total:Number(r.risk_evidences.value),\n        noreviews:Number(r.risk_evidences_unreviewed.value)\n      };\n      vm.risk_factors = {\n        total:Number(r.risk_factors.value),\n        noreviews:Number(r.risk_factors_unreviewed.value)\n      };\n      // vm.medical_experts = {\n      //   total:Number(r.risk_factors.value),\n      //   noreviews:Number(r.risk_factors_unreviewed.value)\n      // };\n      \n      //set data for the graph\n      vm.counterchart_data[0][0]=vm.risk_factors.total;\n      vm.counterchart_data[0][1]=vm.risk_evidences.total;\n      vm.counterchart_data[0][2]=vm.risk_elements.total;\n      vm.counterchart_data[0][3]=vm.observables.total;\n      // vm.counterchart_data[0][0]=vm.measurement_types.total;\n      vm.counterchart_data[0][4]=vm.citations.total;\n      \n      //set top counter\n      vm.countAll = vm.citations.total+\n                    vm.risk_elements.total+\n                    vm.risk_factors.total+\n                    vm.risk_evidences.total+\n                    vm.observables.total+\n                    vm.measurement_types.total;\n                    \n                    \n      /* Donut graph temp */\n    vm.counterdonut_data=[\n      vm.risk_factors.total,\n      vm.risk_evidences.total,\n      vm.risk_elements.total,\n      vm.observables.total,\n      vm.citations.total\n    ];\n    vm.counterdonut_labels=vm.counterchart_labels;\n    vm.counterdonut_options={};\n    \n    });\n\n    \n  }\n})();\n\nangular.module('CarreEntrySystem').service('Citations', function($http, CARRE, CONFIG,QUERY) {\n\n  this.exports={\n    'types': getCitationTypes,\n    'get': getCitations,\n    'save': saveCitation\n  };\n  \n  function getCitations(ArrayOfIDs) { return CARRE.instances('citation',ArrayOfIDs); }\n  \n  function getCitationTypes() {\n    var query=\"PREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \\n\\\n              SELECT ?citationType FROM \"+CONFIG.CARRE_DEFAULT_GRAPH+\" WHERE { ?subject a risk:citation; risk:has_citation_source_type ?citationType}\";\n    return CARRE.query(query,'no prefix').then(function(res){\n      var types=[];\n      if(res.data instanceof Array) {\n        res.data.forEach(function(obj){\n          var type=obj.citationType.value;\n          if(type.length>0 && types.indexOf(type)===-1) types.push(type);\n        });\n      }\n      return types;\n    });\n  }\n\n  function saveCitation(oldElem, newElem, user) {\n    console.log('Inserted citation by ',CONFIG.currentUser.graphName);\n    user = user || CONFIG.currentUser.graphName;\n    var newObj = mapper(newElem);\n    console.log('Old: ',oldElem);\n    console.log('New: ',newElem);\n    console.log('Mapped: ',newObj);\n    \n    /* invalidate citation_all */\n    CARRE.invalidateCache('citation_all');\n    CARRE.invalidateCache('count_all');\n    \n    var updateQuery = \"\",insertQuery = \"\";\n\n    if (oldElem.id) {\n      /*Update query*/\n      updateQuery = QUERY.update(oldElem,newObj);\n      console.log('----Update Query----');\n      return CARRE.query(updateQuery,'no prefix');\n    }\n    else {\n      /*Insert query*/\n      insertQuery = QUERY.insert(newObj,\"citation\",\"CI\",user);\n      console.info('-----insertQuery------');\n      return CARRE.query(insertQuery,'no prefix');\n    }\n\n  }\n  \n  //map the final object to rdf properties\n  function mapper(obj){\n    return {\n      has_citation_source_type: {pre:'risk',value:obj.type.toString(),type:\"string\"},\n      has_citation_source_level: {pre:'risk',value:obj.level.toString(),type:\"integer\"},\n      has_citation_summary: {pre:'risk',value:obj.summary.toString(),type:\"string\"},\n      has_citation_pubmed_identifier: {pre:'risk',value:obj.pubmedId.toString(),type:\"string\"}\n    };\n  }\n  \n  return this.exports;\n  \n});\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n    \n    $stateProvider\n    \n      /*  Citations  */\n      .state('main.citations', {\n        'abstract':true,\n        templateUrl: 'app/pages/citations/main.html',\n        url: '/citations'\n      })\n      .state('main.citations.list', {\n        controller: 'citationsController',\n        controllerAs: 'citations',\n        templateUrl: 'app/pages/citations/list.html',\n        url: ''\n      })\n      .state('main.citations.createWithId', {\n        templateUrl: 'app/pages/citations/single/single.html',\n        controller: 'citationsSingleController',\n        controllerAs: 'citation',\n        url: '/create/:pubmedId',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.citations.create', {\n        templateUrl: 'app/pages/citations/single/single.html',\n        controller: 'citationsSingleController',\n        controllerAs: 'citation',\n        url: '/create',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.citations.edit', {\n        templateUrl: 'app/pages/citations/single/single.html',\n        controller: 'citationsSingleController',\n        controllerAs: 'citation',\n        url: '/:id/edit',\n        data: {\n          permissions: {\n            only: ['authenticated_user'],\n            redirectTo: function(rejectedPromise) {\n              window.location.replace(window.location.href.replace('/edit','').replace('/create',''));\n            }        \n            \n          }\n        }\n      })\n      .state('main.citations.view', {\n        controller: 'citationsSingleController',\n        templateUrl: 'app/pages/citations/single/single.html',\n        controllerAs: 'citation',\n        url: '/:id'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('citationsController', citationsController);\n\n  /** @ngInject */\n  function citationsController(toastr, Citations,currentUser, $stateParams, CONFIG, uiGridGroupingConstants, $timeout, Pubmed, uiGridConstants, $state, content, VisibleFields) {\n    var vm = this; //controller as vm\n    \n    \n    /************** List Template **************/\n    var visibleGridColumns=VisibleFields('citation','list');\n    \n    var citations = [];\n    vm.gridLoading=Citations.get().then(function(res) {\n      citations = res.data;\n      vm.mygrid.data = citations;\n      \n      console.log('Model response: ', res);\n      //make the response available in the view\n      vm.res = res;\n\n      /* Reset columns */\n      vm.mygrid.columnDefs = [];\n      \n      vm.mygrid.columnDefs.push({\n        field: 'View',\n        enableFiltering: false,\n        enableColumnMenu: false,\n        cellTemplate: \n          '<div class=\"ui-grid-cell-contents\">'+\n          '<button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.citations.view({id:row.entity.id_label})\"><i class=\"fa fa-eye\"></i></button> '+\n          // '<button type=\"button\" class=\"btn btn-xs btn-primary\" ng-click=\"citations.setPubmed(56)\"><i class=\"fa fa-search-plus\"></i></button>'+\n          '</div>',\n        width: 70\n      });\n\n      //show edit buttons\n      if (currentUser.username) {\n        vm.mygrid.columnDefs.push({\n          field: 'Edit',\n          enableFiltering: false,\n          enableColumnMenu: false,\n          cellTemplate: \n            '<div class=\"ui-grid-cell-contents\">'+\n            '<button type=\"button\" class=\"btn btn-xs btn-primary\" ui-sref=\"main.citations.edit({id:row.entity.id_label})\"><i class=\"fa fa-edit\"></i></button> '+\n            '</div>',\n          width: 60\n        });\n      }\n      \n      //dynamic creation of the grid columns\n      content.fields(res.fields, visibleGridColumns).forEach((function(obj) {\n        vm.mygrid.columnDefs.push(obj);\n      }));\n\n      vm.mygrid.columnDefs.push({\n        field: 'id_label',\n        displayName: 'ID',\n        visible: false\n      });\n\n    });\n\n    /* GRID Default options */\n    vm.mygrid = content.default;\n\n\n  }\n})();\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreViewPubmed', function(CONFIG) {\n    return {\n      templateUrl: 'app/components/view-pubmed/view-pubmed.html',\n      restrict: 'E',\n      replace: true,\n      scope: {\n        'id': '@'\n      },\n      controller: function($scope, Pubmed) {\n      \n        $scope.loading = Pubmed.fetch($scope.id).then(function(res) {\n          $scope.pubmedArticle = res.data;\n        });\n\n\n        //debug\n      }\n    };\n  });\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name izzyposWebApp.directive:adminPosHeader\n * @description\n * # adminPosHeader\n */\nangular.module('CarreEntrySystem')\n    .directive('stats',function() {\n    \treturn {\n  \t\ttemplateUrl:'app/components/stats/stats.html',\n  \t\trestrict:'E',\n  \t\treplace:true,\n  \t\tscope: {\n        'model': '=',\n        'comments': '@',\n        'number': '@',\n        'name': '@',\n        'title': '@',\n        'color': '@',\n        'details':'@',\n        'type':'@',\n        'goto':'@'\n  \t\t},\n  \t\t// controller:function($scope){\n  \t\t    \n  \t\t//     $scope.setStyle=function(hexColor){\n  \t\t//         if(!hexColor) return \"\";\n  \t\t//         if(hexColor.indexOf(\"#\")===-1) return \"\";\n  \t\t//         var rgb=hexToRgb(hexColor);\n  \t\t//         var bgcolor='rgba('+rgb.r+', '+rgb.g+', '+rgb.b+', 1)';\n  \t\t//         console.log(bgcolor);\n  \t\t//         return {'background-color':bgcolor};\n  \t\t//     }\n  \t\t    \n  \t\t//     function hexToRgb(hex) {\n    //             // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n    //             var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n    //             hex = hex.replace(shorthandRegex, function(m, r, g, b) {\n    //                 return r + r + g + g + b + b;\n    //             });\n            \n    //             var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    //             return result ? {\n    //                 r: parseInt(result[1], 16),\n    //                 g: parseInt(result[2], 16),\n    //                 b: parseInt(result[3], 16)\n    //             } : null;\n    //         }\n\n  \t\t// }\n  \t\t\n  \t}\n  });\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name izzyposWebApp.directive:adminPosHeader\n * @description\n * # adminPosHeader\n */\nangular.module('CarreEntrySystem')\n  .directive('sidebar',sidebarDirective);\n  \n  function sidebarDirective() {\n    return {\n      templateUrl:'app/components/sidebar/sidebar.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      controllerAs:'sidebar',\n      controller:function($rootScope, $scope,$state){\n        \n        var carreElementsMenu=[];\n        angular.forEach(angular.element('#carreElements > ul.nav.nav-second-level > li > a'), function( el ){\n          carreElementsMenu.push(angular.element(el).attr('ui-sref-active-if'))\n        })\n        function show_carreElementsMenu(state){ return carreElementsMenu.indexOf(state.substring(0,state.lastIndexOf('.')))>=0; }\n        \n        //handle ui-router errors\n        $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams, error) {\n            $scope.carreElements =  show_carreElementsMenu(toState.name);\n        });\n        //collapse sidebar submenus\n        $scope.carreElements = show_carreElementsMenu($state.current.name);\n        \n        \n        \n        $scope.slideWidth=(window.innerWidth>730)?window.innerWidth*0.4:window.innerWidth*0.9;\n        \n        $(window).resize(function(){\n            if($scope.showAbout) { \n              // console.log('Width changed', window.innerWidth);\n              $scope.slideWidth=(window.innerWidth>730)?window.innerWidth*0.4:window.innerWidth*0.9;\n              $scope.slideWidth=(window.innerWidth>730)?window.innerWidth*0.4:window.innerWidth*0.9;\n              $scope.$apply(function(){ $scope.showAbout=false;  });\n              $scope.$apply(function(){ $scope.showAbout=true;  });\n            }\n        });\n\n      }\n    };\n  };\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreLinker', function(CONFIG) {\n    return {\n      templateUrl: 'app/components/linker/linker.html',\n      restrict: 'E',\n      replace: true,\n      scope: {\n        'property': '@',\n        'model': '='\n      },\n      controller: function($scope, CONFIG, Medical_experts) {\n        \n        $scope.show = 'label';\n        $scope.items = [];\n        var label_arr = [];\n        var avoidExpressions = ['has_observable_condition'];\n        var arr = $scope.model[$scope.property];\n        $scope.label = $scope.model[$scope.property + '_label'];\n        \n        //handle medical experts\n        if ($scope.property === 'has_author' || $scope.property === 'has_reviewer') {\n            Medical_experts.get().then(function(res) {\n              var USERS={}\n              res.data.forEach(function(user){\n                USERS[user.has_graph_uri_label]=user;\n              });\n              \n              label_arr = $scope.model[$scope.property + '_label_arr'];\n              $scope.show = 'links';\n              label_arr.forEach(function(username){\n                var user = USERS[username];\n                  $scope.items.push({\n                    link: (CONFIG.ENV === 'PROD' ? '' : '#/') + \"medical_experts/\" + user.id_label,\n                    label: user.has_firstname_label+' '+user.has_lastname_label\n                  });\n              })\n            });\n        } else //handle condition\n            if ($scope.property === 'has_observable_condition') {\n          $scope.show='condition';\n          \n          $scope.model['has_risk_evidence_observable'].forEach(function(obj,index){\n            var id=obj.substr(obj.lastIndexOf('/')+1);\n            var link=(CONFIG.ENV === 'PROD' ? '' : '#/') + 'observables/' + id;\n            var label=$scope.model['has_risk_evidence_observable_label_arr'][index];\n            //construct <a> tag\n            var atag=\"<a href=\"+link+\">\"+label+\"</a>\";\n            //replace all OB_* in the expression\n            $scope.label=$scope.label.replace(new RegExp(id, 'g'), atag)\n            .replace(new RegExp(\">=\", 'g'), '&ge;').replace(new RegExp(\"<=\", 'g'), '&le;'); //replace greater than and lower than symbols\n          });\n          \n        }  else //handle external annotations\n            if ($scope.property === 'has_external_type' || $scope.property === 'has_external_unit'|| $scope.property === 'has_external_predicate')  {\n                $scope.show='external_link';\n                $scope.external_link = \"<a target='_blank' href='\"+$scope.model[$scope.property]+\"'>\"+$scope.model[$scope.property+'_label']+\"</a>\";\n        }\n        else {\n          // handle links\n          if (arr instanceof Array && avoidExpressions.indexOf($scope.property) === -1) {\n              \n            label_arr = $scope.model[$scope.property + '_label_arr'];\n\n            arr.forEach(function(str, index) {\n              var id = str.substr(str.lastIndexOf('/') + 1);\n              var cat = id.substr(0, 2);\n              var type = false;\n              switch (cat) {\n                case 'CI':\n                  // make label for observables\n                  type = 'citations/';\n                  break;\n                case 'OB':\n                  // make label for observables\n                  type = 'observables/';\n                  break;\n                case 'ME':\n                  // make label for measurent types\n                  type = 'measurement_types/';\n                  break;\n                case 'RF':\n                  // make label for risk factor                          \n                  type = 'risk_factors/';\n                  break;\n                case 'RL':\n                  // make label for risk element\n                  type = 'risk_elements/';\n                  break;\n                case 'RV':\n                  // make label for risk evidence\n                  type = 'risk_evidences/';\n                  break;\n                default:\n              }\n              if (type) {\n                $scope.show = 'links';\n                $scope.items.push({\n                  link: (CONFIG.ENV === 'PROD' ? '' : '#/') + type + id,\n                  label: label_arr[index]\n                });\n              }\n\n            });\n          }\n        }\n        //debug\n        // console.log('Label:',$scope.label,($scope.showlink?'link':'text'));\n      }\n    };\n  });\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\n.directive('leEditor', ['$compile','$timeout','$q', function($compile,$timeout,$q) {\n    return {\n        restrict: 'E',\n        scope: {\n            group: '=',\n            observables: '=',\n            metypes: '='\n        },\n        templateUrl: 'app/components/le_editor/le_editor.html',\n        compile: function(element, attrs) {\n            var content, directive;\n            content = element.contents().remove();\n            return function(scope, element, attrs) {\n                scope.operators = [{\n                        name: 'AND'\n                    },\n                    // { name: 'AND NOT' },\n                    {\n                        name: 'OR'\n                    }\n                    // { name: 'OR NOT' }\n                ];\n\n                scope.field = {};\n\n                scope.conditions = [\n                    {\n                        name: '=',  value: '=', types:'integer,float,enum,boolean'\n                    },\n                    {\n                        name: '<',  value: '<', types:'integer,float'\n                    }, \n                    {\n                        name: '',  value: '<=', types:'integer,float'\n                    }, \n                    {\n                        name: '>',  value: '>', types:'integer,float'\n                    }, \n                    {\n                        name: '',  value: '>=', types:'integer,float'\n                    }\n                ];\n\n                scope.getMeasurementType = function(item, model, rule) {\n                    rule.hiddenData=true;\n                    $timeout(function() { \n                        \n                        var me_id = '';\n                        if (!item) {\n                            for (var i = 0; i < scope.observables.length; i++) {\n                                if (scope.observables[i].value === model) {\n                                    console.log(scope.observables[i])\n                                    me_id = scope.observables[i].metype_id;\n                                    break;\n                                }\n                            }\n                            me_id = me_id.substring(me_id.indexOf('ME_'));\n                            console.log('Get measurement type called!',me_id);\n                        }\n                        else {\n                            me_id = item.metype_id;\n                            me_id = me_id.substring(me_id.indexOf('ME_'));\n                            console.log('Get measurement type called!',me_id);\n                        }\n                            \n                        for (var i = 0; i < scope.metypes.length; i++) {\n                            if (scope.metypes[i].id_label === me_id) {\n                                //do stuff\n                                rule.datatype = scope.metypes[i].has_datatype_label;\n                                rule.unit = scope.metypes[i].has_label_label;\n                                rule.unit_label = scope.metypes[i].has_measurement_type_name_label;\n                                if (scope.metypes[i].has_enumeration_values_label) rule.dataoptions = scope.metypes[i].has_enumeration_values_label.split(';').map(function(obj) {\n                                    return {\n                                        value: obj,\n                                        name: obj\n                                    }\n                                });\n                                break;\n                            }\n                        }\n                        \n                        //make it like loading\n                        $timeout(function(){rule.hiddenData=!rule.hiddenData;},400);\n                        \n                    }, 500);\n\n                };\n\n                scope.addCondition = function() {\n                    scope.group.rules.push({\n                        condition: '=',\n                        field: {\n                            selected: {\n                                label: ''\n                            }\n                        },\n                        data: ''\n                    });\n                };\n\n                scope.removeCondition = function(index) {\n                    scope.group.rules.splice(index, 1);\n                };\n\n                scope.addGroup = function() {\n                    scope.group.rules.push({\n                        group: {\n                            operator: 'AND',\n                            rules: []\n                        }\n                    });\n                };\n\n                scope.removeGroup = function() {\n                    \"group\" in scope.$parent && scope.$parent.group.rules.splice(scope.$parent.$index, 1);\n                };\n\n                directive || (directive = $compile(content));\n\n                element.append(directive(scope, function($compile) {\n                    return $compile;\n                }));\n            }\n        }\n\n\n    }\n}]);\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name izzyposWebApp.directive:adminPosHeader\n * @description\n * # adminPosHeader\n */\nangular.module('CarreEntrySystem')\n\t.directive('carreHeader',function(){\n\t\treturn {\n            templateUrl:'app/components/header/header.html',\n            restrict: 'E',\n            replace: true,\n            controllerAs:'header',\n            controller:function($scope,$rootScope,$window){\n                var vm = this;\n                $scope.toggleNavbar=function(){\n                    if($('div.navbar-collapse').hasClass('collapse')) {\n                        $('div.navbar-collapse').removeClass('collapse');\n                    } else {\n                        $('div.navbar-collapse').addClass('collapse');\n                    }\n                }\n                //when you change state close again the navbar\n                $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams){\n                    // console.log(fromState,toState);\n                    if(fromState!==toState) $('div.navbar-collapse').addClass('collapse');\n                })\n            }\n    \t}\n\t});\n\n\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreGraphSankeyRisk', function() {\n    return {\n      templateUrl: 'app/components/graph-sankey/template.html',\n      restrict: 'E',\n      scope: {\n        'limitNewConnections': '@',\n        'height': '@',\n        'riskid': '='\n      },\n      controller: function($scope, $timeout, toastr, CARRE, $location, CONFIG, GRAPH, content,$q) {\n\n        var vm = $scope;\n        vm.loading = false;\n        vm.containerId = \"sankey\";\n        \n          //graph init configuration\n        vm.limitNewConnections = $scope.limitNewConnections || 30;\n        vm.minConnections = 6;\n        vm.height = vm.height || 600;\n        vm.customHeight=0;\n        \n        vm.alwaysOnDetails=true;\n        vm.showRiskEvidences=false;\n        vm.onlyCore= false;\n        \n        \n        // ratio filter\n        vm.ratioFilter = {\n          \"min\":0,\n          \"max\":50\n        };\n        function ratioFilterFn (a) {\n          if(!vm.showRiskEvidences) return true;\n          if(a.ratio>=vm.ratioFilter.min&&a.ratio<=vm.ratioFilter.max) return true;\n          else {\n            // console.debug(a.id+':'+vm.ratioFilter.min+'<'+a.ratio+'<'+vm.ratioFilter.max);\n            return false;\n          }\n        }\n        $scope.$watch('ratioFilter.min',function(n,o){\n          if(n&&o&&n!==o) vm.renderSankey();\n        })\n        $scope.$watch('ratioFilter.max',function(n,o){\n          if(n&&o&&n!==o) vm.renderSankey();\n        })\n        \n        //resize events\n        $(window).resize(function(){ vm.renderSankey(); });\n        vm.addSize=function(){\n          if(vm.customHeight>=800) return false;\n          vm.customHeight+=100;\n          $timeout(function() {\n            vm.renderSankey();\n          });\n        };\n        vm.removeSize=function(){\n          if(vm.customHeight<=-300) return false;\n          vm.customHeight-=100;\n          $timeout(function() {\n            vm.renderSankey();\n          });\n        };\n        \n        vm.init =function (id){\n          \n          id = id || vm.riskid;\n          \n          vm.loading = GRAPH.network(id,!vm.showRiskEvidences?'risk_factor':null).then(function(data) {\n\n            //set initial nodes and edges\n            vm.nodesArr = id ? data.nodes.map(function(obj,index) {\n              var obj_pos = -1;\n              //handle colors\n              if (id instanceof Array ) {\n                if(id[0].indexOf(\"RL_\")>=0) obj_pos = id.indexOf(obj.id); else {\n                  //if this is not a risk element array\n                  obj_pos = index;\n                }\n              } else {\n                if(id[0].indexOf(\"RL_\")>=0) id.substring(id.lastIndexOf(\"/\") + 1) === obj.id.substring(obj.id.lastIndexOf(\"/\") + 1) ? 0 : -1; else {\n                  //if this is not a risk element\n                  obj_pos = index;\n                }\n              }                         \n              if (obj_pos >= 0) obj.color = CONFIG.COLORS[obj_pos];\n              return obj;\n            })\n            // .filter(function(node){\n            //   if(vm.onlyCore) {\n            //     return node.color?true:false;\n            //   } else return true;\n            // }) \n            :data.nodes.filter(function(obj) {\n              return obj.connections > vm.minConnections;\n            });            \n            \n            //filter edges\n            vm.edgesArr = data.edges.filter(function(edge) {\n              var from = false;\n              var to = false;\n              for (var i = 0, len = vm.nodesArr.length; i < len; i++) {\n                if (vm.nodesArr[i].id === edge.from) from = true;\n                if (vm.nodesArr[i].id === edge.to) to = true;\n              }\n              return from && to;\n            });\n            \n            $timeout(function() {vm.renderSankey();}, 0);\n\n          });\n        };\n        \n        //start the initialization\n        vm.init(vm.riskid);\n        \n        \n        /* Graph manipulations */\n        vm.goToSelected = function(){\n          var elem = vm.selectedItem.obj||{},\n              id = elem.id.substring(elem.id.lastIndexOf(\"/\")+1),\n              label,\n              type = vm.selectedItem.type;\n              \n          if(type==='node') label=elem.label;\n          else if (type==='link'){\n              label=elem.source.label+\" \"+elem.label+\" \"+elem.target.label;\n          } else return false;\n          content.goTo(id,label);\n        };\n        \n        vm.addNodeRelations = function () {\n          var id = vm.selectedId;\n          vm.loading=GRAPH.network(id,!vm.showRiskEvidences?'risk_factor':null).then(function(data){\n            var limit=vm.limitNewConnections;\n            var nodes={};\n            data.nodes.forEach(function(node){\n              nodes[node.id]=node;\n            });\n            data.edges.forEach(function(edge){\n              if(GRAPH.FindIndex(vm.edgesArr,edge.id)===-1&&limit>0) {\n                if(GRAPH.FindIndex(vm.nodesArr,edge.from)===-1) vm.nodesArr.push(nodes[edge.from]);\n                if(GRAPH.FindIndex(vm.nodesArr,edge.to)===-1) vm.nodesArr.push(nodes[edge.to]);\n                vm.edgesArr.push(edge);\n                limit--;\n              }\n            });\n            //re-render graph\n            $timeout(function() {vm.renderSankey();}, 0);\n          });\n          \n        };\n        vm.deleteSelected = function(d){\n          if(!vm.selectedItem || vm.selectedItem.type!=='node') return false; \n          var elem = vm.selectedItem.obj||{};\n          //remove connected edges\n          elem.sourceLinks.forEach(function(link){ vm.edgesArr.splice(GRAPH.FindIndex(vm.edgesArr,link.id), 1); });\n          elem.targetLinks.forEach(function(link){ vm.edgesArr.splice(GRAPH.FindIndex(vm.edgesArr,link.id), 1); });\n          //remove related nodes\n          vm.nodesArr=vm.nodesArr.filter(function(node){ \n            return GRAPH.FindIndex(vm.edgesArr,node.id,'from')+GRAPH.FindIndex(vm.edgesArr,node.id,'to')>=-1;\n          });\n          if(d) d3.event.preventDefault();\n          //re-render graph\n          $timeout(function() {vm.renderSankey();}, 0);\n        };\n\n        //main graph render function\n        vm.renderSankey = function() {\n          // Some setup stuff.\n          var node_index = {};\n          var graph = {};\n          \n          graph.nodes = vm.nodesArr.map(function(obj, index) {\n              node_index[obj.id] = {\n                index: index,\n                value: obj.value\n              };\n              obj.name = obj.label;\n              return obj;\n            });\n            \n          graph.links = vm.edgesArr\n            .map(function(obj) {\n              if(vm.showRiskEvidences) obj.ratio_type = GRAPH.ratioType(obj.ratio_type);\n              obj.value = Number(obj.ratio)||1;\n              obj.source = node_index[obj.from].index;\n              obj.target = node_index[obj.to].index;\n              return obj;\n            });\n          \n          console.log(\"Sankey graph data\",graph);\n          \n          var calculated_height = vm.customHeight+Math.log(graph.links.length)*250;\n          \n            var margin = {top: 10, right: 10, bottom: 10, left: 10},\n                width = chartCss('width') - margin.left - margin.right,\n                height = (calculated_height>vm.height?calculated_height:vm.height) - margin.top - margin.bottom;\n                \n            var viewBox = '0 0 '+(angular.element(window).width()+40)+' '+(height+20);\n            \n            var formatNumber = d3.format(\",.0f\"), \n                format = function(d) { return formatNumber(d); },\n                d3colors = d3.scale.category20b();\n            \t\n            // append the svg canvas to the page\n            angular.element(\"#\"+vm.containerId+\" svg\").remove();\n            var svg = d3.select(\"#\"+vm.containerId).append(\"svg\")\n              .attr(\"xmlns\",\"http://www.w3.org/2000/svg\")\n              .attr(\"xmlns:xlink\",\"http://www.w3.org/1999/xlink\")\n                .attr(\"width\", \"100%\")\n                .attr(\"height\", \"100%\")\n                .attr(\"viewBox\",viewBox)\n              .append(\"g\")\n                .attr(\"transform\", \n                      \"translate(\" + margin.left + \",\" + margin.top + \")\");\n            \n            \t   \n            // Set the sankey diagram properties\n            var sankey = d3.sankey()\n                .nodeWidth(20)\n                .nodePadding(12)\n                .size([width, height]);\n            var path = sankey.link();\n            sankey\n              .nodes(graph.nodes)\n              .links(graph.links)\n              .layout(32);\n\n            // add in the links\n            var link = svg.append(\"g\").selectAll(\".link\")\n              .data(graph.links.filter(ratioFilterFn))\n              .enter().append(\"path\")\n              .attr(\"id\", function(d,i){return idLabel(d.id)})\n              .attr(\"class\", \"link\")\n              .attr(\"d\", path)\n              .style(\"stroke\", function(d, i) {\n                return vm.riskid?(d.source.color||'#aaaaaa'):CONFIG.COLORS[node_index[d.source.id].index];\n              })\n              .style(\"stroke-width\", function(d) {\n                return Math.max(2, d.dy)-1; //add white seperator\n              })\n              .sort(function(a, b) {\n                return b.dy - a.dy;\n              });\n              \n              link.append(\"title\")\n                .text(function(d) {\n                return d.source.name +\" --> \"+ d.target.name + (vm.showRiskEvidences\n                ?\", \"+d.ratio_type+\" = \"+d.ratio\n                :\", \"+d.evidences.length+\" evidence(s) \"+GRAPH.ratioMinMax(d.evidences));\n              });\n              \n              // var linkText = svg.append(\"g\")\n              // .selectAll(\".link\")\n              // .data(graph.links.filter(ratioFilterFn))\n              // .enter().append(\"text\").attr(\"class\",\"linkText\")\n              // .attr(\"id\", function(d,i){return idLabel(d.id)+\"-text\"})\n              // .append(\"textPath\").attr(\"class\", \"textpath\")\n              // .attr(\"xlink:href\",function(d,i){return \"#\"+idLabel(d.id)})\n              // .text(function(d) {\n              //   return d.source.name +\" --> \"+ d.target.name + (vm.showRiskEvidences?\", risk ratio = \"+d.ratio:\"\");\n              // })\n              \n              \n              // svg.append(\"g\")\n              // .selectAll(\".link\")\n              // .data(graph.links.filter(ratioFilterFn))\n              // .enter().append(\"use\")\n              // .attr(\"id\", function(d,i){return idLabel(d.id)+\"-line\"})\n              // .attr(\"xlink:href\",function(d,i){return \"#\"+idLabel(d.id)})\n              \n              \n              \n            // add in the nodes\n            var node = svg.append(\"g\").selectAll(\".node\")\n              .data(graph.nodes)\n              .enter().append(\"g\")\n              .attr(\"class\", \"node\")\n              .attr(\"transform\", function(d) {\n                return \"translate(\" + d.x + \",\" + d.y + \")\";\n              })\n              .call(d3.behavior.drag()\n                .origin(function(d) {\n                  return d;\n                })\n                .on(\"dragstart\", function() {\n                  this.parentNode.appendChild(this);\n                })\n                .on(\"dragend\", function() {\n                    sankey.relayout();\n                })\n                .on(\"drag\", dragmove));\n              \n            // add the rectangles for the nodes\n            node.append(\"rect\")\n              .attr(\"height\", function(d) {\n                return d.dy;\n              })\n              .attr(\"width\", \n                sankey.nodeWidth()\n              )\n              .style(\"stroke\", function(d, i) {\n                return vm.riskid?(d.color||'#aaaaaa'):CONFIG.COLORS[i]; // = color(i);\n              })\n              .style(\"fill\", function(d, i) {\n                return vm.riskid?(d.color||'#aaaaaa'):CONFIG.COLORS[i]; // = color(i);\n              })\n              // .style(\"stroke\", function(d) {\n              //   return d3.rgb('#aaaaaa');\n              // })\n              .attr('data-title', function(d) {\n                return d.name// + \"\\n\" + format(d.value);\n              })\n\n\n            // add in the title for the nodes\n            node.append(\"text\")\n              .attr(\"x\", -6)\n              .attr(\"y\", function(d) {\n                return d.dy / 2;\n              })\n              .attr(\"dy\", \"0.50em\")\n              .attr(\"text-anchor\", \"end\")\n              .attr(\"transform\", null)\n              .text(function(d) {\n                return d.name.charAt(0).toUpperCase() + d.name.slice(1);;\n              })\n              .filter(function(d) {\n                return d.x < width / 2;\n              })\n              .attr(\"x\", 6 + sankey.nodeWidth())\n              .attr(\"text-anchor\", \"start\");\n              \n              \n            // the function for moving the nodes\n          function dragmove(d) {\n              d3.select(this).attr(\"transform\",\n                \"translate(\" + d.x + \",\" + (\n                  d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))\n                ) + \")\");\n              link.attr(\"d\", path);\n            }\n            \n            //assign events\n            node.on('mousedown',clickNode);\n            link.on('mousedown',clickLink);\n            \n            node.on('dblclick',vm.addNodeRelations);\n            link.on('dblclick',vm.goToSelected);\n            \n            node.on('contextmenu',vm.deleteSelected);\n            \n        };\n            \n        //register events==============================>\n        \n        function clickNode(obj,i){ \n          clearSelection();\n          d3.select(this).select(\"rect\").classed(\"selected\", !d3.select(this).classed(\"selected\"));\n          selectElement(obj,'node');\n          d3.event.stopPropagation(); //events hack\n        }\n        function clickLink(obj,i){ \n          clearSelection();\n          d3.select(this).classed(\"selected\", !d3.select(this).classed(\"selected\"));\n          selectElement(obj,'link');\n          d3.event.stopPropagation(); //events hack\n        }\n\n        //clear selection event\n        angular.element(\"#\"+vm.containerId).on('mousedown',clearSelection);\n        \n        //help functions\n        function clearSelection(){\n          $timeout(function(){vm.selectedId = null; },0);\n          d3.select(\"#\"+vm.containerId+\" svg\").selectAll(\".link\").classed(\"selected\", false);\n          d3.select(\"#\"+vm.containerId+\" svg\").selectAll(\".node\").select(\"rect\").classed(\"selected\", false);\n        }\n        function selectElement(obj,type){\n          var id = obj?obj.id:null;\n          if(!id) return;\n          else {\n            if(id.indexOf('/')!==-1) id = id.substr(id.lastIndexOf('/')+1);\n            $timeout(function(){\n              vm.selectedId = id; \n              vm.selectedItem={type:type,obj:obj};\n            },0);\n            if(vm.showDetails && vm.alwaysOnDetails) { //reload element hack\n              $timeout(function(){vm.showDetails=false; },0);\n              $timeout(function(){vm.showDetails = true;},100);\n            }\n          }\n        }\n        function idLabel(id){\n          return id.substr(id.lastIndexOf(\"/\")+1);\n        }\n        function chartCss(attr){\n          var elem=document.getElementById(vm.containerId);\n          if(elem) return Number(getComputedStyle(elem, null).getPropertyValue(attr).replace('px',''));\n          else return null;\n        }\n        \n        //end of controller\n      }\n\n    };\n  });\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreGraphRisk', function() {\n    return {\n      templateUrl: 'app/components/graph-network-vis/template.html',\n      restrict: 'E',\n      scope: {\n        'limitNewConnections':'@',\n        'height': '@',\n        'riskid': '='\n      },\n      controller: function($scope, $timeout, toastr, $location, CONFIG, GRAPH ,content,$q) {\n      \n        var vm = $scope;\n        vm.loading=null;\n        //graph init configuration\n        vm.limitNewConnections = $scope.limitNewConnections||4;\n        vm.minConnections = 7;\n        vm.height = vm.height || 600;\n        vm.customHeight=0;\n        \n        vm.alwaysOnDetails=true;\n        vm.showRiskEvidences=$location.search().elementstype==='risk_evidences'?true:false||false;\n        vm.onlyCore= false;\n        \n        var network;\n        vm.containerId=\"network\";\n        var d3colors=d3.scale.category20b();\n        \n        //resize events\n        vm.addSize=function(){\n          vm.customHeight+=100;\n          network.setSize('100%',Number(vm.height)+vm.customHeight+'px');\n          network.redraw();\n          network.fit();\n        };\n        vm.removeSize=function(){\n          if(vm.customHeight<=0) return false;\n          vm.customHeight-=100;\n          network.setSize('100%',Number(vm.height)+vm.customHeight+'px');\n          network.redraw();\n          network.fit();\n        };\n        \n        \n        vm.init=function(id) {\n          \n          id = id || vm.riskid;\n          \n          //check if loading promise exists and act accordingly\n          $timeout(function(){vm.loading=$q.defer();},0);\n          \n          GRAPH.network(id,!vm.showRiskEvidences?'risk_factor':null).then(function(data){ \n            \n            //set initial nodes and edges\n            vm.nodesArr=id\n              ?\n              data.nodes.map(function(obj,index){\n                var obj_pos = -1;\n                //handle colors\n                if (id instanceof Array ) {\n                  if(id[0].indexOf(\"RL_\")>=0) obj_pos = id.indexOf(obj.id); else {\n                    //if this is not a risk element array\n                    obj_pos = index;\n                  }\n                } else {\n                  if(id[0].indexOf(\"RL_\")>=0) id.substring(id.lastIndexOf(\"/\") + 1) === obj.id.substring(obj.id.lastIndexOf(\"/\") + 1) ? 0 : -1; else {\n                    //if this is not a risk element\n                    obj_pos = index;\n                  }\n                }                         \n                if (obj_pos >= 0) obj.color = CONFIG.COLORS[obj_pos];\n                return obj;\n              })\n              :\n              data.nodes.filter(function(obj){ return obj.connections>vm.minConnections;}).map(function(obj,i){\n                obj.color = CONFIG.COLORS[i]; //d3colors(i);\n                return obj;\n              });\n              \n            //filter edges\n            vm.edgesArr=data.edges.filter(function(edge){\n              var from=false;\n              var to=false;\n              for (var i=0,len=vm.nodesArr.length;i<len;i++){\n                if(vm.nodesArr[i].id===edge.from) from=true;\n                if(vm.nodesArr[i].id===edge.to) to=true;\n              }\n              return from&&to;\n            }).map(function(edge){\n              var pos=(id instanceof Array)?id.indexOf(edge.from):null;\n              edge.color = pos>=0?CONFIG.COLORS[pos]:\"#aaaaaa\";\n              return edge;\n            })\n            \n            $timeout(function(){\n              if(vm.onlyCore && vm.riskid instanceof Array && vm.riskid.length>1) {\n                  var nodeIds=[];\n                  vm.startNetwork({\n                    nodes:vm.nodesArr.filter(function(node){\n                    if(network.getConnectedEdges(node.id).length>1 || node.color ){\n                      if(nodeIds.indexOf(node.id)===-1) nodeIds.push(node.id);\n                      return true;\n                    } else return false;\n                  }),\n                    edges:vm.edgesArr.filter(function(edge){\n                    return nodeIds.indexOf(edge.from)>=0 && nodeIds.indexOf(edge.to)>=0;\n                  })\n                    \n                  });\n              } else vm.startNetwork();\n            },0);\n            \n          }); \n        };\n        \n        //start the initialization\n        vm.init(vm.riskid);\n        \n        /* Graph manipulations */\n        vm.addNodeRelations = function (id) {\n          var id = id || vm.selectedId;\n          vm.loading=GRAPH.network(id,!vm.showRiskEvidences?'risk_factor':null).then(function(data){\n            var limit=vm.limitNewConnections;\n            var nodes={};\n            data.nodes.forEach(function(node){\n              nodes[node.id]=node;\n            });\n            data.edges.forEach(function(edge){\n              if(!vm.edges._data[edge.id]&&limit>0) {\n                if(!vm.nodes._data[edge.from]) vm.nodes.add(nodes[edge.from]);\n                if(!vm.nodes._data[edge.to]) vm.nodes.add(nodes[edge.to]);\n                vm.edges.add(edge);\n                limit--;\n              }\n            });\n          });\n        };\n        \n        vm.selectElement = function(id){\n          if(!id) $timeout(function(){vm.selectedId = false; },0);\n          else {\n            if(id.indexOf('/')!==-1) id = id.substr(id.lastIndexOf('/')+1);\n            $timeout(function(){vm.selectedId = id; },0);\n            if(vm.showDetails && vm.alwaysOnDetails) { //reload element hack\n              $timeout(function(){vm.showDetails=false; },0);\n              $timeout(function(){vm.showDetails = true;},100);\n            }\n          }\n          \n        };\n        vm.deleteSelected = function(id){\n          var node=id||network.getSelectedNodes()[0];\n          if(!node) return false; \n          var nodeData={\n            nodes:[node],\n            edges:network.getConnectedEdges(node)\n          }\n          vm.removeOrphan(nodeData);\n        }\n        \n        vm.goToSelected = function(){\n          var nodes=network.getSelectedNodes();\n          var edges=network.getSelectedEdges();\n          var id,label;\n          \n          if(nodes.length===1) {\n             //then it is a risk element\n            id=nodes[0].substring(nodes[0].lastIndexOf(\"/\")+1);\n            label=vm.nodes._data[nodes[0]].label;\n          \n          } else if (edges.length===1){\n              var edge=vm.edges._data[edges[0]];\n              id=edges[0].substring(edges[0].lastIndexOf(\"/\")+1);\n              label=vm.nodes._data[edge.from].label+\" \"+edge.label+\" \"+vm.nodes._data[edge.to].label;\n              \n          } else return false;\n          content.goTo(id,label);\n        }\n        \n        vm.removeOrphan = function(data){\n          data.nodes.forEach(function(node){vm.nodes.remove(node);});\n          data.edges.forEach(function(edge){ vm.edges.remove(edge);});\n          var nodes=Object.keys(vm.nodes._data);\n          nodes.forEach(function(node){\n            var edges=network.getConnectedEdges(node);\n            if(edges.length<=0) {\n              vm.nodes.remove(node);\n            }\n          });\n        };\n    \n        /* Network Graph native configuration */\n        vm.startNetwork = function(externalData) {\n            if(!vm.loading || !vm.loading.promise || vm.loading.promise.$$state.status===1) $timeout(function(){vm.loading=$q.defer();},0);\n          \n            externalData = externalData || {}\n            vm.customHeight=0;\n            vm.edges = new vis.DataSet(externalData.edges||vm.edgesArr);\n            vm.nodes = new vis.DataSet(externalData.nodes||vm.nodesArr);\n            \n            // create a network\n            var container = document.getElementById(vm.containerId);\n            var data = {\n                nodes: vm.nodes,\n                edges: vm.edges\n            };\n            var options = {\n              autoResize:true,\n              height: vm.height+'px',\n              width: '100%',\n              manipulation: {\n                enabled:false,\n              },\n              configure: {\n                enabled:false\n              },  \n              edges:{\n                smooth:{enabled:true,type:'dynamic'},\n                arrows: 'to',\n                color:'#aaaaaa',\n                font: {\n                  color: '#343434',\n                  size: 11, // px\n                  face: 'arial',\n                  background: 'none',\n                  strokeWidth: 1, // px\n                  strokeColor: '#ffffff',\n                  // align:'middle'\n                }\n              },\n              nodes:{\n                color:{\n                  border:'#aaaaaa',\n                  background:'#ffffff'\n                }\n                \n              },\n              physics:{\n                enabled: true,\n                barnesHut: {\n                  gravitationalConstant: -1000,\n                  centralGravity: 0.1,\n                  springLength: 200,\n                  springConstant: 0.001,\n                  damping: 0.09,\n                  avoidOverlap: 0\n                },\n                forceAtlas2Based: {\n                  gravitationalConstant: -70,\n                  centralGravity: 0.01,\n                  springConstant: 0.08,\n                  springLength: 100,\n                  damping: 0.4,\n                  avoidOverlap: 1\n                },\n                maxVelocity: 50,\n                minVelocity: 0.1,\n                solver: 'barnesHut',\n                stabilization: {\n                  enabled: true,\n                  iterations: 300,\n                  updateInterval: 100,\n                  onlyDynamicEdges: false,\n                  fit: true\n                },\n                timestep: 0.5,\n                adaptiveTimestep: true\n              }\n            };\n            network = new vis.Network(container, data, options);\n            \n            //register events\n            network.on(\"doubleClick\", function (params) {\n                if(params.nodes.length===1) vm.addNodeRelations(params.nodes[0]);\n                else if(params.edges.length===1) {\n                  \n                  // vm.addRiskEvidences(vm.edges._data[params.edges[0]]);\n                  \n                  // do something with the edge\n                  var edge=vm.edges._data[params.edges[0]];\n                  var rf_id=params.edges[0].substring(params.edges[0].lastIndexOf(\"/\")+1);\n                  var rf_label=vm.nodes._data[edge.from].label+\" \"+edge.label+\" \"+vm.nodes._data[edge.to].label;\n                  content.goTo(rf_id,rf_label);\n                }\n            });\n            //left click\n            network.on(\"click\", function (params) {\n              if(params.nodes.length===1) {\n                vm.selectElement(params.nodes[0]);\n              } else if(params.edges.length===1) {\n                vm.selectElement(params.edges[0]);\n              } else {\n                vm.selectElement();\n              }\n            });\n            //right click\n            network.on(\"oncontext\", function (params) {\n              var nodeId=network.getNodeAt(params.pointer.DOM);\n              if(nodeId) {\n                params.event.preventDefault();\n                vm.deleteSelected(nodeId);\n              }\n            });\n            \n            //after render\n            network.on(\"afterDrawing\", function (params) {\n              if(vm.loading && vm.loading.promise && vm.loading.promise.$$state.status===0) $timeout(function(){vm.loading.resolve();},50);\n              \n        \n            });\n        };\n        //end of controller\n      }\n    \n    };\n  });\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreGraphNetworkD3', function() {\n    return {\n      templateUrl: 'app/components/graph-network-d3/template.html',\n      restrict: 'E',\n      scope: {\n        'limitNewConnections':'@',\n        'height': '@',\n        'riskid': '='\n      },\n      controller: function($scope, $timeout, toastr, $location, CONFIG, GRAPH ,$state,SweetAlert,$q) {\n      \n  var vm = $scope;\n        vm.loading=false;\n        //graph init configuration\n        vm.limitNewConnections = $scope.limitNewConnections||4;\n        vm.minConnections = 10;\n        vm.height = vm.height || 600;\n        vm.customHeight=0;\n        var network;\n        vm.options = {\n          showRiskEvidences:false,\n          onlyCore: false\n        }\n        $timeout(function() {\n            vm.selectedId = 'RL_2'\n        },3000);\n        $scope.$watch('options',function(n,o){\n          if(n.showRiskEvidences!==o.showRiskEvidences) {\n            console.debug('ShowRiskEvidences')\n          } else if(n.onlyCore!==o.onlyCore) {\n            console.debug('onlyCore')\n          }\n          if(n.showRiskEvidences!==o.showRiskEvidences||n.onlyCore!==o.onlyCore)\n            vm.loading=$q.defer();\n            $timeout(function(){\n              vm.loading=vm.init(vm.riskid); \n            },250);\n        });\n        \n        \n        vm.addSize=function(){\n          console.debug(\"size++\")\n        }\n        \n        vm.removeSize=function(){\n          console.debug(\"size--\")\n        }\n        \n        \n        \n        vm.init=function(id) {\n          if(!id) id = vm.riskid;\n          vm.loading=GRAPH.network(id,!vm.options.showRiskEvidences?'risk_factor':null).then(function(data){ \n            \n            //set initial nodes and edges\n            vm.nodesArr=id?data.nodes.map(function(obj){\n                var obj_pos=-1;\n                //handle colors\n                if(id instanceof Array) obj_pos=id.indexOf(obj.id);\n                else obj_pos=id.substring(id.lastIndexOf(\"/\")+1)===obj.id.substring(obj.id.lastIndexOf(\"/\")+1)?0:-1;\n                if(obj_pos>=0) obj.color=CONFIG.COLORS[obj_pos];\n                \n                return obj;\n              }):data.nodes.filter(function(obj){ return obj.connections>vm.minConnections;});\n              \n            //filter edges\n            vm.edgesArr=data.edges.filter(function(edge){\n              \n              \n              var from=false;\n              var to=false;\n              for (var i=0,len=vm.nodesArr.length;i<len;i++){\n                if(vm.nodesArr[i].id===edge.from) from=true;\n                if(vm.nodesArr[i].id===edge.to) to=true;\n              }\n              return from&&to;\n            });\n            \n            //init network after 50ms delay\n            $timeout(function(){\n              \n            \n              if(vm.options.onlyCore && vm.riskid instanceof Array && vm.riskid.length>1) {\n                  var nodeIds=[];\n                  vm.loading=vm.startNetwork({\n                    nodes:vm.nodesArr.filter(function(node){\n                    if(network.getConnectedEdges(node.id).length>1 || node.color ){\n                      if(nodeIds.indexOf(node.id)===-1) nodeIds.push(node.id);\n                      return true;\n                    } else return false;\n                  }),\n                    edges:vm.edgesArr.filter(function(edge){\n                    return nodeIds.indexOf(edge.from)>=0 && nodeIds.indexOf(edge.to)>=0;\n                  })\n                    \n                  });\n              } else vm.startNetwork();\n              \n              \n            },50);\n            \n          }); \n        }\n        \n        //start the initialization\n        vm.init(vm.riskid);\n        \n        \n        vm.showRiskFactor=function(id,label){\n          //implement a basic confirm popup\n          SweetAlert.swal({\n              title: \"Show the Risk factor?\",\n              text: \"This will redirect you to the \\\"\"+label+\"\\\" risk factor's detail page.\",\n              type: \"info\",\n              showCancelButton: true,\n              confirmButtonColor: \"#2E8B57\",\n              confirmButtonText: \"Yes, show me!\",\n              closeOnConfirm: true,\n              closeOnCancel: true\n            },\n            function(isConfirm) {\n              if (isConfirm) {\n                $state.go(\"main.risk_factors.view\",{id:id});\n              }\n            });\n          \n        };\n        \n        vm.showRiskElement=function(id,label){\n          //implement a basic confirm popup\n          SweetAlert.swal({\n              title: \"Show the Risk element?\",\n              text: \"This will redirect you to the \\\"\"+label+\"\\\" risk element's detail page.\",\n              type: \"info\",\n              showCancelButton: true,\n              confirmButtonColor: \"#2E8B57\",\n              confirmButtonText: \"Yes, show me!\",\n              closeOnConfirm: true,\n              closeOnCancel: true\n            },\n            function(isConfirm) {\n              if (isConfirm) {\n                $state.go(\"main.risk_elements.view\",{id:id});\n              }\n            });\n          \n        };\n        \n        /* Graph manipulations */\n        vm.addNodeRelations = function (id) {\n          id = id || vm.selectedId;\n          vm.loading=GRAPH.network(id,!vm.options.showRiskEvidences?'risk_factor':null).then(function(data){\n            var limit=vm.limitNewConnections;\n            var nodes={};\n            data.nodes.forEach(function(node){\n              nodes[node.id]=node;\n            });\n            data.edges.forEach(function(edge){\n              if(!vm.edges._data[edge.id]&&limit>0) {\n                if(!vm.nodes._data[edge.from]) vm.nodes.add(nodes[edge.from]);\n                if(!vm.nodes._data[edge.to]) vm.nodes.add(nodes[edge.to]);\n                vm.edges.add(edge);\n                limit--;\n              }\n            });\n          });\n        };\n        \n        vm.selectElement = function(id){\n          if(!id) $timeout(function(){vm.showDetails=false; vm.selectedId = false; },0);\n          else {\n            if(id.indexOf('/')!==-1) id = id.substr(id.lastIndexOf('/')+1);\n            $timeout(function(){vm.selectedId = id; },0);\n            if(vm.showDetails) { //reload element hack\n              $timeout(function(){vm.showDetails=false; },0);\n              $timeout(function(){vm.showDetails = true;},100);\n            }\n          }\n          \n        };\n        vm.deleteSelected = function(id){\n          var node=id||network.getSelectedNodes()[0];\n          if(!node) return false; \n          var nodeData={\n            nodes:[node],\n            edges:network.getConnectedEdges(node)\n          }\n          vm.removeOrphan(nodeData);\n        }\n        \n        vm.goToSelected = function(){\n          var nodes=network.getSelectedNodes();\n          var edges=network.getSelectedEdges();\n          \n          if(nodes.length===1) {\n             //then it is a risk element\n             var rl_id=nodes[0].substring(nodes[0].lastIndexOf(\"/\")+1);\n             var rl_label=vm.nodes._data[nodes[0]].label;\n             vm.showRiskElement(rl_id,rl_label);\n          } else if (edges.length===1){\n            //then it is a risk factor\n            var edge=vm.edges._data[edges[0]];\n            var rf_id=edges[0].substring(edges[0].lastIndexOf(\"/\")+1);\n            var rf_label=vm.nodes._data[edge.from].label+\" \"+edge.label+\" \"+vm.nodes._data[edge.to].label;\n            vm.showRiskFactor(rf_id,rf_label);\n          } else return false;\n        }\n        \n        vm.removeOrphan = function(data){\n          data.nodes.forEach(function(node){vm.nodes.remove(node);});\n          data.edges.forEach(function(edge){ vm.edges.remove(edge);});\n          var nodes=Object.keys(vm.nodes._data);\n          nodes.forEach(function(node){\n            var edges=network.getConnectedEdges(node);\n            if(edges.length<=0) {\n              vm.nodes.remove(node);\n            }\n          });\n        };\n    \n        \n   \n        \n        // EVENTS===============\n        \n/*            \n            //register events\n            network.on(\"doubleClick\", function (params) {\n                if(params.nodes.length===1) vm.addNodeRelations(params.nodes[0]);\n                else if(params.edges.length===1) {\n                  \n                  // vm.addRiskEvidences(vm.edges._data[params.edges[0]]);\n                  \n                  // do something with the edge\n                  var edge=vm.edges._data[params.edges[0]];\n                  var rf_id=params.edges[0].substring(params.edges[0].lastIndexOf(\"/\")+1);\n                  var rf_label=vm.nodes._data[edge.from].label+\" \"+edge.label+\" \"+vm.nodes._data[edge.to].label;\n                  vm.showRiskFactor(rf_id,rf_label);\n                }\n            });\n            //left click\n            network.on(\"click\", function (params) {\n              var deleteButton=angular.element('#explore_deleteButton');\n              var goButton=angular.element('#explore_goButton');\n              if(params.nodes.length===1) {\n                vm.selectElement(params.nodes[0]);\n                deleteButton.css(\"display\",\"inline\");\n                goButton.css(\"display\",\"inline\"); \n              } else if(params.edges.length===1) {\n                goButton.css(\"display\",\"inline\"); \n                vm.selectElement(params.edges[0]);\n              } else {\n                goButton.css(\"display\",\"none\"); \n                deleteButton.css(\"display\",\"none\"); \n              }\n            });\n            //right click\n            network.on(\"oncontext\", function (params) {\n              var nodeId=network.getNodeAt(params.pointer.DOM);\n              if(nodeId) {\n                params.event.preventDefault();\n                vm.deleteSelected(nodeId);\n              }\n            });\n            */\n            \n\nvm.startNetwork = function(externalData) {\n            \n        externalData = externalData || {}\n        vm.customHeight=0;\n        var  nodes = externalData.nodes||vm.nodesArr;\n        var  links = externalData.edges||vm.edgesArr;\n        angular.element('#network svg').remove();\n        visualize('network',window.width-200,500,\n        {\n          \"nodes\":nodes,\n          \"links\":links.map(function(l){\n                    l.source = GRAPH.FindIndex(nodes,l.source,\"id\");\n                    l.target = GRAPH.FindIndex(nodes,l.target,\"id\");\n                    l.value = l.ratio;\n                    return l;\n                  })\n        });\n};\n\n    function visualize(id, w, h, data) {\n        var color = d3.scale.category20b();\n        var vis = d3.select(\"#\" + id).append(\"svg\").attr(\"id\", \"graph\").attr(\"width\", w).attr(\"height\", h)\n            .attr(\"style\", \"pointer-events:fill;\");\n\n        var force = self.force = d3.layout.force().nodes(data.nodes).links(data.links).gravity(.2).distance(180)\n            .charge(-500).size([ w, h ]).start();\n\n        // end-of-line arrow\n        vis.append(\"svg:defs\").selectAll(\"marker\").data([ \"end-marker\" ]) // link types if needed\n            .enter()\n            .append(\"svg:marker\").attr(\"id\", String).attr(\"viewBox\", \"0 -5 10 10\")\n            .attr(\"refX\", 30).attr(\"refY\", 0).attr(\"markerWidth\", 2).attr(\"markerHeight\", 2)\n            .attr(\"class\", \"marker\").attr(\"orient\",\"auto\")\n            .append(\"svg:path\").attr(\"d\", \"M0,-5L10,0L0,5\")\n            .style(\"fill\",\"#aaaaaa\")\n            .style(\"stroke\",\"#aaaaaa\");\n                \n                \n        var radius=20\n        var node = vis.selectAll(\"g.node\").data(data.nodes).enter().append(\"circle\").attr(\"class\", \"node\").attr(\n                \"r\", radius).style(\"fill\",function (d) {\n                return d.color||'#aaaaaa';\n            }).style(\"stroke-width\",function (d) {\n                return d[\"selected\"] ? 2 : 2;\n            }).style(\"stroke\",function (d) {\n                var sel = d[\"selected\"];\n                return sel ? \"red\" /* was d3.rgb(color2(hash(sel) % 20)).brighter() */ : \"white\";\n            }).call(force.drag);\n\n\n        var link = vis.selectAll(\"line.link\").data(data.links).enter().append(\"svg:line\").attr(\"class\", \"link\")\n            .attr(\"marker-end\", function (d) {\n                return \"url(#\" + \"end-marker\" + \")\";\n            }) // was d.type\n            .style(\"stroke\",function (d) {\n                var sel = d[\"selected\"];\n                return sel ? \"red\" : \"#aaaaaa\";\n            }).style(\"stroke-width\",function (d) {\n                return d[\"selected\"] ? 5 : 5;\n            }).attr(\"x1\",function (d) {\n                return d.source.x;\n            }).attr(\"y1\",function (d) {\n                return d.source.y;\n            }).attr(\"x2\",function (d) {\n                return d.target.x;\n            }).attr(\"y2\", function (d) {\n                return d.target.y;\n            });\n            \n            \n        //node text\n        node.append(\"title\").text(function (d) {\n            return d.label;\n        });\n        var text = vis.append(\"svg:g\").selectAll(\"g\").data(force.nodes()).enter().append(\"svg:g\");\n        // A copy of the text with a thick white stroke for legibility.\n        text.append(\"svg:text\").attr(\"x\", 28).attr(\"y\",0).attr(\"class\", \"text shadow\").text(function (d) {\n            return d.label;\n        });\n        text.append(\"svg:text\").attr(\"x\", 28).attr(\"y\", 0).attr(\"class\", \"text\").text(function (d) {\n            return d.label;\n        });\n        \n        \n        //link text\n        var path_text = vis.append(\"svg:g\").selectAll(\"g\").data(force.links()).enter().append(\"svg:g\");\n        path_text.append(\"svg:text\").attr(\"class\", \"path-text shadow\").text(function (d) {\n            return d.label;\n        });\n        path_text.append(\"svg:text\").attr(\"class\", \"path-text\").text(function (d) {\n            return d.label;\n        });\n        \n\n        force.on(\"tick\", function () {\n            link.attr(\"x1\",function (d) {\n                return d.source.x;\n            }).attr(\"y1\",function (d) {\n                    return d.source.y;\n                }).attr(\"x2\",function (d) {\n                    return d.target.x;\n                }).attr(\"y2\", function (d) {\n                    return d.target.y;\n                });\n\n            text.attr(\"transform\", function (d) {\n                return \"translate(\" + d.x + \",\" + d.y + \")\";\n            });\n\n            node.attr(\"transform\", function (d) {\n                return \"translate(\" + d.x + \",\" + d.y + \")\";\n            });\n            \n            path_text.attr(\"transform\", function (d) {\n                var dx = ( d.target.x - d.source.x ), dy = ( d.target.y - d.source.y );\n                var dr = Math.sqrt(dx * dx + dy * dy);\n                if (dr == 0) dr = 0.1;\n                var sinus = dy / dr;\n                var cosinus = dx / dr;\n                var l = d.label.length * 6;\n                var offset = ( 1 - ( l / dr ) ) / 2;\n                var x = ( d.source.x + dx * offset );\n                var y = ( d.source.y + dy * offset );\n                return \"translate(\" + x + \",\" + y + \") matrix(\" + cosinus + \", \" + sinus + \", \" + -sinus + \", \" + cosinus\n                    + \", 0 , 0)\";\n            });\n\n        });\n    }\n    \n        //end of controller\n      }\n    \n    };\n  });\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\t.directive('carreGraphControls',function(){\n\t\treturn {\n            templateUrl:'app/components/graph-controls/template.html',\n            restrict: 'E',\n            replace: false,\n            bindToController: {\n                \n                // variables\n                'selectedId': '=',\n                'disableOptions':'=?',\n                'enableRotation': '@',\n                'rotation': '=?',\n                'onlyPath':'=?',\n                'showRiskEvidences':'=?',\n                'ratioFilter':'=?',\n                \n                //functions\n                'refresh':'&',\n                'addSize':'&',\n                'removeSize':'&',\n                'navigate':'&',\n                'expand':'&',\n                'clear':'&'\n            },\n            controllerAs:'controls',\n            scope: true,\n            controller:function($timeout,CONFIG,content,$scope){\n                var vm = this;\n                \n                $scope.$watch('selectedId',function(n,o){ \n                    //hack for refresh element\n                    if(n && n!==o && $scope.showDetails){ \n                        $scope.showDetails=false;\n                        $timeout(function(){ $scope.showDetails=true; });\n                    }\n                }.bind(this));\n                \n                $scope.applyRefresh = function (){\n                    $timeout(function() { \n                        vm.refresh({}); \n                        // show slider only when risk evidences exist\n                        if(vm.showRiskEvidences)  {\n                            $scope.$broadcast('rzSliderForceRender'); \n                            vm.showSlider = true;\n                        } else vm.showSlider = false;\n                    },0);\n                };\n                \n                vm.user = CONFIG.currentUser.username;\n                vm.getType=content.typeFromId;\n                \n                // Slider configuration\n                vm.showSlider = vm.showRiskEvidences?true:false;\n                var maxLimit = 50.5;\n                var step = 0.5;\n                var stepsArray = [];\n                for(var i=0; i<maxLimit; i=i+step){ stepsArray.push( Number(Math.round(i+'e2')+'e-2') );}\n                vm.slider_toggle = {\n                    options: {\n                        stepsArray:stepsArray\n                    }\n                };\n                \n            }\n    \t};\n\t});\n\n\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreGraphChordRisk', function() { \nreturn {\n    templateUrl: 'app/components/graph-chord/template.html',\n    restrict: 'E',\n    scope: {\n        'limitNewConnections':'@',\n        'height': '@',\n        'riskid': '='\n    },\n    controller: function($scope, $timeout, toastr, CARRE, $location, CONFIG, GRAPH,$state,SweetAlert,content) {\n  \n        var vm = $scope;\n        vm.loading=false;\n        vm.containerId = \"chord\";\n        \n        //graph init configuration\n        vm.limitNewConnections = $scope.limitNewConnections||10;\n        vm.minConnections = 5;\n        vm.height = vm.height || 700;\n        vm.customHeight=0;\n        vm.rotation=0;\n        \n        vm.alwaysOnDetails=true;\n        vm.showRiskEvidences=false;\n        vm.onlyCore= false;\n        \n        //resize events\n        \n        //resize events\n        $(window).resize(function(){ vm.renderChord(); });\n        vm.addSize=function(){\n          if(vm.customHeight>=800) return false;\n          vm.customHeight+=100;\n          $timeout(function() {\n            vm.renderChord();\n          });\n        };\n        vm.removeSize=function(){\n          if(vm.customHeight<=-300) return false;\n          vm.customHeight-=100;\n          $timeout(function() {\n            vm.renderChord();\n          });\n        };\n        \n        \n        vm.init =function (id){\n          \n          id = id || vm.riskid;\n          \n          vm.loading = GRAPH.network(id,!vm.showRiskEvidences?'risk_factor':null).then(function(data) {\n\n            //set initial nodes and edges\n            vm.nodesArr=id?data.nodes.map(function(obj){\n                var obj_pos=-1;\n                //handle colors\n                if(id instanceof Array) obj_pos=id.indexOf(obj.id);\n                else obj_pos=id.substring(id.lastIndexOf(\"/\")+1)===obj.id.substring(obj.id.lastIndexOf(\"/\")+1)?0:-1;\n                if(obj_pos>=0) obj.color=CONFIG.COLORS[obj_pos];\n                \n                return obj;\n              }):data.nodes.filter(function(obj){ return obj.connections>vm.minConnections;});\n              \n            //filter edges\n            vm.edgesArr=data.edges.filter(function(edge){\n              var from=false;\n              var to=false;\n              for (var i=0,len=vm.nodesArr.length;i<len;i++){\n                if(vm.nodesArr[i].id===edge.from) from=true;\n                if(vm.nodesArr[i].id===edge.to) to=true;\n              }\n              return from&&to;\n            });\n            //init network after 50ms delay\n            $timeout(function(){ vm.renderChord(); },0);\n            \n          }); \n        }\n        \n        //start the initialization\n        vm.init(vm.riskid);\n        \n      \n        /* Graph manipulations */\n        vm.goToSelected = function () {\n          var elem = vm.selectedItem.obj||{},\n              id = elem.id.substring(elem.id.lastIndexOf(\"/\")+1),\n              label,\n              type = vm.selectedItem.type;\n          if(type==='node') label=elem.label;\n          else if (type==='link'){\n              label=vm.nodesArr[GRAPH.FindIndex(vm.nodesArr,elem.from)].label\n              +\" \"+elem.label+\" \"+\n              vm.nodesArr[GRAPH.FindIndex(vm.nodesArr,elem.to)].label;\n          } else return false;\n          content.goTo(id,label);\n        };\n        \n        vm.addNodeRelations = function () {\n          var id = vm.selectedId;\n          vm.loading=GRAPH.network(id,!vm.showRiskEvidences?'risk_factor':null).then(function(data){\n            var limit=vm.limitNewConnections;\n            var nodes={};\n            data.nodes.forEach(function(node){\n              nodes[node.id]=node;\n            });\n            data.edges.forEach(function(edge){\n              if(GRAPH.FindIndex(vm.edgesArr,edge.id)===-1&&limit>0) {\n                if(GRAPH.FindIndex(vm.nodesArr,edge.from)===-1) vm.nodesArr.push(nodes[edge.from]);\n                if(GRAPH.FindIndex(vm.nodesArr,edge.to)===-1) vm.nodesArr.push(nodes[edge.to]);\n                vm.edgesArr.push(edge);\n                limit--;\n              }\n            });\n            //re-render graph\n            $timeout(function() {vm.renderChord();}, 0);\n          });\n          \n        };\n        vm.deleteSelected = function(d){\n          if(!vm.selectedItem || vm.selectedItem.type!=='node') return false; \n          var elem = vm.selectedItem.obj||{};\n          //remove connected edges\n          vm.edgesArr=vm.edgesArr.filter(function(link, i) {\n            return !(link.from===elem.id||link.to===elem.id);\n          });          \n          vm.nodesArr=vm.nodesArr.filter(function(node){ \n            return GRAPH.FindIndex(vm.edgesArr,node.id,'from')+GRAPH.FindIndex(vm.edgesArr,node.id,'to')>=-1;\n          });\n          if(d) {\n            \n            console.debug(\"Context Menu\",d3.event,this,d);\n            d3.event.preventDefault();\n          }\n          //re-render graph\n          $timeout(function() {vm.renderChord();}, 0);\n        };\n    \n        vm.renderChord = function() {\n            if(vm.rotationWatch) vm.rotationWatch();\n      \n            var options = {\n                \"rotation\": vm.rotation\n            };\n            var nodesIndex={};\n            var edgeMatrix = [];\n            var matrix = [];\n            vm.nodesArr.forEach(function(n,i){\n              nodesIndex[n.id]={i:i,obj:n};\n              edgeMatrix[i]=edgeMatrix[i]||[];\n              matrix[i]=matrix[i]||[];\n              vm.nodesArr.forEach(function(m,j){\n                edgeMatrix[i][j]=0;\n                matrix[i][j]=0;\n              });\n            });\n            vm.edgesArr.forEach(function(e,i){\n              edgeMatrix[nodesIndex[e.from].i][nodesIndex[e.to].i]=e;\n              matrix[nodesIndex[e.from].i][nodesIndex[e.to].i]=1;\n            });\n            \n            \n            console.log(\"Chord graph data matrix\",matrix,edgeMatrix);\n            \n            // initialize the chord configuration variables\n            var config = {\n                width: chartCss('width'),\n                height: 700+vm.customHeight,\n                rotation: 0,\n                textgap: 10\n            };\n            \n            // add options to the chord configuration object\n            if (options) {\n                extend(config, options);\n            }\n            \n            // set chord visualization variables from the configuration object\n            var offset = Math.PI * vm.rotation,\n                width = config.width,\n                height = config.height,\n                textgap = config.textgap,\n                colors = d3.scale.category20b();\n            // set viewBox and aspect ratio to enable a resize of the visual dimensions \n            var viewBoxDimensions = \"0 0 \" + width + \" \" + height,\n                aspect = width / height;\n            \n    \n            // start the d3 magic\n            var chord = d3.layout.chord()\n                .padding(.05)\n                .sortSubgroups(d3.descending)\n                .matrix(matrix);\n    \n            var innerRadius = Math.min(width, height) * .31,\n                outerRadius = innerRadius * 1.1;\n    \n            var fill = function(d, i) {\n                    i = i||d;\n                    return vm.riskid?(vm.nodesArr[i].color||'#aaaaaa'):colors(i) // = color(i);\n            }\n              \n            var rotate=function(){\n                d3.select(\"#\"+vm.containerId+\" svg g\")\n                .transition()\n                .duration(1000)\n                .attr(\"transform\", \"translate(\" + width / 2 + \",\" + height / 2 + \")rotate(\"+vm.rotation+\")\")\n            }\n            \n            vm.rotationWatch=$scope.$watch('rotation',function(){\n                $timeout(function(){ rotate(); },0);\n            });\n        \n            \n            angular.element(\"#\"+vm.containerId+\" svg\").remove();\n            var svg = d3.select(\"#\"+vm.containerId).append(\"svg\")\n                .attr(\"viewBox\", viewBoxDimensions)\n                .attr(\"preserveAspectRatio\", \"xMinYMid\")    // add viewBox and preserveAspectRatio\n                .attr(\"width\", width)\n                .attr(\"height\", height)\n                .append(\"g\")\n                .attr(\"transform\", \"translate(\" + width / 2 + \",\" + height / 2 + \")\");\n    \n            var g = svg.selectAll(\"g.group\")\n                .data(chord.groups)\n                .enter().append(\"svg:g\")\n                .attr(\"class\", \"group\");\n    \n                //group arc\n                g.append(\"svg:path\")\n                .style(\"fill\", function(d) { return fill(d.index); })\n                .style(\"stroke\", function(d) { return fill(d.index); })\n                .attr(\"id\", function(d, i) { return \"group\" + d.index; })\n                .attr(\"d\", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius).startAngle(startAngle).endAngle(endAngle))\n                //group text\n                g.append(\"svg:text\")\n                .each(function(d) {d.angle = ((d.startAngle + d.endAngle) / 2) + offset; })\n                .attr(\"dy\", \".35em\")\n                .attr(\"text-anchor\", function(d) { return d.angle > Math.PI ? \"end\" : null; })\n                .attr(\"transform\", function(d) {\n                    return \"rotate(\" + (d.angle * 180 / Math.PI - 90) + \")\"\n                        + \"translate(\" + (outerRadius + textgap) + \")\"\n                        + (d.angle > Math.PI ? \"rotate(180)\" : \"\");\n                  })\n                .text(function(d) { return vm.nodesArr[d.index].label; })\n                .style(\"fill\", function(d) { return fill(d.index); });\n    \n            var link=svg.append(\"g\")\n                .attr(\"class\", \"chord\")\n                .selectAll(\"path\")\n                .data(chord.chords)\n                .enter().append(\"path\")\n                .attr(\"d\", d3.svg.chord().radius(innerRadius).startAngle(startAngle).endAngle(endAngle))\n                .style(\"fill\", function(d) { return fill(d.source.index); })\n                .style(\"opacity\", 1);\n                \n            //link text\n            link.append(\"svg:title\").text(function(d) { \n                return  vm.nodesArr[d.source.index].label +\" \"+ \n                edgeMatrix[d.source.index][d.target.index].label +\" \"+ \n                vm.nodesArr[d.target.index].label; \n            });\n        \n            // helper functions start here\n            \n            function startAngle(d) { return d.startAngle + offset; }\n            function endAngle(d) { return d.endAngle + offset; }\n            function extend(a, b) { for(var i in b) {a[i]=b[i];} }\n            \n            // Returns an event handler for fading a given chord group.\n            function fade(opacity) {\n                return function(g, i) {\n                  svg.selectAll(\".chord path\")\n                  .filter(function(d) { return d.source.index != i && d.target.index != i; })\n                  .transition().style(\"opacity\", opacity);\n                };\n            }\n            \n            //assign events\n            g.on(\"mouseover\", fade(.1))\n                .on(\"mouseout\", fade(1))\n                .on('click',clickNode)\n                .on('dblclick',vm.addNodeRelations)\n                // .on('contextmenu',vm.deleteSelected);\n                \n            link.on('click',clickLink)\n                .on('dblclick',vm.goToSelected);\n    \n        }\n        \n        //register events==============================>\n        \n        function clickNode(obj,i){ \n          console.debug(\"Click\",d3.event,this,obj,i);\n          clearSelection();\n          d3.select(this).classed(\"selected\", !d3.select(this).classed(\"selected\"));\n          selectElement(vm.nodesArr[i],'node');\n          if(d3.event.type===\"click\") d3.event.stopPropagation(); //events hack\n        }\n        function clickLink(obj,i){\n          // console.debug(\"Link\",this,obj,i);\n          clearSelection();\n          d3.select(this).classed(\"selected\", !d3.select(this).classed(\"selected\"));\n          var link=vm.edgesArr.filter(function(link){\n            return link.from===vm.nodesArr[obj.source.index].id && link.to===vm.nodesArr[obj.target.index].id;\n          })[0];\n          selectElement(link,'link');\n          d3.event.stopPropagation(); //events hack\n        }\n\n        //clear selection event\n        angular.element(\"#\"+vm.containerId).on('click',clearSelection);\n        \n        //help functions\n        function clearSelection(){\n          $timeout(function(){vm.selectedId = null; },0);\n          d3.select(\"#\"+vm.containerId+\" svg\").selectAll(\".chord path\").classed(\"selected\", false);\n          d3.select(\"#\"+vm.containerId+\" svg\").selectAll(\".group\").classed(\"selected\", false);\n        }\n        function selectElement(obj,type){\n          var id = obj?obj.id:null;\n          if(!id) return;\n          else {\n            if(id.indexOf('/')!==-1) id = id.substr(id.lastIndexOf('/')+1);\n            $timeout(function(){\n              vm.selectedId = id; \n              vm.selectedItem={type:type,obj:obj};\n            },0);\n            if(vm.showDetails && vm.alwaysOnDetails) { //reload element hack\n              $timeout(function(){vm.showDetails=false; },0);\n              $timeout(function(){vm.showDetails = true;},100);\n            }\n          }\n        }\n        function chartCss(attr){\n          var elem=document.getElementById(vm.containerId);\n          if(elem) return Number(getComputedStyle(elem, null).getPropertyValue(attr).replace('px',''));\n          else return null;\n        }\n        \n        \n\n\n    }\n\n    \n    //end of controller\n}\n      \n      \n    \n});\n'use strict';\n\n/**\n * @ngdoc directive\n * @name izzyposWebApp.directive:adminPosHeader\n * @description\n * # adminPosHeader\n */\nangular.module('CarreEntrySystem')\n\t.directive('carreFooter',function(){\n\t\treturn {\n        templateUrl:'app/components/footer/footer.html',\n        restrict: 'E',\n        replace: true\n    \t}\n\t});\n\n\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n\t.directive('carreElementControls',function(){\n\t\treturn {\n            templateUrl:'app/components/carre-element-controls/template.html',\n            restrict: 'E',\n            replace: true,\n            bindToController: {\n                'carreId': '@'\n            },\n            controllerAs:'controls',\n            scope: true,\n            controller:function(CONFIG){\n                this.dev = CONFIG.AllowDelete;\n                this.user = CONFIG.currentUser.username;\n            }\n    \t}\n\t});\n\n\n\n'use strict';\n\nangular.module('CarreEntrySystem')\n  .directive('carreElement', function(CONFIG) {\n    return {\n      templateUrl: 'app/components/carre-element/template.html',\n      restrict: 'E',\n      replace: true,\n      scope:{\n        'type': '@',\n        'mode': '@',\n        'elemId': '@',\n        'elem': '=',\n        'notFields': '@',\n        'hidePubmed': '@'\n      },\n      controller: function($rootScope, $state, $scope, $timeout, content, CONFIG, VisibleFields, Observables, Risk_elements, Risk_factors, Measurement_types, Citations, Medical_experts, Risk_evidences) {\n        \n        var vm = $scope;\n        vm.current = vm.elem || {};\n          \n        vm.notFields = vm.notFields || '';\n        if(vm.elemId) {\n          //init\n          renderElement(vm.type,vm.elemId);\n          //setup watcher\n          // WATCHER delete before restart;\n          if($rootScope.elementViewerWatcher) $rootScope.elementViewerWatcher();\n          $rootScope.elementViewerWatcher=$scope.$watch('elemId',\n            function(newId,oldId){ if(newId && newId.length>=2 && newId !== oldId) { renderElement(vm.type,newId);  }\n          });\n          \n        } else if(vm.type&&vm.elem) {\n            renderTempElement(vm.type,vm.elem);\n        }\n        \n        // =========MAIN function==============\n        \n        function renderElement(type,id) {\n          type = type || content.typeFromId(id).raw;\n          vm.type=type;\n          console.log(\"Element ID: \",id);\n          console.log(\"Element sub: \", id.substring(0,2));\n          \n          //setup type\n          switch (type) {\n            case 'risk_element':\n              if(id.substring(0,2)!==\"RL\") $state.go(\"404_error\");\n              else getRisk_element(id);\n              break;\n            case 'risk_factor':\n              if(id.substring(0,2)!==\"RF\") $state.go(\"404_error\");\n              else getRisk_factor(id);\n              break;\n            case 'risk_evidence':\n              if(id.substring(0,2)!==\"RV\") $state.go(\"404_error\");\n              else getRisk_evidence(id);\n              break;\n            case 'observable':\n              if(id.substring(0,2)!==\"OB\") $state.go(\"404_error\");\n              else getObservable(id);\n              break;\n            case 'citation':\n              if(id.substring(0,2)!==\"CI\") $state.go(\"404_error\");\n              else getCitation(id);\n              break;\n            case 'measurement_type':\n              if(id.substring(0,2)!==\"ME\") $state.go(\"404_error\");\n              else getMeasurement_type(id);\n              break;\n            case 'medical_expert':\n              // code\n              break;\n            \n            default:\n            console.log(\"Type not found :\", type);\n            $state.go(\"404_error\");\n          }\n        }\n        \n        \n        // =========== Fetching functions for each element ==========\n        \n        function renderTempElement(type,data) {\n          var visibleFields=VisibleFields(type,'single',vm.notFields.split(','));\n            vm.current = data;\n            vm.fields = visibleFields.map(function(field) {\n              return {\n                value: field,\n                label: content.labelOf(field)\n              };\n            });\n            vm.rdf_source = rdfSource(vm.current.id);\n          \n        }\n        \n        \n        // =========== Fetching functions for each element ==========\n        \n        function getRisk_element(id) {\n          var visibleFields=VisibleFields('risk_element','single',vm.notFields.split(','));\n          vm.loading=Risk_elements.get([id]).then(function(res) {\n            if (res.data) {\n              vm.current = res.data[0];\n              vm.fields = visibleFields.map(function(field) {\n                return {\n                  value: field,\n                  label: content.labelOf(field)\n                };\n              });\n              vm.rdf_source = rdfSource(vm.current.id);\n          \n            }\n          });\n        }\n        function getRisk_factor(id) {\n          var visibleFields=VisibleFields('risk_factor','single',vm.notFields.split(','));\n          vm.loading=Risk_factors.get([id]).then(function(res) {\n            if (res.data) {\n              vm.current = res.data[0];\n              vm.fields = visibleFields.map(function(field) {\n                return {\n                  value: field,\n                  label: content.labelOf(field)\n                };\n              });\n              vm.rdf_source = rdfSource(vm.current.id);\n          \n            }\n          });\n        }\n        function getRisk_evidence(id) {\n          var visibleFields=VisibleFields('risk_evidence','single',vm.notFields.split(','));\n          vm.loading=Risk_evidences.get([id]).then(function(res) {\n            if (res.data) {\n              vm.current = res.data[0];\n              vm.current.pubmedId = $scope.hidePubmed?false:res.data[0].has_risk_evidence_source_label;\n              vm.fields = visibleFields.map(function(field) {\n                return {\n                  value: field,\n                  label: content.labelOf(field)\n                };\n              });\n              vm.rdf_source = rdfSource(vm.current.id);\n          \n            } else {\n             console.log(\"No risk_evidence with id:\",id); \n            }\n          });\n        }\n        function getCitation(id) {\n          var visibleFields=VisibleFields('citation','single',vm.notFields.split(','));\n          vm.loading=Citations.get([id]).then(function(res) {\n            if (res.data) {\n              vm.current = res.data[0];\n              vm.current.pubmedId = $scope.hidePubmed?false:res.data[0].has_citation_pubmed_identifier_label;\n              vm.fields = visibleFields.map(function(field) {\n                return {\n                  value: field,\n                  label: content.labelOf(field)\n                };\n              });\n              vm.rdf_source = rdfSource(vm.current.id);\n          \n            }\n          });\n        }\n        function getObservable(id) {\n          var visibleFields=VisibleFields('observable','single',vm.notFields.split(','));\n          vm.loading=Observables.get([id]).then(function(res) {\n            if (res.data) {\n              vm.current = res.data[0];\n              vm.fields = visibleFields.map(function(field) {\n                return {\n                  value: field,\n                  label: content.labelOf(field)\n                };\n              });\n              vm.rdf_source = rdfSource(vm.current.id);\n          \n            }\n          });\n        }\n        \n        function getMeasurement_type(id) {\n          var visibleFields=VisibleFields('measurement_type','single',vm.notFields.split(','));\n          vm.loading=Measurement_types.get([id]).then(function(res) {\n            if (res.data) {\n              vm.current = res.data[0];\n              vm.fields = visibleFields.map(function(field) {\n                return {\n                  value: field,\n                  label: content.labelOf(field)\n                };\n              });\n              \n              vm.rdf_source = rdfSource(vm.current.id);\n          \n            }\n          });\n        }\n        \n        function rdfSource(id){\n          // return 'https://devices.duth.carre-project.eu/sparql?query=DESCRIBE%20%3C'+id+'%3E&format=text/plain';\n          return 'https://'+\n            CONFIG.CARRE_API_URL.substring(CONFIG.CARRE_API_URL.indexOf('://')+3,CONFIG.CARRE_API_URL.indexOf('/ws'))+\n            '/sparql?query=DESCRIBE%20%3C'+id+'%3E&format=text/plain';\n        }\n        \n      }\n    };\n  });\n\nangular.module('CarreEntrySystem').service('VisibleFields', function() {\n  \n  var visibleFields={\n    \"risk_element\": {\n      \"single\": [\n              // \"type\",      \n              // \"id\",\n              \"has_risk_element_name\",\n              \"has_risk_element_identifier\",\n              \"has_risk_element_type\",\n              \"has_risk_element_modifiable_status\",\n              \"has_risk_element_observable\",\n              \"has_risk_element_observable_condition\",\n              \"includes_risk_element\",\n              \"has_author\",\n              \"has_reviewer\"\n      ],\n      \"list\": [\n            'has_risk_element_name',\n            'has_risk_element_identifier',\n            'has_risk_element_type',\n            'has_risk_element_modifiable_status',\n            'has_risk_element_observable'\n      ]\n    },\n    \"risk_evidence\": {\n      \"single\": [\n            // \"type\",\n            // \"id\",\n            \"has_risk_factor\",\n            \"has_risk_evidence_observable\",\n            \"has_observable_condition\",\n            \"has_risk_evidence_ratio_type\",\n            \"has_risk_evidence_ratio_value\",\n            \"has_confidence_interval_min\",\n            \"has_confidence_interval_max\",\n            \"is_adjusted_for\",\n            \"has_risk_evidence_source\",\n            \"has_author\",\n            \"has_reviewer\"\n            ],\n      \"list\": [\n        'has_risk_factor',\n        'has_observable_condition_text',\n        // 'has_risk_evidence_source',\n        // 'has_risk_evidence_ratio_type',\n        'has_risk_evidence_ratio_value',\n        // 'has_confidence_interval_min',\n        // 'has_confidence_interval_max'\n        ]\n      },\n    \"risk_factor\": {\n      \"single\": [\n                // \"type\",      \n                // \"id\",\n                \"has_risk_factor_source\",\n                \"has_risk_factor_target\",\n                \"has_risk_factor_association_type\",\n                \"has_author\",\n                \"has_reviewer\"\n              ],\n      \"list\": [\n              'has_risk_factor_source',\n              'has_risk_factor_target',\n              'has_risk_factor_association_type'\n            ]\n    },\n    \"risk_review\": {\n      \"single\": [\n        \"is_for_element\",\n        \"is_assigned_to\",\n        \"has_review_notes\",\n        \"has_review_json\",\n        \"review_date\",\n        \"assign_date\",\n        \"review_status\"\n      ],\n      \"list\": [\n        \"is_for_element\",\n        \"is_assigned_to\",\n        \"has_review_notes\",\n        \"review_status\"\n      ]\n    },\n    \"observable\": {\n      \"single\": [\n        // \"type\",      \n        // \"id\",\n        \"has_observable_name\",\n        \"has_observable_acronym\",\n        \"has_observable_type\",\n        \"has_observable_measurement_type\",\n        \"has_external_type\",\n        \"has_external_predicate\",\n        \"has_author\",\n        \"has_reviewer\"\n      ],\n      \"list\": [\n        'has_observable_name',\n        'has_observable_type',\n        'has_observable_measurement_type'\n      ]\n    },\n    \"citation\": {\n      \"single\": [\n        // \"type\",      \n        // \"id\",\n        \"has_citation_pubmed_identifier\",\n        \"has_citation_summary\",\n        \"has_citation_source_type\",\n        \"has_citation_source_level\",\n        \"has_author\",\n        \"has_reviewer\"\n      ],\n      \"list\": [\n        'has_citation_pubmed_identifier',\n        'has_citation_summary',\n        'has_citation_source_type',\n        'has_citation_source_level'\n      ]\n    },\n    \"measurement_type\": {\n      \"single\": [\n        // \"type\",      \n        // \"id\",\n        \"has_measurement_type_name\",\n        \"has_enumeration_values\",\n        \"has_label\",\n        \"has_datatype\",\n        \"has_external_unit\"\n      ],\n      \"list\": [\n        'has_measurement_type_name',\n        'has_datatype',\n        'has_label',\n        'has_enumeration_values'\n      ]\n    },\n    \"medical_expert\": {\n      \"single\": [],\n      \"list\": []\n    }\n    \n  };\n  \n  return function(type,view,removeFields){\n    if(!type || !visibleFields[type]) return '';\n    view = view || 'list'; //list or single\n    removeFields = (removeFields && removeFields instanceof Array) ? removeFields : [];\n    return visibleFields[type][view].filter(function(field){\n      if(removeFields.indexOf(field)==-1) return true; \n      else return false;\n    });\n  };\n  \n});\nangular.module('CarreEntrySystem').service('Auth', function($http, CONFIG, $cookies,$state,$q,$timeout, Email, $location, $window) {\n\n  // Retrieving a cookie and set initial user object\n  this.cookie = $cookies.get('CARRE_USER') || CONFIG.TEST_TOKEN || '';\n  this.isLoggedIn=function(){\n    var deferred = $q.defer();\n    if(CONFIG.currentUser.role) deferred.resolve(CONFIG.currentUser); \n    else if(CONFIG.currentUser.guest) deferred.reject('Guest users not allowed to do this!'); \n    else this.getUser().then(function(){\n        $timeout(function(){\n          if(CONFIG.currentUser.role) deferred.resolve(CONFIG.currentUser); \n          else if(CONFIG.currentUser.guest) deferred.reject('Guest users not allowed to do this!'); \n        },200);\n      });\n    return deferred.promise;\n  };\n  this.getUser=function(){\n    console.log('User authentication called');\n    var deferred = $q.defer();\n    \n    if(CONFIG.currentUser.role||CONFIG.currentUser.guest) deferred.resolve(CONFIG.currentUser);\n    //validate cookie token with userProfile api function and get username userGraph\n    else if (this.cookie.length > 0) {\n      $http.get(CONFIG.CARRE_API_URL + 'userProfile?token=' + this.cookie,{cache:true,timeout:5000}).then(function(res) {\n        \n        //check if virtuoso is down\n        if (res.data.error) {\n          Email.bug({data:CONFIG.CARRE_DEVICES+'logout?next='+$location.absUrl(),title:\"Invalid Token, Redirect url\"});\n          $window.location.href=CONFIG.CARRE_DEVICES+'logout?next='+$location.absUrl();\n          CONFIG.currentUser = {'guest':true};\n          console.log(res.data.error);\n        } else if (res.data.username.indexOf(\"(\")===0) {\n            Email.bug({data:res.data,title:\"RDF server is down\"});\n            CONFIG.currentUser = {'guest':true};\n        } else if (!res.data.role) {\n            Email.bug({data:res.data,title:\"User is not a doctor\"});\n            console.warn(\"User is not a doctor\",res);\n            CONFIG.currentUser = {'guest':true};\n        } else {\n        \n          CONFIG.currentUser=res.data;\n          //Show different graph on logged in users\n          CONFIG.CARRE_DEFAULT_GRAPH=CONFIG.CARRE_ARCHIVE_GRAPH;\n          console.log('User authentication completed',CONFIG.currentUser);\n          \n        }\n        deferred.resolve(CONFIG.currentUser);\n        // Set the user ID using signed-in user_id.\n        // for GOOGLE Analytics\n        // ga('set', 'userId', CONFIG.currentUser.username);\n        // ga('set', 'dimension3', CONFIG.currentUser.username);\n        \n        \n      }).catch(function(err) {\n        CONFIG.currentUser = {};\n        deferred.reject(err);\n        Email.bug(err);\n        $state.go('500_API_ERROR');\n      });\n    } else {  \n      CONFIG.currentUser={'guest':true};\n      deferred.resolve(CONFIG.currentUser);\n      console.log('User not logged in',CONFIG.currentUser);\n    }\n    \n    return deferred.promise;\n  };\n});\n'use strict';\nangular.module('CarreEntrySystem').service('content', function(CarreTranslate,SweetAlert,$state) {\n\n  this.exports = {\n    'default': getDefaultGridProperties(),\n    'fields': getModelFields,\n    'labelOf':labelFromKey,\n    'typeFromId':getTypeFromId,\n    'goTo':showElement\n  };\n\n  //auto build grid columns from keys of each element\n  function getModelFields(fieldsArray, visibleArray) {\n    // console.log(fieldsArray,visibleArray);\n    var columnDefs = [];\n    \n    //add ordered columns\n    visibleArray.forEach(function(field_name) {\n        columnDefs.push({\n          field: field_name+'_label',\n          displayName: labelFromKey(field_name)\n        });\n    }); \n    \n    //add rest of the fields;\n    fieldsArray.forEach(function(field_name) {\n      if(visibleArray.indexOf(field_name)===-1) {\n        columnDefs.push({\n          field: field_name+'_label',\n          displayName: labelFromKey(field_name),\n          visible:false\n        });\n      }\n    });\n    \n    //enable sorting ASC by the 1st field usually name\n    columnDefs[0].sort={ priority: 0, direction: 'asc' };\n    \n    return columnDefs;\n  }\n\n\n  function getDefaultGridProperties() {\n\n    /* GRID Default properties */\n    return {\n        paginationPageSizes: [10, 50, 100],\n        paginationPageSize: 10,\n        enableColumnResizing: true,\n        enableFiltering: true,\n        allowCellFocus: true,\n        enableGridMenu: true,\n        multiSelect: true,\n        enableRowSelection: true,\n        enableHighlighting: true,\n        // enableFullRowSelection  : true,\n        enableColumnMenus: true,\n        showGridFooter: true,\n        showColumnFooter: true,\n        exporterMenuPdf: false, // ADD THIS\n        exporterCsvFilename: window.location.href.substr(window.location.href.lastIndexOf(\"/\")+1)+'.csv',\n        // fastWatch: true\n    };\n    \n  }\n  \n  //alias for CarreTranslate\n  function labelFromKey(key) {\n    return CarreTranslate(key);\n  }\n  \n  \n  function getTypeFromId(id){\n    if(!id) return '';\n    if(id.indexOf('_')===-1) return '';\n    var str=id.substr(id.lastIndexOf('_')-2,2).toUpperCase();\n    if(str==='OB') return {state:'observables',raw:'risk_element',label:'Risk element'};\n    if(str==='CI') return {state:'citations',raw:'citation',label:'Citation'};\n    if(str==='MD') return {state:'medical_experts',raw:'medical_expert',label:'Medical expert'};\n    if(str==='ME') return {state:'measurement_types',raw:'measurement_type',label:'Measurement types'};\n    if(str==='RL') return {state:'risk_elements',raw:'risk_element',label:'Risk element'};\n    if(str==='RF') return {state:'risk_factors',raw:'risk_factor',label:'Risk factor'};\n    if(str==='RV') return {state:'risk_evidences',raw:'risk_evidence',label:'Risk evidence'};\n    if(str==='RW') return {state:'risk_reviews',raw:'risk_review',label:'Review'};\n    else console.log(str,id);\n  }\n        \n        \n  function showElement(id,label){\n    var type=getTypeFromId(id);\n    //implement a basic confirm popup\n    SweetAlert.swal({\n        title: \"Show the \"+type.label+\"?\",\n        text: \"This will redirect you to the `\"+label+\"` \"+type.label+\"'s detail page.\",\n        type: \"info\",\n        showCancelButton: true,\n        confirmButtonColor: \"#2E8B57\",\n        confirmButtonText: \"Yes, show me!\",\n        closeOnConfirm: true,\n        closeOnCancel: true\n      },\n      function(isConfirm) {\n        if (isConfirm) {\n          $state.go(\"main.\"+type.state+\".view\",{id:id});\n        }\n      });\n  };\n\n\n\n  return this.exports;\n\n});\nangular.module('CarreEntrySystem').service('Tutorial', function($http, CONFIG, toastr,$state) {\n  \n  this.exports = {\n    'startGuest': startGuest,\n    'startUser': startUser,\n    'options': defaultOptions\n  }\n  \n  function startGuest (fn) {\n    var user=CONFIG.currentUser&&CONFIG.currentUser.username?CONFIG.currentUser.username:'guest';\n    fn();\n  }  \n    \n  function startUser (data) {\n    var user=CONFIG.currentUser?CONFIG.currentUser.username:'guest';\n    $http.post(CONFIG.CARRE_CACHE_URL+'sendemail',{\n      action: 'report_bug',\n      user:user,\n      reqdata:JSON.stringify(data)\n    });\n  }  \n  \n    \n    \n    \n    \n  function defaultOptions(){\n    return {\n        steps:[\n          {\n              element: '#intro-risk-model',\n              intro: \"Here you can see the CARRE risk model overview\",      \n              position: 'right'\n          }\n          ,{\n              element: '#intro-stats',\n              intro: \"This chart represents all the current CARRE elements in the database\",\n              position: 'left'\n          }  ,{\n              element: '#intro-box-risk-factors',\n              intro: \"This box is a counter for all the CARRE risk factors\",\n              position: 'top'\n          },{\n              element: '#intro-box-risk-evidences',\n              intro: \"This box is a counter for all the CARRE risk evidences\",\n              position: 'top'\n          }\n          // ,{\n          //     element: '#intro-menu',\n          //     intro: \"This is the menu......\",\n          //     position: 'right'\n          // }\n          // ,{\n          //     element: '#intro-login',\n          //     intro: \"Login to start editing the data\",\n          //     position: 'bottom'\n          // }\n          ],        \n            showStepNumbers: false,\n                showBullets: false,\n                exitOnOverlayClick: true,\n                exitOnEsc:true,\n                nextLabel: '<strong>Next</strong>',\n                prevLabel: '<strong>Previous</strong>',\n                skipLabel: 'Exit',\n                doneLabel: 'OK that\\'s enough!'\n        };\n\n  }\n  \n  \n  \n  \n  return this.exports;\n});\nangular.module('CarreEntrySystem').filter('translateMapping', function(CarreTranslate) {\n  return function(input) {\n    return CarreTranslate(input);\n  };\n}).service('CarreTranslate',[\"CONFIG\", function(CONFIG) {\n  \n  var translations=window.CARRE_TRANSLATIONS;\n  \n  return function(str,showOnlyIfExists){\n    // console.log((showOnlyIfExists?\"--Not-Available-Translation--\":str));\n    if(translations[CONFIG.LANG].hasOwnProperty(str)) return translations[CONFIG.LANG][str];\n    else return (showOnlyIfExists?\"--Not-Available-Translation--\":str);\n  };\n  \n}])\n  .filter('translate',function(Translate){\n    return function(input){\n      return Translate(input);\n    }\n  });\nangular.module('CarreEntrySystem').service('RdfFormatter', function(CONFIG, CarreTranslate, Email) {\n\n  this.exports = {\n    'groupByProp': groupByProp,\n    'mappings': replaceMappings,\n    'translate':translate\n  };\n\n  /* =====================Simple groupby prop============================================ */\n\n  /*\n  You can configure triplet variable names and group by index of property.\n  e.g groupByProp(data,[\"citation\",\"relation\",\"value\"],0).data groups by citation\n  */\n  function groupByProp(data, triplesFormat, propIndex, valueProp) {\n    triplesFormat = triplesFormat || ['subject', 'predicate', 'object'];\n    var settingsObj = {\n      triplesFormat: triplesFormat,\n      groupProp: triplesFormat[(propIndex || 0)],\n      valueProp: valueProp,\n      keys: [],\n      fields: [],\n      mappings: {},\n      data: []\n    };                  \n                      //reducer           //initial object acts as prev in the reducer\n    return data.reduce(tripleAccumulator, settingsObj);\n  }   \n                            //accumulatedObj , current\n  function tripleAccumulator(settings, obj) {\n    \n    \n    \n    var type,id, rel, val, val_label;\n    \n    id = obj[settings.groupProp][settings.valueProp];\n    rel = makeLabel(obj[settings.triplesFormat[1]][settings.valueProp]);\n    type = obj[settings.triplesFormat[2]].type;\n    val = obj[settings.triplesFormat[2]][settings.valueProp];\n\n    /*  Filter educational objects  */\n    if (rel === 'has_educational_material') return settings;\n    \n    //replace greater than and lower than symbols\n    if (rel === 'has_observable_condition_text') val = val.replace(new RegExp(\">=\", 'g'), '').replace(new RegExp(\"<=\", 'g'), ''); \n    \n    /*  Filter BUG-Virtuoso  */\n    // if (rel === 'has_risk_evidence_ratio_value' && val===\"NAN\") {\n    //   console.log(\"BUG-Virtuoso: \",id+': ',val);\n    //   Email.bug({\n    //     \"title\": \"Risk evidence ratio value \"+(settings.data.length>1?\"List view\":\"Single view\"),\n    //     \"element\": id,\n    //     \"predicate\": \"has_risk_evidence_ratio_value\",\n    //     \"value\": val\n    //   });\n    // }\n    \n    /*  Filter other languages  */\n    if(obj[settings.triplesFormat[2]].hasOwnProperty('xml:lang') && obj[settings.triplesFormat[2]]['xml:lang']!==CONFIG.LANG){\n      return settings;\n    }\n    \n    //make labels only for literals (not for nodes or relations)\n    if(type===\"typed-literal\"){ val_label=val; } else { val_label=makeLabel(val);}\n\n    // console.log(type,id,rel,val_label);\n    \n    //get extra mappings\n    if (['CI','OB', 'RF', 'RL', 'RV','ME'].indexOf(val_label.substr(0, 2)) > -1 && val_label.indexOf(\"observable_condition\")===-1) {\n      settings.mappings[val_label] = settings.mappings[val_label] || {};\n      for (var prop in obj) {\n        //except the 3 basic properties\n        if (prop !== 'subject' && prop !== 'predicate' && prop !== 'object' && obj[prop].value.length > 0) {\n          settings.mappings[val_label][prop] = obj[prop].value;\n        }\n      }\n    }\n    \n    // dont make labels for external annotations\n    if(rel === 'has_external_type' || rel === 'has_external_unit'|| rel === 'has_external_predicate') {\n      val_label = makeLabel(val);\n    }\n\n\n    if (settings.fields.indexOf(rel) === -1) settings.fields.push(rel);\n    var index = settings.keys.indexOf(id);\n    if (index === -1) {\n      //then push into the arrays\n      settings.keys.push(id);\n      settings.data.push({\n        \"id\": id,\n        \"id_label\": makeLabel(id)\n      });\n      //change index to the last item added\n      index = settings.keys.length - 1;\n    }\n    settings.data[index][rel] = settings.data[index][rel] || [];\n    settings.data[index][rel].push(val);\n    \n    //add label for each value\n    // val = (val.indexOf('#') >= 0 ? val.split('#')[1] : val);\n    settings.data[index][rel + '_label'] = settings.data[index][rel + '_label'] || '';\n    settings.data[index][rel + '_label'] += (settings.data[index][rel + '_label'].length > 0 ? ',' : '') + val_label;\n    settings.data[index][rel + '_label_arr'] = settings.data[index][rel + '_label_arr'] || [];\n    settings.data[index][rel + '_label_arr'].push(val_label);\n\n    return settings;\n  }\n\n\n  /*========================== HELPERS  ==================================================*/\n  function replaceMappings(settings) {\n    settings.data=settings.data.map(function(obj) {\n      var cat = '';\n      for (var prop in obj) {\n        if ( prop.indexOf('_label_arr') > 0 && prop.indexOf('has_observable_condition')===-1) {\n          //select only props : has_....._label\n          obj[prop]=obj[prop].map(function(term) {\n            if (settings.mappings.hasOwnProperty(term)) {\n              cat = term.substr(0, 2);\n              switch (cat) {\n                case 'CI':\n                  // make label for observables\n                  return settings.mappings[term].has_citation_pubmed_identifier;\n                case 'OB':\n                  // make label for observables\n                  return settings.mappings[term].has_observable_name;\n                case 'ME':\n                  // make label for measurent types\n                  return settings.mappings[term].has_measurement_type_name;\n                case 'RF':\n                  // make label for risk factor    \n                  return settings.mappings[term].has_source_risk_element_name +\n                    ' ['+ translate(settings.mappings[term].has_risk_factor_association_type) + '] ' +\n                    settings.mappings[term].has_target_risk_element_name;\n                case 'RL':\n                  // make label for risk element\n                  return settings.mappings[term].has_risk_element_name;\n                case 'RV':\n                  // make label for risk evidence\n                  return term;\n\n                default:\n                  return term;\n              }\n            } else return translate(term);\n            \n          });\n          obj[prop.split('_arr')[0]]=obj[prop].join(', ');\n          \n        }\n      }\n      return obj;\n    });\n    return settings;\n  }\n\n  function translate(str){\n    if(!str) return '';\n    if(str.indexOf('#') >= 0) return CarreTranslate(str.split('#')[1]);\n    else return CarreTranslate(str);\n  };\n  function makeLabel(str) {\n    if(str.indexOf('#') >= 0) {\n      str=str.split('#')[1];\n      return str;\n    } else if(str.indexOf('http') >= 0) {\n      return str.substring(str.lastIndexOf('/') + 1);\n    } else return str;\n  }\n\n  return this.exports;\n});\nangular.module('CarreEntrySystem').service('QUERY', function(CONFIG) {\n\n  this.exports = {\n    'insert': buildInsertQuery,\n    'update': buildUpdateQuery,\n    'prefix': getPrefix\n  };\n\n  /* The prefixes for CARRE*/\n  var PREFIXES = {\n    'xsd': 'http://www.w3.org/2001/XMLSchema#',\n    'rdf': 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\n    'carreUsers': 'https://carre.kmi.open.ac.uk/users/',\n    'risk': 'http://carre.kmi.open.ac.uk/ontology/risk.owl#',\n    'ME': 'http://carre.kmi.open.ac.uk/measurement_types/',\n    'OB': 'http://carre.kmi.open.ac.uk/observables/',\n    'RL': 'http://carre.kmi.open.ac.uk/risk_elements/',\n    'RV': 'http://carre.kmi.open.ac.uk/risk_evidences/',\n    'RF': 'http://carre.kmi.open.ac.uk/risk_factors/',\n    'MD': 'http://carre.kmi.open.ac.uk/medical_experts/',\n    'CI': 'http://carre.kmi.open.ac.uk/citations/',\n    'RW': 'http://carre.kmi.open.ac.uk/reviews/'\n  };\n  var PREFIXSTR = '';\n  var PREFIXARR = [];\n  \n  function getPrefix(id){\n    if(id.indexOf(\"http\")>=0) return id;\n    var type = id.split('_')[0];\n    return PREFIXES.hasOwnProperty(type)?PREFIXES[type]+id:id;\n  }\n  \n  \n  function addPrefix(prefix) {\n    if (prefix) {\n      if (PREFIXES.hasOwnProperty(prefix)&&PREFIXARR.indexOf(prefix)===-1) {\n        PREFIXARR.push(prefix);\n        PREFIXSTR += 'PREFIX ' + prefix + ': <' + PREFIXES[prefix] + '> \\n';\n      }\n    }\n    else {\n      //add all prefixes\n      for (var prop in PREFIXES) {\n        PREFIXARR.push(prop);\n        PREFIXSTR += 'PREFIX ' + prop + ': <' + PREFIXES[prop] + '> \\n';\n      }\n    }\n  }\n\n  function keepDiffProps(oldObj,newObj) {\n    var obj={};\n    for (var prop in newObj) {\n      //iterate new object properties\n      if( newObj[prop].value instanceof Array ) {\n        //if array\n        console.log(\"Array DEBUG: \",prop,newObj[prop].value,oldObj[prop]);\n        if(!(oldObj[prop] instanceof Array)) obj[prop]=newObj[prop];\n        else if((newObj[prop].value.length!==oldObj[prop].length)) obj[prop]=newObj[prop];\n        else {\n          for (var i=0,arr=newObj[prop].value;i<arr.length;i++){\n            if(oldObj[prop].indexOf(arr[i])===-1) {\n            console.log(oldObj[prop],newObj[prop]);\n              obj[prop]=newObj[prop];\n              break;\n            }\n          }\n        }\n      } else if(!oldObj[prop]||oldObj[prop][0]!=newObj[prop].value) obj[prop]=newObj[prop];\n    }\n    return obj;\n  }\n  \n  function parse(node){\n    if(node instanceof Object) {\n      //it should be an object\n      if(node.type!==\"node\"){\n        if(node.type===\"lang\") {\n          console.log(\"NODE is \",node);\n          return \"\\\"\" + node.value + \"\\\"@\" + CONFIG.LANG.trim();\n        } else return \"\\\"\" + node.value + \"\\\"^^\" + fillPrefix('xsd:' + node.type);\n      } else {\n          if (node.value.indexOf('http://') === 0 || node.value.indexOf('https://') === 0) return '<' + node.value + '>';  //if it is node without prefix\n          else return fillPrefix(node.value); //if it is node or relation with prefix\n      }\n    } else {\n      if (node.indexOf('http://') === 0 || node.indexOf('https://') === 0) return '<' + node + '>';  //if it is node without prefix\n      else return fillPrefix(node); //if it is node or relation with prefix\n    }\n  }\n  \n  function fillPrefix(test, prefixes) {\n    if(test.indexOf(\":\")===-1) test = \"risk:\"+test;\n    var val = test.split(':');\n    if(CONFIG.OPTIONS.usePrefix) {\n      addPrefix(val[0]);\n      return test;\n    } \n    prefixes = prefixes || PREFIXES;\n    if (prefixes.hasOwnProperty(val[0])) return '<' + prefixes[val[0]] + val[1] + '>';\n    else return '<node_' + Math.round(Math.random() * 100000000) + '>';\n  }\n\n  /* Update query */\n  function buildUpdateQuery (old,obj,id,graph) {\n    PREFIXARR=[];\n    PREFIXSTR=[];\n    graph = graph || CONFIG.CARRE_DEFAULT_GRAPH;\n    obj = keepDiffProps(old,obj);\n    id = id||parse(old.id);\n    var deleteTriples = \"\";\n    var insertTriples = \"\";\n    var objEmpty = true;\n    for (var prop in obj) {\n      objEmpty = false;\n      var pre=obj[prop].pre;\n      deleteTriples+= id +\" \"+ parse(pre+\":\"+prop) +\" ?\"+prop+\"_var . \\n\";\n      if(obj[prop].value instanceof Array){\n        // array e.g observables\n        obj[prop].value.forEach(function(elem){\n          insertTriples+= id +\" \"+ parse(pre+\":\"+prop) +\" \"+parse(elem)+\" . \\n\" ;\n        });\n      } else {\n        insertTriples+= id +\" \"+ parse(pre+\":\"+prop) +\" \"+parse(obj[prop])+\" . \\n\" ;\n      }\n    }\n    if(objEmpty) return \"\";\n    var deleteQuery = \"WITH \" + graph + \" DELETE { \\n\" + deleteTriples + \" } \\n WHERE { \\n\"+ deleteTriples + \" } \\n\";\n    var insertQuery = \"INSERT DATA { GRAPH \" + graph + \" { \\n\" + insertTriples + \" }} \\n\";\n    \n    return (CONFIG.OPTIONS.usePrefix?PREFIXSTR:\"\")+deleteQuery + insertQuery;\n  }\n\n  /* Insert query */\n  function buildInsertQuery (obj,type,idlabel,usergraph,graph) {\n    PREFIXARR=[];\n    PREFIXSTR=[];\n    graph = graph || CONFIG.CARRE_DEFAULT_GRAPH;\n    usergraph = usergraph || CONFIG.currentUser.graphName;\n    var insertTriples = \"\";\n    var objEmpty = true;\n    for (var prop in obj) {\n      objEmpty = false;\n      var pre=obj[prop].pre;\n      if(obj[prop].value instanceof Array){\n        // array e.g observables\n        obj[prop].value.forEach(function(elem){\n          insertTriples+= \"?newid \"+ parse(pre+\":\"+prop) +\" \"+parse(elem)+\" . \\n\";\n        });\n      } else {\n        //non array\n        insertTriples+= \"?newid \"+ parse(pre+\":\"+prop) +\" \"+parse(obj[prop])+\" . \\n\";\n      }\n    }\n    if(objEmpty) return \"\";\n    //add author and type\n    insertTriples+= \"?newid \"+parse(\"risk:has_author\")+ \" \" + parse(usergraph) + \"; a \"+parse(\"risk:\"+type)+\" .  \\n\";\n    var insertQuery = \"INSERT { GRAPH \" + graph + \" { \\n\" + insertTriples + \" }} WHERE \\n\\\n          { GRAPH \" + graph + \" \\n\\\n          { { \\n\\\n              SELECT ?oldindex FROM \" + graph + \" \\n\\\n              WHERE { \\n\\\n               ?elem a \"+parse(\"risk:\"+type)+\" . \\n\\\n                BIND (xsd:integer(strafter(STR(?elem),\\\"\"+idlabel+\"_\\\")) AS ?oldindex) \\n\\\n              } ORDER BY DESC(?oldindex) LIMIT 1 \\n\\\n            } \\n\\\n            BIND (IRI(CONCAT(\"+parse(idlabel+\":\")+\", \\\"\"+idlabel+\"_\\\", ?oldindex+1)) AS ?newid) \\n\\\n          } }\";\n    \n    return (CONFIG.OPTIONS.usePrefix?PREFIXSTR:\"\")+insertQuery;\n  }\n      \n\n  return this.exports;\n});\nangular.module('CarreEntrySystem').service('Pubmed', function($http,CONFIG) {\n  var apiEfetch=CONFIG.PUBMED_API_URL;\n  var apiSearch=CONFIG.EUROPEPMC_API_URL;\n  \n  var efetch=function(id){\n    return $http.get(apiEfetch+'efetch.fcgi?db=pubmed&retmode=text&rettype=abstract&id='+id,{ignoreLoadingBar: false,cache:true}).then(function(res){\n            console.info(res);\n            return res;\n    },function(err){console.error(err)});\n  };\n  \n  //search Pubmed Central through EuropePMC\n  var esearch=function(query){\n    return $http.jsonp(apiSearch+'search?resulttype=lite&format=json&callback=JSON_CALLBACK&query='+query,{ignoreLoadingBar: false,cache:true}).then(function(res){\n      return { \n        count : res.data.hitCount,\n        result : res.data.resultList.result\n      };\n    },function(err){console.error(err)});\n  };\n  \n  return {\n    'fetch':efetch,\n    'search':esearch\n  };\n  \n});\nangular.module('CarreEntrySystem').service('Email', function($http, CONFIG, toastr) {\n  \n  this.exports = {\n    'example': recommendExample,\n    'bug': reportBug,\n    'send': sendEmail\n  }\n  \n  function recommendExample (data) {\n    var user=CONFIG.currentUser?CONFIG.currentUser.username:'guest';\n    $http.post(CONFIG.CARRE_CACHE_URL+'sendemail',{\n      action: 'recommend_examples',\n      user:user,\n      reqdata:JSON.stringify(data)\n    }).then(function(data){\n      toastr.success('<b>Example sent!</b>', '<h4>Thank you!</h4>');\n    },function(err){\n      toastr.error('<b>Example not sent</b>' + err, '<h4>Example error</h4>');\n    });\n  }  \n    \n  function reportBug (data) {\n    var user=CONFIG.currentUser?CONFIG.currentUser.username:'guest';\n    $http.post(CONFIG.CARRE_CACHE_URL+'sendemail',{\n      action: 'report_bug',\n      user:user,\n      reqdata:JSON.stringify(data)\n    });\n  }  \n    \n  function sendEmail (data,action){\n    var user=CONFIG.currentUser?CONFIG.currentUser.username:'guest';\n    $http.post(CONFIG.CARRE_CACHE_URL+'sendemail',{\n      action: action, //'recommend_examples',\n      user:user,\n      reqdata:JSON.stringify(data)\n    }).then(function(data){\n      toastr.success('<b>Message sent!</b>', '<h4>Thank you!</h4>');\n    },function(err){\n      toastr.error('<b>Message not sent</b>' + err, '<h4>Message error</h4>');\n    });\n  }\n  \n  \n  \n  \n  \n  return this.exports;\n});\nd3.sankey = function() {\n  var sankey = {},\n      nodeWidth = 24,\n      nodePadding = 8,\n      size = [1, 1],\n      nodes = [],\n      links = [];\n\n  sankey.nodeWidth = function(_) {\n    if (!arguments.length) return nodeWidth;\n    nodeWidth = +_;\n    return sankey;\n  };\n\n  sankey.nodePadding = function(_) {\n    if (!arguments.length) return nodePadding;\n    nodePadding = +_;\n    return sankey;\n  };\n\n  sankey.nodes = function(_) {\n    if (!arguments.length) return nodes;\n    nodes = _;\n    return sankey;\n  };\n\n  sankey.links = function(_) {\n    if (!arguments.length) return links;\n    links = _;\n    return sankey;\n  };\n\n  sankey.size = function(_) {\n    if (!arguments.length) return size;\n    size = _;\n    return sankey;\n  };\n\n  sankey.layout = function(iterations) {\n    computeNodeLinks();\n    computeNodeValues();\n    computeNodeBreadths();\n    computeNodeDepths(iterations);\n    computeLinkDepths();\n    return sankey;\n  };\n\n  sankey.relayout = function() {\n    computeLinkDepths();\n    return sankey;\n  };\n\n  sankey.link = function() {\n    var curvature = .5;\n\n    function link(d) {\n      var x0 = d.source.x + d.source.dx,\n          x1 = d.target.x,\n          xi = d3.interpolateNumber(x0, x1),\n          x2 = xi(curvature),\n          x3 = xi(1 - curvature),\n          y0 = d.source.y + d.sy + d.dy / 2,\n          y1 = d.target.y + d.ty + d.dy / 2;\n      return \"M\" + x0 + \",\" + y0\n           + \"C\" + x2 + \",\" + y0\n           + \" \" + x3 + \",\" + y1\n           + \" \" + x1 + \",\" + y1;\n    }\n\n    link.curvature = function(_) {\n      if (!arguments.length) return curvature;\n      curvature = +_;\n      return link;\n    };\n\n    return link;\n  };\n\n  // Populate the sourceLinks and targetLinks for each node.\n  // Also, if the source and target are not objects, assume they are indices.\n  function computeNodeLinks() {\n    nodes.forEach(function(node) {\n      node.sourceLinks = [];\n      node.targetLinks = [];\n    });\n    links.forEach(function(link) {\n      var source = link.source,\n          target = link.target;\n      if (typeof source === \"number\") source = link.source = nodes[link.source];\n      if (typeof target === \"number\") target = link.target = nodes[link.target];\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n  }\n\n  // Compute the value (size) of each node by summing the associated links.\n  function computeNodeValues() {\n    nodes.forEach(function(node) {\n      node.value = Math.max(\n        d3.sum(node.sourceLinks, value),\n        d3.sum(node.targetLinks, value)\n      );\n    });\n  }\n\n  // Iteratively assign the breadth (x-position) for each node.\n  // Nodes are assigned the maximum breadth of incoming neighbors plus one;\n  // nodes with no incoming links are assigned breadth zero, while\n  // nodes with no outgoing links are assigned the maximum breadth.\n  function computeNodeBreadths() {\n    var remainingNodes = nodes,\n        nextNodes,\n        x = 0;\n\n    while (remainingNodes.length) {\n      nextNodes = [];\n      remainingNodes.forEach(function(node) {\n        node.x = x;\n        node.dx = nodeWidth;\n        node.sourceLinks.forEach(function(link) {\n          nextNodes.push(link.target);\n        });\n      });\n      remainingNodes = nextNodes;\n      ++x;\n    }\n\n    //\n    moveSinksRight(x);\n    var width = window.innerWidth || document.width;\n    scaleNodeBreadths((width - nodeWidth) / (x - 1));\n  }\n\n  function moveSourcesRight() {\n    nodes.forEach(function(node) {\n      if (!node.targetLinks.length) {\n        node.x = d3.min(node.sourceLinks, function(d) { return d.target.x; }) - 1;\n      }\n    });\n  }\n\n  function moveSinksRight(x) {\n    nodes.forEach(function(node) {\n      if (!node.sourceLinks.length) {\n        node.x = x - 1;\n      }\n    });\n  }\n\n  function scaleNodeBreadths(kx) {\n    nodes.forEach(function(node) {\n      node.x *= kx;\n    });\n  }\n\n  function computeNodeDepths(iterations) {\n    var nodesByBreadth = d3.nest()\n        .key(function(d) { return d.x; })\n        .sortKeys(d3.ascending)\n        .entries(nodes)\n        .map(function(d) { return d.values; });\n\n    //\n    initializeNodeDepth();\n    resolveCollisions();\n    for (var alpha = 1; iterations > 0; --iterations) {\n      relaxRightToLeft(alpha *= .99);\n      resolveCollisions();\n      relaxLeftToRight(alpha);\n      resolveCollisions();\n    }\n\n    function initializeNodeDepth() {\n      var ky = d3.min(nodesByBreadth, function(nodes) {\n        return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);\n      });\n\n      nodesByBreadth.forEach(function(nodes) {\n        nodes.forEach(function(node, i) {\n          node.y = i;\n          node.dy = node.value * ky;\n        });\n      });\n\n      links.forEach(function(link) {\n        link.dy = link.value * ky;\n      });\n    }\n\n    function relaxLeftToRight(alpha) {\n      nodesByBreadth.forEach(function(nodes, breadth) {\n        nodes.forEach(function(node) {\n          if (node.targetLinks.length) {\n            var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);\n            node.y += (y - center(node)) * alpha;\n          }\n        });\n      });\n\n      function weightedSource(link) {\n        return center(link.source) * link.value;\n      }\n    }\n\n    function relaxRightToLeft(alpha) {\n      nodesByBreadth.slice().reverse().forEach(function(nodes) {\n        nodes.forEach(function(node) {\n          if (node.sourceLinks.length) {\n            var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);\n            node.y += (y - center(node)) * alpha;\n          }\n        });\n      });\n\n      function weightedTarget(link) {\n        return center(link.target) * link.value;\n      }\n    }\n\n    function resolveCollisions() {\n      nodesByBreadth.forEach(function(nodes) {\n        var node,\n            dy,\n            y0 = 0,\n            n = nodes.length,\n            i;\n\n        // Push any overlapping nodes down.\n        nodes.sort(ascendingDepth);\n        for (i = 0; i < n; ++i) {\n          node = nodes[i];\n          dy = y0 - node.y;\n          if (dy > 0) node.y += dy;\n          y0 = node.y + node.dy + nodePadding;\n        }\n\n        // If the bottommost node goes outside the bounds, push it back up.\n        dy = y0 - nodePadding - size[1];\n        if (dy > 0) {\n          y0 = node.y -= dy;\n\n          // Push any overlapping nodes back up.\n          for (i = n - 2; i >= 0; --i) {\n            node = nodes[i];\n            dy = node.y + node.dy + nodePadding - y0;\n            if (dy > 0) node.y -= dy;\n            y0 = node.y;\n          }\n        }\n      });\n    }\n\n    function ascendingDepth(a, b) {\n      return a.y - b.y;\n    }\n  }\n\n  function computeLinkDepths() {\n    nodes.forEach(function(node) {\n      node.sourceLinks.sort(ascendingTargetDepth);\n      node.targetLinks.sort(ascendingSourceDepth);\n    });\n    nodes.forEach(function(node) {\n      var sy = 0, ty = 0;\n      node.sourceLinks.forEach(function(link) {\n        link.sy = sy;\n        sy += link.dy;\n      });\n      node.targetLinks.forEach(function(link) {\n        link.ty = ty;\n        ty += link.dy;\n      });\n    });\n\n    function ascendingSourceDepth(a, b) {\n      return a.source.y - b.source.y;\n    }\n\n    function ascendingTargetDepth(a, b) {\n      return a.target.y - b.target.y;\n    }\n  }\n\n  function center(node) {\n    return node.y + node.dy / 2;\n  }\n\n  function value(link) {\n    return link.value;\n  }\n\n  return sankey;\n};\nangular.module('CarreEntrySystem').service('CARRE', function($http, CONFIG, Auth, RdfFormatter,$q,toastr,$state,$cacheFactory, QUERY, Email,$rootScope) {\n\n  this.exports = {\n    // 'count': countInstance,\n    'countAll': countAllInstances,\n    'query': apiQuery,\n    'cacheQuery': cacheQuery,\n    'invalidateCache': invalidateCache,\n    'selectQuery': selectQuery,\n    'instances': queryInstances,\n    'search': searchInstances,\n    'delete': deleteInstance\n  };\n  \n\n  /*\n    PREFIX carreManufacturer: <http://carre.kmi.open.ac.uk/manufacturers/> \\n\\\n    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> \\n\\\n    PREFIX sensors: <http://carre.kmi.open.ac.uk/ontology/sensors.owl#> \\n\\\n  */\n  /* The prefixes for CARRE*/\n  var PREFIXSTR = \"PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> \\n\\\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \\n\\\nPREFIX carreUsers: <https://carre.kmi.open.ac.uk/users/> \\n\\\nPREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \\n\\\nPREFIX ME: <http://carre.kmi.open.ac.uk/measurement_types/> \\n\\\nPREFIX OB: <http://carre.kmi.open.ac.uk/observables/> \\n\\\nPREFIX RL: <http://carre.kmi.open.ac.uk/risk_elements/> \\n\\\nPREFIX RV: <http://carre.kmi.open.ac.uk/risk_evidences/> \\n\\\nPREFIX RF: <http://carre.kmi.open.ac.uk/risk_factors/> \\n\\\nPREFIX RW: <http://carre.kmi.open.ac.uk/risk_reviews/> \\n\\\nPREFIX MD: <http://carre.kmi.open.ac.uk/medical_experts/> \\n\\\nPREFIX CI: <http://carre.kmi.open.ac.uk/citations/> \\n\";\n\n\n  function deleteInstance(id){\n    console.log(QUERY.prefix(id));\n    var query = \"WITH \" + CONFIG.CARRE_ARCHIVE_GRAPH + \" DELETE { <\"+QUERY.prefix(id)+\"> ?s ?p .  }  WHERE { <\"+QUERY.prefix(id)+\"> ?s ?p .}\";\n    return apiQuery(query);\n  /*               \n      OPTIONAL {    \\n\\\n                 ?object risk:includes_risk_element ?includes_risk_element. \\n\\\n                 ?includes_risk_element risk:has_risk_element_name ?includes_risk_element_name. \\n\\\n                } \\n\\\n                */\n                \n                /*\n                Another delete query\n                \n                \n                PREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#>\nPREFIX OB: <http://carre.kmi.open.ac.uk/observables/>\n#select ?ob ?predicate FROM <http://carre.kmi.open.ac.uk/riskdata> WHERE { ?ob a risk:observable; risk:has_external_predicate ?predicate. FILTER (?ob=OB:OB_5 || ?ob=OB:OB_6) }\n\nWITH <http://carre.kmi.open.ac.uk/public> DELETE { OB:OB_5 risk:has_external_predicate ?p .  }  WHERE { OB:OB_5 risk:has_external_predicate ?p .}\n\n                */\n  }\n  \n  \n  \n\n  function searchInstances(type, term) {\n    if(!type||!term) {\n      throw \"CARRE Error: Cannot search without type and term!\";\n    } \n    var listQuery = \"SELECT * FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" WHERE { \\n\\\n             ?subject a risk:\" + type + \"; ?predicate ?object. \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:citation. \\n\\\n               ?object risk:has_citation_pubmed_identifier ?has_citation_pubmed_identifier  \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:observable. \\n\\\n               ?object risk:has_observable_name ?has_observable_name  \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:risk_element. \\n\\\n               ?object risk:has_risk_element_name ?has_risk_element_name  \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:measurement_type. \\n\\\n               ?object risk:has_measurement_type_name ?has_measurement_type_name  \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:risk_factor.  \\n\\\n               ?object risk:has_risk_factor_association_type ?has_risk_factor_association_type. \\n\\\n               ?object risk:has_risk_factor_source ?has_risk_factor_source. \\n\\\n               ?object risk:has_risk_factor_target ?has_risk_factor_target. \\n\\\n               ?has_risk_factor_source risk:has_risk_element_name ?has_source_risk_element_name.  \\n\\\n               ?has_risk_factor_target risk:has_risk_element_name ?has_target_risk_element_name.  \\n\\\n              } \\n\";\n\n\n    //add filter to query if a single observable is requested\n    listQuery += \"FILTER (lcase(str(?object)) = \\\"\"+term+\"\\\") }\";\n\n    return selectQuery(listQuery);\n\n  }\n  \n  function langFilter(variable_predicate){\n    var lang = CONFIG.LANG;\n    return \"FILTER(lang(\"+variable_predicate+\")='\"+lang+\"') \";\n  }\n  /*\n      OPTIONAL {    \\n\\\n    #Language filter \\n\\\n     VALUES ?predicate {\"+CONFIG.LANGPredicates.join(\" \")+\" }. \\n\\\n     \"+langFilter('?predicate')+\" \\\n    } \\n\\\n  */\n  \n  function queryInstances(type, ArrayOfIDs) {\n\n    var listQuery = \"SELECT * FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" WHERE { \\n\\\n             ?subject a risk:\" + type + \"; ?predicate ?object. \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:citation. \\n\\\n               ?object risk:has_citation_pubmed_identifier ?has_citation_pubmed_identifier  \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:observable. \\n\\\n               ?object risk:has_observable_name ?has_observable_name  \\n\\\n              \"+langFilter('?has_observable_name')+\" \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:risk_element. \\n\\\n               ?object risk:has_risk_element_name ?has_risk_element_name  \\n\\\n              \"+langFilter('?has_risk_element_name')+\" \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:measurement_type. \\n\\\n               ?object risk:has_measurement_type_name ?has_measurement_type_name  \\n\\\n              \"+langFilter('?has_measurement_type_name')+\" \\n\\\n              } \\n\\\n              OPTIONAL {    \\n\\\n               ?object a risk:risk_factor.  \\n\\\n               ?object risk:has_risk_factor_association_type ?has_risk_factor_association_type. \\n\\\n               ?object risk:has_risk_factor_source ?has_risk_factor_source. \\n\\\n               ?object risk:has_risk_factor_target ?has_risk_factor_target. \\n\\\n               ?has_risk_factor_source risk:has_risk_element_name ?has_source_risk_element_name.  \\n\\\n               ?has_risk_factor_target risk:has_risk_element_name ?has_target_risk_element_name.  \\n\\\n              \"+langFilter('?has_source_risk_element_name')+\" \\n\\\n              \"+langFilter('?has_target_risk_element_name')+\" \\n\\\n              } \\n\";\n\n\n\n    //add filter to query if a single observable is requested\n    if (ArrayOfIDs) {\n      listQuery += \"FILTER ( \" + ArrayOfIDs.map(function(id) {\n        return \"?subject=\" + id.split('_')[0] + \":\" + id;\n      }).join(\"||\") + \"  )\\n }\";\n      \n      return selectQuery(listQuery);\n    }\n    else {\n      listQuery += \"}\";\n      \n      return selectQuery(listQuery,null,(CONFIG.USECACHE?type+'_all':null));\n    }\n   \n\n  }\n\n  \n  /* Dashboard count instances methods */\n  function countAllInstances() {\n    var query = \"SELECT \\n\\\n    (COUNT(?rf) as ?risk_factors) \\n\\\n    (COUNT(?rf_r) as ?risk_factors_unreviewed) \\n\\\n    (COUNT(?rl) as ?risk_elements) \\n\\\n    (COUNT(?rl_r) as ?risk_elements_unreviewed) \\n\\\n    (COUNT(?ob) as ?observables) \\n\\\n    (COUNT(?ob_r) as ?observables_unreviewed) \\n\\\n    (COUNT(?rv) as ?risk_evidences) \\n\\\n    (COUNT(?rv_r) as ?risk_evidences_unreviewed) \\n\\\n    (COUNT(?ci) as ?citations) \\n\\\n    (COUNT(?me) as ?measurement_types)  \\n\\\n    FROM \" + CONFIG.CARRE_DEFAULT_GRAPH + \" WHERE { \\n\\\n    {?rf a risk:risk_factor} \\n\\\n    UNION { ?rf_r a risk:risk_factor FILTER NOT EXISTS {?rf_r risk:has_reviewer ?anything} } \\n\\\n    UNION {?rl a risk:risk_element} \\n\\\n    UNION { ?rl_r a risk:risk_element FILTER NOT EXISTS {?rl_r risk:has_reviewer ?anything} } \\n\\\n    UNION {?ob a risk:observable} UNION { ?ob_r a risk:observable FILTER NOT EXISTS {?ob_r risk:has_reviewer ?anything} } \\n\\\n    UNION {?rv a risk:risk_evidence} UNION { ?rv_r a risk:risk_evidence FILTER NOT EXISTS {?rv_r risk:has_reviewer ?anything} } \\n\\\n    UNION {?ci a risk:citation} \\n\\\n    UNION {?me a risk:measurement_type}  }\";\n    if(CONFIG.USECACHE) return cacheQuery(query,null,'count_all');\n    else return apiQuery(query);\n  }\n  \n\n  /* Easy select query to transform triples to javascript objects */\n  function selectQuery(sparqlQuery, raw,cache_id) {\n    var props=[\n      'subject',\n      'predicate',\n      'object',\n      'has_observable_name',\n      'has_risk_element_name',\n      'has_measurement_type_name',\n      'has_risk_factor_association_type',\n      'has_risk_factor_source',\n      'has_risk_factor_target',\n      'has_source_risk_element_name',\n      'has_target_risk_element_name',\n      'has_citation_pubmed_identifier'\n      ];\n    if( cache_id ) { \n      // USE CACHE\n      return cacheQuery(sparqlQuery,null,cache_id).then(function(res) {\n        if (raw) return res;\n        // console.log(res.data);\n        var results = RdfFormatter.groupByProp(res.data, props, null, 'value');\n        if (results.data.length > 0) return RdfFormatter.mappings(results);\n        else return [];\n      });\n    } else {\n      return apiQuery(sparqlQuery).then(function(res) {\n          \n        console.log(\"=========NO CACHE===================\");\n        \n        // console.log(\"Sparql Query: \",sparqlQuery);\n        console.log(\"Raw: \",res.data);\n        if (raw) return res;\n        var results = RdfFormatter.groupByProp(res.data, props, null, 'value');\n        console.log(\"groupByProp: \",results);\n        if (results.data.length > 0) {\n          var MappedResults = RdfFormatter.mappings(results);\n          console.log(\"MappedResults: \",results);\n          return MappedResults\n        } else return [];\n        \n        \n        console.log(\"===========NO CACHE===============\");\n        \n      });\n    } \n  }\n\n\n\n  /* CORE query method*/\n  function apiQuery(sparqlQuery,noprefix) {\n    \n    if($rootScope.isOffline) {\n      $state.go('500_API_ERROR');\n      return $q.reject({});\n    }\n    \n    var params = {};\n    //add prefixes\n    params.sparql = (noprefix?\"\":PREFIXSTR) + sparqlQuery;\n    console.info('API query: ', params.sparql);\n    // use token\n    if (Auth.cookie) params.token = Auth.cookie;\n    return $http.post(CONFIG.CARRE_API_URL + 'query', params).then(function(res){\n      if(res.data==='No JSON object could be decoded'||res.status===500||res.status===404||res.status===401) {\n        console.error(res);\n        toastr.error('<p>'+res.data+'</p>','<h4>Oh Error</h4>');\n        return $q.reject(res);\n      }  else return res;\n    }).catch(function(err){\n        console.log(err);\n        Email.bug(err);\n        $state.go('500_API_ERROR');\n    });\n\n  }\n  \n\n  /* CACHE methods */\n  function cacheQuery(sparqlQuery,noprefix,req_url_id) {\n    \n    console.info('CACHE query: ', (noprefix?\"\":PREFIXSTR) + sparqlQuery);\n    \n    var graphName=CONFIG.CARRE_DEFAULT_GRAPH.substring(CONFIG.CARRE_DEFAULT_GRAPH.lastIndexOf(\"/\")+1,CONFIG.CARRE_DEFAULT_GRAPH.lastIndexOf(\">\"));\n    var url=CONFIG.CARRE_CACHE_URL + 'carreapi/'\n            +graphName+'_'+CONFIG.LANG+'_'+req_url_id+'/'\n            +encodeURIComponent(CONFIG.CARRE_API_URL+'query')+'/'\n            +encodeURIComponent((noprefix?\"\":PREFIXSTR) + sparqlQuery)\n            +(Auth.cookie?'/'+Auth.cookie:'');\n    console.log(url);\n    \n    return $http.get(url, {\"cache\":false}).then(function(res){\n      if(res.data==='No JSON object could be decoded') {\n        console.error(res);\n        toastr.error('<p>'+res.data+'</p>','<h4>Oh Error</h4>');\n        return $q.reject(res);\n      }  else {\n        \n          //setup client caching\n          // CONFIG.CACHED_QUERIES[graphName+'_'+req_url_id]=url;\n    \n        return res;\n      }\n    }).catch(function(err){\n        console.log(err);\n        $state.go('500_API_ERROR');\n    });\n\n  }\n  \n  function invalidateCache(req_url_id){\n    if(!CONFIG.USECACHE) return; \n    var graphName=CONFIG.CARRE_DEFAULT_GRAPH.substring(CONFIG.CARRE_DEFAULT_GRAPH.lastIndexOf(\"/\")+1,CONFIG.CARRE_DEFAULT_GRAPH.lastIndexOf(\">\"));\n    var url=CONFIG.CARRE_CACHE_URL + 'refresh_cache/'+graphName+'_'+CONFIG.LANG+'_'+req_url_id\n    \n    // remove cached url\n    // var cached_url=CONFIG.CACHED_QUERIES[graphName+'_'+req_url_id];\n    // $cacheFactory.get('$http').remove(cached_url); \n    \n    return $http.get(url).then(function(res){\n      console.log(res);\n    }).catch(function(err){\n        console.log(err);\n        $state.go('500_API_ERROR');\n    });\n  }\n  \n\n  return this.exports;\n});\nangular.module('CarreEntrySystem').service('Bioportal', function($http, CONFIG) {\n\n  var apikey = CONFIG.BIOPORTAL_API_KEY;\n  var apiurl = CONFIG.BIOPORTAL_API_URL;\n\n  //pass the Bioportal supported options to override the default \n  var fetch = function(term, options,nocui) {\n    return search(term, options).then(function(res) {\n      var cuis = [];\n      var results = [];\n      res.data.collection.forEach(function(obj) {\n        if (nocui||((obj.cui?obj.cui.length>0:false) && cuis.indexOf(obj.cui[0]) === -1)) {\n          if(!nocui) cuis.push(obj.cui[0]);\n          results.push({\n            label: obj.prefLabel,\n            value: nocui?obj['@id']:obj.cui[0],\n            link:obj.links.ui\n          });\n        }\n        \n      });\n      console.info(results);\n      return results;\n\n    });\n\n  };\n\n\n  /*Implement basic methods*/\n  var cachesearch = function(input, options) {\n    var params = options || {};\n    params.q = input;\n    params.apikey = apikey;\n    return $http.get('http://beta.carre-project.eu:3002/bioportal/'+encodeURIComponent(apiurl + 'search/'+$.param( params )), {\n      ignoreLoadingBar: true,\n      cache: true\n    });\n  };\n  \n  /*Implement basic methods*/\n  var search = function(input, options) {\n    options = options || {};\n    var params = {\n      display_context: options.display_context||'false',\n      require_exact_match: options.require_exact_match||'false',\n      include: options.include||'prefLabel,definition,cui',\n      display_links: options.display_links||'true',\n      ontologies: options.ontologies||CONFIG.BIOPORTAL_ONTOLOGIES,\n      require_definitions: options.require_definitions||'false'\n    };\n    params.q = input;\n    params.apikey = apikey;\n    return $http.get(apiurl + 'search', {\n      params: params,\n      ignoreLoadingBar: true,\n      cache: true\n    });\n  };\n  var annotator = function(input, options) {\n    var params = options || {};\n    params.text = input;\n    params.apikey = apikey;\n    return $http.get(apiurl + 'annotator', {\n      params: params,\n      ignoreLoadingBar: true,\n      cache: true\n    });\n  };\n  var recommender = function(input, options) {\n    var params = options || {};\n    params.input = input;\n    params.apikey = apikey;\n    return $http.get(apiurl + 'recommender', {\n      params: params,\n      ignoreLoadingBar: true,\n      cache: true\n    });\n  };\n\n  return {\n    'fetch': fetch,\n    'search': search,\n    'annotator': annotator,\n    'recommender': recommender\n  }\n  \n  /* Unimplemented */\n\n// var CUI_DETAILS = {};\n\n// var BIOPORTAL_ONTOLOGIES=\"ICD10,ICD10CM\";//\",ICD10CM,ICD10PCS,ICD9CM\";\n\n\n// var BioPortalsearch = function(input, cuis) {\n//     cuis = (cuis instanceof Array)?cuis:(cuis?cuis.split(','):'');\n//     input=input||\"\";\n//     request({\n//         url: \"https://data.bioontology.org/search?token=a15281a9-d87d-4c0f-b7aa-31debe0f6449&cui=\"+cuis.join(',')+\"&q=\"+input+\"&include=prefLabel,definition,cui&display_context=false&display_links=true&ontologies=\"+BIOPORTAL_ONTOLOGIES,\n//         method: 'GET'\n        \n//     }, function(error, response, body){\n//         if(error) { console.log(error); } else saveCuis(cuis,body.collection); });\n     \n// };\n// /*Implement BioPortalsearch methods*/\n// var saveCuis = (cuis,data)=>{\n//     var arr=[];\n//     arr.concat(data);\n    \n//     cuis.forEach((cui)=>{\n//         for (var i=0,len=arr.length;i<len;i++){\n//             if(arr[i].cui.indexOf(arr[i])>=0) {\n//                 mcache.put(cui,arr[i]);\n//                 getAncestors(cui,arr[i].links.ancestors);\n//                 arr.splice(i,1);\n//                 break;\n//             }   \n//         }        \n//     })\n// }\n\n// var getAncestors = (cui,ancestorUrl) => {\n//     var cachedAncestors = mcache.get(cui+'_ancestors');\n//     if(cachedAncestors) return cachedAncestors; \n//     else return request(ancestorUrl,function(err,res,body){\n//         if(err) console.log(err); else {\n//             mcache.put(cui+'_ancestors',body);\n//             return body;\n//         }\n//     });\n// }\n\n});\n/* global angular */\n(function() {\n    'use strict';\n\n    angular\n        .module('CarreEntrySystem')\n        .filter('trustAsResourceUrl', trustResourceFilter)\n        .filter('hideSelected', hideSelected)\n        .filter('sliceLast', sliceLast)\n        .filter('prettySigns', prettySigns)\n        .filter('propsFilter', propsFilter)\n        .filter('exclude', excludeItems);\n\n\n    /** @ngInject */\n    function trustResourceFilter($sce) {\n        return function(val) {\n            return $sce.trustAsResourceUrl(val);\n        };\n    }\n\n    /** @ngInject */\n    function hideSelected() {\n        return function(item, selectedItems) {\n            if(selectedItems.length===0) return false; \n            selectedItems.forEach(function(obj){\n                if(item.value===obj) return true;\n            });\n            return false;\n        };\n    }\n    \n    /** @ngInject */\n    function sliceLast() {\n        return function(item, char) {\n            if(!item||item.length<=0||!char||char.length<=0) return ''; \n            return item.substring(item.lastIndexOf(char)+1);\n        };\n    }\n    /** @ngInject */\n    function prettySigns() {\n        return function(val) {\n            if(!val||val.length<=0) return ''; \n            else return val.replace(new RegExp(\">=\", 'g'), '').replace(new RegExp(\"<=\", 'g'), '')\n        };\n    }\n\n    /** @ngInject */\n    function excludeItems() {\n        return function(items, selectedItems) {\n            var out=[];\n            if(selectedItems.length===0) return items; \n            //you want to remove the selected items from items\n            items.forEach(function(item){\n                if(selectedItems.indexOf(item.value)===-1) out.push(item);\n            });\n            return out;\n        };\n    }\n\n\n    /** @ngInject */\n    function propsFilter() {\n        return function(items, props) {\n            var out = [];\n\n            if (angular.isArray(items)) {\n                items.forEach(function(item) {\n                    var itemMatches = false;\n\n                    var keys = Object.keys(props);\n                    for (var i = 0; i < keys.length; i++) {\n                        var prop = keys[i];\n                        var text = props[prop].toLowerCase();\n                        try {\n                            if (item[prop].toString().toLowerCase().indexOf(text) !== -1) {\n                                itemMatches = true;\n                                break;\n                            }\n                        } catch(err) {\n                            console.info(item,prop,item[prop]);\n                            console.error('Error',err)\n                        }\n                    }\n\n                    if (itemMatches) {\n                        out.push(item);\n                    }\n                });\n            }\n            else {\n                // Let the output be the input untouched\n                out = items;\n            }\n\n            return out;\n        };\n    }\n\n})();\n/* global angular */\n(function() {\n    'use strict';\n\n    angular\n        .module('CarreEntrySystem')\n        .directive('uiSrefActiveIf', uiSrefActiveIfDirective)\n        .directive('countTo', countToDirective);\n\n    /** @ngInject */\n    function uiSrefActiveIfDirective($state) {\n        return {\n            restrict: \"A\",\n            controller: ['$scope', '$element', '$attrs', 'CONFIG', function($scope, $element, $attrs, CONFIG) {\n                \n                var menuColor=function(state){\n                    var elem=state.substr(state.lastIndexOf('.')+1);\n                    console.log(elem);\n                    var color=\"\";\n                    switch (elem) {\n                        case 'risk_factors':\n                            color=CONFIG.COLORS[0];\n                            break;\n                        case 'risk_evidences':\n                            color=CONFIG.COLORS[1];\n                            break;\n                        case 'risk_elements':\n                            color=CONFIG.COLORS[2];\n                            break;\n                        case 'observables':\n                            color=CONFIG.COLORS[3];\n                            break;\n                        case 'citations':\n                            color=CONFIG.COLORS[4];\n                            break;\n                        \n                        default:\n                            color=\"#EEEEEE\";\n                    }\n                    return color;\n                }\n                function update() {\n                    var state = $attrs.uiSrefActiveIf;\n                    if ($state.includes(state) || $state.is(state)) {\n                            // console.log(state,$state.includes(state),$state.is(state))\n                            $element.css(\"border-right\",\"5px solid \"+menuColor(state))\n                            $element.addClass(\"active\");\n                    }\n                    else {\n                        // angular.element(\"#side-menu li\").each(function() {\n                        //   $( this ).removeClass(\"active\");\n                        // });\n                        $element.css(\"border-right\",\"none\");\n                        $element.removeClass(\"active\");\n                    }\n                }\n\n                $scope.$on('$stateChangeSuccess', update);\n                update();\n            }]\n        };\n    }\n    \n    /** @ngInject */\n    function countToDirective($timeout) {\n        return {\n            replace: false,\n            scope: true,\n            link: function (scope, element, attrs) {\n\n                var e = element[0];\n                var num, refreshInterval, duration, steps, step, countTo, value, increment;\n\n                var calculate = function () {\n                    refreshInterval = 30;\n                    step = 0;\n                    scope.timoutId = null;\n                    countTo = parseInt(attrs.countTo) || 0;\n                    scope.value = parseInt(attrs.value, 10) || 0;\n                    duration = (parseFloat(attrs.duration) * 1000) || 0;\n\n                    steps = Math.ceil(duration / refreshInterval);\n                    increment = ((countTo - scope.value) / steps);\n                    num = scope.value;\n                };\n\n                var tick = function () {\n                    scope.timoutId = $timeout(function () {\n                        num += increment;\n                        step++;\n                        if (step >= steps) {\n                            $timeout.cancel(scope.timoutId);\n                            num = countTo;\n                            e.textContent = countTo;\n                        } else {\n                            e.textContent = Math.round(num);\n                            tick();\n                        }\n                    }, refreshInterval);\n\n                };\n\n                var start = function () {\n                    if (scope.timoutId) {\n                        $timeout.cancel(scope.timoutId);\n                    }\n                    calculate();\n                    tick();\n                };\n\n                attrs.$observe('countTo', function (val) {\n                    if (val) {\n                        start();\n                    }\n                });\n\n                attrs.$observe('value', function (val) {\n                    start();\n                });\n\n                return true;\n            }\n        };\n    }\n        \n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($timeout, toastr, $location, CONFIG,CARRE,$state,SweetAlert, Tutorial,$scope,$rootScope) {\n    var vm = this;\n    \n    CONFIG.ROOT_URL=rootUrl();\n    vm.config = CONFIG;\n    vm.user = vm.config.currentUser || {};\n    \n    //set up the urls \n    vm.loginUrl = CONFIG.CARRE_DEVICES + 'login?next=';\n    vm.logoutUrl = CONFIG.CARRE_DEVICES + 'logout?next=';\n    vm.settingsUrl = CONFIG.CARRE_DEVICES + 'settings';\n    vm.passwordUrl = CONFIG.CARRE_DEVICES + 'recover?next=';\n\n    //show message for the user\n    if( !$rootScope.isEmbedded ) {\n      if(vm.user.username){\n        toastr.success('Have fun with the risk factors!','<h4>Hi '+vm.user.username+'!</h4>');\n      } else {\n        toastr.info('Please login if you want to add/edit data.','<h4>Hello Guest!</h4>');\n      }\n    }\n    \n    function rootUrl(){\n      if(CONFIG.ENV==='DEV'){\n        return window.location.host+'/#/';\n      } else if(CONFIG.ENV==='PROD'){\n        return window.location.host+'/';\n      }\n    }\n    \n    vm.deleteCurrent = function(id) {\n      if(!id) return;\n      SweetAlert.swal({\n          title: \"Are you sure?\",\n          text: \"Your will not be able to recover this element!\",\n          type: \"warning\",\n          showCancelButton: true,\n          confirmButtonColor: \"#DD6B55\",\n          confirmButtonText: \"Yes, delete it!\",\n          closeOnConfirm: true,\n          closeOnCancel: true\n        },\n        function(isConfirm) {\n          if (isConfirm) { \n            if(CONFIG.AllowDelete) {\n              CARRE.delete(id).then(function() { $state.go('^.list'); }); \n            } else {\n              toastr.info(id+' deleted!','DEBUG');\n              $timeout(function(){ $state.go('^.list') },500);\n            }\n          }\n        });\n    };\n    \n    $scope.IntroOptions = Tutorial.options();\n    \n  \n    $timeout(function(){\n      if(!CONFIG.currentUser.username && CONFIG.ENV==='DEV' &&  $state.includes(\"main.dashboard\") ) Tutorial.startGuest($scope.startIntro);\n    },1000)\n    \n\n  }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('CarreEntrySystem')\n        .run(runBlock)\n        .run(setPermissionValidator);\n\n    /** @ngInject */\n    function setPermissionValidator(Permission, Auth, $q) {\n        // Define anonymous role\n        console.log('Role Definition called!');\n        Permission.defineRole('authenticated_user', function(stateParams) {\n            return Auth.isLoggedIn();\n        });\n    }\n\n    /** @ngInject */\n    function runBlock($rootScope,$state,$location,CONFIG,$http,$cookies) {\n            \n\n        // check if it is embeded\n        if($location.search().embed) {\n            \n          $rootScope.isEmbedded = true;\n          if($location.search().hidemenu) $rootScope.hideMenu = true;\n          if($location.search().showonlygraph) $rootScope.showOnlyGraph = true;\n          \n        }\n        \n        // handle ui-router error redirect\n        if(CONFIG.useOfflineMode) {\n            $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams, options){\n                if(toState.name==='500_API_ERROR') { \n                    event.preventDefault(); \n                    $rootScope.isOffline = true; \n                }\n            });\n        }\n\n        //handle ui-router errors\n        $rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {\n            // this is required if you want to prevent the $UrlRouter reverting the URL to the previous valid location\n            event.preventDefault();\n            console.error('Ui Router error:', event, toState, toParams, fromState, fromParams, error);\n            console.log(error);\n            // $state.go(toState.name,toParams.id);\n        });\n\n        // window.hexToRgb = function(hex) {\n        //     var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        //     hex = hex.replace(shorthandRegex, function(m, r, g, b) {\n        //         return r + r + g + g + b + b;\n        //     });\n\n        //     var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        //     return result ? {\n        //         r: parseInt(result[1], 16),\n        //         g: parseInt(result[2], 16),\n        //         b: parseInt(result[3], 16)\n        //     } : null;\n        // }\n        \n        \n        // allow language change hack\n        var lang_cookie = $cookies.get('CARRE_LANG')\n        CONFIG.LANG = lang_cookie&&lang_cookie.length===2?lang_cookie:\"en\";\n        if($location.search().lang) {\n          CONFIG.LANG = $location.search().lang;\n        }\n        \n        // load language file\n        window.CARRE_TRANSLATIONS = {'el':{},'lt':{},'en':{}};\n        $http.get('/translation.'+CONFIG.LANG+'.json',{cache:true}).then(function(res){\n            console.debug(res);\n            window.CARRE_TRANSLATIONS[CONFIG.LANG] = res.data;\n        });\n\n    }\n\n})();\n\n\n/*JQUERY MetisMenu - external library for sidebar rendering */\n\n$(function() {\n\n    $('#side-menu').metisMenu();\n\n});\n\n//Loads the correct sidebar on window load,\n//collapses the sidebar on window resize.\n// Sets the min-height of #page-wrapper to window size\n$(function() {\n    $(window).bind(\"load resize\", function() {\n        topOffset = 50;\n        width = (this.window.innerWidth > 0) ? this.window.innerWidth : this.screen.width;\n        if (width < 768) {\n            $('div.navbar-collapse').addClass('collapse');\n            topOffset = 100; // 2-row-menu\n        }\n        else {\n            $('div.navbar-collapse').removeClass('collapse');\n        }\n\n        height = ((this.window.innerHeight > 0) ? this.window.innerHeight : this.screen.height) - 1;\n        height = height - topOffset;\n        if (height < 1) height = 1;\n        if (height > topOffset) {\n            $(\"#page-wrapper\").css(\"min-height\", (height) + \"px\");\n        }\n    });\n\n    var url = window.location;\n    var element = $('ul.nav a').filter(function() {\n        return this.href == url || url.href.indexOf(this.href) == 0;\n    }).addClass('active').parent().parent().addClass('in').parent();\n    if (element.is('li')) {\n        element.addClass('active');\n    }\n});\n\n/*global angular*/\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider) {\n\n    $stateProvider\n      .state('main', {\n        'abstract': true,\n        controller: 'MainController',\n        controllerAs: 'main',\n        templateUrl: 'app/main.html',\n        resolve:{\n          'currentUser':function(Auth){\n            return Auth.getUser();\n          }\n        }\n      })\n      \n      /*Error routes*/\n      .state('404_error', {\n        templateUrl: '404.html',\n        url: '/404_error'\n      })\n      .state('500_API_ERROR', {\n        templateUrl: '500_API.html',\n        url: '/500_api_error'\n      });\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .constant(\"CONFIG\", {    \n      \"currentUser\":{},\n      \"USECACHE\":false,\n      \"ENV\": \"PROD\",\n      \"useOfflineMode\":true,\n      \"AllowDelete\":true,\n    }).config(function($locationProvider, $compileProvider, $urlRouterProvider) {\n      \n      //show error\n      $urlRouterProvider.otherwise( function($injector) {\n        var $state = $injector.get(\"$state\");\n        $state.go('404_error');\n      });\n      \n      //Set url handler  \n      $locationProvider.html5Mode(true);\n      \n      // Disable log\n      $compileProvider.debugInfoEnabled(false);\n      \n      //load the google analytics only in production\n      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n      ga('create', 'UA-60507179-2', 'auto');\n      ga('send', 'pageview');\n  \n    });\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('CarreEntrySystem')\n    .config(config);\n\n  /** @ngInject */\n  function config(toastrConfig, $httpProvider, cfpLoadingBarProvider,CONFIG) {\n    \n    \n    // SYSTEM_CONFIGURATION\n    var defaults = {\n      language:'en',\n      api_url:'https://devices.duth.carre-project.eu/ws/',\n      cache_url:'NO_CACHE',\n      authentication_url:'https://devices.duth.carre-project.eu/devices/accounts/',\n      graph_url:'carre.kmi.open.ac.uk'\n    };\n    window.CARRE_ENTRY_SYSTEM_CONFIGURATION = angular.isObject(window.CARRE_ENTRY_SYSTEM_CONFIGURATION)?angular.extend(defaults, window.CARRE_ENTRY_SYSTEM_CONFIGURATION):defaults;\n    \n    CONFIG.CARRE_DEFAULT_GRAPH=\"<http://\"+window.CARRE_ENTRY_SYSTEM_CONFIGURATION.graph_url+\"/public>\";\n    CONFIG.CARRE_ARCHIVE_GRAPH=\"<http://\"+window.CARRE_ENTRY_SYSTEM_CONFIGURATION.graph_url+\"/riskdata>\";\n    CONFIG.CARRE_DEVICES=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.authentication_url;\n    CONFIG.CARRE_API_URL=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.api_url;\n    CONFIG.CARRE_CACHE_URL=window.CARRE_ENTRY_SYSTEM_CONFIGURATION.cache_url;\n    \n    // if(CONFIG.CARRE_CACHE_URL==='NO_CACHE') CONFIG.USECACHE=false;\n    CONFIG.USECACHE=false;\n    CONFIG.AllowDelete = true;\n    \n    //EXTERNAL API'S\n    CONFIG.BIOPORTAL_API_URL=\"https://data.bioontology.org/\";\n    CONFIG.BIOPORTAL_API_KEY=\"a15281a9-d87d-4c0f-b7aa-31debe0f6449\";\n    CONFIG.BIOPORTAL_ONTOLOGIES=\"ICD10,ICD10CM\";//\",ICD10CM,ICD10PCS,ICD9CM\";\n    CONFIG.PUBMED_API_URL=\"https://eutils.ncbi.nlm.nih.gov/entrez/eutils/\";\n    CONFIG.EUROPEPMC_API_URL=\"https://www.ebi.ac.uk/europepmc/webservices/rest/\";\n    \n    //Client caching\n    CONFIG.CACHED_QUERIES={};\n    \n    // Set options third-party lib\n    CONFIG.OPTIONS={\n      usePrefix:true\n    };\n    \n    // Language\n    CONFIG.LANG = window.CARRE_ENTRY_SYSTEM_CONFIGURATION.language || \"en\"; //el,lt\n    CONFIG.LANGPredicates = [\n      \"risk:has_risk_element_name\",\"risk:has_observable_name\",\"risk:has_measurement_type_name\",\"risk:has_enumeration_values\",\"risk:has_label\"\n    ];\n    \n    // Sensor predicates \n    //\n    CONFIG.SENSOR_PREDICATES = [\n      \"bmi\",\"height\",\"provenance\",\"calories_metabolised\",\"steps\",\"o2saturation\",\"light_activity_duration\",\"sodium\",\"sleep_time\",\"sleep_efficiency\",\"asleep_duration\",\"deep_sleep_duration\",\"weight\",\"protein\",\"calories_b_m_r\",\"sedentary_activity_duration\",\"date\",\"body_fat\",\"muscle_mass\",\"water_mass\",\"bone_mass\",\"body_d_c_i\",\"intense_activity_duration\",\"intense_activity_distance\",\"logged_activity_distance\",\"sedentary_activity_distance\",\"actuality\",\"minutes_after_wakeup\",\"fat\",\"fibre\",\"blood_pressure_systolic\",\"blood_pressure_diastolic\",\"who_b_p_level\",\"pulse\",\"elevation\",\"floors\",\"moderate_activity_duration\",\"light_activity_distance\",\"moderate_activity_distance\",\"tracked_activity_distance\",\"distance\",\"times_restless\",\"time_to_fall_asleep\",\"awake_duration\",\"restless_duration\",\"calories\",\"activity_calories\",\"marginal_calories\",\"times_awake\",\"carbs\",\"glucose\",\"dinner_situation\",\"drug_situation\",\"start_date\",\"sleep_status\",\"note\",\"latitude\",\"longitude\",\"end_date\",\"light_sleep_duration\",\"water\",\"lean_mass\",\"location\",\"arrhythmia_type\",\"activity_points\",\"fat_mass\",\"timezone\",\"logged_activity_duration\",\"logged_activity_name\",\"http://carre.kmi.open.ac.uk/ontology/sensors.owl#date\",\"diagnosis\",\"left_ventricular_hypertrophy_diagnosis\",\"acute_kidney_injury_diagnosis\",\"egfr\",\"blood_pressure\",\"uric_acid_serum_concentration\",\"smoking_status\",\"blood_glucose_fasting\",\"blood_glucose_2h_glucose_after_oral_glucose_tolerance_test\",\"duration\",\"heartrate\",\"haemoglobin_hb\",\"high-density_lipoprotein_cholesterol_hdl-c\",\"ldl-c_low-density_lipoprotein_cholesterol\",\"total_cholesterol_tc\",\"triglycerides_serum_concentration_tg\",\"hemoglobin_hb_level\",\"diabetes_diagnosis\",\"hypertension_diagnosis\"\n    ];\n    \n    //chart colors\n    var jnnnColors=[\"#e08526\", \"#a118fb\", \"#2f739c\", \"#2db315\", \"#fb64b0\", \"#27af8d\", \"#4663db\", \"#706f42\", \"#ba4645\", \"#b68bce\", \"#ad36bc\", \"#ac9c1f\", \"#b3948f\", \"#2b7d1a\", \"#d32528\", \"#ad4a80\", \"#8f6521\", \"#4ea8ad\", \"#87a64a\", \"#3d7860\", \"#77687f\", \"#ea7790\", \"#fe4df0\", \"#cb2964\", \"#9d5962\", \"#f57550\", \"#d78670\", \"#4858fb\", \"#7499ee\", \"#c37eef\", \"#6f60bc\", \"#9a3cdb\", \"#7ca66d\", \"#107d40\", \"#3e6cbb\", \"#6ba78d\", \"#f067d0\", \"#939f8e\", \"#4f7741\", \"#bd4525\", \"#c52d81\", \"#c3924d\", \"#22a3ee\", \"#54717e\", \"#657061\", \"#58771c\", \"#d02747\", \"#766f1e\", \"#c589af\", \"#7d43fb\", \"#a696ae\", \"#81a0ae\", \"#8b6543\", \"#0d797e\", \"#69ad18\", \"#4dae6c\", \"#5fad49\", \"#a14c9e\", \"#8ea51c\", \"#c79223\", \"#a79d4b\", \"#bd936f\", \"#836661\", \"#9f9e6e\", \"#e26af0\", \"#65a1ce\", \"#63699d\", \"#a75823\", \"#935b7f\", \"#dd854e\", \"#9297ce\", \"#914fbc\", \"#d47bcf\", \"#b54863\", \"#d0878f\", \"#f17671\", \"#a08def\", \"#7753db\", \"#bb319e\", \"#e179af\", \"#f9742a\", \"#a35844\", \"#855d9d\"]\n    //var myColors = [\"#a6cee3\",\"#1f78b4\",\"#b2df8a\",\"#33a02c\",\"#fb9a99\",\"#e31a1c\",\"#fdbf6f\",\"#ff7f00\",\"#cab2d6\",\"#6a3d9a\",\"#ffff99\",\"#b15928\",\"#46BFBD\", \"#F7464A\",\"#2E8B57\", \"#DB7093\", \"#FDB45C\", \"#949FB1\", \"#4D5360\",'#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00','#cab2d6','#6a3d9a','#ffff99','#b15928'];\n    // [\"#46BFBD\", \"#F7464A\",\"#2E8B57\", \"#DB7093\", \"#FDB45C\", \"#949FB1\", \"#4D5360\"]\n    var myColors = ['#377eb8','#e41a1c','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'].concat(jnnnColors);\n    CONFIG.COLORS=myColors.concat(d3.scale.category20().range()); //mix the 20 default d3 color palette so you have almost 40\n    Chart.defaults.global.colours=CONFIG.COLORS.map(function(color){return { fillColor: color }; });\n    \n    //toaster notification\n    angular.extend(toastrConfig, {\n      allowHtml: true,\n      closeButton: false,\n      closeHtml: '<button>&times;</button>',\n      extendedTimeOut: 1000,\n      iconClasses: {\n        error: 'toast-error',\n        info: 'toast-info',\n        success: 'toast-success',\n        warning: 'toast-warning'\n      },\n      positionClass: 'toast-top-right',\n      messageClass: 'toast-message',\n      onHidden: null,\n      onShown: null,\n      onTap: null,\n      preventDuplicates: false,\n      progressBar: false,\n      tapToDismiss: true,\n      // templates: {\n      //   toast: 'directives/toast/toast.html',\n      //   progressbar: 'directives/progressbar/progressbar.html'\n      // },\n      timeOut: 4000,\n      titleClass: 'toast-title',\n      toastClass: 'toast'\n    });\n\n    cfpLoadingBarProvider.spinnerTemplate = '<div style=\"position:absolute; top:-80px; z-index:99999; left:49%\"><div class=\"loader\">Loading...</div></div>';\n    cfpLoadingBarProvider.latencyThreshold = 600;\n    // cfpLoadingBarProvider.includeBar = false;\n\n\n\n    //fix 500 and -1 errors\n    $httpProvider.interceptors.push(function($q, $injector) {\n      var incrementalTimeout = 1000;\n\n      function retryRequest(httpConfig) {\n        var $timeout = $injector.get('$timeout');\n        incrementalTimeout *= 2;\n        return $timeout(function() {\n          var $http = $injector.get('$http');\n          return $http(httpConfig);\n        }, incrementalTimeout);\n      }\n\n      return {\n        request: function(config) {\n          return config;\n        },\n        requestError: function(request) {\n          console.warn('Error on request: ', request);\n          return request;\n        },\n        responseError: function(response) {\n\n          if (response.status === 500 || response.status === -1) {\n\n\n            console.warn('Weird API 500 error intercepted! : ', response);\n            if (incrementalTimeout < 4000) {\n              return retryRequest(response.config);\n            }\n            else {\n              // document.location.href = '/500_API_ERROR';\n              console.log('The remote server seems to be busy at the moment. Please try again in 5 minutes');\n              \n              return $q.reject(response);\n            }\n          }\n          else {\n            incrementalTimeout = 1000;\n          }\n          return $q.reject(response);\n        }\n      };\n    });\n\n\n  }\n\n})();\n\nangular.module(\"CarreEntrySystem\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main.html\",\"<div id=\\\"wrapper\\\" ng-intro-options=\\\"IntroOptions\\\" ng-intro-method=\\\"startIntro\\\" ng-intro-oncomplete=\\\"CompletedEvent\\\" ng-intro-onexit=\\\"ExitEvent\\\" ng-intro-onchange=\\\"ChangeEvent\\\" ng-intro-onbeforechange=\\\"BeforeChangeEvent\\\" ng-intro-autostart=\\\"false\\\"><div style=\\\"width:100%; height:19px; background-color:#E41A1C; color:white\\\" class=\\\"text-center\\\" ng-if=\\\"isOffline\\\">OFFLINE MODE</div><carre-header ng-hide=\\\"isEmbedded\\\"></carre-header><sidebar ng-if=\\\"!hideMenu\\\"></sidebar><div id=\\\"page-wrapper\\\" style=\\\"min-height: 561px;\\\" ng-style=\\\"hideMenu?{\\'margin\\':\\'0 0 0 0\\'}:{}\\\"><div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-6\\\"><labe>Configuration<pre>{{main.config | json}}</pre></labe></div><div class=\\\"col-xs-6\\\"><labe>User<pre>{{main.user | json}}</pre></labe></div></div><div ui-view=\\\"\\\"></div></div><carre-footer ng-hide=\\\"isEmbedded\\\"></carre-footer></div>\");\n$templateCache.put(\"app/about/about.html\",\"<h2 class=\\\"header\\\">More Information</h2><div><iframe src=\\\"//www.slideshare.net/slideshow/embed_code/key/rL6KQLdZuhK9Xu?startSlide=2\\\" width=\\\"595\\\" height=\\\"485\\\" frameborder=\\\"0\\\" marginwidth=\\\"0\\\" marginheight=\\\"0\\\" scrolling=\\\"no\\\" style=\\\"border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;\\\" allowfullscreen=\\\"\\\"></iframe><p>The CARRE risk entry system enables the <a href=\\\"http://entry.carre-project.eu/medical_experts\\\">medical experts</a> in the <a href=\\\"http://www.carre-project.eu/\\\">CARRE project</a> to encode the risk factors between biological, demographic, lifestyle and environmental elements and clinical outcomes in accordance with evidence from the clinical literature. The presented system is based fundamentally on <a href=\\\"http://www.w3.org/DesignIssues/LinkedData.html\\\"></a>Linked Data principles, and so in order to make the best use of these encoded factors, they are available as Linked Data through the <a href=\\\"http://carre.kmi.open.ac.uk:8890/sparql\\\">CARRE SPARQL Endpoint</a>, making use of control vocabularies (<a href=\\\"https://www.nlm.nih.gov/research/umls/\\\">UMLS</a> , <a href=\\\"https://www.nlm.nih.gov/snomed/\\\"></a>SNOMED, etc.) and the <a href=\\\"http://bioportal.bioontology.org/ontologies/CARRE\\\">CARRE risk factor ontology</a>; specifically, they are encoded in the (standard) Resource Description Framework (<a href=\\\"http://www.w3.org/RDF/\\\">RDF</a>) format.</p><p>The system has been developed as a client side web application that follows the <a href=\\\"http://microservices.io/\\\">Microservices</a> architectural style and provides native RDF support via the <a href=\\\"https://carre.kmi.open.ac.uk/ws/\\\">CARRE API</a> and the <a href=\\\"http://carre.kmi.open.ac.uk:8890/sparql\\\">CARRE SPARQL Endpoint</a>. Moreover custom form components have been developed to reflect the structure of the <a href=\\\"http://bioportal.bioontology.org/ontologies/CARRE\\\">CARRE risk factor ontology</a>, so that citations, observables, risk elements, risk evidences and risk factors are automatically stored into the CARRE RDF triple store. The CARRE risk entry system is implemented in <a href=\\\"http://www.w3.org/TR/html5/\\\">HTML5</a>, <a href=\\\"http://www.w3.org/Style/CSS/\\\"></a>CSS and <a href=\\\"https://www.javascript.com/\\\">JavaScript</a> using the <a href=\\\"https://angularjs.org/\\\">AngularJS</a> framework. The system is open source and the source code is available at <a href=\\\"https://github.com/carre-project/carre-entry-system\\\">GitHub</a>. The system maintains referential integrity, so that if diabetes is entered as a risk element entity, then a risk factor representing an observed link between diabetes and hypertension will refer to the existing diabetes risk element entity. Medical experts are supported in the reuse of data already entered into the system by the user interface, which allows existing relevant entities to be selected via appropriate searchable lists wherever possible.</p><p>Web development: <a href=\\\"http://nporto.com/\\\">Nick Portokallidis</a></p><p>Data cleansing: <a href=\\\"http://drosatos.info/\\\">George Drosatos</a></p><p>Scientific supervision: <a href=\\\"http://iris.med.duth.gr/kaldoudi/en/\\\">Eleni Kaldoudi</a></p></div><br><br><footer class=\\\"footer\\\" style=\\\"height:60px;\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-6\\\"><span><a href=\\\"//www.carre-project.eu\\\" target=\\\"_blank\\\"><img src=\\\"assets/images/CARRE-FooterLogo.png\\\" width=\\\"36\\\" height=\\\"40\\\" alt=\\\"CARRE\\\">&nbsp;CARRE Project  2015</a></span></div><div class=\\\"col-xs-6\\\"><span class=\\\"pull-right\\\" style=\\\"\\\">FP7-ICT-611140.&nbsp; <a href=\\\"//cordis.europa.eu/\\\" target=\\\"_blank\\\"><img src=\\\"assets/images/Picture1-150x150.png\\\" width=\\\"40\\\" height=\\\"40\\\" alt=\\\"EU\\\"></a></span></div></div></footer>\");\n$templateCache.put(\"app/components/carre-element/template.html\",\"<div class=\\\"carre-element\\\"><div cg-busy=\\\"loading\\\" style=\\\"position:relative;top:-15px;z-index:1\\\"></div><div ng-if=\\\"mode===\\'view\\'\\\" class=\\\"carre-element-view\\\"><div ng-class=\\\"{\\'col-sm-6\\':current.pubmedId,\\'col-sm-12\\':!current.pubmedId }\\\"><ul class=\\\"list-group\\\"><li ng-repeat=\\\"field in fields\\\" ng-if=\\\"current[field.value]\\\" class=\\\"list-group-item\\\">{{field.label}}:<carre-linker model=\\\"current\\\" property=\\\"{{field.value}}\\\"></carre-linker></li></ul><a ng-href=\\\"{{rdf_source | trustAsResourceUrl}}\\\" target=\\\"_blank\\\" class=\\\"btn btn-default btn-xs pull-right\\\">View RDF source</a></div><div ng-if=\\\"current.pubmedId\\\" class=\\\"col-sm-6\\\"><carre-view-pubmed id=\\\"{{current.pubmedId}}\\\"></carre-view-pubmed></div></div><div ng-if=\\\"mode!==\\'view\\'\\\" class=\\\"carre-element-form\\\"><risk-element-form ng-if=\\\"type===\\'risk_element\\'&&(current.id||mode===\\'create\\')\\\" model=\\\"current\\\"></risk-element-form><risk-factor-form ng-if=\\\"type===\\'risk_factor\\'&&(current.id||mode===\\'create\\')\\\" model=\\\"current\\\"></risk-factor-form><risk-evidence-form ng-if=\\\"type===\\'risk_evidence\\'&&(current.id||mode===\\'create\\')\\\" model=\\\"current\\\"></risk-evidence-form><citation-form ng-if=\\\"type===\\'citation\\'&&(current.id||mode===\\'create\\')\\\" model=\\\"current\\\"></citation-form><measurement-type-form ng-if=\\\"type===\\'measurement_type\\'&&(current.id||mode===\\'create\\')\\\" model=\\\"current\\\"></measurement-type-form><observable-form ng-if=\\\"type===\\'observable\\'&&(current.id||mode===\\'create\\')\\\" model=\\\"current\\\"></observable-form></div></div>\");\n$templateCache.put(\"app/components/carre-element-controls/template.html\",\"<div class=\\\"well-sm\\\" ng-if=\\\"controls.user\\\"><a ng-show=\\\"\\'**.view\\'|includedByState\\\" class=\\\"btn btn-xs btn-primary\\\" ui-sref=\\\"^.edit({id:controls.carreId})\\\"><i class=\\\"fa fa-pencil\\\"></i> Edit</a> <a ng-show=\\\"\\'**.edit\\'|includedByState\\\" class=\\\"btn btn-xs btn-primary\\\" ui-sref=\\\"^.view({id:controls.carreId})\\\"><i class=\\\"fa fa-eye\\\"></i> View</a> <span ng-if=\\\"controls.dev&&controls.carreId\\\"><a class=\\\"btn btn-xs btn-danger\\\" href=\\\"\\\" ng-click=\\\"main.deleteCurrent(controls.carreId)\\\"><i class=\\\"fa fa-trash-o\\\"></i> Delete</a> <span class=\\\"badge\\\">{{controls.carreId}}</span></span></div>\");\n$templateCache.put(\"app/components/footer/footer.html\",\"<footer class=\\\"footer\\\" style=\\\"height:60px;padding:10px\\\"><div class=\\\"col-xs-6\\\"><span style=\\\"padding-left:10px\\\"><a href=\\\"//www.carre-project.eu\\\" target=\\\"_blank\\\"><img src=\\\"assets/images/CARRE-FooterLogo.png\\\" width=\\\"36\\\" height=\\\"40\\\" alt=\\\"CARRE\\\">&nbsp;CARRE Project  2015</a></span></div><div class=\\\"col-xs-6\\\"><span class=\\\"pull-right\\\" style=\\\"padding-right:10px\\\">CARRE project is partly funded by the EC under the grant no. FP7-ICT-611140.&nbsp; <a href=\\\"//cordis.europa.eu/\\\" target=\\\"_blank\\\"><img src=\\\"assets/images/Picture1-150x150.png\\\" width=\\\"40\\\" height=\\\"40\\\" alt=\\\"EU\\\"></a></span></div></footer>\");\n$templateCache.put(\"app/components/graph-chord/template.html\",\"<div cg-busy=\\\"loading\\\"><carre-graph-controls selected-id=\\\"selectedId\\\" disable-options=\\\"{showRiskEvidences:true,onlyPath:true}\\\" enable-rotation=\\\"true\\\" rotation=\\\"rotation\\\" refresh=\\\"init()\\\" add-size=\\\"addSize()\\\" remove-size=\\\"removeSize()\\\" navigate=\\\"goToSelected()\\\" expand=\\\"addNodeRelations()\\\" clear=\\\"deleteSelected()\\\"></carre-graph-controls><div id=\\\"chord\\\" class=\\\"carre-graph\\\"></div></div>\");\n$templateCache.put(\"app/components/graph-controls/template.html\",\"<div class=\\\"carre-graph-controls\\\"><div class=\\\"col-xs-6 col-sm-7 col-md-5\\\"><div ng-show=\\\"selectedId\\\" class=\\\"panel panel-xs panel-default\\\" style=\\\"margin:0;position:absolute;z-index:4\\\"><div class=\\\"panel-heading\\\" style=\\\"padding-top:0;padding-bottom:0;padding-left:0;\\\"><button ng-show=\\\"!showDetails\\\" style=\\\"background:none\\\" ng-click=\\\"showDetails=!showDetails\\\" class=\\\"btn btn-sm\\\"><i class=\\\"fa fa-caret-square-o-down\\\"></i> Show details</button> <button ng-show=\\\"showDetails\\\" ng-click=\\\"showDetails=!showDetails\\\" class=\\\"btn btn-sm\\\"><i class=\\\"fa fa-caret-square-o-up\\\"></i> Hide details</button> <span class=\\\"hidden-xs\\\"><strong>{{controls.getType(controls.selectedId).label}}</strong></span> <button ng-click=\\\"controls.navigate({})\\\" class=\\\"btn btn-xs btn-primary\\\" title=\\\"Navigate\\\"><i class=\\\"fa fa-link\\\"></i></button> <button ng-show=\\\"controls.selectedId && controls.selectedId.indexOf(\\'RL\\')>=0\\\" title=\\\"Expand\\\" ng-click=\\\"controls.expand({id:controls.selectedId})\\\" class=\\\"btn btn-xs btn-info\\\"><i class=\\\"fa fa-share-alt\\\"></i></button> <button ng-show=\\\"controls.selectedId && controls.selectedId.indexOf(\\'RL\\')>=0\\\" title=\\\"Remove from graph\\\" ng-click=\\\"controls.clear({})\\\" class=\\\"btn btn-xs btn-danger\\\"><i class=\\\"fa fa-remove\\\"></i></button></div><div class=\\\"panel-body\\\" ng-if=\\\"showDetails&&controls.selectedId\\\"><carre-element elem-id=\\\"{{controls.selectedId}}\\\" mode=\\\"view\\\" not-fields=\\\"has_author,has_reviewer\\\" hide-pubmed=\\\"true\\\"></carre-element></div></div></div><div class=\\\"col-xs-6 col-sm-5 col-md-5 col-md-offset-2 text-right\\\"><div ng-if=\\\"controls.enableRotation\\\" class=\\\"btn-group\\\"><button ng-click=\\\"controls.rotation=controls.rotation-40\\\" class=\\\"btn btn-sm btn-default\\\"><i class=\\\"fa fa-chevron-left\\\"></i></button> <button class=\\\"btn btn-sm btn-default disabled\\\">ROTATE</button> <button ng-click=\\\"controls.rotation=controls.rotation+40\\\" class=\\\"btn btn-sm btn-default\\\"><i class=\\\"fa fa-chevron-right\\\"></i></button></div><div ng-hide=\\\"controls.disableOptions.showRiskEvidences&&controls.disableOptions.onlyPath\\\" class=\\\"btn-group\\\" uib-dropdown=\\\"\\\" is-open=\\\"status.isopen\\\"><button type=\\\"button\\\" class=\\\"btn btn-sm btn-default\\\" uib-dropdown-toggle=\\\"\\\">Options <span class=\\\"caret\\\"></span></button><ul uib-dropdown-menu=\\\"\\\" role=\\\"menu\\\"><li ng-hide=\\\"controls.disableOptions.showRiskEvidences\\\" role=\\\"menuitem\\\" style=\\\"width:180px\\\"><label class=\\\"carre-dropdown-checkbox\\\">Show Risk evidences <input type=\\\"checkbox\\\" ng-change=\\\"applyRefresh()\\\" ng-model=\\\"controls.showRiskEvidences\\\"></label></li><li ng-show=\\\"controls.showSlider\\\" role=\\\"menuitem\\\" style=\\\"width:180px\\\"><label style=\\\"width: 100%;\\\" class=\\\"carre-dropdown-checkbox\\\">Ratio filter<rzslider rz-slider-model=\\\"controls.ratioFilter.min\\\" rz-slider-high=\\\"controls.ratioFilter.max\\\" rz-slider-options=\\\"controls.slider_toggle.options\\\"></rzslider></label></li><li ng-hide=\\\"controls.disableOptions.onlyPath\\\" role=\\\"menuitem\\\" style=\\\"width:180px\\\"><label class=\\\"carre-dropdown-checkbox\\\">Show only path <input type=\\\"checkbox\\\" ng-change=\\\"applyRefresh()\\\" ng-model=\\\"controls.onlyPath\\\"></label></li></ul></div><button ng-click=\\\"controls.removeSize({})\\\" class=\\\"btn btn-sm btn-default\\\"><i class=\\\"fa fa-minus\\\"></i></button> <button ng-click=\\\"controls.addSize({})\\\" class=\\\"btn btn-sm btn-default\\\"><i class=\\\"fa fa-plus\\\"></i></button> <button ng-click=\\\"controls.refresh({})\\\" class=\\\"btn btn-sm btn-default\\\"><i class=\\\"fa fa-refresh\\\"></i></button></div></div>\");\n$templateCache.put(\"app/components/graph-network-d3/template.html\",\"<div cg-busy=\\\"loading\\\"><carre-graph-controls selected-id=\\\"selectedId\\\" only-path=\\\"onlyCore\\\" show-risk-evidences=\\\"showRiskEvidences\\\" refresh=\\\"init()\\\" add-size=\\\"addSize()\\\" remove-size=\\\"removeSize()\\\" navigate=\\\"goToSelected()\\\" expand=\\\"addNodeRelations()\\\" clear=\\\"deleteSelected()\\\"></carre-graph-controls><div id=\\\"network\\\" class=\\\"carre-graph\\\"></div></div>\");\n$templateCache.put(\"app/components/graph-network-vis/template.html\",\"<div cg-busy=\\\"loading\\\"><carre-graph-controls selected-id=\\\"selectedId\\\" only-path=\\\"onlyCore\\\" show-risk-evidences=\\\"showRiskEvidences\\\" refresh=\\\"init()\\\" add-size=\\\"addSize()\\\" remove-size=\\\"removeSize()\\\" navigate=\\\"goToSelected()\\\" expand=\\\"addNodeRelations()\\\" clear=\\\"deleteSelected()\\\"></carre-graph-controls><div id=\\\"network\\\" class=\\\"carre-graph\\\"></div></div>\");\n$templateCache.put(\"app/components/graph-sankey/template.html\",\"<div cg-busy=\\\"loading\\\"><carre-graph-controls selected-id=\\\"selectedId\\\" only-path=\\\"onlyCore\\\" disable-options=\\\"{onlyPath:true}\\\" show-risk-evidences=\\\"showRiskEvidences\\\" ratio-filter=\\\"ratioFilter\\\" refresh=\\\"init()\\\" add-size=\\\"addSize()\\\" remove-size=\\\"removeSize()\\\" navigate=\\\"goToSelected()\\\" expand=\\\"addNodeRelations()\\\" clear=\\\"deleteSelected()\\\"></carre-graph-controls><div id=\\\"sankey\\\" class=\\\"carre-graph\\\"></div></div>\");\n$templateCache.put(\"app/components/header/header.html\",\"<nav class=\\\"navbar navbar-default navbar-static-top\\\" role=\\\"navigation\\\" style=\\\"margin-bottom: 0\\\"><div class=\\\"navbar-header\\\"><button type=\\\"button\\\" class=\\\"navbar-toggle\\\" ng-click=\\\"toggleNavbar()\\\"><span class=\\\"sr-only\\\">Toggle navigation</span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span></button> <a class=\\\"navbar-brand\\\" href=\\\"/\\\"><img src=\\\"assets/images/carre_logo.png\\\" class=\\\"logo\\\" alt=\\\"CARRE\\\"> CARRE Risk entry system</a></div><header-notification></header-notification></nav>\");\n$templateCache.put(\"app/components/le_editor/le_editor.html\",\"<div class=\\\"alert alert-default alert-group\\\"><div class=\\\"form-inline\\\"><select ng-options=\\\"o.name as o.name for o in operators\\\" ng-model=\\\"group.operator\\\" class=\\\"form-control input-sm\\\"></select><a style=\\\"margin-left: 5px\\\" ng-click=\\\"addCondition()\\\" class=\\\"btn btn-sm btn-default\\\"><span class=\\\"glyphicon glyphicon-plus-sign\\\"></span> Add Condition</a> <a style=\\\"margin-left: 5px\\\" ng-click=\\\"addGroup()\\\" class=\\\"btn btn-sm btn-default\\\"><span class=\\\"glyphicon glyphicon-plus-sign\\\"></span> Add Group</a> <a ng-show=\\\"$parent.group\\\" style=\\\"margin-left: 5px\\\" ng-click=\\\"removeGroup()\\\" class=\\\"btn btn-sm btn-danger\\\"><span class=\\\"glyphicon glyphicon-minus-sign\\\"></span> Remove Group</a></div><div class=\\\"group-conditions\\\"><div ng-repeat=\\\"rule in group.rules track by $index| orderBy:\\'index\\'\\\" class=\\\"condition\\\"><div ng-switch=\\\"rule.hasOwnProperty(\\'group\\')\\\"><div ng-switch-when=\\\"true\\\"><le-editor observables=\\\"observables\\\" metypes=\\\"metypes\\\" group=\\\"rule.group\\\"></le-editor></div><div ng-switch-default=\\\"ng-switch-default\\\"><div class=\\\"form-inline\\\"><div class=\\\"row\\\" uib-collapse=\\\"!rule.hiddenData\\\"><div class=\\\"text-center\\\">loading <img src=\\\"assets/images/ajax-loader.gif\\\"></div></div><div class=\\\"row\\\" uib-collapse=\\\"rule.hiddenData\\\"><ui-select class=\\\"le-editor observables input-sm\\\" ng-model=\\\"rule.field\\\" theme=\\\"bootstrap\\\" ng-init=\\\"getMeasurementType(null, rule.field, rule)\\\" on-select=\\\"getMeasurementType($item, $model, rule)\\\"><ui-select-match placeholder=\\\"Select observable\\\">{{$select.selected.label||\\'Select Observable\\'}}</ui-select-match><ui-select-choices repeat=\\\"ob.value as ob in observables | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"ob.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><select ng-options=\\\"c.value as c.name for c in conditions | filter: {types:rule.datatype}\\\" ng-model=\\\"rule.condition\\\" class=\\\"form-control\\\"></select><div class=\\\"input-group\\\"><input ng-if=\\\"rule.datatype===\\'integer\\'\\\" style=\\\"margin-left: 5px; width:100px\\\" min=\\\"0\\\" type=\\\"number\\\" ng-model=\\\"rule.data\\\" class=\\\"form-control\\\"> <input ng-if=\\\"rule.datatype===\\'float\\'\\\" style=\\\"margin-left: 5px; width:100px\\\" type=\\\"number\\\" step=\\\"0.01\\\" min=\\\"0\\\" ng-model=\\\"rule.data\\\" class=\\\"form-control\\\"><select ng-if=\\\"rule.datatype===\\'enum\\'||rule.datatype===\\'boolean\\'\\\" style=\\\"margin-left: 5px\\\" ng-options=\\\"c.value as c.name for c in rule.dataoptions\\\" ng-model=\\\"rule.data\\\" class=\\\"form-control\\\"><option value=\\\"\\\">Select</option></select><span popover-trigger=\\\"mouseenter\\\" uib-popover=\\\"{{rule.unit_label}}\\\" class=\\\"input-group-addon\\\" ng-show=\\\"rule.unit\\\">{{rule.unit}}</span></div><a style=\\\"margin-left: 10px\\\" ng-click=\\\"removeCondition($index)\\\" class=\\\"btn btn-xs btn-danger\\\"><span class=\\\"glyphicon glyphicon-minus-sign\\\"></span></a></div></div></div></div><span style=\\\"margin: 0 15%;\\\" class=\\\"text-center label label-default\\\">{{(($index+1)!==group.rules.length?group.operator:\\\"\\\")}}</span></div></div></div>\");\n$templateCache.put(\"app/components/linker/linker.html\",\"<span><span ng-if=\\\"show===\\'links\\'\\\"><span ng-repeat=\\\"i in items\\\">&nbsp;<a href=\\\"/{{i.link | trustAsResourceUrl}}\\\">{{i.label}}</a><span ng-if=\\\"!$last\\\">,</span></span></span> <span ng-if=\\\"show===\\'external_link\\'\\\" ng-bind-html=\\\"external_link | trustAsResourceUrl\\\"></span> <span ng-if=\\\"show===\\'condition\\'\\\" ng-bind-html=\\\"label | trustAsResourceUrl\\\"></span> <span ng-if=\\\"show===\\'label\\'\\\">{{label}}</span></span>\");\n$templateCache.put(\"app/components/sidebar/sidebar.html\",\"<div class=\\\"navbar-default sidebar\\\" role=\\\"navigation\\\"><div class=\\\"sidebar-nav navbar-collapse collapse\\\"><ul class=\\\"nav in\\\" id=\\\"side-menu\\\"><li><a href=\\\"\\\" style=\\\"border:none; text-align:left;\\\" class=\\\"btn btn-default\\\" ng-click=\\\"showAbout=!showAbout\\\"><i class=\\\"fa fa-question-circle\\\"></i> Help</a></li><li><a ui-sref=\\\"main.dashboard\\\" ui-sref-active-if=\\\"main.dashboard\\\">Dashboard</a></li><li id=\\\"Explore\\\" ng-class=\\\"{active: Explore}\\\"><a href=\\\"\\\" ng-click=\\\"Explore=!Explore\\\">Explore<span class=\\\"fa arrow\\\"></span></a><ul class=\\\"nav nav-second-level\\\" uib-collapse=\\\"!Explore\\\"><li><a ui-sref=\\\"main.explore\\\" ui-sref-active-if=\\\"main.explore\\\">Explore risks</a></li><li><a target=\\\"_blank\\\" href=\\\"http://www.pubmed.gov\\\">Search PubMed</a></li></ul></li><li id=\\\"carreElements\\\" ng-class=\\\"{active: carreElements}\\\"><a href=\\\"\\\" ng-click=\\\"carreElements=!carreElements\\\">CARRE elements<span class=\\\"fa arrow\\\"></span></a><ul class=\\\"nav nav-second-level\\\" uib-collapse=\\\"!carreElements\\\"><li><a ui-sref=\\\"main.risk_factors.list\\\" ui-sref-active-if=\\\"main.risk_factors\\\">Risk Factors</a></li><li><a ui-sref=\\\"main.risk_evidences.list\\\" ui-sref-active-if=\\\"main.risk_evidences\\\">Risk Evidences</a></li><li><a ui-sref=\\\"main.risk_elements.list\\\" ui-sref-active-if=\\\"main.risk_elements\\\">Risk Elements</a></li><li><a ui-sref=\\\"main.observables.list\\\" ui-sref-active-if=\\\"main.observables\\\">Observables</a></li><li><a ui-sref=\\\"main.citations.list\\\" ui-sref-active-if=\\\"main.citations\\\">Citations</a></li><li><a ui-sref=\\\"main.measurement_types.list\\\" ui-sref-active-if=\\\"main.measurement_types\\\">Measurement Types</a></li></ul></li><li><a ui-sref=\\\"main.medical_experts.list\\\" ui-sref-active-if=\\\"main.medical_experts\\\">Medical experts</a></li></ul></div><div pageslide=\\\"\\\" ps-size=\\\"{{slideWidth}}px\\\" ps-open=\\\"showAbout\\\" ps-side=\\\"right\\\"><div class=\\\"row\\\" style=\\\"padding:30px; padding-top:15px; padding-bottom:0; margin-bottom:0;\\\"><a href=\\\"\\\" ng-click=\\\"showAbout=!showAbout\\\" class=\\\"btn btn-primary pull-left\\\"><i class=\\\"fa fa-times fa-lg\\\"></i></a></div><div class=\\\"row\\\" style=\\\"padding:50px; margin-top:0; padding-top:0; overflow: auto; height: 90%;\\\"><div autoscroll=\\\"\\\" ng-include=\\\"\\\" src=\\\"\\'app/about/about.html\\'\\\"></div></div></div></div>\");\n$templateCache.put(\"app/components/stats/stats.html\",\"<div class=\\\"col-lg-3 col-md-6\\\"><a ui-sref=\\\"{{goto}}\\\"><div class=\\\"panel\\\" ng-style=\\\"{\\'background-color\\':color}\\\"><div class=\\\"panel-heading\\\" style=\\\"color:white\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-3\\\"><i class=\\\"fa fa-{{type}} fa-5x\\\"></i></div><div class=\\\"col-xs-9 text-right\\\"><div class=\\\"huge\\\"><span count-to=\\\"{{number}}\\\" value=\\\"0\\\" duration=\\\"1\\\"></span></div><div>{{comments}}</div></div></div></div><div class=\\\"panel-footer\\\" style=\\\"color:black\\\"><span class=\\\"pull-left\\\"><b>{{title}}</b></span> <span class=\\\"pull-right\\\"><i class=\\\"fa fa-arrow-circle-right\\\"></i></span><div class=\\\"clearfix\\\"></div></div></div></a></div>\");\n$templateCache.put(\"app/components/view-pubmed/view-pubmed.html\",\"<div cg-busy=\\\"loading\\\" class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\">Article : {{id}} <a ng-href=\\\"http://www.ncbi.nlm.nih.gov/pubmed/{{id}}\\\" target=\\\"_blank\\\">link to PubMed</a></div><div class=\\\"panel-body\\\"><div style=\\\"white-space: pre-line; overflow-y: auto;\\\">{{pubmedArticle| trustAsResourceUrl}}</div></div></div>\");\n$templateCache.put(\"app/pages/citations/list.html\",\"<div class=\\\"col-xs-12\\\"><div cg-busy=\\\"citations.gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"citations.mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div>\");\n$templateCache.put(\"app/pages/citations/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Citations <a ng-hide=\\\"\\'main.citations.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.citations.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a> <a ng-hide=\\\"(\\'main.citations.create\\' | isState) ||(\\'main.citations.createWithId\\' | isState) || !main.user.username\\\" class=\\\"btn btn-sm btn-primary\\\" ui-sref=\\\"main.citations.create\\\"><i class=\\\"fa fa-plus\\\"></i> <b>Create new</b></a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/pages/dashboard/index.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-lg-12\\\"><h2 class=\\\"page-header\\\">Dashboard</h2></div></div><div class=\\\"row\\\"><div class=\\\"col-lg-6 col-md-6\\\"><p id=\\\"intro-risk-model\\\" class=\\\"text-center\\\"><img style=\\\"width:100%; height:100%\\\" src=\\\"assets/images/model.jpg\\\"></p></div><div class=\\\"col-lg-6 col-md-6\\\"><canvas id=\\\"intro-stats\\\" height=\\\"210%\\\" class=\\\"chart chart-bar chart-sm\\\" chart-data=\\\"dashboard.counterchart_data\\\" chart-labels=\\\"dashboard.counterchart_labels\\\" chart-options=\\\"dashboard.counterchart_options\\\"></canvas></div></div><div class=\\\"row\\\"><hr></div><div class=\\\"row\\\"><stats id=\\\"intro-box-risk-factors\\\" goto=\\\"main.risk_factors.list\\\" title=\\\"Risk Factors\\\" number=\\\"{{dashboard.risk_factors.total||0}}\\\" comments=\\\"{{dashboard.risk_factors.noreviews||0}} unreviewed!\\\" color=\\\"{{dashboard.colors[0]}}\\\" type=\\\"info\\\"></stats><stats id=\\\"intro-box-risk-evidences\\\" goto=\\\"main.risk_evidences.list\\\" title=\\\"Risk Evidences\\\" number=\\\"{{dashboard.risk_evidences.total||0}}\\\" comments=\\\"{{dashboard.risk_evidences.noreviews||0}} unreviewed!\\\" color=\\\"{{dashboard.colors[1]}}\\\" type=\\\"info\\\"></stats><stats goto=\\\"main.risk_elements.list\\\" title=\\\"Risk Elements\\\" number=\\\"{{dashboard.risk_elements.total||0}}\\\" comments=\\\"{{dashboard.risk_elements.noreviews||0}} unreviewed!\\\" color=\\\"{{dashboard.colors[2]}}\\\" type=\\\"info\\\"></stats><stats goto=\\\"main.observables.list\\\" title=\\\"Observables\\\" number=\\\"{{dashboard.observables.total||0}}\\\" comments=\\\"{{dashboard.observables.noreviews||0}} unreviewed!\\\" color=\\\"{{dashboard.colors[3]}}\\\" type=\\\"info\\\"></stats><stats goto=\\\"main.citations.list\\\" title=\\\"Citations\\\" number=\\\"{{dashboard.citations.total||0}}\\\" comments=\\\"\\\" color=\\\"{{dashboard.colors[4]}}\\\" type=\\\"info\\\"></stats></div></div>\");\n$templateCache.put(\"app/pages/explore/index.html\",\"<div><div class=\\\"row\\\" ng-hide=\\\"showOnlyGraph\\\"><div class=\\\"col-lg-12\\\"><h2 class=\\\"page-header\\\">Explore <small></small></h2></div></div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><div class=\\\"row\\\" ng-hide=\\\"showOnlyGraph\\\"><div class=\\\"col-sm-9\\\"><div class=\\\"form-group\\\"><label>Graph search by risk elements</label><ui-select multiple=\\\"\\\" ng-model=\\\"explore.risk_elements_selected\\\" theme=\\\"bootstrap\\\" style=\\\"width:100%\\\" on-select=\\\"refreshColors()\\\" on-remove=\\\"refreshColors()\\\"><ui-select-match placeholder=\\\"Select...\\\">{{$item.label}}</ui-select-match><ui-select-choices repeat=\\\"el.value as el in explore.risk_elements | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"el.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div style=\\\"margin-top:5px\\\"><div class=\\\"btn-group\\\"><button ng-click=\\\"explore.risk_elements_selected=[];\\\" class=\\\"btn btn-sm btn-default\\\">Reset</button> <button ng-click=\\\"explore.setNewId()\\\" ng-disabled=\\\"explore.risk_elements_selected.length===0\\\" class=\\\"btn btn-sm btn-primary\\\">Search</button></div><div class=\\\"btn-group\\\"><div class=\\\"btn-group\\\" uib-dropdown=\\\"\\\"><button id=\\\"single-button\\\" type=\\\"button\\\" class=\\\"btn btn-sm btn-default\\\" uib-dropdown-toggle=\\\"\\\" ng-disabled=\\\"disabled\\\"><i class=\\\"fa fa-youtube-play\\\"></i> Examples <span class=\\\"caret\\\"></span></button><ul uib-dropdown-menu=\\\"\\\" role=\\\"menu\\\" aria-labelledby=\\\"single-button\\\"><li role=\\\"menuitem\\\" ng-repeat=\\\"ex in explore.examples\\\"><a href=\\\"\\\" ng-click=\\\"runExample(ex.data)\\\">{{ex.label}}</a></li></ul></div><button popover-is-open=\\\"explore.popover_open\\\" ng-disabled=\\\"explore.risk_elements_selected.length===0\\\" popover-placement=\\\"bottom\\\" uib-popover-template=\\\"explore.recommendPopoverUrl\\\" popover-title=\\\"Recommend example\\\" type=\\\"button\\\" class=\\\"btn btn-sm btn-default\\\"><i class=\\\"fa fa-bookmark\\\"></i> Recommend</button></div></div></div></div><div class=\\\"col-sm-3\\\"><label for=\\\"visualization_type\\\">Visualization type</label><select id=\\\"visualization_type\\\" class=\\\"form-control\\\" ng-model=\\\"explore.graph_type\\\"><option value=\\\"network\\\">Network graph</option><option ng-if=\\\"main.config.ENV===\\'DEV\\'\\\" value=\\\"network-d3\\\">Network graph d3</option><option value=\\\"sankey\\\">Sankey graph</option><option value=\\\"chord\\\">Chord graph</option></select></div></div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><carre-graph-sankey-risk ng-if=\\\"explore.graph_type===\\'sankey\\' && explore.ready\\\" riskid=\\\"explore.id\\\"></carre-graph-sankey-risk><carre-graph-chord-risk ng-if=\\\"explore.graph_type===\\'chord\\' && explore.ready\\\" riskid=\\\"explore.id\\\"></carre-graph-chord-risk><carre-graph-risk ng-if=\\\"explore.graph_type===\\'network\\' && explore.ready\\\" riskid=\\\"explore.id\\\"></carre-graph-risk><carre-graph-network-d3 ng-if=\\\"explore.graph_type===\\'network-d3\\' && explore.ready\\\" riskid=\\\"explore.id\\\"></carre-graph-network-d3></div></div></div></div></div><script type=\\\"text/ng-template\\\" id=\\\"recommendExampleTemplate.html\\\"><div class=\\\"form-group\\\"> <label>Add a description for your example</label> <textarea ng-model=\\\"exampleDesc\\\" style=\\\"width:400px\\\" class=\\\"form-control\\\"></textarea> <hr> <div> <a href=\\\"\\\" ng-click=\\\"explore.popover_open=false;\\\" class=\\\"btn btn-default\\\"> Cancel </a> <a href=\\\"\\\" ng-click=\\\"explore.recommendExample(exampleDesc);explore.popover_open=false;\\\" class=\\\"btn btn-primary\\\"> Send </a> </div> </div></script>\");\n$templateCache.put(\"app/pages/explore/mine-literature.html\",\"<div><div class=\\\"row\\\" ng-hide=\\\"showOnlyGraph\\\"><div class=\\\"col-lg-12\\\"><h2 class=\\\"page-header\\\">Mine Literature</h2></div></div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><div class=\\\"row\\\"><iframe style=\\\"border:0 none; width:100%;height:700px\\\" id=\\\"mine-literature-iframe\\\" src=\\\"https://visual.duth.carre-project.eu/static/academy/list.html\\\" frameborder=\\\"0\\\" hspace=\\\"0\\\" vspace=\\\"0\\\" marginheight=\\\"0\\\" marginwidth=\\\"0\\\"></iframe></div></div></div></div>\");\n$templateCache.put(\"app/pages/measurement_types/list.html\",\"<div class=\\\"col-xs-12\\\"><div cg-busy=\\\"measurement_types.gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"measurement_types.mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div>\");\n$templateCache.put(\"app/pages/measurement_types/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Measurement Types <a ng-hide=\\\"\\'main.measurement_types.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.measurement_types.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a> <a ng-hide=\\\"(\\'main.measurement_types.create\\' | isState) || !main.user.username\\\" class=\\\"btn btn-sm btn-primary\\\" ui-sref=\\\"main.measurement_types.create\\\"><i class=\\\"fa fa-plus\\\"></i> <b>Create new</b></a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/pages/medical_experts/list.html\",\"<div class=\\\"col-xs-12\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-6 col-lg-4\\\" ng-repeat=\\\"item in medical_experts.users track by $index| orderBy:\\'$index\\'\\\"><div class=\\\"panel panel-default\\\" style=\\\"height:300px\\\"><div class=\\\"panel-heading\\\"><a href=\\\"\\\" ui-sref=\\\"main.medical_experts.view({id:item.id_label})\\\">{{item.has_firstname_label}} {{item.has_lastname_label}}, {{item.has_educational_degree_label}}</a><div class=\\\"box-tools pull-right\\\"><a href=\\\"\\\" ui-sref=\\\"main.medical_experts.view({id:item.id_label})\\\">View profile</a></div></div><div class=\\\"panel-body\\\" style=\\\"height:220px\\\"><ul style=\\\"padding-left:5px\\\"><li style=\\\"list-style-type: none; margin-top:10px\\\" ng-repeat=\\\"pos in item.has_medical_position\\\"><i class=\\\"fa fa-angle-right fa-lg fa-x2\\\"></i> {{ pos}}</li></ul></div><div class=\\\"panel-footer\\\" style=\\\"padding-bottom:26px\\\"><span style=\\\"float:left\\\"><span ng-if=\\\"item.is_coordinator_of_team\\\"><b>Coordinator</b></span></span> <span style=\\\"float:right\\\">{{item.has_team_name[0]}} Team</span></div></div></div></div></div>\");\n$templateCache.put(\"app/pages/medical_experts/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Medical Experts <a ng-hide=\\\"\\'main.medical_experts.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.medical_experts.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/pages/observables/list.html\",\"<div class=\\\"col-xs-12\\\"><div cg-busy=\\\"observables.gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"observables.mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div>\");\n$templateCache.put(\"app/pages/observables/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Observables <a ng-hide=\\\"\\'main.observables.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.observables.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a> <a ng-hide=\\\"(\\'main.observables.create\\' | isState) || !main.user.username\\\" class=\\\"btn btn-sm btn-primary\\\" ui-sref=\\\"main.observables.create\\\"><i class=\\\"fa fa-plus\\\"></i> <b>Create new</b></a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/pages/risk_elements/list.html\",\"<div class=\\\"col-xs-12\\\"><div cg-busy=\\\"risk_elements.gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"risk_elements.mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div>\");\n$templateCache.put(\"app/pages/risk_elements/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Risk elements <a ng-hide=\\\"\\'main.risk_elements.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.risk_elements.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a> <a ng-hide=\\\"(\\'main.risk_elements.create\\' | isState) || !main.user.username\\\" class=\\\"btn btn-sm btn-primary\\\" ui-sref=\\\"main.risk_elements.create\\\"><i class=\\\"fa fa-plus\\\"></i> <b>Create new</b></a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/pages/risk_evidences/list.html\",\"<div class=\\\"col-xs-12\\\"><div cg-busy=\\\"risk_evidences.gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"risk_evidences.mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div><div pageslide=\\\"\\\" ps-size=\\\"640px\\\" ps-open=\\\"risk_evidences.selectedRisk_evidence\\\" ps-side=\\\"right\\\"><div cg-busy=\\\"risk_evidences.loading\\\" style=\\\"padding:10px;\\\"><a ui-sref=\\\"main.risk_evidences.view({id:risk_evidences.selectedRisk_evidence})\\\" class=\\\"btn btn-primary\\\">Profile</a> <a href=\\\"\\\" ng-click=\\\"risk_evidences.setPubmed()\\\" class=\\\"btn btn-primary\\\"><i class=\\\"fa fa-times fa-lg\\\"></i></a><br><br><div ng-if=\\\"risk_evidences.selectedRisk_evidence\\\"><div ng-if=\\\"risk_evidences.pubmedApi\\\" style=\\\"white-space: pre-line; overflow-y: auto;height: 95%; width:620px; position: fixed;\\\" ng-bind-html=\\\"risk_evidences.pubmedArticle\\\"></div><iframe ng-if=\\\"!risk_evidences.pubmedApi\\\" style=\\\"border:none; position: fixed; height:90%; width:620px\\\" height=\\\"90%\\\" width=\\\"620px\\\" src=\\\"{{\\'http://www.ncbi.nlm.nih.gov/pubmed/\\'+risk_evidences.selectedRisk_evidence | trustAsResourceUrl}}\\\"></iframe></div></div></div>\");\n$templateCache.put(\"app/pages/risk_evidences/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Risk evidences <a ng-hide=\\\"\\'main.risk_evidences.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.risk_evidences.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a> <a ng-hide=\\\"(\\'main.risk_evidences.create\\' | isState) || !main.user.username\\\" class=\\\"btn btn-sm btn-primary\\\" ui-sref=\\\"main.risk_evidences.create\\\"><i class=\\\"fa fa-plus\\\"></i> <b>Create new</b></a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/pages/risk_factors/list.html\",\"<div class=\\\"col-xs-12\\\"><div cg-busy=\\\"risk_factors.gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"risk_factors.mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div>\");\n$templateCache.put(\"app/pages/risk_factors/main.html\",\"<div><div class=\\\"row\\\"><div class=\\\"col-xs-12\\\"><h2 class=\\\"page-header\\\">Risk factors <a ng-hide=\\\"\\'main.risk_factors.list\\' | isState\\\" class=\\\"btn btn-sm btn-default\\\" ui-sref=\\\"main.risk_factors.list\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</a> <a ng-hide=\\\"(\\'main.risk_factors.create\\' | isState) || !main.user.username\\\" class=\\\"btn btn-sm btn-primary\\\" ui-sref=\\\"main.risk_factors.create\\\"><i class=\\\"fa fa-plus\\\"></i> <b>Create new</b></a></h2></div></div><div class=\\\"row\\\" ui-view=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/components/header/header-notification/header-notification.html\",\"<ul class=\\\"nav navbar-top-links navbar-right\\\"><li style=\\\"position: relative;top: 10px;\\\"><toggle-switch ng-show=\\\"main.config.ENV===\\'DEV\\'\\\" ng-model=\\\"main.DEBUG\\\" knob-label=\\\"Debug\\\"><toggle-switch></toggle-switch></toggle-switch></li><li ng-show=\\\"main.user.username\\\" class=\\\"dropdown\\\" uib-dropdown=\\\"\\\"><a href=\\\"\\\" uib-dropdown-toggle=\\\"\\\">Hi {{main.user.username}} <i class=\\\"fa fa-user fa-fw\\\"></i> <i class=\\\"fa fa-caret-down\\\"></i></a><ul class=\\\"uib-dropdown-menu\\\"><li><a ng-href=\\\"{{main.settingsUrl}}\\\" target=\\\"_blank\\\"><i class=\\\"fa fa-gear fa-fw\\\"></i> Settings</a></li><li><a ng-href=\\\"{{main.passwordUrl}}\\\"><i class=\\\"fa fa-user fa-fw\\\"></i> Change password</a></li><li class=\\\"divider\\\"></li><li><a id=\\\"logoutUrl\\\" ng-href=\\\"{{main.logoutUrl}}{{pathname}}\\\"><i class=\\\"fa fa-sign-out fa-fw\\\"></i> Logout</a></li></ul></li><li ng-hide=\\\"main.user.username\\\"><a id=\\\"loginUrl\\\" ng-href=\\\"{{main.loginUrl}}{{pathname}}\\\">Hello Guest, Login<i class=\\\"fa fa-sign-in fa-fw\\\"></i></a></li></ul>\");\n$templateCache.put(\"app/components/sidebar/sidebar-search/sidebar-search.html\",\"<li class=\\\"sidebar-search\\\"><div class=\\\"input-group custom-search-form\\\"><input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"Search...\\\"> <span class=\\\"input-group-btn\\\"><button class=\\\"btn btn-default\\\" type=\\\"button\\\"><i class=\\\"fa fa-search\\\"></i></button></span></div></li>\");\n$templateCache.put(\"app/pages/citations/form_component/form.html\",\"<div><div ng-class=\\\"{\\'col-sm-6\\':!noPubmed}\\\"><form name=\\\"form\\\" ng-submit=\\\"saveModel()\\\"><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><span ng-show=\\\"loadingElementIdentifier\\\" class=\\\"loadingSelect\\\"></span> <label>Evidence source (Pubmed ID)</label> <span class=\\\"badge badge-default\\\">{{pubmedAutocompleteResultsCount}} Result(s)</span><ui-select on-select=\\\"selectPubmed($item,$model)\\\" class=\\\"ui-select-big-text\\\" ng-model=\\\"citation.pubmedId\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Enter Pubmed ID\\\"><div>{{$select.selected.title}}</div><div>{{$select.selected.authorString}}</div><div>{{$select.selected.source}} - {{$select.selected.pubYear}}</div></ui-select-match><ui-select-choices style=\\\"max-height: 500px;\\\" repeat=\\\"obj.pmid as obj in pubmedAutocompleteResults | propsFilter: { title: $select.search, authorString: $select.search, source: $select.search, pmid: $select.search, pubYear: $select.search }\\\" refresh=\\\"searchPubmed($select.search)\\\" refresh-delay=\\\"1000\\\"><div class=\\\"ui-select-big-text\\\"><div ng-bind-html=\\\"obj.title | highlight: $select.search\\\"></div><div><small ng-bind-html=\\\"obj.authorString | highlight: $select.search\\\"></small></div><div><small ng-bind-html=\\\"obj.source | highlight: $select.search\\\"></small> / <small ng-bind-html=\\\"obj.pubYear | highlight: $select.search\\\"></small> / <small ng-bind-html=\\\"obj.pmid | highlight: $select.search\\\"></small></div></div></ui-select-choices></ui-select></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Citation summary</label> <textarea class=\\\"form-control\\\" rows=\\\"6\\\" ng-model=\\\"citation.summary\\\"></textarea></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Study type</label><ui-select ng-model=\\\"citation.studyType\\\" limit=\\\"1\\\" multiple=\\\"\\\" tagging=\\\"\\\" tagging-label=\\\"(add new type)\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select study type\\\">{{$item}}</ui-select-match><ui-select-choices repeat=\\\"type in types | filter: $select.search\\\"><div ng-bind-html=\\\"type | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Study Level</label> <input type=\\\"number\\\" min=\\\"1\\\" max=\\\"4\\\" class=\\\"form-control\\\" ng-model=\\\"citation.level\\\"></div><div class=\\\"form-group\\\"><button type=\\\"button\\\" ng-click=\\\"cancelForm()\\\" class=\\\"btn btn-danger\\\">Cancel</button> <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Submit</button></div></form></div><div ng-hide=\\\"noPubmed||!showPubmed\\\" class=\\\"col-sm-6\\\"><label>Pubmed Viewer</label><carre-view-pubmed ng-if=\\\"showPubmed\\\" id=\\\"{{citation.pubmedId}}\\\"></carre-view-pubmed></div></div>\");\n$templateCache.put(\"app/pages/citations/single/single.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current citation<pre>{{citation | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><carre-element-controls carre-id=\\\"{{id}}\\\"></carre-element-controls><carre-element ng-if=\\\"mode\\\" type=\\\"citation\\\" elem-id=\\\"{{id}}\\\" mode=\\\"{{mode}}\\\" elem=\\\"current\\\"></carre-element></div>\");\n$templateCache.put(\"app/pages/measurement_types/form_component/form.html\",\"<div><form name=\\\"form\\\" novalidate=\\\"\\\" ng-submit=\\\"saveModel()\\\"><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.name.$touched && form.name.$invalid }\\\"><label>Name</label> <input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"e.g filtration rate\\\" class=\\\"form-control\\\" ng-model=\\\"measurement_type.name\\\" required=\\\"\\\"><div class=\\\"help-block\\\" ng-messages=\\\"form.name.$error\\\" ng-if=\\\"form.name.$touched\\\"><p ng-message=\\\"required\\\">Name is required.</p></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Date type</label><ui-select ng-model=\\\"measurement_type.datatype\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select datatype\\\">{{$select.selected}}</ui-select-match><ui-select-choices repeat=\\\"type in datatypes\\\"><div ng-bind-html=\\\"type | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-if=\\\"measurement_type.datatype===\\'integer\\' || measurement_type.datatype===\\'float\\'\\\" ng-class=\\\"{ \\'has-error\\': form.unit.$touched && form.unit.$invalid }\\\"><label>Unit</label> <input type=\\\"text\\\" name=\\\"unit\\\" placeholder=\\\"e.g ml/min/1.73 m^2\\\" class=\\\"form-control\\\" ng-model=\\\"measurement_type.unit\\\" required=\\\"\\\"><div class=\\\"help-block\\\" ng-messages=\\\"form.unit.$error\\\" ng-if=\\\"form.unit.$touched\\\"><p ng-message=\\\"required\\\">Unit is required.</p></div></div><div class=\\\"form-group\\\" ng-if=\\\"measurement_type.datatype===\\'enum\\'\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Values</label><ui-select multiple=\\\"\\\" tagging=\\\"\\\" tagging-label=\\\"(custom \\'new\\' value)\\\" ng-model=\\\"measurement_type.values\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select values...\\\">{{$item}}</ui-select-match><ui-select-choices repeat=\\\"val in []\\\">{{val}}</ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-if=\\\"measurement_type.datatype===\\'boolean\\'\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Values</label><ui-select multiple=\\\"\\\" limit=\\\"2\\\" tagging=\\\"\\\" tagging-label=\\\"(custom \\'new\\' value)\\\" ng-model=\\\"measurement_type.values\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select values...\\\">{{$item}}</ui-select-match><ui-select-choices repeat=\\\"val in [\\'yes\\',\\'no\\']\\\">{{val}}</ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Semantic annotation for \\\"{{measurement_type.name||\\'e.g age\\'}}\\\"</label><div class=\\\"alert alert-warning\\\" style=\\\"margin-bottom: 0\\\">{{measurement_type.identifier}}</div><uib-accordion close-others=\\\"true\\\"><uib-accordion-group><uib-accordion-heading><span uib-popover=\\\"Units of Measurement Ontology by Bioportal\\\" popover-trigger=\\\"mouseenter\\\">UO ontology</span><div ng-show=\\\"loadingElementIdentifier\\\" class=\\\"loadingSelect\\\"></div></uib-accordion-heading><ui-select ng-model=\\\"measurement_type.identifier\\\" theme=\\\"bootstrap\\\"><ui-select-match allow-clear=\\\"true\\\" placeholder=\\\"Search...\\\">{{$select.selected.label}} - {{$select.selected.value | sliceLast:\\'/\\' }}</ui-select-match><ui-select-choices repeat=\\\"elem.value as elem in bioportalAutocompleteResults | propsFilter: {label: $select.search}\\\" refresh=\\\"bioportalAutocomplete($select.search)\\\" refresh-delay=\\\"500\\\"><div ng-bind-html=\\\"elem.label | highlight: $select.search\\\"></div><small>{{elem.value}}</small></ui-select-choices></ui-select></uib-accordion-group><uib-accordion-group heading=\\\"Custom\\\"><input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"e.g {{measurement_type.name}}\\\" class=\\\"form-control\\\" ng-change=\\\"transformItem(customIdentifier)\\\" ng-model=\\\"customIdentifier\\\"></uib-accordion-group></uib-accordion></div><div class=\\\"form-group\\\"><button type=\\\"button\\\" ng-click=\\\"cancelForm()\\\" class=\\\"btn btn-danger\\\">Cancel</button> <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Submit</button></div></form></div>\");\n$templateCache.put(\"app/pages/measurement_types/single/single.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current measurement_type<pre>{{measurement_type | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><carre-element-controls carre-id=\\\"{{id}}\\\"></carre-element-controls><carre-element type=\\\"measurement_type\\\" elem-id=\\\"{{id}}\\\" mode=\\\"{{mode}}\\\"></carre-element></div>\");\n$templateCache.put(\"app/pages/medical_experts/single/view.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current medical_expert<pre>{{medical_expert | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><div class=\\\"col-sm-6\\\"><div ng-show=\\\"main.user.username && main.config.ENV===\\'DEV\\'\\\">ID: <b>{{medical_expert.id}}</b> <a class=\\\"btn btn-xs btn-danger\\\" href=\\\"\\\" ng-click=\\\"medical_expert.deleteCurrent()\\\"><i class=\\\"fa fa-trash-o\\\"></i> Delete</a></div><div class=\\\"thumbnail\\\" style=\\\"display: inline-block;\\\"><img class=\\\"avatar-img\\\" ng-src=\\\"{{medical_expert.current.has_avatar[0]}}\\\"></div><ul class=\\\"list-group\\\"><li class=\\\"list-group-item\\\">Name: <b>{{medical_expert.current.has_firstname_label}} {{medical_expert.current.has_lastname_label}}, {{medical_expert.current.has_educational_degree_label}}</b></li><li class=\\\"list-group-item\\\">Medical specialty: <b><a target=\\\"_blank\\\" ng-href=\\\"{{medical_expert.current.has_medical_specialty_link}}\\\">{{medical_expert.current.has_medical_specialty_label}}</a></b></li><li class=\\\"list-group-item\\\">Medical Positions:<ul style=\\\"padding-left:5px\\\"><li style=\\\"list-style-type: none;\\\" ng-repeat=\\\"pos in medical_expert.current.has_medical_position\\\"><b><i class=\\\"fa fa-angle-right fa-lg fa-x2\\\"></i> {{ pos}}</b></li></ul></li><li ng-if=\\\"medical_expert.current.has_short_cv.length>1\\\" class=\\\"list-group-item\\\">Short CV: <b>{{medical_expert.current.has_short_cv}}</b></li><li ng-if=\\\"medical_expert.current.has_personal_page_url\\\" class=\\\"list-group-item\\\">More details: <b><a target=\\\"_blank\\\" ng-href=\\\"{{medical_expert.current.has_personal_page_url[0]}}\\\">link</a></b></li><li ng-if=\\\"medical_expert.current.is_coordinator_of_team\\\" class=\\\"list-group-item\\\">Coordinator: <b>{{medical_expert.current.is_coordinator_of_team[0]}} team</b></li><li ng-if=\\\"!medical_expert.current.is_coordinator_of_team\\\" class=\\\"list-group-item\\\">Team: <b>{{medical_expert.current.has_team_name[0]}}</b></li><b></b><hr></ul></div><div class=\\\"col-sm-6\\\"><canvas height=\\\"170%\\\" class=\\\"chart chart-bar chart-sm\\\" chart-legend=\\\"true\\\" chart-data=\\\"medical_expert.counterchart_data\\\" chart-series=\\\"medical_expert.counterchart_series\\\" chart-labels=\\\"medical_expert.counterchart_labels\\\" chart-options=\\\"medical_expert.counterchart_options\\\"></canvas></div></div>\");\n$templateCache.put(\"app/pages/observables/form_component/form.html\",\"<div><form name=\\\"form\\\" novalidate=\\\"\\\" ng-submit=\\\"saveModel()\\\"><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.name.$touched && form.name.$invalid }\\\"><label>Name</label> <input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"e.g glucose tolerance test\\\" class=\\\"form-control\\\" ng-model=\\\"observable.name\\\" required=\\\"\\\"><div class=\\\"help-block\\\" ng-messages=\\\"form.name.$error\\\" ng-if=\\\"form.name.$touched\\\"><p ng-message=\\\"required\\\">Name is required.</p></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Type</label><ui-select ng-model=\\\"observable.type\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select observable type\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"type.value as type in types | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"type.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Measurement type</label><ui-select ng-model=\\\"observable.measurement_type\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select measurement type\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"obj.value as obj in measurement_types | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"obj.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\"><label>Semantic annotation for \\\"{{observable.name||\\'e.g age\\'}}\\\"</label><div class=\\\"alert alert-warning\\\" style=\\\"margin-bottom: 0\\\">{{observable.identifier}}</div><uib-accordion close-others=\\\"true\\\"><uib-accordion-group><uib-accordion-heading><span uib-popover=\\\"Clinical Measurement Ontology by Bioportal\\\" popover-trigger=\\\"mouseenter\\\">CMO ontology</span><div ng-show=\\\"loadingElementIdentifier\\\" class=\\\"loadingSelect\\\"></div></uib-accordion-heading><ui-select ng-model=\\\"observable.identifier\\\" theme=\\\"bootstrap\\\"><ui-select-match allow-clear=\\\"true\\\" placeholder=\\\"Search...\\\">{{$select.selected.label}} - {{$select.selected.value | sliceLast:\\'/\\' }}</ui-select-match><ui-select-choices repeat=\\\"elem.value as elem in bioportalAutocompleteResults | propsFilter: {label: $select.search}\\\" refresh=\\\"bioportalAutocomplete($select.search)\\\" refresh-delay=\\\"500\\\"><div ng-bind-html=\\\"elem.label | highlight: $select.search\\\"></div><small>{{elem.value}}</small></ui-select-choices></ui-select></uib-accordion-group><uib-accordion-group heading=\\\"Custom\\\"><input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"e.g {{observable.name}}\\\" class=\\\"form-control\\\" ng-change=\\\"transformIdentifier(customIdentifier)\\\" ng-model=\\\"customIdentifier\\\"></uib-accordion-group></uib-accordion></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Sensor annotation for \\\"{{observable.name||\\'e.g age\\'}}\\\"</label><div class=\\\"alert alert-warning\\\" style=\\\"margin-bottom: 0\\\">{{observable.predicate}}</div><uib-accordion close-others=\\\"true\\\"><uib-accordion-group><uib-accordion-heading><span uib-popover=\\\"CARRE Sensors ontology\\\" popover-trigger=\\\"mouseenter\\\">CARRE Sensors ontology</span><div ng-show=\\\"loadingElementIdentifier\\\" class=\\\"loadingSelect\\\"></div></uib-accordion-heading><ui-select on-select=\\\"transformPredicate(customPredicate)\\\" ng-model=\\\"customPredicate\\\" theme=\\\"bootstrap\\\"><ui-select-match allow-clear=\\\"true\\\" placeholder=\\\"Select from sensors ontology..\\\">{{$select.selected }}</ui-select-match><ui-select-choices repeat=\\\"elem in SensorPredicates | filter : $select.search\\\"><div ng-bind-html=\\\"elem | highlight: $select.search\\\"></div></ui-select-choices></ui-select></uib-accordion-group><uib-accordion-group heading=\\\"Custom\\\"><input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"Or type a custom name\\\" class=\\\"form-control\\\" ng-change=\\\"transformPredicate(customPredicate)\\\" ng-model=\\\"customPredicate\\\"></uib-accordion-group></uib-accordion></div><div class=\\\"form-group\\\"><button type=\\\"button\\\" ng-click=\\\"cancelForm()\\\" class=\\\"btn btn-danger\\\">Cancel</button> <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Submit</button></div></form></div>\");\n$templateCache.put(\"app/pages/observables/single/single.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current observable<pre>{{observable | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><carre-element-controls carre-id=\\\"{{id}}\\\"></carre-element-controls><carre-element type=\\\"observable\\\" elem-id=\\\"{{id}}\\\" mode=\\\"{{mode}}\\\"></carre-element></div>\");\n$templateCache.put(\"app/pages/risk_elements/form_component/form.html\",\"<div><form name=\\\"form\\\" novalidate=\\\"\\\" ng-submit=\\\"saveModel()\\\"><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.name.$touched && form.name.$invalid }\\\"><label>Name</label> <input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"Risk element name e.g acute kidney disease\\\" class=\\\"form-control\\\" ng-model=\\\"risk_element.name\\\" required=\\\"\\\"><div class=\\\"help-block\\\" ng-messages=\\\"form.name.$error\\\" ng-if=\\\"form.name.$touched\\\"><p ng-message=\\\"required\\\">Name is required.</p></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Modifiable status</label> <input type=\\\"checkbox\\\" ng-true-value=\\\"\\'yes\\'\\\" ng-false-value=\\\"\\'no\\'\\\" ng-model=\\\"risk_element.modifiable_status\\\"></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Type</label><ui-select ng-model=\\\"risk_element.type\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select risk element type\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"type.value as type in types | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"type.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Identifier</label><div ng-show=\\\"loadingElementIdentifier\\\" class=\\\"loadingSelect\\\"></div><ui-select ng-model=\\\"risk_element.identifier\\\" theme=\\\"bootstrap\\\"><ui-select-match style=\\\"min-width: 100px;\\\" placeholder=\\\"Search for CUI...\\\">{{$select.selected.label+\\' - \\'+$select.selected.value}}</ui-select-match><ui-select-choices repeat=\\\"elem.value as elem in bioportalAutocompleteResults | propsFilter: {label: $select.search}\\\" refresh=\\\"bioportalAutocomplete($select.search)\\\" refresh-delay=\\\"500\\\"><div ng-bind-html=\\\"elem.label | highlight: $select.search\\\"></div><small>{{elem.value}}</small></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Observables</label><ui-select multiple=\\\"\\\" ng-model=\\\"risk_element.observables\\\" theme=\\\"bootstrap\\\"><pre>{{$model| json}}</pre><ui-select-match placeholder=\\\"Select observables\\\">{{$item.label}}</ui-select-match><ui-select-choices repeat=\\\"ob.value as ob in observables | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"ob.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Include other risk elements</label><ui-select multiple=\\\"\\\" ng-model=\\\"risk_element.risk_elements\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select risk elements\\\">{{$item.label}}</ui-select-match><ui-select-choices repeat=\\\"el.value as el in risk_elements | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"el.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\"><button type=\\\"button\\\" ng-click=\\\"cancelForm()\\\" class=\\\"btn btn-danger\\\">Cancel</button> <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Submit</button></div></form></div>\");\n$templateCache.put(\"app/pages/risk_elements/single/single.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current risk_element<pre>{{risk_element | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><div class=\\\"col-sm-4\\\"><carre-element-controls carre-id=\\\"{{id}}\\\"></carre-element-controls><carre-element ng-if=\\\"mode\\\" type=\\\"risk_element\\\" elem-id=\\\"{{id}}\\\" mode=\\\"{{mode}}\\\"></carre-element></div><div class=\\\"col-sm-8\\\"><carre-graph-chord-risk ng-if=\\\"mode!==\\'create\\'\\\" height=\\\"400\\\" riskid=\\\"id\\\"></carre-graph-chord-risk></div></div>\");\n$templateCache.put(\"app/pages/risk_evidences/form_component/form.html\",\"<div><div class=\\\"col-sm-6\\\"><form name=\\\"form\\\" novalidate=\\\"\\\" ng-submit=\\\"saveModel()\\\"><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Risk factor</label><ui-select ng-model=\\\"risk_evidence.risk_factor\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select risk factor\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"rl.value as rl in risk_factors | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"rl.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Observables</label><ui-select multiple=\\\"\\\" ng-model=\\\"risk_evidence.observables\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select observables\\\">{{$item.label}}</ui-select-match><ui-select-choices repeat=\\\"ob.id as ob in observables | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"ob.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select></div><div class=\\\"form-group\\\"><label>Condition <a class=\\\"btn btn-xs btn-default\\\" ng-click=\\\"leEditEnabled=!leEditEnabled\\\"><span ng-if=\\\"!leEditEnabled\\\">Show editor <i class=\\\"fa fa-plus-square\\\"></i></span> <span ng-if=\\\"leEditEnabled\\\">Hide editor <i class=\\\"fa fa-minus-square\\\"></i></span></a></label><div><div class=\\\"alert alert-warning\\\" ng-bind-html=\\\"output | prettySigns\\\"></div></div><div uib-collapse=\\\"!leEditEnabled\\\"><le-editor ng-if=\\\"showLeEditor\\\" observables=\\\"observables\\\" metypes=\\\"metypes\\\" group=\\\"filter.group\\\"></le-editor></div></div><div class=\\\"row\\\"><div class=\\\"form-group col-sm-6\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Ratio value</label> <input type=\\\"number\\\" min=\\\"{{risk_evidence.confidence_interval_min||0}}\\\" max=\\\"{{risk_evidence.confidence_interval_max}}\\\" step=\\\"0.01\\\" class=\\\"form-control\\\" ng-model=\\\"risk_evidence.ratio_value\\\"></div><div class=\\\"form-group col-sm-6\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Confidence Interval Minimum</label> <input type=\\\"number\\\" step=\\\"0.01\\\" class=\\\"form-control\\\" min=\\\"0\\\" max=\\\"{{risk_evidence.confidence_interval_max}}\\\" ng-model=\\\"risk_evidence.confidence_interval_min\\\"></div><div class=\\\"form-group col-sm-6\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Ratio Type</label><ui-select ng-model=\\\"risk_evidence.ratio_type\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select ratio type\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"type.value as type in ratiotypes\\\"><div ng-bind-html=\\\"type.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select></div><div class=\\\"form-group col-sm-6\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Confidence Interval Maximum</label> <input type=\\\"number\\\" step=\\\"0.01\\\" class=\\\"form-control\\\" min=\\\"{{risk_evidence.confidence_interval_min||0}}\\\" max=\\\"\\\" ng-model=\\\"risk_evidence.confidence_interval_max\\\"></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Evidence source</label><ui-select on-select=\\\"viewPubmed($item,$model)\\\" class=\\\"ui-select-big-text\\\" ng-model=\\\"risk_evidence.evidence_source\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select evidence source\\\"><div>{{$select.selected.title}}</div><div>{{$select.selected.authors}}</div><div>{{$select.selected.date}}</div></ui-select-match><ui-select-choices repeat=\\\"obj.value as obj in citations | propsFilter: {title: $select.search,authors: $select.search,date: $select.search}\\\"><div class=\\\"ui-select-big-text\\\"><div ng-bind-html=\\\"obj.title | highlight: $select.search\\\"></div><div><small ng-bind-html=\\\"obj.authors | highlight: $select.search\\\"></small></div><div><small ng-bind-html=\\\"obj.date | highlight: $select.search\\\"></small></div></div></ui-select-choices></ui-select></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Adjusted for</label><ui-select multiple=\\\"\\\" tagging=\\\"\\\" tagging-label=\\\"(custom \\'new\\' value)\\\" ng-model=\\\"risk_evidence.adjusted_for\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select values...\\\">{{$item}}</ui-select-match><ui-select-choices repeat=\\\"val in adjusted_for | filter: $select.search\\\"><div ng-bind-html=\\\"val| highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\"><button type=\\\"button\\\" ng-click=\\\"cancelForm()\\\" class=\\\"btn btn-danger\\\">Cancel</button> <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Submit</button></div></form></div><script type=\\\"text/ng-template\\\" id=\\\"newCitationTemplate.html\\\"><carre-element ng-if=\\\"showAddCitation\\\" type=\\\"citation\\\" mode=\\\"create\\\" elem=\\\"{pubmedId:risk_evidence.pubmedId,noPubmed:true}\\\"></carre-element></script><div class=\\\"col-sm-6\\\"><label>Pubmed Id <a href=\\\"\\\" ng-show=\\\"!risk_evidence.evidence_source\\\" popover-is-open=\\\"showAddCitation\\\" popover-placement=\\\"bottom\\\" uib-popover-template=\\\"\\'newCitationTemplate.html\\'\\\" popover-title=\\\"Create a new citation and add it to the collection\\\" class=\\\"btn btn-xs btn-default\\\" ng-click=\\\"\\\">Add to Citations <i class=\\\"fa fa-plus\\\"></i></a></label> <input type=\\\"text\\\" name=\\\"name\\\" placeholder=\\\"Enter pubmed Id\\\" class=\\\"form-control\\\" ng-change=\\\"loadPubmed()\\\" ng-model=\\\"risk_evidence.pubmedId\\\" required=\\\"\\\"><carre-view-pubmed ng-if=\\\"showPubmed\\\" id=\\\"{{risk_evidence.pubmedId}}\\\"></carre-view-pubmed></div></div>\");\n$templateCache.put(\"app/pages/risk_evidences/single/single.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current risk_evidence<pre>{{risk_evidence | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><carre-element-controls carre-id=\\\"{{id}}\\\"></carre-element-controls><carre-element ng-if=\\\"mode\\\" type=\\\"risk_evidence\\\" elem-id=\\\"{{id}}\\\" mode=\\\"{{mode}}\\\" elem=\\\"current\\\"></carre-element></div>\");\n$templateCache.put(\"app/pages/risk_factors/form_component/form.html\",\"<div><form name=\\\"form\\\" novalidate=\\\"\\\" ng-submit=\\\"saveModel()\\\"><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Source risk element</label><ui-select ng-model=\\\"risk_factor.source\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select risk element\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"rl.value as rl in risk_elements | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"rl.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Target risk element</label><ui-select ng-model=\\\"risk_factor.target\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select risk element\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"rl.value as rl in risk_elements | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"rl.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{ \\'has-error\\': form.email.$touched && form.email.$invalid }\\\"><label>Association Type</label><ui-select ng-model=\\\"risk_factor.type\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Select risk association type\\\">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat=\\\"type.value as type in types | propsFilter: {label: $select.search}\\\"><div ng-bind-html=\\\"type.label | highlight: $select.search\\\"></div></ui-select-choices></ui-select><div class=\\\"help-block\\\" ng-messages=\\\"form.email.$error\\\" ng-if=\\\"form.email.$touched\\\"><div ng-messages-include=\\\"messages.html\\\"></div></div></div><div class=\\\"form-group\\\"><button type=\\\"button\\\" ng-click=\\\"cancelForm()\\\" class=\\\"btn btn-danger\\\">Cancel</button> <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Submit</button></div></form></div>\");\n$templateCache.put(\"app/pages/risk_factors/single/single.html\",\"<div uib-collapse=\\\"!main.DEBUG\\\" class=\\\"row\\\"><div class=\\\"col-xs-12\\\">Current risk_factor<pre>{{risk_factor | json}}</pre></div></div><div class=\\\"col-xs-12\\\"><div class=\\\"col-sm-6\\\"><carre-element-controls carre-id=\\\"{{id}}\\\"></carre-element-controls><carre-element type=\\\"risk_factor\\\" elem-id=\\\"{{id}}\\\" mode=\\\"{{mode}}\\\"></carre-element></div><div ng-if=\\\"mode===\\'view\\'\\\" class=\\\"col-sm-6\\\"><carre-graph-risk height=\\\"250\\\" riskid=\\\"id\\\"></carre-graph-risk></div></div><div ng-if=\\\"mode===\\'view\\'\\\" class=\\\"col-xs-12\\\"><h4 class=\\\"page-header\\\">Related risk evidences</h4><div cg-busy=\\\"gridLoading\\\" id=\\\"grid1\\\" ui-grid=\\\"mygrid\\\" ui-grid-pagination=\\\"\\\" ui-grid-selection=\\\"\\\" ui-grid-resize-columns=\\\"\\\" ui-grid-move-columns=\\\"\\\" ui-grid-exporter=\\\"\\\" ui-grid-auto-resize=\\\"\\\" class=\\\"grid\\\"></div></div>\");}]);"],"sourceRoot":"/source/"}